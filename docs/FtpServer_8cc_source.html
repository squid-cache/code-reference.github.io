<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Squid Web Cache: squid/src/servers/FtpServer.cc Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Squid Web Cache<span id="projectnumber">&#160;master</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function() { init_codefold(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('FtpServer_8cc_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">FtpServer.cc</div></div>
</div><!--header-->
<div class="contents">
<a href="FtpServer_8cc.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="comment">/*</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="comment"> * Copyright (C) 1996-2026 The Squid Software Foundation and contributors</span></div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="comment"> *</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="comment"> * Squid software is distributed under GPLv2+ license and includes</span></div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="comment"> * contributions from numerous individuals and organizations.</span></div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="comment"> * Please see the COPYING and CONTRIBUTORS files for details.</span></div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="comment"> */</span></div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span> </div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="comment">/* DEBUG: section 33    Transfer protocol servers */</span></div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span> </div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span><span class="preprocessor">#include &quot;<a class="code" href="squid_8h.html">squid.h</a>&quot;</span></div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="preprocessor">#include &quot;<a class="code" href="FilledChecklist_8h.html">acl/FilledChecklist.h</a>&quot;</span></div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="preprocessor">#include &quot;<a class="code" href="CharacterSet_8h.html">base/CharacterSet.h</a>&quot;</span></div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="preprocessor">#include &quot;<a class="code" href="Raw_8h.html">base/Raw.h</a>&quot;</span></div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span><span class="preprocessor">#include &quot;<a class="code" href="RefCount_8h.html">base/RefCount.h</a>&quot;</span></div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span><span class="preprocessor">#include &quot;<a class="code" href="Subscription_8h.html">base/Subscription.h</a>&quot;</span></div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span><span class="preprocessor">#include &quot;<a class="code" href="client__side__reply_8h.html">client_side_reply.h</a>&quot;</span></div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="preprocessor">#include &quot;<a class="code" href="client__side__request_8h.html">client_side_request.h</a>&quot;</span></div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span><span class="preprocessor">#include &quot;<a class="code" href="clientStream_8h.html">clientStream.h</a>&quot;</span></div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span><span class="preprocessor">#include &quot;<a class="code" href="ConnOpener_8h.html">comm/ConnOpener.h</a>&quot;</span></div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span><span class="preprocessor">#include &quot;<a class="code" href="Read_8h.html">comm/Read.h</a>&quot;</span></div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span><span class="preprocessor">#include &quot;<a class="code" href="TcpAcceptor_8h.html">comm/TcpAcceptor.h</a>&quot;</span></div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span><span class="preprocessor">#include &quot;<a class="code" href="Write_8h.html">comm/Write.h</a>&quot;</span></div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span><span class="preprocessor">#include &quot;<a class="code" href="errorpage_8h.html">errorpage.h</a>&quot;</span></div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span><span class="preprocessor">#include &quot;<a class="code" href="fd_8h.html">fd.h</a>&quot;</span></div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span><span class="preprocessor">#include &quot;<a class="code" href="ftp_2Elements_8h.html">ftp/Elements.h</a>&quot;</span></div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span><span class="preprocessor">#include &quot;<a class="code" href="ftp_2Parsing_8h.html">ftp/Parsing.h</a>&quot;</span></div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span><span class="preprocessor">#include &quot;<a class="code" href="globals_8h.html">globals.h</a>&quot;</span></div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span><span class="preprocessor">#include &quot;<a class="code" href="RequestParser_8h.html">http/one/RequestParser.h</a>&quot;</span></div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span><span class="preprocessor">#include &quot;<a class="code" href="http_2Stream_8h.html">http/Stream.h</a>&quot;</span></div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span><span class="preprocessor">#include &quot;<a class="code" href="HttpHdrCc_8h.html">HttpHdrCc.h</a>&quot;</span></div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span><span class="preprocessor">#include &quot;<a class="code" href="ip_2tools_8h.html">ip/tools.h</a>&quot;</span></div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span><span class="preprocessor">#include &quot;<a class="code" href="FdNotes_8h.html">ipc/FdNotes.h</a>&quot;</span></div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span><span class="preprocessor">#include &quot;<a class="code" href="parser_2Tokenizer_8h.html">parser/Tokenizer.h</a>&quot;</span></div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span><span class="preprocessor">#include &quot;<a class="code" href="servers_2forward_8h.html">servers/forward.h</a>&quot;</span></div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span><span class="preprocessor">#include &quot;<a class="code" href="FtpServer_8h.html">servers/FtpServer.h</a>&quot;</span></div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span><span class="preprocessor">#include &quot;<a class="code" href="SquidConfig_8h.html">SquidConfig.h</a>&quot;</span></div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span><span class="preprocessor">#include &quot;<a class="code" href="StatCounters_8h.html">StatCounters.h</a>&quot;</span></div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span><span class="preprocessor">#include &quot;<a class="code" href="tools_8h.html">tools.h</a>&quot;</span></div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span> </div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span><span class="preprocessor">#include &lt;set&gt;</span></div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span><span class="preprocessor">#include &lt;map&gt;</span></div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span> </div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno"><a class="line" href="FtpServer_8cc.html#a051b5ed2ffe3a2751f1c37981cac2703">   44</a></span><a class="code hl_define" href="cbdata_8h.html#ad60a7b19cb747d7868f3b241c67f77b9">CBDATA_NAMESPACED_CLASS_INIT</a>(<a class="code hl_namespace" href="namespaceFtp.html">Ftp</a>, <a class="code hl_class" href="classServer.html">Server</a>);</div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span> </div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span><span class="keyword">namespace </span><a class="code hl_namespace" href="namespaceFtp.html">Ftp</a></div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span>{</div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code hl_function" href="namespaceFtp.html#afbe492e82e3511179f2af6c59c2eb5b8">PrintReply</a>(<a class="code hl_class" href="classMemBuf.html">MemBuf</a> &amp;mb, <span class="keyword">const</span> <a class="code hl_class" href="classHttpReply.html">HttpReply</a> *reply, <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> prefix = <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code hl_function" href="namespaceFtp.html#a14f2935b10878a54a2cc5e6621b3e946">SupportedCommand</a>(<span class="keyword">const</span> <a class="code hl_class" href="classSBuf.html">SBuf</a> &amp;name);</div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code hl_function" href="namespaceFtp.html#a970f9156aff8feb9e9642c20c5fab8b8">CommandHasPathParameter</a>(<span class="keyword">const</span> <a class="code hl_class" href="classSBuf.html">SBuf</a> &amp;cmd);</div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span>};</div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span> </div>
<div class="foldopen" id="foldopen00053" data-start="{" data-end="}">
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#a74fc75d405fb33c1ee941b3849cfb6e2">   53</a></span><a class="code hl_function" href="classFtp_1_1Server.html#a74fc75d405fb33c1ee941b3849cfb6e2">Ftp::Server::Server</a>(<span class="keyword">const</span> <a class="code hl_class" href="classRefCount.html">MasterXaction::Pointer</a> &amp;xact):</div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span>    <a class="code hl_class" href="classAsyncJob.html">AsyncJob</a>(<span class="stringliteral">&quot;Ftp::Server&quot;</span>),</div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span>    <a class="code hl_class" href="classConnStateData.html">ConnStateData</a>(xact),</div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span>    master(new <a class="code hl_class" href="classFtp_1_1MasterState.html">MasterState</a>),</div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span>    uri(),</div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span>    host(),</div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span>    gotEpsvAll(false),</div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span>    onDataAcceptCall(),</div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span>    dataListenConn(),</div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span>    dataConn(),</div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span>    uploadAvailSize(0),</div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>    listener(),</div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>    dataConnWait(),</div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>    reader(),</div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span>    waitingForOrigin(false),</div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>    originDataDownloadAbortedOnError(false)</div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span>{</div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span>    <a class="code hl_variable" href="classConnStateData.html#a7f95d063c54bfa6618b5d45869b5c21b">flags</a>.<a class="code hl_variable" href="classConnStateData.html#ac049eac9adf044f1310c48e058778f6d">readMore</a> = <span class="keyword">false</span>; <span class="comment">// we need to announce ourselves first</span></div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span>    *<a class="code hl_variable" href="classFtp_1_1Server.html#a93a3abbbf6ec0099007957bf5d3fccdf">uploadBuf</a> = 0;</div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span>}</div>
</div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span> </div>
<div class="foldopen" id="foldopen00074" data-start="{" data-end="}">
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#af575d2e7efe3b7130dcbffc2c163f5e6">   74</a></span><a class="code hl_function" href="classFtp_1_1Server.html#af575d2e7efe3b7130dcbffc2c163f5e6">Ftp::Server::~Server</a>()</div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span>{</div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>    closeDataConnection();</div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span>}</div>
</div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span> </div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span><span class="keywordtype">int</span></div>
<div class="foldopen" id="foldopen00080" data-start="{" data-end="}">
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#ade79635001afef68c7936aae16267f05">   80</a></span><a class="code hl_function" href="classFtp_1_1Server.html#ade79635001afef68c7936aae16267f05">Ftp::Server::pipelinePrefetchMax</a>()<span class="keyword"> const</span></div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span><span class="keyword"></span>{</div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span>    <span class="keywordflow">return</span> 0; <span class="comment">// no support for concurrent FTP requests</span></div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span>}</div>
</div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span> </div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>time_t</div>
<div class="foldopen" id="foldopen00086" data-start="{" data-end="}">
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#a73eaed1cdcd71f4611166021f2c13c10">   86</a></span><a class="code hl_function" href="classFtp_1_1Server.html#a73eaed1cdcd71f4611166021f2c13c10">Ftp::Server::idleTimeout</a>()<span class="keyword"> const</span></div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span><span class="keyword"></span>{</div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="SquidConfig_8cc.html#a75b136e6a1eef61424d84596a404aafe">Config</a>.<a class="code hl_variable" href="classSquidConfig.html#a616f6fb80c58175d607c035c74744b17">Timeout</a>.<a class="code hl_variable" href="classSquidConfig.html#a43c9fbdbbc5e8378236fea4989ff1981">ftpClientIdle</a>;</div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span>}</div>
</div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span> </div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00092" data-start="{" data-end="}">
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#a836442f1bc5870bde3d986e77d19b3aa">   92</a></span><a class="code hl_function" href="classFtp_1_1Server.html#a836442f1bc5870bde3d986e77d19b3aa">Ftp::Server::start</a>()</div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>{</div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>    <a class="code hl_function" href="classConnStateData.html#a4cbbc46289185d9b973594b11f7649fa">ConnStateData::start</a>();</div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span> </div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>    <span class="keywordflow">if</span> (transparent()) {</div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>        <span class="keywordtype">char</span> buf[<a class="code hl_define" href="ip_2forward_8h.html#a28806a9f06b4d32dab73b27053f10494">MAX_IPSTRLEN</a>];</div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>        clientConnection-&gt;local.toUrl(buf, <a class="code hl_define" href="ip_2forward_8h.html#a28806a9f06b4d32dab73b27053f10494">MAX_IPSTRLEN</a>);</div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>        host = buf;</div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span>        calcUri(<span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;FTP transparent URL: &quot;</span> &lt;&lt; uri);</div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span>    }</div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span> </div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>    writeEarlyReply(220, <span class="stringliteral">&quot;Service ready&quot;</span>);</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>}</div>
</div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span> </div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00109" data-start="{" data-end="}">
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#a448ac7f18ac63bd5ebf64bafd9fe20da">  109</a></span><a class="code hl_function" href="classFtp_1_1Server.html#a448ac7f18ac63bd5ebf64bafd9fe20da">Ftp::Server::maybeReadUploadData</a>()</div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span>{</div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span>    <span class="keywordflow">if</span> (reader != <span class="keyword">nullptr</span>)</div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span> </div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span>    <span class="keyword">const</span> <span class="keywordtype">size_t</span> availSpace = <span class="keyword">sizeof</span>(uploadBuf) - uploadAvailSize;</div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span>    <span class="keywordflow">if</span> (availSpace &lt;= 0)</div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span> </div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 4, dataConn &lt;&lt; <span class="stringliteral">&quot;: reading FTP data...&quot;</span>);</div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span> </div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span>    <span class="keyword">typedef</span> <a class="code hl_class" href="classCommCbMemFunT.html">CommCbMemFunT&lt;Server, CommIoCbParams&gt;</a> Dialer;</div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span>    reader = <a class="code hl_define" href="AsyncJobCalls_8h.html#a3412f4fa1246aee4d4ac46a143075e03">JobCallback</a>(33, 5, Dialer, <span class="keyword">this</span>, <a class="code hl_function" href="classFtp_1_1Server.html#aeb55d738404a6a927fdd9f2704c808f5">Ftp::Server::readUploadData</a>);</div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>    <a class="code hl_function" href="Read_8h.html#a172f652cee9cf7837348c4a3bb6599f7">comm_read</a>(dataConn, uploadBuf + uploadAvailSize, availSpace,</div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>              reader);</div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>}</div>
</div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span> </div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00128" data-start="{" data-end="}">
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#ae058b6cf529fdbfb29fdea2217e43011">  128</a></span><a class="code hl_function" href="classFtp_1_1Server.html#ae058b6cf529fdbfb29fdea2217e43011">Ftp::Server::doProcessRequest</a>()</div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span>{</div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span>    <span class="comment">// zero pipelinePrefetchMax() ensures that there is only parsed request</span></div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span>    <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(pipeline.count() == 1);</div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span>    <a class="code hl_class" href="classRefCount.html">Http::StreamPointer</a> context = pipeline.front();</div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>    <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(context != <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span> </div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span>    <a class="code hl_class" href="classClientHttpRequest.html">ClientHttpRequest</a> *<span class="keyword">const</span> http = context-&gt;http;</div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(http != <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span> </div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span>    <a class="code hl_class" href="classHttpRequest.html">HttpRequest</a> *<span class="keyword">const</span> request = http-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#a2becc63f591bbc0b40542099c1bb05a9">request</a>;</div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>    <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(http-&gt;<a class="code hl_function" href="classClientHttpRequest.html#ac8c0f73794781ce53acf6083e0077f34">storeEntry</a>() || request);</div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span>    <span class="keyword">const</span> <span class="keywordtype">bool</span> mayForward = !http-&gt;<a class="code hl_function" href="classClientHttpRequest.html#ac8c0f73794781ce53acf6083e0077f34">storeEntry</a>() &amp;&amp; handleRequest(request);</div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span> </div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>    <span class="keywordflow">if</span> (http-&gt;<a class="code hl_function" href="classClientHttpRequest.html#ac8c0f73794781ce53acf6083e0077f34">storeEntry</a>() != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 4, <span class="stringliteral">&quot;got an immediate response&quot;</span>);</div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>        <a class="code hl_function" href="client__side_8cc.html#aa598a3822a54b412815630007ed6982b">clientSetKeepaliveFlag</a>(http);</div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>        context-&gt;pullData();</div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mayForward) {</div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 4, <span class="stringliteral">&quot;forwarding request to server side&quot;</span>);</div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span>        <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(http-&gt;<a class="code hl_function" href="classClientHttpRequest.html#ac8c0f73794781ce53acf6083e0077f34">storeEntry</a>() == <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>        <a class="code hl_function" href="client__side_8cc.html#a543c6b42543c68733190d18e2a933a58">clientProcessRequest</a>(<span class="keyword">this</span>, <a class="code hl_class" href="classRefCount.html">Http1::RequestParserPointer</a>(), context.<a class="code hl_function" href="classRefCount.html#a9f2168c1df4a4ab6b7931425d85c37f0">getRaw</a>());</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 4, <span class="stringliteral">&quot;will resume processing later&quot;</span>);</div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>    }</div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>}</div>
</div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span> </div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00156" data-start="{" data-end="}">
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#a6c92190199455f65a55e459ad42821be">  156</a></span><a class="code hl_function" href="classFtp_1_1Server.html#a6c92190199455f65a55e459ad42821be">Ftp::Server::processParsedRequest</a>(<a class="code hl_class" href="classRefCount.html">Http::StreamPointer</a> &amp;)</div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span>{</div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span>    <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(pipeline.count() == 1);</div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span> </div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span>    <span class="comment">// Process FTP request asynchronously to make sure FTP</span></div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>    <span class="comment">// data connection accept callback is fired first.</span></div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>    <a class="code hl_define" href="AsyncJobCalls_8h.html#a3841bf50f853d9ba9de4309dcc96e72f">CallJobHere</a>(33, 4, <a class="code hl_class" href="classCbcPointer.html">CbcPointer&lt;Server&gt;</a>(<span class="keyword">this</span>),</div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span>                <a class="code hl_class" href="classFtp_1_1Server.html">Ftp::Server</a>, doProcessRequest);</div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span>}</div>
</div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span> </div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00168" data-start="{" data-end="}">
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#aeb55d738404a6a927fdd9f2704c808f5">  168</a></span><a class="code hl_function" href="classFtp_1_1Server.html#aeb55d738404a6a927fdd9f2704c808f5">Ftp::Server::readUploadData</a>(<span class="keyword">const</span> <a class="code hl_class" href="classCommIoCbParams.html">CommIoCbParams</a> &amp;io)</div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>{</div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, io.<a class="code hl_variable" href="classCommCommonCbParams.html#acbcbe42d3ccd12c6de3b1f3d1d7c4bc3">conn</a> &lt;&lt; <span class="stringliteral">&quot; size &quot;</span> &lt;&lt; io.<a class="code hl_variable" href="classCommIoCbParams.html#a34e29cc8266e4126764a5a6077859542">size</a>);</div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>    <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(reader != <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>    reader = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span> </div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(<a class="code hl_function" href="namespaceComm.html#a91f0a0e22e74a7ad6f7c44c137c6f005">Comm::IsConnOpen</a>(dataConn));</div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(io.<a class="code hl_variable" href="classCommCommonCbParams.html#acbcbe42d3ccd12c6de3b1f3d1d7c4bc3">conn</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a8e53f4d6fd38545947a5aac6efb98fca">fd</a> == dataConn-&gt;fd);</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span> </div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>    <span class="keywordflow">if</span> (io.<a class="code hl_variable" href="classCommCommonCbParams.html#aaa1b70c6ff254ac72ac1503fc158df7e">flag</a> == <a class="code hl_enumvalue" href="namespaceComm.html#a9d8d4f4a5745b975c5785998e4246050a2d02cf4ed31f765e18f4d8474ede4e24">Comm::OK</a> &amp;&amp; bodyPipe != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>        <span class="keywordflow">if</span> (io.<a class="code hl_variable" href="classCommIoCbParams.html#a34e29cc8266e4126764a5a6077859542">size</a> &gt; 0) {</div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>            <a class="code hl_variable" href="StatCounters_8cc.html#a97511f6512b50279a2cd9cf1446060d7">statCounter</a>.<a class="code hl_variable" href="classStatCounters.html#ae0515f9863b6255630e2563b01f8ca43">client_http</a>.<a class="code hl_variable" href="classStatCounters.html#aa88b8ad0eef8be950212966821e49b49">kbytes_in</a> += io.<a class="code hl_variable" href="classCommIoCbParams.html#a34e29cc8266e4126764a5a6077859542">size</a>;</div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span> </div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span>            <span class="keywordtype">char</span> *<span class="keyword">const</span> current_buf = uploadBuf + uploadAvailSize;</div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>            <span class="keywordflow">if</span> (io.<a class="code hl_variable" href="classCommIoCbParams.html#a1ca0b2967f5e2a60cef9ac296ba9b9c7">buf</a> != current_buf)</div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span>                memmove(current_buf, io.<a class="code hl_variable" href="classCommIoCbParams.html#a1ca0b2967f5e2a60cef9ac296ba9b9c7">buf</a>, io.<a class="code hl_variable" href="classCommIoCbParams.html#a34e29cc8266e4126764a5a6077859542">size</a>);</div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>            uploadAvailSize += io.<a class="code hl_variable" href="classCommIoCbParams.html#a34e29cc8266e4126764a5a6077859542">size</a>;</div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>            shovelUploadData();</div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (io.<a class="code hl_variable" href="classCommIoCbParams.html#a34e29cc8266e4126764a5a6077859542">size</a> == 0) {</div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span>            <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, io.<a class="code hl_variable" href="classCommCommonCbParams.html#acbcbe42d3ccd12c6de3b1f3d1d7c4bc3">conn</a> &lt;&lt; <span class="stringliteral">&quot; closed&quot;</span>);</div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span>            closeDataConnection();</div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span>            <span class="keywordflow">if</span> (uploadAvailSize &lt;= 0)</div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span>                finishDechunkingRequest(<span class="keyword">true</span>);</div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>        }</div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>    } <span class="keywordflow">else</span> { <span class="comment">// not Comm::Flags::OK or unexpected read</span></div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, io.<a class="code hl_variable" href="classCommCommonCbParams.html#acbcbe42d3ccd12c6de3b1f3d1d7c4bc3">conn</a> &lt;&lt; <span class="stringliteral">&quot; closed&quot;</span>);</div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>        closeDataConnection();</div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>        finishDechunkingRequest(<span class="keyword">false</span>);</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>    }</div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span> </div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span>}</div>
</div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span> </div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00202" data-start="{" data-end="}">
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#ad45a60163911e766785a77148c25566a">  202</a></span><a class="code hl_function" href="classFtp_1_1Server.html#ad45a60163911e766785a77148c25566a">Ftp::Server::shovelUploadData</a>()</div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>{</div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(bodyPipe != <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span> </div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;handling FTP request data for &quot;</span> &lt;&lt; clientConnection);</div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span>    <span class="keyword">const</span> <span class="keywordtype">size_t</span> putSize = bodyPipe-&gt;putMoreData(uploadBuf,</div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span>                           uploadAvailSize);</div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span>    <span class="keywordflow">if</span> (putSize &gt; 0) {</div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span>        uploadAvailSize -= putSize;</div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span>        <span class="keywordflow">if</span> (uploadAvailSize &gt; 0)</div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span>            memmove(uploadBuf, uploadBuf + putSize, uploadAvailSize);</div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>    }</div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span> </div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="namespaceComm.html#a91f0a0e22e74a7ad6f7c44c137c6f005">Comm::IsConnOpen</a>(dataConn))</div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>        maybeReadUploadData();</div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (uploadAvailSize &lt;= 0)</div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>        finishDechunkingRequest(<span class="keyword">true</span>);</div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>}</div>
</div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span> </div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00222" data-start="{" data-end="}">
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#acd6efb656e34a35cafb6368eb748d3a9">  222</a></span><a class="code hl_function" href="classFtp_1_1Server.html#acd6efb656e34a35cafb6368eb748d3a9">Ftp::Server::noteMoreBodySpaceAvailable</a>(<a class="code hl_class" href="classRefCount.html">BodyPipe::Pointer</a>)</div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>{</div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="comm_8cc.html#a8464d2ca5f1d7e8046880d95fe30873a">isOpen</a>()) <span class="comment">// if we are closing, nothing to do</span></div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span> </div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>    shovelUploadData();</div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>}</div>
</div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span> </div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00231" data-start="{" data-end="}">
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#a6cff7ff003b533336e5ed9e030d23dc2">  231</a></span><a class="code hl_function" href="classFtp_1_1Server.html#a6cff7ff003b533336e5ed9e030d23dc2">Ftp::Server::noteBodyConsumerAborted</a>(<a class="code hl_class" href="classRefCount.html">BodyPipe::Pointer</a> ptr)</div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span>{</div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="comm_8cc.html#a8464d2ca5f1d7e8046880d95fe30873a">isOpen</a>()) <span class="comment">// if we are closing, nothing to do</span></div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span> </div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>    <a class="code hl_function" href="classConnStateData.html#ae41a2f60162e48d848dcb535fa1ab2ff">ConnStateData::noteBodyConsumerAborted</a>(ptr);</div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>    closeDataConnection();</div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span>}</div>
</div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span> </div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00242" data-start="{" data-end="}">
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#a415ec5a03d629f95a7dc0b3dd9c830d6">  242</a></span><a class="code hl_function" href="classFtp_1_1Server.html#a415ec5a03d629f95a7dc0b3dd9c830d6">Ftp::Server::AcceptCtrlConnection</a>(<span class="keyword">const</span> <a class="code hl_class" href="classCommAcceptCbParams.html">CommAcceptCbParams</a> &amp;params)</div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>{</div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span>    <a class="code hl_define" href="Assure_8h.html#a1fcca4cd6cfc3b9f835aa3652eb0c2f5">Assure</a>(params.<a class="code hl_variable" href="classCommAcceptCbParams.html#a42535776245356fa787da0705fc46f40">port</a>);</div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span> </div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span>    <span class="comment">// NP: it is possible the port was reconfigured when the call or accept() was queued.</span></div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span> </div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span>    <span class="keywordflow">if</span> (params.<a class="code hl_variable" href="classCommCommonCbParams.html#aaa1b70c6ff254ac72ac1503fc158df7e">flag</a> != <a class="code hl_enumvalue" href="namespaceComm.html#a9d8d4f4a5745b975c5785998e4246050a2d02cf4ed31f765e18f4d8474ede4e24">Comm::OK</a>) {</div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span>        <span class="comment">// Its possible the call was still queued when the client disconnected</span></div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 2, params.<a class="code hl_variable" href="classCommAcceptCbParams.html#a42535776245356fa787da0705fc46f40">port</a>-&gt;listenConn &lt;&lt; <span class="stringliteral">&quot;: FTP accept failure: &quot;</span> &lt;&lt; <a class="code hl_function" href="xstrerror_8cc.html#a3d643f764de4776e5489d4eb55a99849">xstrerr</a>(params.<a class="code hl_variable" href="classCommCommonCbParams.html#a5376946442719c10cc9307045e09460d">xerrno</a>));</div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span>    }</div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span> </div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 4, params.<a class="code hl_variable" href="classCommCommonCbParams.html#acbcbe42d3ccd12c6de3b1f3d1d7c4bc3">conn</a> &lt;&lt; <span class="stringliteral">&quot;: accepted&quot;</span>);</div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>    <a class="code hl_function" href="fd_8cc.html#a397dc4e5e5cf728d8f1a48b32cb4e60d">fd_note</a>(params.<a class="code hl_variable" href="classCommCommonCbParams.html#acbcbe42d3ccd12c6de3b1f3d1d7c4bc3">conn</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a8e53f4d6fd38545947a5aac6efb98fca">fd</a>, <span class="stringliteral">&quot;client ftp connect&quot;</span>);</div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span> </div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span>    <span class="keyword">const</span> <span class="keyword">auto</span> xact = <a class="code hl_function" href="classMasterXaction.html#af3cb33c92de57dbb4f9b5a0bf5488ad4">MasterXaction::MakePortful</a>(params.<a class="code hl_variable" href="classCommAcceptCbParams.html#a42535776245356fa787da0705fc46f40">port</a>);</div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span>    xact-&gt;tcpClient = params.<a class="code hl_variable" href="classCommCommonCbParams.html#acbcbe42d3ccd12c6de3b1f3d1d7c4bc3">conn</a>;</div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span> </div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>    <a class="code hl_function" href="classAsyncJob.html#a1dd42e9842d751193268966d4e0de2fa">AsyncJob::Start</a>(<span class="keyword">new</span> <a class="code hl_class" href="classFtp_1_1Server.html">Server</a>(xact));</div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>    <span class="comment">// XXX: do not abandon the MasterXaction object</span></div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>}</div>
</div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span> </div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00265" data-start="{" data-end="}">
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno"><a class="line" href="namespaceFtp.html#ae2b3b88ec5c7af470746a1658d7434f3">  265</a></span><a class="code hl_function" href="namespaceFtp.html#ae2b3b88ec5c7af470746a1658d7434f3">Ftp::StartListening</a>()</div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span>{</div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>    <span class="keyword">const</span> <span class="keyword">auto</span> savedContext = <a class="code hl_function" href="classCodeContext.html#a13251c00d03b5a9cb9f3b164f0154969">CodeContext::Current</a>();</div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span>    <span class="keywordflow">for</span> (<a class="code hl_class" href="classRefCount.html">AnyP::PortCfgPointer</a> s = <a class="code hl_variable" href="PortCfg_8cc.html#a31b693c418c2d271a30c0d70c2fbb170">FtpPortList</a>; s != <span class="keyword">nullptr</span>; s = s-&gt;next) {</div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span>        <a class="code hl_function" href="classCodeContext.html#aeed1567dd2fb1c97eb3fa3f10df4622e">CodeContext::Reset</a>(s);</div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span>        <span class="keywordflow">if</span> (<a class="code hl_define" href="PortCfg_8h.html#ad26669cbef20c833f401d0c236dfa54b">MAXTCPLISTENPORTS</a> == <a class="code hl_variable" href="PortCfg_8cc.html#a20da400521f3fa3eb2de9df0eb5f96fc">NHttpSockets</a>) {</div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>            <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(1, <a class="code hl_define" href="debug_2Stream_8h.html#ad1f6f001d275799243ee96d0b1519d3a">DBG_IMPORTANT</a>, <span class="stringliteral">&quot;Ignoring ftp_port lines exceeding the&quot;</span> &lt;&lt;</div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span>                   <span class="stringliteral">&quot; limit of &quot;</span> &lt;&lt; <a class="code hl_define" href="PortCfg_8h.html#ad26669cbef20c833f401d0c236dfa54b">MAXTCPLISTENPORTS</a> &lt;&lt; <span class="stringliteral">&quot; ports.&quot;</span>);</div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span>        }</div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span> </div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span>        <span class="comment">// direct new connections accepted by listenConn to Accept()</span></div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span>        <span class="keyword">typedef</span> <a class="code hl_class" href="classCommCbFunPtrCallT.html">CommCbFunPtrCallT&lt;CommAcceptCbPtrFun&gt;</a> AcceptCall;</div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span>        <a class="code hl_class" href="classRefCount.html">RefCount&lt;AcceptCall&gt;</a> subCall = <a class="code hl_function" href="CommCalls_8h.html#a7e143fa246c3e54c90fa8d20b390b88d">commCbCall</a>(5, 5, <span class="stringliteral">&quot;Ftp::Server::AcceptCtrlConnection&quot;</span>,</div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span>                                       <a class="code hl_class" href="classCommAcceptCbPtrFun.html">CommAcceptCbPtrFun</a>(<a class="code hl_function" href="classFtp_1_1Server.html#a415ec5a03d629f95a7dc0b3dd9c830d6">Ftp::Server::AcceptCtrlConnection</a>,</div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span>                                               <a class="code hl_class" href="classCommAcceptCbParams.html">CommAcceptCbParams</a>(<span class="keyword">nullptr</span>)));</div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span>        <a class="code hl_function" href="client__side_8cc.html#ad4b535b12e4c55b5763c6644d0e40a6e">clientStartListeningOn</a>(s, subCall, <a class="code hl_enumvalue" href="namespaceIpc.html#a08603c9424a847b7951bb043ed92c6d7a94a6de559e17ce534c152883d7b58663">Ipc::fdnFtpSocket</a>);</div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span>    }</div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span>    <a class="code hl_function" href="classCodeContext.html#aeed1567dd2fb1c97eb3fa3f10df4622e">CodeContext::Reset</a>(savedContext);</div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span>}</div>
</div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span> </div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00287" data-start="{" data-end="}">
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno"><a class="line" href="namespaceFtp.html#adf377404cef36010cd7e17ec7b5a8a87">  287</a></span><a class="code hl_function" href="namespaceFtp.html#adf377404cef36010cd7e17ec7b5a8a87">Ftp::StopListening</a>()</div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span>{</div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span>    <span class="keyword">const</span> <span class="keyword">auto</span> savedContext = <a class="code hl_function" href="classCodeContext.html#a13251c00d03b5a9cb9f3b164f0154969">CodeContext::Current</a>();</div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span>    <span class="keywordflow">for</span> (<a class="code hl_class" href="classRefCount.html">AnyP::PortCfgPointer</a> s = <a class="code hl_variable" href="PortCfg_8cc.html#a31b693c418c2d271a30c0d70c2fbb170">FtpPortList</a>; s != <span class="keyword">nullptr</span>; s = s-&gt;next) {</div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span>        <a class="code hl_function" href="classCodeContext.html#aeed1567dd2fb1c97eb3fa3f10df4622e">CodeContext::Reset</a>(s);</div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span>        <span class="keywordflow">if</span> (s-&gt;listenConn != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span>            <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(1, <a class="code hl_define" href="debug_2Stream_8h.html#ad1f6f001d275799243ee96d0b1519d3a">DBG_IMPORTANT</a>, <span class="stringliteral">&quot;Closing FTP port &quot;</span> &lt;&lt; s-&gt;listenConn-&gt;local);</div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span>            s-&gt;listenConn-&gt;close();</div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span>            s-&gt;listenConn = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span>        }</div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>    }</div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span>    <a class="code hl_function" href="classCodeContext.html#aeed1567dd2fb1c97eb3fa3f10df4622e">CodeContext::Reset</a>(savedContext);</div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span>}</div>
</div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span> </div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00302" data-start="{" data-end="}">
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#a8e274e401beeaa3b2f18c9f78b5cac42">  302</a></span><a class="code hl_function" href="classFtp_1_1Server.html#a8e274e401beeaa3b2f18c9f78b5cac42">Ftp::Server::notePeerConnection</a>(<a class="code hl_class" href="classRefCount.html">Comm::ConnectionPointer</a> conn)</div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span>{</div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span>    <span class="comment">// find request</span></div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span>    <a class="code hl_class" href="classRefCount.html">Http::StreamPointer</a> context = pipeline.front();</div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span>    <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(context != <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span>    <a class="code hl_class" href="classClientHttpRequest.html">ClientHttpRequest</a> *<span class="keyword">const</span> http = context-&gt;http;</div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span>    <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(http != <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span>    <a class="code hl_class" href="classHttpRequest.html">HttpRequest</a> *<span class="keyword">const</span> request = http-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#a2becc63f591bbc0b40542099c1bb05a9">request</a>;</div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>    <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(request != <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span>    <span class="comment">// make FTP peer connection exclusive to our request</span></div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span>    pinBusyConnection(conn, request);</div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span>}</div>
</div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span> </div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00316" data-start="{" data-end="}">
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#a7443373c03f2b2f3a9846f12105d305b">  316</a></span><a class="code hl_function" href="classFtp_1_1Server.html#a7443373c03f2b2f3a9846f12105d305b">Ftp::Server::clientPinnedConnectionClosed</a>(<span class="keyword">const</span> <a class="code hl_class" href="classCommCloseCbParams.html">CommCloseCbParams</a> &amp;io)</div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span>{</div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span>    <a class="code hl_function" href="classConnStateData.html#a17f5c3c2de993a7edcf465054e08d8de">ConnStateData::clientPinnedConnectionClosed</a>(io);</div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span> </div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span>    <span class="comment">// TODO: Keep the control connection open after fixing the reset</span></div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span>    <span class="comment">// problem below</span></div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="namespaceComm.html#a91f0a0e22e74a7ad6f7c44c137c6f005">Comm::IsConnOpen</a>(clientConnection))</div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span>        clientConnection-&gt;close();</div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span> </div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span>    <span class="comment">// TODO: If the server control connection is gone, reset state to login</span></div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span>    <span class="comment">// again. Resetting login alone is not enough: FtpRelay::sendCommand() will</span></div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span>    <span class="comment">// not re-login because FtpRelay::serverState() is not going to be</span></div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span>    <span class="comment">// fssConnected. Calling resetLogin() alone is also harmful because</span></div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span>    <span class="comment">// it does not reset correctly the client-to-squid control connection (eg</span></div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span>    <span class="comment">// respond if required with an error code, in all cases)</span></div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span>    <span class="comment">// resetLogin(&quot;control connection closure&quot;);</span></div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span>}</div>
</div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span> </div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00336" data-start="{" data-end="}">
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#a6c743f785f963e6b8d77a47a65a39ff4">  336</a></span><a class="code hl_function" href="classFtp_1_1Server.html#a6c743f785f963e6b8d77a47a65a39ff4">Ftp::Server::resetLogin</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *reason)</div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span>{</div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;will need to re-login due to &quot;</span> &lt;&lt; reason);</div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span>    master-&gt;clientReadGreeting = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span>    changeState(<a class="code hl_enumvalue" href="namespaceFtp.html#a56abcf0499ca5d50f20f9ce02525124eab7bb00cd04b240b0fc4554117f7d226b">fssBegin</a>, reason);</div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span>}</div>
</div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span> </div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00345" data-start="{" data-end="}">
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#a0545b68871f07591508658821e2fe756">  345</a></span><a class="code hl_function" href="classFtp_1_1Server.html#a0545b68871f07591508658821e2fe756">Ftp::Server::calcUri</a>(<span class="keyword">const</span> <a class="code hl_class" href="classSBuf.html">SBuf</a> *file)</div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span>{</div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span>    <span class="comment">// TODO: fill a class AnyP::Uri instead of string</span></div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span>    uri = <span class="stringliteral">&quot;ftp://&quot;</span>;</div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span>    uri.append(host);</div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="eDirectory_2ldap__backend_8cc.html#a63c89c04d1feae07ca35558055155ffb">port</a>-&gt;ftp_track_dirs &amp;&amp; master-&gt;workingDir.length()) {</div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span>        <span class="keywordflow">if</span> (master-&gt;workingDir[0] != <span class="charliteral">&#39;/&#39;</span>)</div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span>            uri.append(<span class="stringliteral">&quot;/&quot;</span>, 1);</div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span>        uri.append(master-&gt;workingDir);</div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span>    }</div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span> </div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span>    <span class="keywordflow">if</span> (uri[uri.length() - 1] != <span class="charliteral">&#39;/&#39;</span>)</div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span>        uri.append(<span class="stringliteral">&quot;/&quot;</span>, 1);</div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span> </div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="eDirectory_2ldap__backend_8cc.html#a63c89c04d1feae07ca35558055155ffb">port</a>-&gt;ftp_track_dirs &amp;&amp; file) {</div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span>        <span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classCharacterSet.html">CharacterSet</a> Slash(<span class="stringliteral">&quot;/&quot;</span>, <span class="stringliteral">&quot;/&quot;</span>);</div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span>        <a class="code hl_class" href="classParser_1_1Tokenizer.html">Parser::Tokenizer</a> <a class="code hl_struct" href="structtok.html">tok</a>(*file);</div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span>        <a class="code hl_struct" href="structtok.html">tok</a>.skipAll(Slash);</div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span>        uri.append(<a class="code hl_struct" href="structtok.html">tok</a>.remaining());</div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span>    }</div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span>}</div>
</div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span> </div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span></div>
<div class="foldopen" id="foldopen00370" data-start="{" data-end="}">
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#ad801a22938549c5a29b2d9958374d23a">  370</a></span><a class="code hl_function" href="classFtp_1_1Server.html#ad801a22938549c5a29b2d9958374d23a">Ftp::Server::listenForDataConnection</a>()</div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span>{</div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span>    closeDataConnection();</div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span> </div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span>    <a class="code hl_class" href="classRefCount.html">Comm::ConnectionPointer</a> conn = <span class="keyword">new</span> <a class="code hl_class" href="classComm_1_1Connection.html">Comm::Connection</a>;</div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span>    conn-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a31fb1758ce5a186c27710515b69aa94e">flags</a> = <a class="code hl_define" href="Connection_8h.html#aadad9238e4d0e913034b3dfc22f8ba44">COMM_NONBLOCKING</a>;</div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span>    conn-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a84e6544b719c79cbecbc7d2a891fbcb2">local</a> = transparent() ? <a class="code hl_variable" href="eDirectory_2ldap__backend_8cc.html#a63c89c04d1feae07ca35558055155ffb">port</a>-&gt;s : clientConnection-&gt;local;</div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span>    conn-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a84e6544b719c79cbecbc7d2a891fbcb2">local</a>.<a class="code hl_function" href="classIp_1_1Address.html#aeea3c669850f18acd2efcd336fcf2438">port</a>(0);</div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> note = uri.c_str();</div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span>    <a class="code hl_function" href="comm_8cc.html#a779138fc791bf0190157d0fb368fb790">comm_open_listener</a>(SOCK_STREAM, IPPROTO_TCP, conn, note);</div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="namespaceComm.html#a91f0a0e22e74a7ad6f7c44c137c6f005">Comm::IsConnOpen</a>(conn)) {</div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(5, <a class="code hl_define" href="debug_2Stream_8h.html#af0ecf487aee4d8ff164c0f40e71c5150">DBG_CRITICAL</a>, <span class="stringliteral">&quot;ERROR: comm_open_listener failed for FTP data: &quot;</span> &lt;&lt;</div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span>               conn-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a84e6544b719c79cbecbc7d2a891fbcb2">local</a> &lt;&lt; <span class="stringliteral">&quot; error: &quot;</span> &lt;&lt; errno);</div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span>        writeCustomReply(451, <span class="stringliteral">&quot;Internal error&quot;</span>);</div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span>    }</div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span> </div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span>    <span class="keyword">typedef</span> <a class="code hl_class" href="classCommCbMemFunT.html">CommCbMemFunT&lt;Server, CommAcceptCbParams&gt;</a> AcceptDialer;</div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span>    <span class="keyword">typedef</span> <a class="code hl_class" href="classAsyncCallT.html">AsyncCallT&lt;AcceptDialer&gt;</a> AcceptCall;</div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span>    <span class="keyword">const</span> <span class="keyword">auto</span> call = <a class="code hl_define" href="AsyncJobCalls_8h.html#a3412f4fa1246aee4d4ac46a143075e03">JobCallback</a>(5, 5, AcceptDialer, <span class="keyword">this</span>, <a class="code hl_function" href="classFtp_1_1Server.html#a587c2c7812b6594e676b91e90d5deaa8">Ftp::Server::acceptDataConnection</a>);</div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span>    <a class="code hl_class" href="classRefCount.html">Subscription::Pointer</a> sub = <span class="keyword">new</span> <a class="code hl_class" href="classCallSubscription.html">CallSubscription&lt;AcceptCall&gt;</a>(call);</div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span>    listener = call.getRaw();</div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span>    dataListenConn = conn;</div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span>    <a class="code hl_function" href="classAsyncJob.html#a1dd42e9842d751193268966d4e0de2fa">AsyncJob::Start</a>(<span class="keyword">new</span> <a class="code hl_class" href="classComm_1_1TcpAcceptor.html">Comm::TcpAcceptor</a>(conn, note, sub));</div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span> </div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span>    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> listeningPort = <a class="code hl_function" href="comm_8cc.html#a1c9ec1883ab8ef62d500741ddce94afa">comm_local_port</a>(conn-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a8e53f4d6fd38545947a5aac6efb98fca">fd</a>);</div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span>    conn-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a84e6544b719c79cbecbc7d2a891fbcb2">local</a>.<a class="code hl_function" href="classIp_1_1Address.html#aeea3c669850f18acd2efcd336fcf2438">port</a>(listeningPort);</div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span>    <span class="keywordflow">return</span> listeningPort;</div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span>}</div>
</div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span> </div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00401" data-start="{" data-end="}">
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#a587c2c7812b6594e676b91e90d5deaa8">  401</a></span><a class="code hl_function" href="classFtp_1_1Server.html#a587c2c7812b6594e676b91e90d5deaa8">Ftp::Server::acceptDataConnection</a>(<span class="keyword">const</span> <a class="code hl_class" href="classCommAcceptCbParams.html">CommAcceptCbParams</a> &amp;params)</div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span>{</div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span>    <span class="keywordflow">if</span> (params.<a class="code hl_variable" href="classCommCommonCbParams.html#aaa1b70c6ff254ac72ac1503fc158df7e">flag</a> != <a class="code hl_enumvalue" href="namespaceComm.html#a9d8d4f4a5745b975c5785998e4246050a2d02cf4ed31f765e18f4d8474ede4e24">Comm::OK</a>) {</div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span>        <span class="comment">// Its possible the call was still queued when the client disconnected</span></div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 2, dataListenConn &lt;&lt; <span class="stringliteral">&quot;: accept &quot;</span></div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span>               <span class="stringliteral">&quot;failure: &quot;</span> &lt;&lt; <a class="code hl_function" href="xstrerror_8cc.html#a3d643f764de4776e5489d4eb55a99849">xstrerr</a>(params.<a class="code hl_variable" href="classCommCommonCbParams.html#a5376946442719c10cc9307045e09460d">xerrno</a>));</div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span>    }</div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span> </div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 4, <span class="stringliteral">&quot;accepted &quot;</span> &lt;&lt; params.<a class="code hl_variable" href="classCommCommonCbParams.html#acbcbe42d3ccd12c6de3b1f3d1d7c4bc3">conn</a>);</div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span>    <a class="code hl_function" href="fd_8cc.html#a397dc4e5e5cf728d8f1a48b32cb4e60d">fd_note</a>(params.<a class="code hl_variable" href="classCommCommonCbParams.html#acbcbe42d3ccd12c6de3b1f3d1d7c4bc3">conn</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a8e53f4d6fd38545947a5aac6efb98fca">fd</a>, <span class="stringliteral">&quot;passive client ftp data&quot;</span>);</div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span> </div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span>    <span class="keywordflow">if</span> (!clientConnection) {</div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;late data connection?&quot;</span>);</div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span>        closeDataConnection(); <span class="comment">// in case we are still listening</span></div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span>        params.<a class="code hl_variable" href="classCommCommonCbParams.html#acbcbe42d3ccd12c6de3b1f3d1d7c4bc3">conn</a>-&gt;<a class="code hl_function" href="classComm_1_1Connection.html#a32253e90999f679dc032e19ad50d03ab">close</a>();</div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (params.<a class="code hl_variable" href="classCommCommonCbParams.html#acbcbe42d3ccd12c6de3b1f3d1d7c4bc3">conn</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a60e1b863400f49a2ed17054982561f17">remote</a> != clientConnection-&gt;remote) {</div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 2, <span class="stringliteral">&quot;rogue data conn? ctrl: &quot;</span> &lt;&lt; clientConnection-&gt;remote);</div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span>        params.<a class="code hl_variable" href="classCommCommonCbParams.html#acbcbe42d3ccd12c6de3b1f3d1d7c4bc3">conn</a>-&gt;<a class="code hl_function" href="classComm_1_1Connection.html#a32253e90999f679dc032e19ad50d03ab">close</a>();</div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span>        <span class="comment">// Some FTP servers close control connection here, but it may make</span></div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span>        <span class="comment">// things worse from DoS p.o.v. and no better from data stealing p.o.v.</span></div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span>        closeDataConnection();</div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span>        dataConn = params.<a class="code hl_variable" href="classCommCommonCbParams.html#acbcbe42d3ccd12c6de3b1f3d1d7c4bc3">conn</a>;</div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span>        dataConn-&gt;<a class="code hl_function" href="classComm_1_1Connection.html#a7a09f662fc4891a7240dde7169fc0485">leaveOrphanage</a>();</div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span>        uploadAvailSize = 0;</div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 7, <span class="stringliteral">&quot;ready for data&quot;</span>);</div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span>        <span class="keywordflow">if</span> (onDataAcceptCall != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span>            <a class="code hl_class" href="classRefCount.html">AsyncCall::Pointer</a> call = onDataAcceptCall;</div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span>            onDataAcceptCall = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span>            <span class="comment">// If we got an upload request, start reading data from the client.</span></div>
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno">  432</span>            <span class="keywordflow">if</span> (master-&gt;serverState == <a class="code hl_enumvalue" href="namespaceFtp.html#a56abcf0499ca5d50f20f9ce02525124eaaf7ccbf3756c082cf11222ec601913a8">fssHandleUploadRequest</a>)</div>
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno">  433</span>                maybeReadUploadData();</div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span>            <span class="keywordflow">else</span></div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span>                <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(master-&gt;serverState == <a class="code hl_enumvalue" href="namespaceFtp.html#a56abcf0499ca5d50f20f9ce02525124eaf385076cc145cc42c7248f5b24d05c13">fssHandleDataRequest</a>);</div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span>            <a class="code hl_class" href="classMemBuf.html">MemBuf</a> mb;</div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span>            mb.<a class="code hl_function" href="classMemBuf.html#a4a615d8e887439c66e04aab70f8be60a">init</a>();</div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span>            mb.<a class="code hl_function" href="classPackable.html#ab3147943b218d2943726aeaf135dd776">appendf</a>(<span class="stringliteral">&quot;150 Data connection opened.\r\n&quot;</span>);</div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span>            <a class="code hl_function" href="namespaceComm.html#a96a9518a6c2c77d282a79f406e0252a9">Comm::Write</a>(clientConnection, &amp;mb, call);</div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span>        }</div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span>    }</div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno">  442</span>}</div>
</div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span> </div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00445" data-start="{" data-end="}">
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#af79d866333b560434b1548aa3c7c4509">  445</a></span><a class="code hl_function" href="classFtp_1_1Server.html#af79d866333b560434b1548aa3c7c4509">Ftp::Server::closeDataConnection</a>()</div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span>{</div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span>    <span class="keywordflow">if</span> (listener != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span>        listener-&gt;cancel(<span class="stringliteral">&quot;no longer needed&quot;</span>);</div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span>        listener = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span>    }</div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span> </div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="namespaceComm.html#a91f0a0e22e74a7ad6f7c44c137c6f005">Comm::IsConnOpen</a>(dataListenConn)) {</div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;FTP closing client data listen socket: &quot;</span> &lt;&lt;</div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span>               *dataListenConn);</div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span>        dataListenConn-&gt;close();</div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span>    }</div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span>    dataListenConn = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span> </div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span>    <span class="keywordflow">if</span> (reader != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span>        <span class="comment">// Comm::ReadCancel can deal with negative FDs</span></div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span>        <a class="code hl_function" href="namespaceComm.html#a24de01312960dba5c38466509cadb831">Comm::ReadCancel</a>(dataConn-&gt;fd, reader);</div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span>        reader = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno">  463</span>    }</div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span> </div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="namespaceComm.html#a91f0a0e22e74a7ad6f7c44c137c6f005">Comm::IsConnOpen</a>(dataConn)) {</div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;FTP closing client data connection: &quot;</span> &lt;&lt;</div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span>               *dataConn);</div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span>        dataConn-&gt;close();</div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span>    }</div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span>    dataConn = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span>}</div>
</div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span> </div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00476" data-start="{" data-end="}">
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#af46569dae5e4a0d6e67b0b4eca1e66b5">  476</a></span><a class="code hl_function" href="classFtp_1_1Server.html#af46569dae5e4a0d6e67b0b4eca1e66b5">Ftp::Server::writeEarlyReply</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> code, <span class="keyword">const</span> <span class="keywordtype">char</span> *msg)</div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span>{</div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 7, code &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; msg);</div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno">  479</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(99 &lt; code &amp;&amp; code &lt; 1000);</div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span> </div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span>    <a class="code hl_class" href="classMemBuf.html">MemBuf</a> mb;</div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span>    mb.<a class="code hl_function" href="classMemBuf.html#a4a615d8e887439c66e04aab70f8be60a">init</a>();</div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span>    mb.<a class="code hl_function" href="classPackable.html#ab3147943b218d2943726aeaf135dd776">appendf</a>(<span class="stringliteral">&quot;%i %s\r\n&quot;</span>, code, msg);</div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span> </div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span>    <span class="keyword">typedef</span> <a class="code hl_class" href="classCommCbMemFunT.html">CommCbMemFunT&lt;Server, CommIoCbParams&gt;</a> Dialer;</div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span>    <a class="code hl_class" href="classRefCount.html">AsyncCall::Pointer</a> call = <a class="code hl_define" href="AsyncJobCalls_8h.html#a3412f4fa1246aee4d4ac46a143075e03">JobCallback</a>(33, 5, Dialer, <span class="keyword">this</span>, <a class="code hl_function" href="classFtp_1_1Server.html#abb080a58365191b240f85bbc70d01cdb">Ftp::Server::wroteEarlyReply</a>);</div>
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno">  487</span>    <a class="code hl_function" href="namespaceComm.html#a96a9518a6c2c77d282a79f406e0252a9">Comm::Write</a>(clientConnection, &amp;mb, call);</div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno">  488</span> </div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span>    flags.readMore = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span> </div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span>    <span class="comment">// TODO: Create master transaction. Log it in wroteEarlyReply().</span></div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span>}</div>
</div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span> </div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00495" data-start="{" data-end="}">
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#a6bbbb722cc383590224e0e03b8c71a23">  495</a></span><a class="code hl_function" href="classFtp_1_1Server.html#a6bbbb722cc383590224e0e03b8c71a23">Ftp::Server::writeReply</a>(<a class="code hl_class" href="classMemBuf.html">MemBuf</a> &amp;mb)</div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span>{</div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(9, 2, <span class="stringliteral">&quot;FTP Client &quot;</span> &lt;&lt; clientConnection);</div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(9, 2, <span class="stringliteral">&quot;FTP Client REPLY:\n---------\n&quot;</span> &lt;&lt; mb.<a class="code hl_variable" href="classMemBuf.html#a78daaa064a5aa4557e283a01c4aa27f1">buf</a> &lt;&lt;</div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span>           <span class="stringliteral">&quot;\n----------&quot;</span>);</div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span> </div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span>    <span class="keyword">typedef</span> <a class="code hl_class" href="classCommCbMemFunT.html">CommCbMemFunT&lt;Server, CommIoCbParams&gt;</a> Dialer;</div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span>    <a class="code hl_class" href="classRefCount.html">AsyncCall::Pointer</a> call = <a class="code hl_define" href="AsyncJobCalls_8h.html#a3412f4fa1246aee4d4ac46a143075e03">JobCallback</a>(33, 5, Dialer, <span class="keyword">this</span>, <a class="code hl_function" href="classFtp_1_1Server.html#a4d1af5c70cc5a133ee3f992c3e0ea391">Ftp::Server::wroteReply</a>);</div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span>    <a class="code hl_function" href="namespaceComm.html#a96a9518a6c2c77d282a79f406e0252a9">Comm::Write</a>(clientConnection, &amp;mb, call);</div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span>}</div>
</div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span> </div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00507" data-start="{" data-end="}">
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#a023c93ee1944bea0aa2ba85c1d46f81e">  507</a></span><a class="code hl_function" href="classFtp_1_1Server.html#a023c93ee1944bea0aa2ba85c1d46f81e">Ftp::Server::writeCustomReply</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> code, <span class="keyword">const</span> <span class="keywordtype">char</span> *msg, <span class="keyword">const</span> <a class="code hl_class" href="classHttpReply.html">HttpReply</a> *reply)</div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span>{</div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 7, code &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; msg);</div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(99 &lt; code &amp;&amp; code &lt; 1000);</div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span> </div>
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno">  512</span>    <span class="keyword">const</span> <span class="keywordtype">bool</span> sendDetails = reply != <span class="keyword">nullptr</span> &amp;&amp;</div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span>                             reply-&gt;<a class="code hl_variable" href="classHttp_1_1Message.html#a79ae935ff618211b139dcfdd8a5277ec">header</a>.<a class="code hl_function" href="classHttpHeader.html#abe3327167942e75a78385e92bc1b26b7">has</a>(<a class="code hl_enumvalue" href="namespaceHttp.html#a92faa3c60e0b457c167759389ae061a4a441d11bb798c52af629374cdac708ffa">Http::HdrType::FTP_STATUS</a>) &amp;&amp; reply-&gt;<a class="code hl_variable" href="classHttp_1_1Message.html#a79ae935ff618211b139dcfdd8a5277ec">header</a>.<a class="code hl_function" href="classHttpHeader.html#abe3327167942e75a78385e92bc1b26b7">has</a>(<a class="code hl_enumvalue" href="namespaceHttp.html#a92faa3c60e0b457c167759389ae061a4a99cab0d9e614ea5daec167ffc05839b1">Http::HdrType::FTP_REASON</a>);</div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span> </div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span>    <a class="code hl_class" href="classMemBuf.html">MemBuf</a> mb;</div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span>    mb.<a class="code hl_function" href="classMemBuf.html#a4a615d8e887439c66e04aab70f8be60a">init</a>();</div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span>    <span class="keywordflow">if</span> (sendDetails) {</div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span>        mb.<a class="code hl_function" href="classPackable.html#ab3147943b218d2943726aeaf135dd776">appendf</a>(<span class="stringliteral">&quot;%i-%s\r\n&quot;</span>, code, msg);</div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span>        mb.<a class="code hl_function" href="classPackable.html#ab3147943b218d2943726aeaf135dd776">appendf</a>(<span class="stringliteral">&quot; Server reply:\r\n&quot;</span>);</div>
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno">  520</span>        <a class="code hl_function" href="namespaceFtp.html#afbe492e82e3511179f2af6c59c2eb5b8">Ftp::PrintReply</a>(mb, reply, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno">  521</span>        mb.<a class="code hl_function" href="classPackable.html#ab3147943b218d2943726aeaf135dd776">appendf</a>(<span class="stringliteral">&quot;%i \r\n&quot;</span>, code);</div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span>    } <span class="keywordflow">else</span></div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span>        mb.<a class="code hl_function" href="classPackable.html#ab3147943b218d2943726aeaf135dd776">appendf</a>(<span class="stringliteral">&quot;%i %s\r\n&quot;</span>, code, msg);</div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno">  524</span> </div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno">  525</span>    writeReply(mb);</div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno">  526</span>}</div>
</div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span> </div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00529" data-start="{" data-end="}">
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#a4b356bbe62e9d8ebc34d2681dcce6d3f">  529</a></span><a class="code hl_function" href="classFtp_1_1Server.html#a4b356bbe62e9d8ebc34d2681dcce6d3f">Ftp::Server::changeState</a>(<span class="keyword">const</span> <a class="code hl_enumeration" href="namespaceFtp.html#a56abcf0499ca5d50f20f9ce02525124e">ServerState</a> newState, <span class="keyword">const</span> <span class="keywordtype">char</span> *reason)</div>
<div class="line"><a id="l00530" name="l00530"></a><span class="lineno">  530</span>{</div>
<div class="line"><a id="l00531" name="l00531"></a><span class="lineno">  531</span>    <span class="keywordflow">if</span> (master-&gt;serverState == newState) {</div>
<div class="line"><a id="l00532" name="l00532"></a><span class="lineno">  532</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 3, <span class="stringliteral">&quot;client state unchanged at &quot;</span> &lt;&lt; master-&gt;serverState &lt;&lt;</div>
<div class="line"><a id="l00533" name="l00533"></a><span class="lineno">  533</span>               <span class="stringliteral">&quot; because &quot;</span> &lt;&lt; reason);</div>
<div class="line"><a id="l00534" name="l00534"></a><span class="lineno">  534</span>        master-&gt;serverState = newState;</div>
<div class="line"><a id="l00535" name="l00535"></a><span class="lineno">  535</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00536" name="l00536"></a><span class="lineno">  536</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 3, <span class="stringliteral">&quot;client state was &quot;</span> &lt;&lt; master-&gt;serverState &lt;&lt;</div>
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno">  537</span>               <span class="stringliteral">&quot;, now &quot;</span> &lt;&lt; newState &lt;&lt; <span class="stringliteral">&quot; because &quot;</span> &lt;&lt; reason);</div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span>        master-&gt;serverState = newState;</div>
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno">  539</span>    }</div>
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno">  540</span>}</div>
</div>
<div class="line"><a id="l00541" name="l00541"></a><span class="lineno">  541</span> </div>
<div class="line"><a id="l00543" name="l00543"></a><span class="lineno">  543</span><span class="keyword">static</span> <span class="keywordtype">bool</span></div>
<div class="foldopen" id="foldopen00544" data-start="{" data-end="}">
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno"><a class="line" href="namespaceFtp.html#a970f9156aff8feb9e9642c20c5fab8b8">  544</a></span><a class="code hl_function" href="namespaceFtp.html#a970f9156aff8feb9e9642c20c5fab8b8">Ftp::CommandHasPathParameter</a>(<span class="keyword">const</span> <a class="code hl_class" href="classSBuf.html">SBuf</a> &amp;cmd)</div>
<div class="line"><a id="l00545" name="l00545"></a><span class="lineno">  545</span>{</div>
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno">  546</span>    <span class="keyword">static</span> std::set&lt;SBuf&gt; PathedCommands;</div>
<div class="line"><a id="l00547" name="l00547"></a><span class="lineno">  547</span>    <span class="keywordflow">if</span> (!PathedCommands.size()) {</div>
<div class="line"><a id="l00548" name="l00548"></a><span class="lineno">  548</span>        PathedCommands.insert(<a class="code hl_function" href="namespaceFtp.html#a87996da5ee785620cd35472f3652696a">cmdMlst</a>());</div>
<div class="line"><a id="l00549" name="l00549"></a><span class="lineno">  549</span>        PathedCommands.insert(<a class="code hl_function" href="namespaceFtp.html#a6a14ded9bed8494db4e66daee70f1db2">cmdMlsd</a>());</div>
<div class="line"><a id="l00550" name="l00550"></a><span class="lineno">  550</span>        PathedCommands.insert(<a class="code hl_function" href="namespaceFtp.html#a8cd7e00904c95411d852ea9d1f73c455">cmdStat</a>());</div>
<div class="line"><a id="l00551" name="l00551"></a><span class="lineno">  551</span>        PathedCommands.insert(<a class="code hl_function" href="namespaceFtp.html#a864c4520d3d763f009c14f508f77e079">cmdNlst</a>());</div>
<div class="line"><a id="l00552" name="l00552"></a><span class="lineno">  552</span>        PathedCommands.insert(<a class="code hl_function" href="namespaceFtp.html#a766fc1c345a87ac051e948e05571f00c">cmdList</a>());</div>
<div class="line"><a id="l00553" name="l00553"></a><span class="lineno">  553</span>        PathedCommands.insert(<a class="code hl_function" href="namespaceFtp.html#ab97a258f68a87139b5f64f777764a4ad">cmdMkd</a>());</div>
<div class="line"><a id="l00554" name="l00554"></a><span class="lineno">  554</span>        PathedCommands.insert(<a class="code hl_function" href="namespaceFtp.html#aee082b8b0ceeb30bc8ae847d7d770d69">cmdRmd</a>());</div>
<div class="line"><a id="l00555" name="l00555"></a><span class="lineno">  555</span>        PathedCommands.insert(<a class="code hl_function" href="namespaceFtp.html#a3872491626f8faa65590d1f3e8ec8ef3">cmdDele</a>());</div>
<div class="line"><a id="l00556" name="l00556"></a><span class="lineno">  556</span>        PathedCommands.insert(<a class="code hl_function" href="namespaceFtp.html#ab6a0942e483ea32aa3731bcd223deade">cmdRnto</a>());</div>
<div class="line"><a id="l00557" name="l00557"></a><span class="lineno">  557</span>        PathedCommands.insert(<a class="code hl_function" href="namespaceFtp.html#ad0ba09ef50b5d9dcf0ac56bb87e879a6">cmdRnfr</a>());</div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span>        PathedCommands.insert(<a class="code hl_function" href="namespaceFtp.html#a1a99fa3e836e0d5c97e88d241976f1bd">cmdAppe</a>());</div>
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno">  559</span>        PathedCommands.insert(<a class="code hl_function" href="namespaceFtp.html#a603e2df6ab8dad0f4b40a86bbfd2e411">cmdStor</a>());</div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno">  560</span>        PathedCommands.insert(<a class="code hl_function" href="namespaceFtp.html#a80fba0aae7827e3cfde9f23944d2fb11">cmdRetr</a>());</div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno">  561</span>        PathedCommands.insert(<a class="code hl_function" href="namespaceFtp.html#a49fa2e886422a3246c0ffe8cae3138dd">cmdSmnt</a>());</div>
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno">  562</span>        PathedCommands.insert(<a class="code hl_function" href="namespaceFtp.html#aa0567d127f548a51c718347e21b1d477">cmdCwd</a>());</div>
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno">  563</span>    }</div>
<div class="line"><a id="l00564" name="l00564"></a><span class="lineno">  564</span> </div>
<div class="line"><a id="l00565" name="l00565"></a><span class="lineno">  565</span>    <span class="keywordflow">return</span> PathedCommands.find(cmd) != PathedCommands.end();</div>
<div class="line"><a id="l00566" name="l00566"></a><span class="lineno">  566</span>}</div>
</div>
<div class="line"><a id="l00567" name="l00567"></a><span class="lineno">  567</span> </div>
<div class="line"><a id="l00569" name="l00569"></a><span class="lineno">  569</span><a class="code hl_class" href="classHttp_1_1Stream.html">Http::Stream</a> *</div>
<div class="foldopen" id="foldopen00570" data-start="{" data-end="}">
<div class="line"><a id="l00570" name="l00570"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#a51ca9368784f809c9f74c953b3930309">  570</a></span><a class="code hl_function" href="classFtp_1_1Server.html#a51ca9368784f809c9f74c953b3930309">Ftp::Server::earlyError</a>(<span class="keyword">const</span> <a class="code hl_enumeration" href="classFtp_1_1Server.html#a318b2a9e533d1cecc0f25fbe4e4dccf4">EarlyErrorKind</a> eek)</div>
<div class="line"><a id="l00571" name="l00571"></a><span class="lineno">  571</span>{</div>
<div class="line"><a id="l00572" name="l00572"></a><span class="lineno">  572</span>    <span class="comment">/* Default values, to be updated by the switch statement below */</span></div>
<div class="line"><a id="l00573" name="l00573"></a><span class="lineno">  573</span>    <span class="keywordtype">int</span> scode = 421;</div>
<div class="line"><a id="l00574" name="l00574"></a><span class="lineno">  574</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *reason = <span class="stringliteral">&quot;Internal error&quot;</span>;</div>
<div class="line"><a id="l00575" name="l00575"></a><span class="lineno">  575</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *errUri = <span class="stringliteral">&quot;error:ftp-internal-early-error&quot;</span>;</div>
<div class="line"><a id="l00576" name="l00576"></a><span class="lineno">  576</span> </div>
<div class="line"><a id="l00577" name="l00577"></a><span class="lineno">  577</span>    <span class="keywordflow">switch</span> (eek) {</div>
<div class="line"><a id="l00578" name="l00578"></a><span class="lineno">  578</span>    <span class="keywordflow">case</span> EarlyErrorKind::HugeRequest:</div>
<div class="line"><a id="l00579" name="l00579"></a><span class="lineno">  579</span>        scode = 421;</div>
<div class="line"><a id="l00580" name="l00580"></a><span class="lineno">  580</span>        reason = <span class="stringliteral">&quot;Huge request&quot;</span>;</div>
<div class="line"><a id="l00581" name="l00581"></a><span class="lineno">  581</span>        errUri = <span class="stringliteral">&quot;error:ftp-huge-request&quot;</span>;</div>
<div class="line"><a id="l00582" name="l00582"></a><span class="lineno">  582</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00583" name="l00583"></a><span class="lineno">  583</span> </div>
<div class="line"><a id="l00584" name="l00584"></a><span class="lineno">  584</span>    <span class="keywordflow">case</span> EarlyErrorKind::MissingLogin:</div>
<div class="line"><a id="l00585" name="l00585"></a><span class="lineno">  585</span>        scode = 530;</div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span>        reason = <span class="stringliteral">&quot;Must login first&quot;</span>;</div>
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno">  587</span>        errUri = <span class="stringliteral">&quot;error:ftp-must-login-first&quot;</span>;</div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno">  588</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno">  589</span> </div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span>    <span class="keywordflow">case</span> EarlyErrorKind::MissingUsername:</div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span>        scode = 501;</div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span>        reason = <span class="stringliteral">&quot;Missing username&quot;</span>;</div>
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno">  593</span>        errUri = <span class="stringliteral">&quot;error:ftp-missing-username&quot;</span>;</div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00595" name="l00595"></a><span class="lineno">  595</span> </div>
<div class="line"><a id="l00596" name="l00596"></a><span class="lineno">  596</span>    <span class="keywordflow">case</span> EarlyErrorKind::MissingHost:</div>
<div class="line"><a id="l00597" name="l00597"></a><span class="lineno">  597</span>        scode = 501;</div>
<div class="line"><a id="l00598" name="l00598"></a><span class="lineno">  598</span>        reason = <span class="stringliteral">&quot;Missing host&quot;</span>;</div>
<div class="line"><a id="l00599" name="l00599"></a><span class="lineno">  599</span>        errUri = <span class="stringliteral">&quot;error:ftp-missing-host&quot;</span>;</div>
<div class="line"><a id="l00600" name="l00600"></a><span class="lineno">  600</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00601" name="l00601"></a><span class="lineno">  601</span> </div>
<div class="line"><a id="l00602" name="l00602"></a><span class="lineno">  602</span>    <span class="keywordflow">case</span> EarlyErrorKind::UnsupportedCommand:</div>
<div class="line"><a id="l00603" name="l00603"></a><span class="lineno">  603</span>        scode = 502;</div>
<div class="line"><a id="l00604" name="l00604"></a><span class="lineno">  604</span>        reason = <span class="stringliteral">&quot;Unknown or unsupported command&quot;</span>;</div>
<div class="line"><a id="l00605" name="l00605"></a><span class="lineno">  605</span>        errUri = <span class="stringliteral">&quot;error:ftp-unsupported-command&quot;</span>;</div>
<div class="line"><a id="l00606" name="l00606"></a><span class="lineno">  606</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno">  607</span> </div>
<div class="line"><a id="l00608" name="l00608"></a><span class="lineno">  608</span>    <span class="keywordflow">case</span> EarlyErrorKind::InvalidUri:</div>
<div class="line"><a id="l00609" name="l00609"></a><span class="lineno">  609</span>        scode = 501;</div>
<div class="line"><a id="l00610" name="l00610"></a><span class="lineno">  610</span>        reason = <span class="stringliteral">&quot;Invalid URI&quot;</span>;</div>
<div class="line"><a id="l00611" name="l00611"></a><span class="lineno">  611</span>        errUri = <span class="stringliteral">&quot;error:ftp-invalid-uri&quot;</span>;</div>
<div class="line"><a id="l00612" name="l00612"></a><span class="lineno">  612</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00613" name="l00613"></a><span class="lineno">  613</span> </div>
<div class="line"><a id="l00614" name="l00614"></a><span class="lineno">  614</span>    <span class="keywordflow">case</span> EarlyErrorKind::MalformedCommand:</div>
<div class="line"><a id="l00615" name="l00615"></a><span class="lineno">  615</span>        scode = 421;</div>
<div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span>        reason = <span class="stringliteral">&quot;Malformed command&quot;</span>;</div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span>        errUri = <span class="stringliteral">&quot;error:ftp-malformed-command&quot;</span>;</div>
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno">  618</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00619" name="l00619"></a><span class="lineno">  619</span> </div>
<div class="line"><a id="l00620" name="l00620"></a><span class="lineno">  620</span>        <span class="comment">// no default so that a compiler can check that we have covered all cases</span></div>
<div class="line"><a id="l00621" name="l00621"></a><span class="lineno">  621</span>    }</div>
<div class="line"><a id="l00622" name="l00622"></a><span class="lineno">  622</span> </div>
<div class="line"><a id="l00623" name="l00623"></a><span class="lineno">  623</span>    <a class="code hl_class" href="classHttp_1_1Stream.html">Http::Stream</a> *context = abortRequestParsing(errUri);</div>
<div class="line"><a id="l00624" name="l00624"></a><span class="lineno">  624</span>    <a class="code hl_class" href="classclientStreamNode.html">clientStreamNode</a> *<a class="code hl_struct" href="structnode.html">node</a> = context-&gt;<a class="code hl_function" href="classHttp_1_1Stream.html#aa440325d7261074611d9150b3133bc26">getClientReplyContext</a>();</div>
<div class="line"><a id="l00625" name="l00625"></a><span class="lineno">  625</span>    <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(<a class="code hl_struct" href="structnode.html">node</a>);</div>
<div class="line"><a id="l00626" name="l00626"></a><span class="lineno">  626</span>    <a class="code hl_class" href="classclientReplyContext.html">clientReplyContext</a> *repContext = <span class="keyword">dynamic_cast&lt;</span><a class="code hl_class" href="classclientReplyContext.html">clientReplyContext</a> *<span class="keyword">&gt;</span>(<a class="code hl_struct" href="structnode.html">node</a>-&gt;data.getRaw());</div>
<div class="line"><a id="l00627" name="l00627"></a><span class="lineno">  627</span>    <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(repContext);</div>
<div class="line"><a id="l00628" name="l00628"></a><span class="lineno">  628</span> </div>
<div class="line"><a id="l00629" name="l00629"></a><span class="lineno">  629</span>    <span class="comment">// We cannot relay FTP scode/reason via HTTP-specific ErrorState.</span></div>
<div class="line"><a id="l00630" name="l00630"></a><span class="lineno">  630</span>    <span class="comment">// TODO: When/if ErrorState can handle native FTP errors, use it instead.</span></div>
<div class="line"><a id="l00631" name="l00631"></a><span class="lineno">  631</span>    <a class="code hl_class" href="classHttpReply.html">HttpReply</a> *reply = <a class="code hl_function" href="namespaceFtp.html#ac99540d79350b5eec3729725a8a52a55">Ftp::HttpReplyWrapper</a>(scode, reason, <a class="code hl_enumvalue" href="namespaceHttp.html#a432f881deb187c726161d6435daec722a74568860e1daf616488c945a9b3d4416">Http::scBadRequest</a>, -1);</div>
<div class="line"><a id="l00632" name="l00632"></a><span class="lineno">  632</span>    repContext-&gt;<a class="code hl_function" href="classclientReplyContext.html#a0f8952c0b6f0b7a451aa61a94cdd7ed9">setReplyToReply</a>(reply);</div>
<div class="line"><a id="l00633" name="l00633"></a><span class="lineno">  633</span>    <span class="keywordflow">return</span> context;</div>
<div class="line"><a id="l00634" name="l00634"></a><span class="lineno">  634</span>}</div>
</div>
<div class="line"><a id="l00635" name="l00635"></a><span class="lineno">  635</span> </div>
<div class="line"><a id="l00639" name="l00639"></a><span class="lineno">  639</span><a class="code hl_class" href="classHttp_1_1Stream.html">Http::Stream</a> *</div>
<div class="foldopen" id="foldopen00640" data-start="{" data-end="}">
<div class="line"><a id="l00640" name="l00640"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#a91c96fb1d958ac2c8232bec4138a40d8">  640</a></span><a class="code hl_function" href="classFtp_1_1Server.html#a91c96fb1d958ac2c8232bec4138a40d8">Ftp::Server::parseOneRequest</a>()</div>
<div class="line"><a id="l00641" name="l00641"></a><span class="lineno">  641</span>{</div>
<div class="line"><a id="l00642" name="l00642"></a><span class="lineno">  642</span>    flags.readMore = <span class="keyword">false</span>; <span class="comment">// common for all but one case below</span></div>
<div class="line"><a id="l00643" name="l00643"></a><span class="lineno">  643</span> </div>
<div class="line"><a id="l00644" name="l00644"></a><span class="lineno">  644</span>    <span class="comment">// OWS &lt;command&gt; [ RWS &lt;parameter&gt; ] OWS LF</span></div>
<div class="line"><a id="l00645" name="l00645"></a><span class="lineno">  645</span> </div>
<div class="line"><a id="l00646" name="l00646"></a><span class="lineno">  646</span>    <span class="comment">// InlineSpaceChars are isspace(3) or RFC 959 Section 3.1.1.5.2, except</span></div>
<div class="line"><a id="l00647" name="l00647"></a><span class="lineno">  647</span>    <span class="comment">// for the LF character that we must exclude here (but see FullWhiteSpace).</span></div>
<div class="line"><a id="l00648" name="l00648"></a><span class="lineno">  648</span>    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> InlineSpaceChars = <span class="stringliteral">&quot; \f\r\t\v&quot;</span>;</div>
<div class="line"><a id="l00649" name="l00649"></a><span class="lineno">  649</span>    <span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classCharacterSet.html">CharacterSet</a> InlineSpace = <a class="code hl_class" href="classCharacterSet.html">CharacterSet</a>(<span class="stringliteral">&quot;Ftp::Inline&quot;</span>, InlineSpaceChars);</div>
<div class="line"><a id="l00650" name="l00650"></a><span class="lineno">  650</span>    <span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classCharacterSet.html">CharacterSet</a> FullWhiteSpace = (InlineSpace + <a class="code hl_variable" href="classCharacterSet.html#a93ba52a29423824a1e9414a3c00b50f9">CharacterSet::LF</a>).rename(<span class="stringliteral">&quot;Ftp::FWS&quot;</span>);</div>
<div class="line"><a id="l00651" name="l00651"></a><span class="lineno">  651</span>    <span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classCharacterSet.html">CharacterSet</a> CommandChars = FullWhiteSpace.<a class="code hl_function" href="classCharacterSet.html#a1b83850bb6e25b80633a956162d720f4">complement</a>(<span class="stringliteral">&quot;Ftp::Command&quot;</span>);</div>
<div class="line"><a id="l00652" name="l00652"></a><span class="lineno">  652</span>    <span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classCharacterSet.html">CharacterSet</a> TailChars = <a class="code hl_variable" href="classCharacterSet.html#a93ba52a29423824a1e9414a3c00b50f9">CharacterSet::LF</a>.<a class="code hl_function" href="classCharacterSet.html#a1b83850bb6e25b80633a956162d720f4">complement</a>(<span class="stringliteral">&quot;Ftp::Tail&quot;</span>);</div>
<div class="line"><a id="l00653" name="l00653"></a><span class="lineno">  653</span> </div>
<div class="line"><a id="l00654" name="l00654"></a><span class="lineno">  654</span>    <span class="comment">// This set is used to ignore empty commands without allowing an attacker</span></div>
<div class="line"><a id="l00655" name="l00655"></a><span class="lineno">  655</span>    <span class="comment">// to keep us endlessly busy by feeding us whitespace or empty commands.</span></div>
<div class="line"><a id="l00656" name="l00656"></a><span class="lineno">  656</span>    <span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classCharacterSet.html">CharacterSet</a> &amp;LeadingSpace = FullWhiteSpace;</div>
<div class="line"><a id="l00657" name="l00657"></a><span class="lineno">  657</span> </div>
<div class="line"><a id="l00658" name="l00658"></a><span class="lineno">  658</span>    <a class="code hl_class" href="classSBuf.html">SBuf</a> cmd;</div>
<div class="line"><a id="l00659" name="l00659"></a><span class="lineno">  659</span>    <a class="code hl_class" href="classSBuf.html">SBuf</a> params;</div>
<div class="line"><a id="l00660" name="l00660"></a><span class="lineno">  660</span> </div>
<div class="line"><a id="l00661" name="l00661"></a><span class="lineno">  661</span>    <a class="code hl_class" href="classParser_1_1Tokenizer.html">Parser::Tokenizer</a> <a class="code hl_struct" href="structtok.html">tok</a>(inBuf);</div>
<div class="line"><a id="l00662" name="l00662"></a><span class="lineno">  662</span> </div>
<div class="line"><a id="l00663" name="l00663"></a><span class="lineno">  663</span>    (void)<a class="code hl_struct" href="structtok.html">tok</a>.skipAll(LeadingSpace); <span class="comment">// leading OWS and empty commands</span></div>
<div class="line"><a id="l00664" name="l00664"></a><span class="lineno">  664</span>    <span class="keyword">const</span> <span class="keywordtype">bool</span> parsed = <a class="code hl_struct" href="structtok.html">tok</a>.prefix(cmd, CommandChars); <span class="comment">// required command</span></div>
<div class="line"><a id="l00665" name="l00665"></a><span class="lineno">  665</span> </div>
<div class="line"><a id="l00666" name="l00666"></a><span class="lineno">  666</span>    <span class="comment">// note that the condition below will eat either RWS or trailing OWS</span></div>
<div class="line"><a id="l00667" name="l00667"></a><span class="lineno">  667</span>    <span class="keywordflow">if</span> (parsed &amp;&amp; <a class="code hl_struct" href="structtok.html">tok</a>.skipAll(InlineSpace) &amp;&amp; <a class="code hl_struct" href="structtok.html">tok</a>.prefix(params, TailChars)) {</div>
<div class="line"><a id="l00668" name="l00668"></a><span class="lineno">  668</span>        <span class="comment">// now params may include trailing OWS</span></div>
<div class="line"><a id="l00669" name="l00669"></a><span class="lineno">  669</span>        <span class="comment">// TODO: Support right-trimming using CharacterSet in Tokenizer instead</span></div>
<div class="line"><a id="l00670" name="l00670"></a><span class="lineno">  670</span>        <span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classSBuf.html">SBuf</a> bufWhiteSpace(InlineSpaceChars);</div>
<div class="line"><a id="l00671" name="l00671"></a><span class="lineno">  671</span>        params.<a class="code hl_function" href="classSBuf.html#a6f56e99bef653fef295096b7fc04be99">trim</a>(bufWhiteSpace, <span class="keyword">false</span>, <span class="keyword">true</span>);</div>
<div class="line"><a id="l00672" name="l00672"></a><span class="lineno">  672</span>    }</div>
<div class="line"><a id="l00673" name="l00673"></a><span class="lineno">  673</span> </div>
<div class="line"><a id="l00674" name="l00674"></a><span class="lineno">  674</span>    <span class="comment">// Why limit command line and parameters size? Did not we just parse them?</span></div>
<div class="line"><a id="l00675" name="l00675"></a><span class="lineno">  675</span>    <span class="comment">// XXX: Our good old String cannot handle very long strings.</span></div>
<div class="line"><a id="l00676" name="l00676"></a><span class="lineno">  676</span>    <span class="keyword">const</span> <a class="code hl_typedef" href="classSBuf.html#ae27bdc0d7ad9a7aba6377e1a4a5af568">SBuf::size_type</a> tokenMax = <a class="code hl_function" href="compat__shared_8h.html#ae39b16594fa61c8ddac14be4cce249cd">min</a>(</div>
<div class="line"><a id="l00677" name="l00677"></a><span class="lineno">  677</span>                                         <span class="keyword">static_cast&lt;</span><a class="code hl_typedef" href="classSBuf.html#ae27bdc0d7ad9a7aba6377e1a4a5af568">SBuf::size_type</a><span class="keyword">&gt;</span>(32*1024), <span class="comment">// conservative</span></div>
<div class="line"><a id="l00678" name="l00678"></a><span class="lineno">  678</span>                                         <span class="keyword">static_cast&lt;</span><a class="code hl_typedef" href="classSBuf.html#ae27bdc0d7ad9a7aba6377e1a4a5af568">SBuf::size_type</a><span class="keyword">&gt;</span>(<a class="code hl_variable" href="SquidConfig_8cc.html#a75b136e6a1eef61424d84596a404aafe">Config</a>.<a class="code hl_variable" href="classSquidConfig.html#a9a5a4aaa278ec44c9807fb2c5433b49b">maxRequestHeaderSize</a>));</div>
<div class="line"><a id="l00679" name="l00679"></a><span class="lineno">  679</span>    <span class="keywordflow">if</span> (cmd.<a class="code hl_function" href="classSBuf.html#a4fdfe954309aa6da19240f11a8f6b583">length</a>() &gt; tokenMax || params.<a class="code hl_function" href="classSBuf.html#a4fdfe954309aa6da19240f11a8f6b583">length</a>() &gt; tokenMax) {</div>
<div class="line"><a id="l00680" name="l00680"></a><span class="lineno">  680</span>        changeState(<a class="code hl_enumvalue" href="namespaceFtp.html#a56abcf0499ca5d50f20f9ce02525124ea21ec8308de0a2e68cac20118053ea9f5">fssError</a>, <span class="stringliteral">&quot;huge req token&quot;</span>);</div>
<div class="line"><a id="l00681" name="l00681"></a><span class="lineno">  681</span>        quitAfterError(<span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l00682" name="l00682"></a><span class="lineno">  682</span>        <span class="keywordflow">return</span> earlyError(EarlyErrorKind::HugeRequest);</div>
<div class="line"><a id="l00683" name="l00683"></a><span class="lineno">  683</span>    }</div>
<div class="line"><a id="l00684" name="l00684"></a><span class="lineno">  684</span> </div>
<div class="line"><a id="l00685" name="l00685"></a><span class="lineno">  685</span>    <span class="comment">// technically, we may skip multiple NLs below, but that is OK</span></div>
<div class="line"><a id="l00686" name="l00686"></a><span class="lineno">  686</span>    <span class="keywordflow">if</span> (!parsed || !<a class="code hl_struct" href="structtok.html">tok</a>.skipAll(<a class="code hl_variable" href="classCharacterSet.html#a93ba52a29423824a1e9414a3c00b50f9">CharacterSet::LF</a>)) { <span class="comment">// did not find terminating LF yet</span></div>
<div class="line"><a id="l00687" name="l00687"></a><span class="lineno">  687</span>        <span class="comment">// we need more data, but can we buffer more?</span></div>
<div class="line"><a id="l00688" name="l00688"></a><span class="lineno">  688</span>        <span class="keywordflow">if</span> (inBuf.length() &gt;= <a class="code hl_variable" href="SquidConfig_8cc.html#a75b136e6a1eef61424d84596a404aafe">Config</a>.<a class="code hl_variable" href="classSquidConfig.html#a9a5a4aaa278ec44c9807fb2c5433b49b">maxRequestHeaderSize</a>) {</div>
<div class="line"><a id="l00689" name="l00689"></a><span class="lineno">  689</span>            changeState(<a class="code hl_enumvalue" href="namespaceFtp.html#a56abcf0499ca5d50f20f9ce02525124ea21ec8308de0a2e68cac20118053ea9f5">fssError</a>, <span class="stringliteral">&quot;huge req&quot;</span>);</div>
<div class="line"><a id="l00690" name="l00690"></a><span class="lineno">  690</span>            quitAfterError(<span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l00691" name="l00691"></a><span class="lineno">  691</span>            <span class="keywordflow">return</span> earlyError(EarlyErrorKind::HugeRequest);</div>
<div class="line"><a id="l00692" name="l00692"></a><span class="lineno">  692</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00693" name="l00693"></a><span class="lineno">  693</span>            flags.readMore = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00694" name="l00694"></a><span class="lineno">  694</span>            <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;Waiting for more, up to &quot;</span> &lt;&lt;</div>
<div class="line"><a id="l00695" name="l00695"></a><span class="lineno">  695</span>                   (<a class="code hl_variable" href="SquidConfig_8cc.html#a75b136e6a1eef61424d84596a404aafe">Config</a>.<a class="code hl_variable" href="classSquidConfig.html#a9a5a4aaa278ec44c9807fb2c5433b49b">maxRequestHeaderSize</a> - inBuf.length()));</div>
<div class="line"><a id="l00696" name="l00696"></a><span class="lineno">  696</span>            <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00697" name="l00697"></a><span class="lineno">  697</span>        }</div>
<div class="line"><a id="l00698" name="l00698"></a><span class="lineno">  698</span>    }</div>
<div class="line"><a id="l00699" name="l00699"></a><span class="lineno">  699</span> </div>
<div class="line"><a id="l00700" name="l00700"></a><span class="lineno">  700</span>    <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(parsed &amp;&amp; cmd.<a class="code hl_function" href="classSBuf.html#a4fdfe954309aa6da19240f11a8f6b583">length</a>());</div>
<div class="line"><a id="l00701" name="l00701"></a><span class="lineno">  701</span>    consumeInput(<a class="code hl_struct" href="structtok.html">tok</a>.parsedSize()); <span class="comment">// TODO: Would delaying optimize copying?</span></div>
<div class="line"><a id="l00702" name="l00702"></a><span class="lineno">  702</span> </div>
<div class="line"><a id="l00703" name="l00703"></a><span class="lineno">  703</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 2, <span class="stringliteral">&quot;&gt;&gt;ftp &quot;</span> &lt;&lt; cmd &lt;&lt; (params.<a class="code hl_function" href="classSBuf.html#a8bda8fe69e451e61946b35c2a2d2340b">isEmpty</a>() ? <span class="stringliteral">&quot;&quot;</span> : <span class="stringliteral">&quot; &quot;</span>) &lt;&lt; params);</div>
<div class="line"><a id="l00704" name="l00704"></a><span class="lineno">  704</span> </div>
<div class="line"><a id="l00705" name="l00705"></a><span class="lineno">  705</span>    cmd.<a class="code hl_function" href="classSBuf.html#a02393e7599a95c4a7bc89fa645120575">toUpper</a>(); <span class="comment">// this should speed up and simplify future comparisons</span></div>
<div class="line"><a id="l00706" name="l00706"></a><span class="lineno">  706</span> </div>
<div class="line"><a id="l00707" name="l00707"></a><span class="lineno">  707</span>    <span class="comment">// interception cases do not need USER to calculate the uri</span></div>
<div class="line"><a id="l00708" name="l00708"></a><span class="lineno">  708</span>    <span class="keywordflow">if</span> (!transparent()) {</div>
<div class="line"><a id="l00709" name="l00709"></a><span class="lineno">  709</span>        <span class="keywordflow">if</span> (!master-&gt;clientReadGreeting) {</div>
<div class="line"><a id="l00710" name="l00710"></a><span class="lineno">  710</span>            <span class="comment">// the first command must be USER</span></div>
<div class="line"><a id="l00711" name="l00711"></a><span class="lineno">  711</span>            <span class="keywordflow">if</span> (!pinning.pinned &amp;&amp; cmd != <a class="code hl_function" href="namespaceFtp.html#ac55a50b808dcd5c95c9f5ebfe6628128">cmdUser</a>())</div>
<div class="line"><a id="l00712" name="l00712"></a><span class="lineno">  712</span>                <span class="keywordflow">return</span> earlyError(EarlyErrorKind::MissingLogin);</div>
<div class="line"><a id="l00713" name="l00713"></a><span class="lineno">  713</span>        }</div>
<div class="line"><a id="l00714" name="l00714"></a><span class="lineno">  714</span> </div>
<div class="line"><a id="l00715" name="l00715"></a><span class="lineno">  715</span>        <span class="comment">// process USER request now because it sets FTP peer host name</span></div>
<div class="line"><a id="l00716" name="l00716"></a><span class="lineno">  716</span>        <span class="keywordflow">if</span> (cmd == <a class="code hl_function" href="namespaceFtp.html#ac55a50b808dcd5c95c9f5ebfe6628128">cmdUser</a>()) {</div>
<div class="line"><a id="l00717" name="l00717"></a><span class="lineno">  717</span>            <span class="keywordflow">if</span> (<a class="code hl_class" href="classHttp_1_1Stream.html">Http::Stream</a> *errCtx = handleUserRequest(cmd, params))</div>
<div class="line"><a id="l00718" name="l00718"></a><span class="lineno">  718</span>                <span class="keywordflow">return</span> errCtx;</div>
<div class="line"><a id="l00719" name="l00719"></a><span class="lineno">  719</span>        }</div>
<div class="line"><a id="l00720" name="l00720"></a><span class="lineno">  720</span>    }</div>
<div class="line"><a id="l00721" name="l00721"></a><span class="lineno">  721</span> </div>
<div class="line"><a id="l00722" name="l00722"></a><span class="lineno">  722</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="namespaceFtp.html#a14f2935b10878a54a2cc5e6621b3e946">Ftp::SupportedCommand</a>(cmd))</div>
<div class="line"><a id="l00723" name="l00723"></a><span class="lineno">  723</span>        <span class="keywordflow">return</span> earlyError(EarlyErrorKind::UnsupportedCommand);</div>
<div class="line"><a id="l00724" name="l00724"></a><span class="lineno">  724</span> </div>
<div class="line"><a id="l00725" name="l00725"></a><span class="lineno">  725</span>    <span class="keyword">const</span> <a class="code hl_class" href="classHttpRequestMethod.html">HttpRequestMethod</a> method =</div>
<div class="line"><a id="l00726" name="l00726"></a><span class="lineno">  726</span>        cmd == <a class="code hl_function" href="namespaceFtp.html#a1a99fa3e836e0d5c97e88d241976f1bd">cmdAppe</a>() || cmd == <a class="code hl_function" href="namespaceFtp.html#a603e2df6ab8dad0f4b40a86bbfd2e411">cmdStor</a>() || cmd == <a class="code hl_function" href="namespaceFtp.html#a53508f6345902671b349430ab26916d5">cmdStou</a>() ?</div>
<div class="line"><a id="l00727" name="l00727"></a><span class="lineno">  727</span>        <a class="code hl_enumvalue" href="namespaceHttp.html#a84eb275fbe86f9dcc2a0ce9164a60787a3eff063fbded3d15e4cea500e09c2de3">Http::METHOD_PUT</a> : <a class="code hl_enumvalue" href="namespaceHttp.html#a84eb275fbe86f9dcc2a0ce9164a60787abf0f2b96078c49aefdf7ab3ef183a5de">Http::METHOD_GET</a>;</div>
<div class="line"><a id="l00728" name="l00728"></a><span class="lineno">  728</span> </div>
<div class="line"><a id="l00729" name="l00729"></a><span class="lineno">  729</span>    <span class="keyword">const</span> <a class="code hl_class" href="classSBuf.html">SBuf</a> *path = (params.<a class="code hl_function" href="classSBuf.html#a4fdfe954309aa6da19240f11a8f6b583">length</a>() &amp;&amp; <a class="code hl_function" href="namespaceFtp.html#a970f9156aff8feb9e9642c20c5fab8b8">CommandHasPathParameter</a>(cmd)) ?</div>
<div class="line"><a id="l00730" name="l00730"></a><span class="lineno">  730</span>                       &amp;params : <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00731" name="l00731"></a><span class="lineno">  731</span>    calcUri(path);</div>
<div class="line"><a id="l00732" name="l00732"></a><span class="lineno">  732</span>    <span class="keyword">const</span> <span class="keyword">auto</span> mx = <a class="code hl_function" href="classMasterXaction.html#af3cb33c92de57dbb4f9b5a0bf5488ad4">MasterXaction::MakePortful</a>(<a class="code hl_variable" href="eDirectory_2ldap__backend_8cc.html#a63c89c04d1feae07ca35558055155ffb">port</a>);</div>
<div class="line"><a id="l00733" name="l00733"></a><span class="lineno">  733</span>    mx-&gt;tcpClient = clientConnection;</div>
<div class="line"><a id="l00734" name="l00734"></a><span class="lineno">  734</span>    <span class="keyword">auto</span> * <span class="keyword">const</span> request = <a class="code hl_function" href="classHttpRequest.html#ad433674df1fe206d190f89b520d59621">HttpRequest::FromUrl</a>(uri, mx, method);</div>
<div class="line"><a id="l00735" name="l00735"></a><span class="lineno">  735</span>    <span class="keywordflow">if</span> (!request) {</div>
<div class="line"><a id="l00736" name="l00736"></a><span class="lineno">  736</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;Invalid FTP URL: &quot;</span> &lt;&lt; uri);</div>
<div class="line"><a id="l00737" name="l00737"></a><span class="lineno">  737</span>        uri.clear();</div>
<div class="line"><a id="l00738" name="l00738"></a><span class="lineno">  738</span>        <span class="keywordflow">return</span> earlyError(EarlyErrorKind::InvalidUri);</div>
<div class="line"><a id="l00739" name="l00739"></a><span class="lineno">  739</span>    }</div>
<div class="line"><a id="l00740" name="l00740"></a><span class="lineno">  740</span>    <span class="keywordtype">char</span> *newUri = <a class="code hl_define" href="negotiate__wrapper_8cc.html#a5eb055ca3b42205cc134b4a438cd9a72">xstrdup</a>(uri.c_str());</div>
<div class="line"><a id="l00741" name="l00741"></a><span class="lineno">  741</span> </div>
<div class="line"><a id="l00742" name="l00742"></a><span class="lineno">  742</span>    request-&gt;flags.ftpNative = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00743" name="l00743"></a><span class="lineno">  743</span>    request-&gt;http_ver = <a class="code hl_function" href="namespaceHttp.html#a8f5de7a6ddd395e9aaf0dffd043c2276">Http::ProtocolVersion</a>(<a class="code hl_function" href="namespaceFtp.html#a249e9fd7ca0e728fa3cfeee3342d2108">Ftp::ProtocolVersion</a>().major, <a class="code hl_function" href="namespaceFtp.html#a249e9fd7ca0e728fa3cfeee3342d2108">Ftp::ProtocolVersion</a>().minor);</div>
<div class="line"><a id="l00744" name="l00744"></a><span class="lineno">  744</span> </div>
<div class="line"><a id="l00745" name="l00745"></a><span class="lineno">  745</span>    <span class="comment">// Our fake Request-URIs are not distinctive enough for caching to work</span></div>
<div class="line"><a id="l00746" name="l00746"></a><span class="lineno">  746</span>    request-&gt;flags.disableCacheUse(<span class="stringliteral">&quot;FTP command wrapper&quot;</span>);</div>
<div class="line"><a id="l00747" name="l00747"></a><span class="lineno">  747</span> </div>
<div class="line"><a id="l00748" name="l00748"></a><span class="lineno">  748</span>    request-&gt;header.putStr(<a class="code hl_enumvalue" href="namespaceHttp.html#a92faa3c60e0b457c167759389ae061a4a9bdd18abe19a7e3517a6786ae7f15b44">Http::HdrType::FTP_COMMAND</a>, cmd.<a class="code hl_function" href="classSBuf.html#a2a7fda503e54cb36b023dcaaab633f65">c_str</a>());</div>
<div class="line"><a id="l00749" name="l00749"></a><span class="lineno">  749</span>    request-&gt;header.putStr(<a class="code hl_enumvalue" href="namespaceHttp.html#a92faa3c60e0b457c167759389ae061a4af9f4f70983e0f5ffa741f2a523f0eda3">Http::HdrType::FTP_ARGUMENTS</a>, params.<a class="code hl_function" href="classSBuf.html#a2a7fda503e54cb36b023dcaaab633f65">c_str</a>()); <span class="comment">// may be &quot;&quot;</span></div>
<div class="line"><a id="l00750" name="l00750"></a><span class="lineno">  750</span>    <span class="keywordflow">if</span> (method == <a class="code hl_enumvalue" href="namespaceHttp.html#a84eb275fbe86f9dcc2a0ce9164a60787a3eff063fbded3d15e4cea500e09c2de3">Http::METHOD_PUT</a>) {</div>
<div class="line"><a id="l00751" name="l00751"></a><span class="lineno">  751</span>        request-&gt;header.putStr(<a class="code hl_enumvalue" href="namespaceHttp.html#a92faa3c60e0b457c167759389ae061a4a51dab0b7ae28f45fb969fca664517f91">Http::HdrType::EXPECT</a>, <span class="stringliteral">&quot;100-continue&quot;</span>);</div>
<div class="line"><a id="l00752" name="l00752"></a><span class="lineno">  752</span>        request-&gt;header.putStr(<a class="code hl_enumvalue" href="namespaceHttp.html#a92faa3c60e0b457c167759389ae061a4abf644a4ab3a498ed2854c3022837e8f9">Http::HdrType::TRANSFER_ENCODING</a>, <span class="stringliteral">&quot;chunked&quot;</span>);</div>
<div class="line"><a id="l00753" name="l00753"></a><span class="lineno">  753</span>    }</div>
<div class="line"><a id="l00754" name="l00754"></a><span class="lineno">  754</span> </div>
<div class="line"><a id="l00755" name="l00755"></a><span class="lineno">  755</span>    <a class="code hl_class" href="classClientHttpRequest.html">ClientHttpRequest</a> *<span class="keyword">const</span> http = <span class="keyword">new</span> <a class="code hl_class" href="classClientHttpRequest.html">ClientHttpRequest</a>(<span class="keyword">this</span>);</div>
<div class="line"><a id="l00756" name="l00756"></a><span class="lineno">  756</span>    http-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#a88642d6f6a181e20927a9e54cabf3c91">req_sz</a> = <a class="code hl_struct" href="structtok.html">tok</a>.parsedSize();</div>
<div class="line"><a id="l00757" name="l00757"></a><span class="lineno">  757</span>    http-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#ac1d305af64fb92ccfce613c1eb96d178">uri</a> = newUri;</div>
<div class="line"><a id="l00758" name="l00758"></a><span class="lineno">  758</span>    http-&gt;<a class="code hl_function" href="classClientHttpRequest.html#a5912c3e9af285d3f77ec815c719b8105">initRequest</a>(request);</div>
<div class="line"><a id="l00759" name="l00759"></a><span class="lineno">  759</span> </div>
<div class="line"><a id="l00760" name="l00760"></a><span class="lineno">  760</span>    <a class="code hl_class" href="classHttp_1_1Stream.html">Http::Stream</a> *<span class="keyword">const</span> result =</div>
<div class="line"><a id="l00761" name="l00761"></a><span class="lineno">  761</span>        <span class="keyword">new</span> <a class="code hl_class" href="classHttp_1_1Stream.html">Http::Stream</a>(clientConnection, http);</div>
<div class="line"><a id="l00762" name="l00762"></a><span class="lineno">  762</span> </div>
<div class="line"><a id="l00763" name="l00763"></a><span class="lineno">  763</span>    <a class="code hl_class" href="classStoreIOBuffer.html">StoreIOBuffer</a> tempBuffer;</div>
<div class="line"><a id="l00764" name="l00764"></a><span class="lineno">  764</span>    tempBuffer.<a class="code hl_variable" href="classStoreIOBuffer.html#a08224ebb5a73aa6b18c0e7a60ebf00b5">data</a> = result-&gt;<a class="code hl_variable" href="classHttp_1_1Stream.html#aa13355bfcaa6f65caf4b0a64765d5968">reqbuf</a>;</div>
<div class="line"><a id="l00765" name="l00765"></a><span class="lineno">  765</span>    tempBuffer.<a class="code hl_variable" href="classStoreIOBuffer.html#a97772bf328fe745e1d1fc23ee91cec39">length</a> = <a class="code hl_define" href="http_2forward_8h.html#a196f6d12d102aebcc7a2778bea3e6b19">HTTP_REQBUF_SZ</a>;</div>
<div class="line"><a id="l00766" name="l00766"></a><span class="lineno">  766</span> </div>
<div class="line"><a id="l00767" name="l00767"></a><span class="lineno">  767</span>    <a class="code hl_class" href="classRefCount.html">ClientStreamData</a> newServer = <span class="keyword">new</span> <a class="code hl_class" href="classclientReplyContext.html">clientReplyContext</a>(http);</div>
<div class="line"><a id="l00768" name="l00768"></a><span class="lineno">  768</span>    <a class="code hl_class" href="classRefCount.html">ClientStreamData</a> newClient = result;</div>
<div class="line"><a id="l00769" name="l00769"></a><span class="lineno">  769</span>    <a class="code hl_function" href="group__ClientStreamInternal.html#ga73019262f28c27affc3937cac3441a43">clientStreamInit</a>(&amp;http-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#ae2f400bf3f3d140535bfa6c43908a348">client_stream</a>, <a class="code hl_variable" href="client__side_8h.html#ae73f7b10b6c2bd55c5f96c9d62839e8d">clientGetMoreData</a>, <a class="code hl_variable" href="client__side_8h.html#ab806362f706a7b39732957bb45e3c2df">clientReplyDetach</a>,</div>
<div class="line"><a id="l00770" name="l00770"></a><span class="lineno">  770</span>                     <a class="code hl_variable" href="client__side_8h.html#a3d42a7ece901f14e6ec973a0feb096e1">clientReplyStatus</a>, newServer, <a class="code hl_variable" href="client__side_8h.html#aa4068f99f4e406110e3f13bfe5904a93">clientSocketRecipient</a>,</div>
<div class="line"><a id="l00771" name="l00771"></a><span class="lineno">  771</span>                     <a class="code hl_variable" href="client__side_8h.html#a2800047b5d0d3e31d1739cd35378f4ab">clientSocketDetach</a>, newClient, tempBuffer);</div>
<div class="line"><a id="l00772" name="l00772"></a><span class="lineno">  772</span> </div>
<div class="line"><a id="l00773" name="l00773"></a><span class="lineno">  773</span>    result-&gt;<a class="code hl_variable" href="classHttp_1_1Stream.html#a720b33b5850e89ebda3011c853c20f9f">flags</a>.<a class="code hl_variable" href="classHttp_1_1Stream.html#a19ce29fe9e19e5a7ea0f5dedc37895c2">parsed_ok</a> = 1;</div>
<div class="line"><a id="l00774" name="l00774"></a><span class="lineno">  774</span>    <span class="keywordflow">return</span> result;</div>
<div class="line"><a id="l00775" name="l00775"></a><span class="lineno">  775</span>}</div>
</div>
<div class="line"><a id="l00776" name="l00776"></a><span class="lineno">  776</span> </div>
<div class="line"><a id="l00777" name="l00777"></a><span class="lineno">  777</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00778" data-start="{" data-end="}">
<div class="line"><a id="l00778" name="l00778"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#a94f14ee4da75b18e38893f9a0aa69147">  778</a></span><a class="code hl_function" href="classFtp_1_1Server.html#a94f14ee4da75b18e38893f9a0aa69147">Ftp::Server::handleReply</a>(<a class="code hl_class" href="classHttpReply.html">HttpReply</a> *reply, <a class="code hl_class" href="classStoreIOBuffer.html">StoreIOBuffer</a> data)</div>
<div class="line"><a id="l00779" name="l00779"></a><span class="lineno">  779</span>{</div>
<div class="line"><a id="l00780" name="l00780"></a><span class="lineno">  780</span>    <span class="comment">// the caller guarantees that we are dealing with the current context only</span></div>
<div class="line"><a id="l00781" name="l00781"></a><span class="lineno">  781</span>    <a class="code hl_class" href="classRefCount.html">Http::StreamPointer</a> context = pipeline.front();</div>
<div class="line"><a id="l00782" name="l00782"></a><span class="lineno">  782</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(context != <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l00783" name="l00783"></a><span class="lineno">  783</span> </div>
<div class="line"><a id="l00784" name="l00784"></a><span class="lineno">  784</span>    <span class="keyword">static</span> ReplyHandler handlers[] = {</div>
<div class="line"><a id="l00785" name="l00785"></a><span class="lineno">  785</span>        <span class="keyword">nullptr</span>, <span class="comment">// fssBegin</span></div>
<div class="line"><a id="l00786" name="l00786"></a><span class="lineno">  786</span>        <span class="keyword">nullptr</span>, <span class="comment">// fssConnected</span></div>
<div class="line"><a id="l00787" name="l00787"></a><span class="lineno">  787</span>        &amp;<a class="code hl_function" href="classFtp_1_1Server.html#a569ffc9a347f8ae7b1aa38c6067b95ac">Ftp::Server::handleFeatReply</a>, <span class="comment">// fssHandleFeat</span></div>
<div class="line"><a id="l00788" name="l00788"></a><span class="lineno">  788</span>        &amp;<a class="code hl_function" href="classFtp_1_1Server.html#a50165f8199d17e1552aab0fcf077b4d8">Ftp::Server::handlePasvReply</a>, <span class="comment">// fssHandlePasv</span></div>
<div class="line"><a id="l00789" name="l00789"></a><span class="lineno">  789</span>        &amp;<a class="code hl_function" href="classFtp_1_1Server.html#a84749bf0f7e8946f7e818435bd00a02c">Ftp::Server::handlePortReply</a>, <span class="comment">// fssHandlePort</span></div>
<div class="line"><a id="l00790" name="l00790"></a><span class="lineno">  790</span>        &amp;<a class="code hl_function" href="classFtp_1_1Server.html#a0242af8d0555c33f19ca03d00d3319fc">Ftp::Server::handleDataReply</a>, <span class="comment">// fssHandleDataRequest</span></div>
<div class="line"><a id="l00791" name="l00791"></a><span class="lineno">  791</span>        &amp;<a class="code hl_function" href="classFtp_1_1Server.html#ac65b32892d544696d1f6b650f028b8c7">Ftp::Server::handleUploadReply</a>, <span class="comment">// fssHandleUploadRequest</span></div>
<div class="line"><a id="l00792" name="l00792"></a><span class="lineno">  792</span>        &amp;<a class="code hl_function" href="classFtp_1_1Server.html#a45ebf20dc16be23b519c2e6f65cad88f">Ftp::Server::handleEprtReply</a>,<span class="comment">// fssHandleEprt</span></div>
<div class="line"><a id="l00793" name="l00793"></a><span class="lineno">  793</span>        &amp;<a class="code hl_function" href="classFtp_1_1Server.html#ab78c320c4406518c7e1b2c08b45a4749">Ftp::Server::handleEpsvReply</a>,<span class="comment">// fssHandleEpsv</span></div>
<div class="line"><a id="l00794" name="l00794"></a><span class="lineno">  794</span>        <span class="keyword">nullptr</span>, <span class="comment">// fssHandleCwd</span></div>
<div class="line"><a id="l00795" name="l00795"></a><span class="lineno">  795</span>        <span class="keyword">nullptr</span>, <span class="comment">// fssHandlePass</span></div>
<div class="line"><a id="l00796" name="l00796"></a><span class="lineno">  796</span>        <span class="keyword">nullptr</span>, <span class="comment">// fssHandleCdup</span></div>
<div class="line"><a id="l00797" name="l00797"></a><span class="lineno">  797</span>        &amp;<a class="code hl_function" href="classFtp_1_1Server.html#a8dfc2912a7b006956187cdab988ad628">Ftp::Server::handleErrorReply</a> <span class="comment">// fssError</span></div>
<div class="line"><a id="l00798" name="l00798"></a><span class="lineno">  798</span>    };</div>
<div class="line"><a id="l00799" name="l00799"></a><span class="lineno">  799</span>    <span class="keywordflow">try</span> {</div>
<div class="line"><a id="l00800" name="l00800"></a><span class="lineno">  800</span>        <span class="keyword">const</span> <a class="code hl_class" href="classFtp_1_1Server.html">Server</a> &amp;<a class="code hl_variable" href="basic__radius__auth_8cc.html#aa8195632e4f244f5dbb6f0728cce9682">server</a> = <span class="keyword">dynamic_cast&lt;</span><span class="keyword">const </span><a class="code hl_class" href="classFtp_1_1Server.html">Ftp::Server</a>&amp;<span class="keyword">&gt;</span>(*context-&gt;getConn());</div>
<div class="line"><a id="l00801" name="l00801"></a><span class="lineno">  801</span>        <span class="keywordflow">if</span> (<span class="keyword">const</span> ReplyHandler handler = handlers[<a class="code hl_variable" href="basic__radius__auth_8cc.html#aa8195632e4f244f5dbb6f0728cce9682">server</a>.master-&gt;serverState])</div>
<div class="line"><a id="l00802" name="l00802"></a><span class="lineno">  802</span>            (this-&gt;*handler)(reply, data);</div>
<div class="line"><a id="l00803" name="l00803"></a><span class="lineno">  803</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l00804" name="l00804"></a><span class="lineno">  804</span>            writeForwardedReply(reply);</div>
<div class="line"><a id="l00805" name="l00805"></a><span class="lineno">  805</span>    } <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception &amp;e) {</div>
<div class="line"><a id="l00806" name="l00806"></a><span class="lineno">  806</span>        callException(e);</div>
<div class="line"><a id="l00807" name="l00807"></a><span class="lineno">  807</span>        <span class="keywordflow">throw</span> <a class="code hl_define" href="TextException_8h.html#a2cf020aa9d72c2ec7abef506457b2f9a">TexcHere</a>(e.what());</div>
<div class="line"><a id="l00808" name="l00808"></a><span class="lineno">  808</span>    }</div>
<div class="line"><a id="l00809" name="l00809"></a><span class="lineno">  809</span>}</div>
</div>
<div class="line"><a id="l00810" name="l00810"></a><span class="lineno">  810</span> </div>
<div class="line"><a id="l00811" name="l00811"></a><span class="lineno">  811</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00812" data-start="{" data-end="}">
<div class="line"><a id="l00812" name="l00812"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#a569ffc9a347f8ae7b1aa38c6067b95ac">  812</a></span><a class="code hl_function" href="classFtp_1_1Server.html#a569ffc9a347f8ae7b1aa38c6067b95ac">Ftp::Server::handleFeatReply</a>(<span class="keyword">const</span> <a class="code hl_class" href="classHttpReply.html">HttpReply</a> *reply, <a class="code hl_class" href="classStoreIOBuffer.html">StoreIOBuffer</a>)</div>
<div class="line"><a id="l00813" name="l00813"></a><span class="lineno">  813</span>{</div>
<div class="line"><a id="l00814" name="l00814"></a><span class="lineno">  814</span>    <span class="keywordflow">if</span> (pipeline.front()-&gt;http-&gt;request-&gt;error) {</div>
<div class="line"><a id="l00815" name="l00815"></a><span class="lineno">  815</span>        writeCustomReply(502, <span class="stringliteral">&quot;Server does not support FEAT&quot;</span>, reply);</div>
<div class="line"><a id="l00816" name="l00816"></a><span class="lineno">  816</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00817" name="l00817"></a><span class="lineno">  817</span>    }</div>
<div class="line"><a id="l00818" name="l00818"></a><span class="lineno">  818</span> </div>
<div class="line"><a id="l00819" name="l00819"></a><span class="lineno">  819</span>    <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(reply);</div>
<div class="line"><a id="l00820" name="l00820"></a><span class="lineno">  820</span>    <a class="code hl_class" href="classRefCount.html">HttpReply::Pointer</a> featReply = <a class="code hl_function" href="namespaceFtp.html#ac99540d79350b5eec3729725a8a52a55">Ftp::HttpReplyWrapper</a>(211, <span class="stringliteral">&quot;End&quot;</span>, <a class="code hl_enumvalue" href="namespaceHttp.html#a432f881deb187c726161d6435daec722ab95a10cc149f601422b96a56b2acf1f7">Http::scNoContent</a>, 0);</div>
<div class="line"><a id="l00821" name="l00821"></a><span class="lineno">  821</span>    <a class="code hl_class" href="classHttpHeader.html">HttpHeader</a> <span class="keyword">const</span> &amp;serverReplyHeader = reply-&gt;<a class="code hl_variable" href="classHttp_1_1Message.html#a79ae935ff618211b139dcfdd8a5277ec">header</a>;</div>
<div class="line"><a id="l00822" name="l00822"></a><span class="lineno">  822</span> </div>
<div class="line"><a id="l00823" name="l00823"></a><span class="lineno">  823</span>    <a class="code hl_typedef" href="HttpHeader_8h.html#aac9fc01c2b9cda8c02b1f7f8a2a9c78b">HttpHeaderPos</a> pos = <a class="code hl_define" href="HttpHeader_8h.html#abf5d862281ddf9a5315fcfa5be166c07">HttpHeaderInitPos</a>;</div>
<div class="line"><a id="l00824" name="l00824"></a><span class="lineno">  824</span>    <span class="keywordtype">bool</span> hasEPRT = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00825" name="l00825"></a><span class="lineno">  825</span>    <span class="keywordtype">bool</span> hasEPSV = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00826" name="l00826"></a><span class="lineno">  826</span>    <span class="keywordtype">int</span> prependSpaces = 1;</div>
<div class="line"><a id="l00827" name="l00827"></a><span class="lineno">  827</span> </div>
<div class="line"><a id="l00828" name="l00828"></a><span class="lineno">  828</span>    featReply-&gt;<a class="code hl_variable" href="classHttp_1_1Message.html#a79ae935ff618211b139dcfdd8a5277ec">header</a>.<a class="code hl_function" href="classHttpHeader.html#a187949b24278b65f28338947c605b130">putStr</a>(<a class="code hl_enumvalue" href="namespaceHttp.html#a92faa3c60e0b457c167759389ae061a4a09b6d21d0dfd00e8253d5c524fd848d4">Http::HdrType::FTP_PRE</a>, <span class="stringliteral">&quot;\&quot;211-Features:\&quot;&quot;</span>);</div>
<div class="line"><a id="l00829" name="l00829"></a><span class="lineno">  829</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> scode = serverReplyHeader.<a class="code hl_function" href="classHttpHeader.html#ac372a06ceba805a52c4bce9cce8b28d8">getInt</a>(<a class="code hl_enumvalue" href="namespaceHttp.html#a92faa3c60e0b457c167759389ae061a4a441d11bb798c52af629374cdac708ffa">Http::HdrType::FTP_STATUS</a>);</div>
<div class="line"><a id="l00830" name="l00830"></a><span class="lineno">  830</span>    <span class="keywordflow">if</span> (scode == 211) {</div>
<div class="line"><a id="l00831" name="l00831"></a><span class="lineno">  831</span>        <span class="keywordflow">while</span> (<span class="keyword">const</span> <a class="code hl_class" href="classHttpHeaderEntry.html">HttpHeaderEntry</a> *e = serverReplyHeader.<a class="code hl_function" href="classHttpHeader.html#a81cb2fc85a9629783ba1e607de0f41ed">getEntry</a>(&amp;pos)) {</div>
<div class="line"><a id="l00832" name="l00832"></a><span class="lineno">  832</span>            <span class="keywordflow">if</span> (e-&gt;id == <a class="code hl_enumvalue" href="namespaceHttp.html#a92faa3c60e0b457c167759389ae061a4a09b6d21d0dfd00e8253d5c524fd848d4">Http::HdrType::FTP_PRE</a>) {</div>
<div class="line"><a id="l00833" name="l00833"></a><span class="lineno">  833</span>                <span class="comment">// assume RFC 2389 FEAT response format, quoted by Squid:</span></div>
<div class="line"><a id="l00834" name="l00834"></a><span class="lineno">  834</span>                <span class="comment">// &lt;&quot;&gt; SP NAME [SP PARAMS] &lt;&quot;&gt;</span></div>
<div class="line"><a id="l00835" name="l00835"></a><span class="lineno">  835</span>                <span class="comment">// but accommodate MS servers sending four SPs before NAME</span></div>
<div class="line"><a id="l00836" name="l00836"></a><span class="lineno">  836</span> </div>
<div class="line"><a id="l00837" name="l00837"></a><span class="lineno">  837</span>                <span class="comment">// command name ends with (SP parameter) or quote</span></div>
<div class="line"><a id="l00838" name="l00838"></a><span class="lineno">  838</span>                <span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classCharacterSet.html">CharacterSet</a> AfterFeatNameChars(<span class="stringliteral">&quot;AfterFeatName&quot;</span>, <span class="stringliteral">&quot; \&quot;&quot;</span>);</div>
<div class="line"><a id="l00839" name="l00839"></a><span class="lineno">  839</span>                <span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classCharacterSet.html">CharacterSet</a> FeatNameChars = AfterFeatNameChars.<a class="code hl_function" href="classCharacterSet.html#a1b83850bb6e25b80633a956162d720f4">complement</a>(<span class="stringliteral">&quot;FeatName&quot;</span>);</div>
<div class="line"><a id="l00840" name="l00840"></a><span class="lineno">  840</span> </div>
<div class="line"><a id="l00841" name="l00841"></a><span class="lineno">  841</span>                <a class="code hl_class" href="classParser_1_1Tokenizer.html">Parser::Tokenizer</a> <a class="code hl_struct" href="structtok.html">tok</a>(<a class="code hl_class" href="classSBuf.html">SBuf</a>(e-&gt;value.termedBuf()));</div>
<div class="line"><a id="l00842" name="l00842"></a><span class="lineno">  842</span>                <span class="keywordflow">if</span> (!<a class="code hl_struct" href="structtok.html">tok</a>.skip(<span class="charliteral">&#39;&quot;&#39;</span>) || !<a class="code hl_struct" href="structtok.html">tok</a>.skip(<span class="charliteral">&#39; &#39;</span>))</div>
<div class="line"><a id="l00843" name="l00843"></a><span class="lineno">  843</span>                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00844" name="l00844"></a><span class="lineno">  844</span> </div>
<div class="line"><a id="l00845" name="l00845"></a><span class="lineno">  845</span>                <span class="comment">// optional spaces; remember their number to accommodate MS servers</span></div>
<div class="line"><a id="l00846" name="l00846"></a><span class="lineno">  846</span>                prependSpaces = 1 + <a class="code hl_struct" href="structtok.html">tok</a>.skipAll(<a class="code hl_variable" href="classCharacterSet.html#a3cbeebe695817ffd06be28481004f787">CharacterSet::SP</a>);</div>
<div class="line"><a id="l00847" name="l00847"></a><span class="lineno">  847</span> </div>
<div class="line"><a id="l00848" name="l00848"></a><span class="lineno">  848</span>                <a class="code hl_class" href="classSBuf.html">SBuf</a> cmd;</div>
<div class="line"><a id="l00849" name="l00849"></a><span class="lineno">  849</span>                <span class="keywordflow">if</span> (!<a class="code hl_struct" href="structtok.html">tok</a>.prefix(cmd, FeatNameChars))</div>
<div class="line"><a id="l00850" name="l00850"></a><span class="lineno">  850</span>                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00851" name="l00851"></a><span class="lineno">  851</span>                cmd.<a class="code hl_function" href="classSBuf.html#a02393e7599a95c4a7bc89fa645120575">toUpper</a>();</div>
<div class="line"><a id="l00852" name="l00852"></a><span class="lineno">  852</span> </div>
<div class="line"><a id="l00853" name="l00853"></a><span class="lineno">  853</span>                <span class="keywordflow">if</span> (<a class="code hl_function" href="namespaceFtp.html#a14f2935b10878a54a2cc5e6621b3e946">Ftp::SupportedCommand</a>(cmd)) {</div>
<div class="line"><a id="l00854" name="l00854"></a><span class="lineno">  854</span>                    featReply-&gt;<a class="code hl_variable" href="classHttp_1_1Message.html#a79ae935ff618211b139dcfdd8a5277ec">header</a>.<a class="code hl_function" href="classHttpHeader.html#aa5d893d7e238241fc80e96d6705e5699">addEntry</a>(e-&gt;clone());</div>
<div class="line"><a id="l00855" name="l00855"></a><span class="lineno">  855</span>                }</div>
<div class="line"><a id="l00856" name="l00856"></a><span class="lineno">  856</span> </div>
<div class="line"><a id="l00857" name="l00857"></a><span class="lineno">  857</span>                <span class="keywordflow">if</span> (cmd == <a class="code hl_function" href="namespaceFtp.html#aaa24147f4a5f2761ce9117f19e706da4">cmdEprt</a>())</div>
<div class="line"><a id="l00858" name="l00858"></a><span class="lineno">  858</span>                    hasEPRT = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00859" name="l00859"></a><span class="lineno">  859</span>                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cmd == <a class="code hl_function" href="namespaceFtp.html#a42edcb3767e7fdd8e3e7742ca5d7f7a2">cmdEpsv</a>())</div>
<div class="line"><a id="l00860" name="l00860"></a><span class="lineno">  860</span>                    hasEPSV = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00861" name="l00861"></a><span class="lineno">  861</span>            }</div>
<div class="line"><a id="l00862" name="l00862"></a><span class="lineno">  862</span>        }</div>
<div class="line"><a id="l00863" name="l00863"></a><span class="lineno">  863</span>    } <span class="comment">// else we got a FEAT error and will only report Squid-supported features</span></div>
<div class="line"><a id="l00864" name="l00864"></a><span class="lineno">  864</span> </div>
<div class="line"><a id="l00865" name="l00865"></a><span class="lineno">  865</span>    <span class="keywordtype">char</span> buf[256];</div>
<div class="line"><a id="l00866" name="l00866"></a><span class="lineno">  866</span>    <span class="keywordflow">if</span> (!hasEPRT) {</div>
<div class="line"><a id="l00867" name="l00867"></a><span class="lineno">  867</span>        snprintf(buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;\&quot;%*s\&quot;&quot;</span>, prependSpaces + 4, <span class="stringliteral">&quot;EPRT&quot;</span>);</div>
<div class="line"><a id="l00868" name="l00868"></a><span class="lineno">  868</span>        featReply-&gt;<a class="code hl_variable" href="classHttp_1_1Message.html#a79ae935ff618211b139dcfdd8a5277ec">header</a>.<a class="code hl_function" href="classHttpHeader.html#a187949b24278b65f28338947c605b130">putStr</a>(<a class="code hl_enumvalue" href="namespaceHttp.html#a92faa3c60e0b457c167759389ae061a4a09b6d21d0dfd00e8253d5c524fd848d4">Http::HdrType::FTP_PRE</a>, buf);</div>
<div class="line"><a id="l00869" name="l00869"></a><span class="lineno">  869</span>    }</div>
<div class="line"><a id="l00870" name="l00870"></a><span class="lineno">  870</span>    <span class="keywordflow">if</span> (!hasEPSV) {</div>
<div class="line"><a id="l00871" name="l00871"></a><span class="lineno">  871</span>        snprintf(buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;\&quot;%*s\&quot;&quot;</span>, prependSpaces + 4, <span class="stringliteral">&quot;EPSV&quot;</span>);</div>
<div class="line"><a id="l00872" name="l00872"></a><span class="lineno">  872</span>        featReply-&gt;<a class="code hl_variable" href="classHttp_1_1Message.html#a79ae935ff618211b139dcfdd8a5277ec">header</a>.<a class="code hl_function" href="classHttpHeader.html#a187949b24278b65f28338947c605b130">putStr</a>(<a class="code hl_enumvalue" href="namespaceHttp.html#a92faa3c60e0b457c167759389ae061a4a09b6d21d0dfd00e8253d5c524fd848d4">Http::HdrType::FTP_PRE</a>, buf);</div>
<div class="line"><a id="l00873" name="l00873"></a><span class="lineno">  873</span>    }</div>
<div class="line"><a id="l00874" name="l00874"></a><span class="lineno">  874</span> </div>
<div class="line"><a id="l00875" name="l00875"></a><span class="lineno">  875</span>    featReply-&gt;<a class="code hl_variable" href="classHttp_1_1Message.html#a79ae935ff618211b139dcfdd8a5277ec">header</a>.<a class="code hl_function" href="classHttpHeader.html#a6a5a2911b3e812c91b5eab549fcf2f09">refreshMask</a>();</div>
<div class="line"><a id="l00876" name="l00876"></a><span class="lineno">  876</span> </div>
<div class="line"><a id="l00877" name="l00877"></a><span class="lineno">  877</span>    writeForwardedReply(featReply.<a class="code hl_function" href="classRefCount.html#a9f2168c1df4a4ab6b7931425d85c37f0">getRaw</a>());</div>
<div class="line"><a id="l00878" name="l00878"></a><span class="lineno">  878</span>}</div>
</div>
<div class="line"><a id="l00879" name="l00879"></a><span class="lineno">  879</span> </div>
<div class="line"><a id="l00880" name="l00880"></a><span class="lineno">  880</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00881" data-start="{" data-end="}">
<div class="line"><a id="l00881" name="l00881"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#a50165f8199d17e1552aab0fcf077b4d8">  881</a></span><a class="code hl_function" href="classFtp_1_1Server.html#a50165f8199d17e1552aab0fcf077b4d8">Ftp::Server::handlePasvReply</a>(<span class="keyword">const</span> <a class="code hl_class" href="classHttpReply.html">HttpReply</a> *reply, <a class="code hl_class" href="classStoreIOBuffer.html">StoreIOBuffer</a>)</div>
<div class="line"><a id="l00882" name="l00882"></a><span class="lineno">  882</span>{</div>
<div class="line"><a id="l00883" name="l00883"></a><span class="lineno">  883</span>    <span class="keyword">const</span> <a class="code hl_class" href="classRefCount.html">Http::StreamPointer</a> context(pipeline.front());</div>
<div class="line"><a id="l00884" name="l00884"></a><span class="lineno">  884</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(context != <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l00885" name="l00885"></a><span class="lineno">  885</span> </div>
<div class="line"><a id="l00886" name="l00886"></a><span class="lineno">  886</span>    <span class="keywordflow">if</span> (context-&gt;http-&gt;request-&gt;error) {</div>
<div class="line"><a id="l00887" name="l00887"></a><span class="lineno">  887</span>        writeCustomReply(502, <span class="stringliteral">&quot;Server does not support PASV&quot;</span>, reply);</div>
<div class="line"><a id="l00888" name="l00888"></a><span class="lineno">  888</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00889" name="l00889"></a><span class="lineno">  889</span>    }</div>
<div class="line"><a id="l00890" name="l00890"></a><span class="lineno">  890</span> </div>
<div class="line"><a id="l00891" name="l00891"></a><span class="lineno">  891</span>    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> localPort = listenForDataConnection();</div>
<div class="line"><a id="l00892" name="l00892"></a><span class="lineno">  892</span>    <span class="keywordflow">if</span> (!localPort)</div>
<div class="line"><a id="l00893" name="l00893"></a><span class="lineno">  893</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00894" name="l00894"></a><span class="lineno">  894</span> </div>
<div class="line"><a id="l00895" name="l00895"></a><span class="lineno">  895</span>    <span class="keywordtype">char</span> addr[<a class="code hl_define" href="ip_2forward_8h.html#a28806a9f06b4d32dab73b27053f10494">MAX_IPSTRLEN</a>];</div>
<div class="line"><a id="l00896" name="l00896"></a><span class="lineno">  896</span>    <span class="comment">// remote server in interception setups and local address otherwise</span></div>
<div class="line"><a id="l00897" name="l00897"></a><span class="lineno">  897</span>    <span class="keyword">const</span> <a class="code hl_class" href="classIp_1_1Address.html">Ip::Address</a> &amp;<a class="code hl_variable" href="basic__radius__auth_8cc.html#aa8195632e4f244f5dbb6f0728cce9682">server</a> = transparent() ?</div>
<div class="line"><a id="l00898" name="l00898"></a><span class="lineno">  898</span>                                clientConnection-&gt;local : dataListenConn-&gt;local;</div>
<div class="line"><a id="l00899" name="l00899"></a><span class="lineno">  899</span>    <a class="code hl_variable" href="basic__radius__auth_8cc.html#aa8195632e4f244f5dbb6f0728cce9682">server</a>.<a class="code hl_function" href="classIp_1_1Address.html#a00a47f51e0c2b78115495af295924aee">toStr</a>(addr, <a class="code hl_define" href="ip_2forward_8h.html#a28806a9f06b4d32dab73b27053f10494">MAX_IPSTRLEN</a>, AF_INET);</div>
<div class="line"><a id="l00900" name="l00900"></a><span class="lineno">  900</span>    addr[<a class="code hl_define" href="ip_2forward_8h.html#a28806a9f06b4d32dab73b27053f10494">MAX_IPSTRLEN</a> - 1] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><a id="l00901" name="l00901"></a><span class="lineno">  901</span>    <span class="keywordflow">for</span> (<span class="keywordtype">char</span> *c = addr; *c != <span class="charliteral">&#39;\0&#39;</span>; ++c) {</div>
<div class="line"><a id="l00902" name="l00902"></a><span class="lineno">  902</span>        <span class="keywordflow">if</span> (*c == <span class="charliteral">&#39;.&#39;</span>)</div>
<div class="line"><a id="l00903" name="l00903"></a><span class="lineno">  903</span>            *c = <span class="charliteral">&#39;,&#39;</span>;</div>
<div class="line"><a id="l00904" name="l00904"></a><span class="lineno">  904</span>    }</div>
<div class="line"><a id="l00905" name="l00905"></a><span class="lineno">  905</span> </div>
<div class="line"><a id="l00906" name="l00906"></a><span class="lineno">  906</span>    <span class="comment">// In interception setups, we combine remote server address with a</span></div>
<div class="line"><a id="l00907" name="l00907"></a><span class="lineno">  907</span>    <span class="comment">// local port number and hope that traffic will be redirected to us.</span></div>
<div class="line"><a id="l00908" name="l00908"></a><span class="lineno">  908</span>    <span class="comment">// Do not use &quot;227 =a,b,c,d,p1,p2&quot; format or omit parens: some nf_ct_ftp</span></div>
<div class="line"><a id="l00909" name="l00909"></a><span class="lineno">  909</span>    <span class="comment">// versions block responses that use those alternative syntax rules!</span></div>
<div class="line"><a id="l00910" name="l00910"></a><span class="lineno">  910</span>    <a class="code hl_class" href="classMemBuf.html">MemBuf</a> mb;</div>
<div class="line"><a id="l00911" name="l00911"></a><span class="lineno">  911</span>    mb.<a class="code hl_function" href="classMemBuf.html#a4a615d8e887439c66e04aab70f8be60a">init</a>();</div>
<div class="line"><a id="l00912" name="l00912"></a><span class="lineno">  912</span>    mb.<a class="code hl_function" href="classPackable.html#ab3147943b218d2943726aeaf135dd776">appendf</a>(<span class="stringliteral">&quot;227 Entering Passive Mode (%s,%i,%i).\r\n&quot;</span>,</div>
<div class="line"><a id="l00913" name="l00913"></a><span class="lineno">  913</span>               addr,</div>
<div class="line"><a id="l00914" name="l00914"></a><span class="lineno">  914</span>               <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(localPort / 256),</div>
<div class="line"><a id="l00915" name="l00915"></a><span class="lineno">  915</span>               <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(localPort % 256));</div>
<div class="line"><a id="l00916" name="l00916"></a><span class="lineno">  916</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(9, 3, <a class="code hl_class" href="classRaw.html">Raw</a>(<span class="stringliteral">&quot;writing&quot;</span>, mb.<a class="code hl_variable" href="classMemBuf.html#a78daaa064a5aa4557e283a01c4aa27f1">buf</a>, mb.<a class="code hl_variable" href="classMemBuf.html#a512e0e6f4a6b327f31c9db28fe9aaeb3">size</a>));</div>
<div class="line"><a id="l00917" name="l00917"></a><span class="lineno">  917</span>    writeReply(mb);</div>
<div class="line"><a id="l00918" name="l00918"></a><span class="lineno">  918</span>}</div>
</div>
<div class="line"><a id="l00919" name="l00919"></a><span class="lineno">  919</span> </div>
<div class="line"><a id="l00920" name="l00920"></a><span class="lineno">  920</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00921" data-start="{" data-end="}">
<div class="line"><a id="l00921" name="l00921"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#a84749bf0f7e8946f7e818435bd00a02c">  921</a></span><a class="code hl_function" href="classFtp_1_1Server.html#a84749bf0f7e8946f7e818435bd00a02c">Ftp::Server::handlePortReply</a>(<span class="keyword">const</span> <a class="code hl_class" href="classHttpReply.html">HttpReply</a> *reply, <a class="code hl_class" href="classStoreIOBuffer.html">StoreIOBuffer</a>)</div>
<div class="line"><a id="l00922" name="l00922"></a><span class="lineno">  922</span>{</div>
<div class="line"><a id="l00923" name="l00923"></a><span class="lineno">  923</span>    <span class="keywordflow">if</span> (pipeline.front()-&gt;http-&gt;request-&gt;error) {</div>
<div class="line"><a id="l00924" name="l00924"></a><span class="lineno">  924</span>        writeCustomReply(502, <span class="stringliteral">&quot;Server does not support PASV (converted from PORT)&quot;</span>, reply);</div>
<div class="line"><a id="l00925" name="l00925"></a><span class="lineno">  925</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00926" name="l00926"></a><span class="lineno">  926</span>    }</div>
<div class="line"><a id="l00927" name="l00927"></a><span class="lineno">  927</span> </div>
<div class="line"><a id="l00928" name="l00928"></a><span class="lineno">  928</span>    writeCustomReply(200, <span class="stringliteral">&quot;PORT successfully converted to PASV.&quot;</span>);</div>
<div class="line"><a id="l00929" name="l00929"></a><span class="lineno">  929</span> </div>
<div class="line"><a id="l00930" name="l00930"></a><span class="lineno">  930</span>    <span class="comment">// and wait for RETR</span></div>
<div class="line"><a id="l00931" name="l00931"></a><span class="lineno">  931</span>}</div>
</div>
<div class="line"><a id="l00932" name="l00932"></a><span class="lineno">  932</span> </div>
<div class="line"><a id="l00933" name="l00933"></a><span class="lineno">  933</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00934" data-start="{" data-end="}">
<div class="line"><a id="l00934" name="l00934"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#a8dfc2912a7b006956187cdab988ad628">  934</a></span><a class="code hl_function" href="classFtp_1_1Server.html#a8dfc2912a7b006956187cdab988ad628">Ftp::Server::handleErrorReply</a>(<span class="keyword">const</span> <a class="code hl_class" href="classHttpReply.html">HttpReply</a> *reply, <a class="code hl_class" href="classStoreIOBuffer.html">StoreIOBuffer</a>)</div>
<div class="line"><a id="l00935" name="l00935"></a><span class="lineno">  935</span>{</div>
<div class="line"><a id="l00936" name="l00936"></a><span class="lineno">  936</span>    <span class="keywordflow">if</span> (!pinning.pinned) <span class="comment">// we failed to connect to server</span></div>
<div class="line"><a id="l00937" name="l00937"></a><span class="lineno">  937</span>        uri.clear();</div>
<div class="line"><a id="l00938" name="l00938"></a><span class="lineno">  938</span>    <span class="comment">// 421: we will close due to fssError</span></div>
<div class="line"><a id="l00939" name="l00939"></a><span class="lineno">  939</span>    writeErrorReply(reply, 421);</div>
<div class="line"><a id="l00940" name="l00940"></a><span class="lineno">  940</span>}</div>
</div>
<div class="line"><a id="l00941" name="l00941"></a><span class="lineno">  941</span> </div>
<div class="line"><a id="l00942" name="l00942"></a><span class="lineno">  942</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00943" data-start="{" data-end="}">
<div class="line"><a id="l00943" name="l00943"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#a0242af8d0555c33f19ca03d00d3319fc">  943</a></span><a class="code hl_function" href="classFtp_1_1Server.html#a0242af8d0555c33f19ca03d00d3319fc">Ftp::Server::handleDataReply</a>(<span class="keyword">const</span> <a class="code hl_class" href="classHttpReply.html">HttpReply</a> *reply, <a class="code hl_class" href="classStoreIOBuffer.html">StoreIOBuffer</a> data)</div>
<div class="line"><a id="l00944" name="l00944"></a><span class="lineno">  944</span>{</div>
<div class="line"><a id="l00945" name="l00945"></a><span class="lineno">  945</span>    <span class="keywordflow">if</span> (reply != <span class="keyword">nullptr</span> &amp;&amp; reply-&gt;<a class="code hl_variable" href="classHttpReply.html#a01790af23c553b590ac6009ebb693b6d">sline</a>.<a class="code hl_function" href="classHttp_1_1StatusLine.html#af852e58bb3e96bc41cd16787b0a7d7db">status</a>() != <a class="code hl_enumvalue" href="namespaceHttp.html#a432f881deb187c726161d6435daec722aad8d279f381aa192a9f4389158d1b25e">Http::scOkay</a>) {</div>
<div class="line"><a id="l00946" name="l00946"></a><span class="lineno">  946</span>        writeForwardedReply(reply);</div>
<div class="line"><a id="l00947" name="l00947"></a><span class="lineno">  947</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="namespaceComm.html#a91f0a0e22e74a7ad6f7c44c137c6f005">Comm::IsConnOpen</a>(dataConn)) {</div>
<div class="line"><a id="l00948" name="l00948"></a><span class="lineno">  948</span>            <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 3, <span class="stringliteral">&quot;closing &quot;</span> &lt;&lt; dataConn &lt;&lt; <span class="stringliteral">&quot; on KO reply&quot;</span>);</div>
<div class="line"><a id="l00949" name="l00949"></a><span class="lineno">  949</span>            closeDataConnection();</div>
<div class="line"><a id="l00950" name="l00950"></a><span class="lineno">  950</span>        }</div>
<div class="line"><a id="l00951" name="l00951"></a><span class="lineno">  951</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00952" name="l00952"></a><span class="lineno">  952</span>    }</div>
<div class="line"><a id="l00953" name="l00953"></a><span class="lineno">  953</span> </div>
<div class="line"><a id="l00954" name="l00954"></a><span class="lineno">  954</span>    <span class="keywordflow">if</span> (!dataConn) {</div>
<div class="line"><a id="l00955" name="l00955"></a><span class="lineno">  955</span>        <span class="comment">// We got STREAM_COMPLETE (or error) and closed the client data conn.</span></div>
<div class="line"><a id="l00956" name="l00956"></a><span class="lineno">  956</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 3, <span class="stringliteral">&quot;ignoring FTP srv data response after clt data closure&quot;</span>);</div>
<div class="line"><a id="l00957" name="l00957"></a><span class="lineno">  957</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00958" name="l00958"></a><span class="lineno">  958</span>    }</div>
<div class="line"><a id="l00959" name="l00959"></a><span class="lineno">  959</span> </div>
<div class="line"><a id="l00960" name="l00960"></a><span class="lineno">  960</span>    <span class="keywordflow">if</span> (!checkDataConnPost()) {</div>
<div class="line"><a id="l00961" name="l00961"></a><span class="lineno">  961</span>        writeCustomReply(425, <span class="stringliteral">&quot;Data connection is not established.&quot;</span>);</div>
<div class="line"><a id="l00962" name="l00962"></a><span class="lineno">  962</span>        closeDataConnection();</div>
<div class="line"><a id="l00963" name="l00963"></a><span class="lineno">  963</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00964" name="l00964"></a><span class="lineno">  964</span>    }</div>
<div class="line"><a id="l00965" name="l00965"></a><span class="lineno">  965</span> </div>
<div class="line"><a id="l00966" name="l00966"></a><span class="lineno">  966</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 7, data.<a class="code hl_variable" href="classStoreIOBuffer.html#a97772bf328fe745e1d1fc23ee91cec39">length</a>);</div>
<div class="line"><a id="l00967" name="l00967"></a><span class="lineno">  967</span> </div>
<div class="line"><a id="l00968" name="l00968"></a><span class="lineno">  968</span>    <span class="keywordflow">if</span> (data.<a class="code hl_variable" href="classStoreIOBuffer.html#a97772bf328fe745e1d1fc23ee91cec39">length</a> &lt;= 0) {</div>
<div class="line"><a id="l00969" name="l00969"></a><span class="lineno">  969</span>        replyDataWritingCheckpoint(); <span class="comment">// skip the actual write call</span></div>
<div class="line"><a id="l00970" name="l00970"></a><span class="lineno">  970</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00971" name="l00971"></a><span class="lineno">  971</span>    }</div>
<div class="line"><a id="l00972" name="l00972"></a><span class="lineno">  972</span> </div>
<div class="line"><a id="l00973" name="l00973"></a><span class="lineno">  973</span>    <a class="code hl_class" href="classMemBuf.html">MemBuf</a> mb;</div>
<div class="line"><a id="l00974" name="l00974"></a><span class="lineno">  974</span>    mb.<a class="code hl_function" href="classMemBuf.html#a4a615d8e887439c66e04aab70f8be60a">init</a>(data.<a class="code hl_variable" href="classStoreIOBuffer.html#a97772bf328fe745e1d1fc23ee91cec39">length</a> + 1, data.<a class="code hl_variable" href="classStoreIOBuffer.html#a97772bf328fe745e1d1fc23ee91cec39">length</a> + 1);</div>
<div class="line"><a id="l00975" name="l00975"></a><span class="lineno">  975</span>    mb.<a class="code hl_function" href="classMemBuf.html#a2e7319f5feaf76c1fd43f163a87ddaad">append</a>(data.<a class="code hl_variable" href="classStoreIOBuffer.html#a08224ebb5a73aa6b18c0e7a60ebf00b5">data</a>, data.<a class="code hl_variable" href="classStoreIOBuffer.html#a97772bf328fe745e1d1fc23ee91cec39">length</a>);</div>
<div class="line"><a id="l00976" name="l00976"></a><span class="lineno">  976</span> </div>
<div class="line"><a id="l00977" name="l00977"></a><span class="lineno">  977</span>    <span class="keyword">typedef</span> <a class="code hl_class" href="classCommCbMemFunT.html">CommCbMemFunT&lt;Server, CommIoCbParams&gt;</a> Dialer;</div>
<div class="line"><a id="l00978" name="l00978"></a><span class="lineno">  978</span>    <a class="code hl_class" href="classRefCount.html">AsyncCall::Pointer</a> call = <a class="code hl_define" href="AsyncJobCalls_8h.html#a3412f4fa1246aee4d4ac46a143075e03">JobCallback</a>(33, 5, Dialer, <span class="keyword">this</span>, <a class="code hl_function" href="classFtp_1_1Server.html#a6e8fa216b3301a1f7d416eff260c0f90">Ftp::Server::wroteReplyData</a>);</div>
<div class="line"><a id="l00979" name="l00979"></a><span class="lineno">  979</span>    <a class="code hl_function" href="namespaceComm.html#a96a9518a6c2c77d282a79f406e0252a9">Comm::Write</a>(dataConn, &amp;mb, call);</div>
<div class="line"><a id="l00980" name="l00980"></a><span class="lineno">  980</span> </div>
<div class="line"><a id="l00981" name="l00981"></a><span class="lineno">  981</span>    pipeline.front()-&gt;noteSentBodyBytes(data.<a class="code hl_variable" href="classStoreIOBuffer.html#a97772bf328fe745e1d1fc23ee91cec39">length</a>);</div>
<div class="line"><a id="l00982" name="l00982"></a><span class="lineno">  982</span>}</div>
</div>
<div class="line"><a id="l00983" name="l00983"></a><span class="lineno">  983</span> </div>
<div class="line"><a id="l00985" name="l00985"></a><span class="lineno">  985</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen00986" data-start="{" data-end="}">
<div class="line"><a id="l00986" name="l00986"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#a6e8fa216b3301a1f7d416eff260c0f90">  986</a></span><a class="code hl_function" href="classFtp_1_1Server.html#a6e8fa216b3301a1f7d416eff260c0f90">Ftp::Server::wroteReplyData</a>(<span class="keyword">const</span> <a class="code hl_class" href="classCommIoCbParams.html">CommIoCbParams</a> &amp;io)</div>
<div class="line"><a id="l00987" name="l00987"></a><span class="lineno">  987</span>{</div>
<div class="line"><a id="l00988" name="l00988"></a><span class="lineno">  988</span>    <span class="keywordflow">if</span> (io.<a class="code hl_variable" href="classCommCommonCbParams.html#aaa1b70c6ff254ac72ac1503fc158df7e">flag</a> == <a class="code hl_enumvalue" href="namespaceComm.html#a9d8d4f4a5745b975c5785998e4246050a884f9d58f0f131131497fa9ceefb3b3c">Comm::ERR_CLOSING</a>)</div>
<div class="line"><a id="l00989" name="l00989"></a><span class="lineno">  989</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00990" name="l00990"></a><span class="lineno">  990</span> </div>
<div class="line"><a id="l00991" name="l00991"></a><span class="lineno">  991</span>    <span class="keywordflow">if</span> (io.<a class="code hl_variable" href="classCommCommonCbParams.html#aaa1b70c6ff254ac72ac1503fc158df7e">flag</a> != <a class="code hl_enumvalue" href="namespaceComm.html#a9d8d4f4a5745b975c5785998e4246050a2d02cf4ed31f765e18f4d8474ede4e24">Comm::OK</a>) {</div>
<div class="line"><a id="l00992" name="l00992"></a><span class="lineno">  992</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 3, <span class="stringliteral">&quot;FTP reply data writing failed: &quot;</span> &lt;&lt; <a class="code hl_function" href="xstrerror_8cc.html#a3d643f764de4776e5489d4eb55a99849">xstrerr</a>(io.<a class="code hl_variable" href="classCommCommonCbParams.html#a5376946442719c10cc9307045e09460d">xerrno</a>));</div>
<div class="line"><a id="l00993" name="l00993"></a><span class="lineno">  993</span>        userDataCompletionCheckpoint(426);</div>
<div class="line"><a id="l00994" name="l00994"></a><span class="lineno">  994</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00995" name="l00995"></a><span class="lineno">  995</span>    }</div>
<div class="line"><a id="l00996" name="l00996"></a><span class="lineno">  996</span> </div>
<div class="line"><a id="l00997" name="l00997"></a><span class="lineno">  997</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(pipeline.front()-&gt;http);</div>
<div class="line"><a id="l00998" name="l00998"></a><span class="lineno">  998</span>    pipeline.front()-&gt;http-&gt;out.size += io.<a class="code hl_variable" href="classCommIoCbParams.html#a34e29cc8266e4126764a5a6077859542">size</a>;</div>
<div class="line"><a id="l00999" name="l00999"></a><span class="lineno">  999</span>    replyDataWritingCheckpoint();</div>
<div class="line"><a id="l01000" name="l01000"></a><span class="lineno"> 1000</span>}</div>
</div>
<div class="line"><a id="l01001" name="l01001"></a><span class="lineno"> 1001</span> </div>
<div class="line"><a id="l01003" name="l01003"></a><span class="lineno"> 1003</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen01004" data-start="{" data-end="}">
<div class="line"><a id="l01004" name="l01004"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#aa7d62ff57f50fc4cbe2b4df15a9b1607"> 1004</a></span><a class="code hl_function" href="classFtp_1_1Server.html#aa7d62ff57f50fc4cbe2b4df15a9b1607">Ftp::Server::replyDataWritingCheckpoint</a>()</div>
<div class="line"><a id="l01005" name="l01005"></a><span class="lineno"> 1005</span>{</div>
<div class="line"><a id="l01006" name="l01006"></a><span class="lineno"> 1006</span>    <span class="keywordflow">switch</span> (pipeline.front()-&gt;socketState()) {</div>
<div class="line"><a id="l01007" name="l01007"></a><span class="lineno"> 1007</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="enums_8h.html#ad7d12a8ac0392194bda3900e7f4f876baafdb40c0b7683e2fd31711c386833017">STREAM_NONE</a>:</div>
<div class="line"><a id="l01008" name="l01008"></a><span class="lineno"> 1008</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 3, <span class="stringliteral">&quot;Keep going&quot;</span>);</div>
<div class="line"><a id="l01009" name="l01009"></a><span class="lineno"> 1009</span>        pipeline.front()-&gt;pullData();</div>
<div class="line"><a id="l01010" name="l01010"></a><span class="lineno"> 1010</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01011" name="l01011"></a><span class="lineno"> 1011</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="enums_8h.html#ad7d12a8ac0392194bda3900e7f4f876ba47cb242ab59c602b4398248aea577b19">STREAM_COMPLETE</a>:</div>
<div class="line"><a id="l01012" name="l01012"></a><span class="lineno"> 1012</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 3, <span class="stringliteral">&quot;FTP reply data transfer successfully complete&quot;</span>);</div>
<div class="line"><a id="l01013" name="l01013"></a><span class="lineno"> 1013</span>        userDataCompletionCheckpoint(226);</div>
<div class="line"><a id="l01014" name="l01014"></a><span class="lineno"> 1014</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01015" name="l01015"></a><span class="lineno"> 1015</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="enums_8h.html#ad7d12a8ac0392194bda3900e7f4f876ba94d16363b82ec2278002d78080a8cb44">STREAM_UNPLANNED_COMPLETE</a>:</div>
<div class="line"><a id="l01016" name="l01016"></a><span class="lineno"> 1016</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 3, <span class="stringliteral">&quot;FTP reply data transfer failed: STREAM_UNPLANNED_COMPLETE&quot;</span>);</div>
<div class="line"><a id="l01017" name="l01017"></a><span class="lineno"> 1017</span>        userDataCompletionCheckpoint(451);</div>
<div class="line"><a id="l01018" name="l01018"></a><span class="lineno"> 1018</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01019" name="l01019"></a><span class="lineno"> 1019</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="enums_8h.html#ad7d12a8ac0392194bda3900e7f4f876bae425b0891f7f866775009972cae49d71">STREAM_FAILED</a>:</div>
<div class="line"><a id="l01020" name="l01020"></a><span class="lineno"> 1020</span>        userDataCompletionCheckpoint(451);</div>
<div class="line"><a id="l01021" name="l01021"></a><span class="lineno"> 1021</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 3, <span class="stringliteral">&quot;FTP reply data transfer failed: STREAM_FAILED&quot;</span>);</div>
<div class="line"><a id="l01022" name="l01022"></a><span class="lineno"> 1022</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01023" name="l01023"></a><span class="lineno"> 1023</span>    <span class="keywordflow">default</span>:</div>
<div class="line"><a id="l01024" name="l01024"></a><span class="lineno"> 1024</span>        <a class="code hl_function" href="fatal_8cc.html#ab64d40563aeeae7c01b72bea4c3ed032">fatal</a>(<span class="stringliteral">&quot;unreachable code&quot;</span>);</div>
<div class="line"><a id="l01025" name="l01025"></a><span class="lineno"> 1025</span>    }</div>
<div class="line"><a id="l01026" name="l01026"></a><span class="lineno"> 1026</span>}</div>
</div>
<div class="line"><a id="l01027" name="l01027"></a><span class="lineno"> 1027</span> </div>
<div class="line"><a id="l01028" name="l01028"></a><span class="lineno"> 1028</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen01029" data-start="{" data-end="}">
<div class="line"><a id="l01029" name="l01029"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#ac65b32892d544696d1f6b650f028b8c7"> 1029</a></span><a class="code hl_function" href="classFtp_1_1Server.html#ac65b32892d544696d1f6b650f028b8c7">Ftp::Server::handleUploadReply</a>(<span class="keyword">const</span> <a class="code hl_class" href="classHttpReply.html">HttpReply</a> *reply, <a class="code hl_class" href="classStoreIOBuffer.html">StoreIOBuffer</a>)</div>
<div class="line"><a id="l01030" name="l01030"></a><span class="lineno"> 1030</span>{</div>
<div class="line"><a id="l01031" name="l01031"></a><span class="lineno"> 1031</span>    writeForwardedReply(reply);</div>
<div class="line"><a id="l01032" name="l01032"></a><span class="lineno"> 1032</span>    <span class="comment">// note that the client data connection may already be closed by now</span></div>
<div class="line"><a id="l01033" name="l01033"></a><span class="lineno"> 1033</span>}</div>
</div>
<div class="line"><a id="l01034" name="l01034"></a><span class="lineno"> 1034</span> </div>
<div class="line"><a id="l01035" name="l01035"></a><span class="lineno"> 1035</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen01036" data-start="{" data-end="}">
<div class="line"><a id="l01036" name="l01036"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#a263e5acd24e621a9919e220d7ed3bb48"> 1036</a></span><a class="code hl_function" href="classFtp_1_1Server.html#a263e5acd24e621a9919e220d7ed3bb48">Ftp::Server::writeForwardedReply</a>(<span class="keyword">const</span> <a class="code hl_class" href="classHttpReply.html">HttpReply</a> *reply)</div>
<div class="line"><a id="l01037" name="l01037"></a><span class="lineno"> 1037</span>{</div>
<div class="line"><a id="l01038" name="l01038"></a><span class="lineno"> 1038</span>    <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(reply);</div>
<div class="line"><a id="l01039" name="l01039"></a><span class="lineno"> 1039</span> </div>
<div class="line"><a id="l01040" name="l01040"></a><span class="lineno"> 1040</span>    <span class="keywordflow">if</span> (waitingForOrigin) {</div>
<div class="line"><a id="l01041" name="l01041"></a><span class="lineno"> 1041</span>        <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(delayedReply == <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l01042" name="l01042"></a><span class="lineno"> 1042</span>        delayedReply = reply;</div>
<div class="line"><a id="l01043" name="l01043"></a><span class="lineno"> 1043</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01044" name="l01044"></a><span class="lineno"> 1044</span>    }</div>
<div class="line"><a id="l01045" name="l01045"></a><span class="lineno"> 1045</span> </div>
<div class="line"><a id="l01046" name="l01046"></a><span class="lineno"> 1046</span>    <span class="keyword">const</span> <a class="code hl_class" href="classHttpHeader.html">HttpHeader</a> &amp;header = reply-&gt;<a class="code hl_variable" href="classHttp_1_1Message.html#a79ae935ff618211b139dcfdd8a5277ec">header</a>;</div>
<div class="line"><a id="l01047" name="l01047"></a><span class="lineno"> 1047</span>    <span class="comment">// adaptation and forwarding errors lack Http::HdrType::FTP_STATUS</span></div>
<div class="line"><a id="l01048" name="l01048"></a><span class="lineno"> 1048</span>    <span class="keywordflow">if</span> (!header.<a class="code hl_function" href="classHttpHeader.html#abe3327167942e75a78385e92bc1b26b7">has</a>(<a class="code hl_enumvalue" href="namespaceHttp.html#a92faa3c60e0b457c167759389ae061a4a441d11bb798c52af629374cdac708ffa">Http::HdrType::FTP_STATUS</a>)) {</div>
<div class="line"><a id="l01049" name="l01049"></a><span class="lineno"> 1049</span>        writeForwardedForeign(reply); <span class="comment">// will get to Ftp::Server::wroteReply</span></div>
<div class="line"><a id="l01050" name="l01050"></a><span class="lineno"> 1050</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01051" name="l01051"></a><span class="lineno"> 1051</span>    }</div>
<div class="line"><a id="l01052" name="l01052"></a><span class="lineno"> 1052</span> </div>
<div class="line"><a id="l01053" name="l01053"></a><span class="lineno"> 1053</span>    <span class="keyword">typedef</span> <a class="code hl_class" href="classCommCbMemFunT.html">CommCbMemFunT&lt;Server, CommIoCbParams&gt;</a> Dialer;</div>
<div class="line"><a id="l01054" name="l01054"></a><span class="lineno"> 1054</span>    <a class="code hl_class" href="classRefCount.html">AsyncCall::Pointer</a> call = <a class="code hl_define" href="AsyncJobCalls_8h.html#a3412f4fa1246aee4d4ac46a143075e03">JobCallback</a>(33, 5, Dialer, <span class="keyword">this</span>, <a class="code hl_function" href="classFtp_1_1Server.html#a4d1af5c70cc5a133ee3f992c3e0ea391">Ftp::Server::wroteReply</a>);</div>
<div class="line"><a id="l01055" name="l01055"></a><span class="lineno"> 1055</span>    writeForwardedReplyAndCall(reply, call);</div>
<div class="line"><a id="l01056" name="l01056"></a><span class="lineno"> 1056</span>}</div>
</div>
<div class="line"><a id="l01057" name="l01057"></a><span class="lineno"> 1057</span> </div>
<div class="line"><a id="l01058" name="l01058"></a><span class="lineno"> 1058</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen01059" data-start="{" data-end="}">
<div class="line"><a id="l01059" name="l01059"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#a45ebf20dc16be23b519c2e6f65cad88f"> 1059</a></span><a class="code hl_function" href="classFtp_1_1Server.html#a45ebf20dc16be23b519c2e6f65cad88f">Ftp::Server::handleEprtReply</a>(<span class="keyword">const</span> <a class="code hl_class" href="classHttpReply.html">HttpReply</a> *reply, <a class="code hl_class" href="classStoreIOBuffer.html">StoreIOBuffer</a>)</div>
<div class="line"><a id="l01060" name="l01060"></a><span class="lineno"> 1060</span>{</div>
<div class="line"><a id="l01061" name="l01061"></a><span class="lineno"> 1061</span>    <span class="keywordflow">if</span> (pipeline.front()-&gt;http-&gt;request-&gt;error) {</div>
<div class="line"><a id="l01062" name="l01062"></a><span class="lineno"> 1062</span>        writeCustomReply(502, <span class="stringliteral">&quot;Server does not support PASV (converted from EPRT)&quot;</span>, reply);</div>
<div class="line"><a id="l01063" name="l01063"></a><span class="lineno"> 1063</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01064" name="l01064"></a><span class="lineno"> 1064</span>    }</div>
<div class="line"><a id="l01065" name="l01065"></a><span class="lineno"> 1065</span> </div>
<div class="line"><a id="l01066" name="l01066"></a><span class="lineno"> 1066</span>    writeCustomReply(200, <span class="stringliteral">&quot;EPRT successfully converted to PASV.&quot;</span>);</div>
<div class="line"><a id="l01067" name="l01067"></a><span class="lineno"> 1067</span> </div>
<div class="line"><a id="l01068" name="l01068"></a><span class="lineno"> 1068</span>    <span class="comment">// and wait for RETR</span></div>
<div class="line"><a id="l01069" name="l01069"></a><span class="lineno"> 1069</span>}</div>
</div>
<div class="line"><a id="l01070" name="l01070"></a><span class="lineno"> 1070</span> </div>
<div class="line"><a id="l01071" name="l01071"></a><span class="lineno"> 1071</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen01072" data-start="{" data-end="}">
<div class="line"><a id="l01072" name="l01072"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#ab78c320c4406518c7e1b2c08b45a4749"> 1072</a></span><a class="code hl_function" href="classFtp_1_1Server.html#ab78c320c4406518c7e1b2c08b45a4749">Ftp::Server::handleEpsvReply</a>(<span class="keyword">const</span> <a class="code hl_class" href="classHttpReply.html">HttpReply</a> *reply, <a class="code hl_class" href="classStoreIOBuffer.html">StoreIOBuffer</a>)</div>
<div class="line"><a id="l01073" name="l01073"></a><span class="lineno"> 1073</span>{</div>
<div class="line"><a id="l01074" name="l01074"></a><span class="lineno"> 1074</span>    <span class="keywordflow">if</span> (pipeline.front()-&gt;http-&gt;request-&gt;error) {</div>
<div class="line"><a id="l01075" name="l01075"></a><span class="lineno"> 1075</span>        writeCustomReply(502, <span class="stringliteral">&quot;Cannot connect to server&quot;</span>, reply);</div>
<div class="line"><a id="l01076" name="l01076"></a><span class="lineno"> 1076</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01077" name="l01077"></a><span class="lineno"> 1077</span>    }</div>
<div class="line"><a id="l01078" name="l01078"></a><span class="lineno"> 1078</span> </div>
<div class="line"><a id="l01079" name="l01079"></a><span class="lineno"> 1079</span>    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> localPort = listenForDataConnection();</div>
<div class="line"><a id="l01080" name="l01080"></a><span class="lineno"> 1080</span>    <span class="keywordflow">if</span> (!localPort)</div>
<div class="line"><a id="l01081" name="l01081"></a><span class="lineno"> 1081</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01082" name="l01082"></a><span class="lineno"> 1082</span> </div>
<div class="line"><a id="l01083" name="l01083"></a><span class="lineno"> 1083</span>    <span class="comment">// In interception setups, we use a local port number and hope that data</span></div>
<div class="line"><a id="l01084" name="l01084"></a><span class="lineno"> 1084</span>    <span class="comment">// traffic will be redirected to us.</span></div>
<div class="line"><a id="l01085" name="l01085"></a><span class="lineno"> 1085</span>    <a class="code hl_class" href="classMemBuf.html">MemBuf</a> mb;</div>
<div class="line"><a id="l01086" name="l01086"></a><span class="lineno"> 1086</span>    mb.<a class="code hl_function" href="classMemBuf.html#a4a615d8e887439c66e04aab70f8be60a">init</a>();</div>
<div class="line"><a id="l01087" name="l01087"></a><span class="lineno"> 1087</span>    mb.<a class="code hl_function" href="classPackable.html#ab3147943b218d2943726aeaf135dd776">appendf</a>(<span class="stringliteral">&quot;229 Entering Extended Passive Mode (|||%u|)\r\n&quot;</span>, localPort);</div>
<div class="line"><a id="l01088" name="l01088"></a><span class="lineno"> 1088</span> </div>
<div class="line"><a id="l01089" name="l01089"></a><span class="lineno"> 1089</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(9, 3, <a class="code hl_class" href="classRaw.html">Raw</a>(<span class="stringliteral">&quot;writing&quot;</span>, mb.<a class="code hl_variable" href="classMemBuf.html#a78daaa064a5aa4557e283a01c4aa27f1">buf</a>, mb.<a class="code hl_variable" href="classMemBuf.html#a512e0e6f4a6b327f31c9db28fe9aaeb3">size</a>));</div>
<div class="line"><a id="l01090" name="l01090"></a><span class="lineno"> 1090</span>    writeReply(mb);</div>
<div class="line"><a id="l01091" name="l01091"></a><span class="lineno"> 1091</span>}</div>
</div>
<div class="line"><a id="l01092" name="l01092"></a><span class="lineno"> 1092</span> </div>
<div class="line"><a id="l01094" name="l01094"></a><span class="lineno"> 1094</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen01095" data-start="{" data-end="}">
<div class="line"><a id="l01095" name="l01095"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#a608f182a639606058f8db59f4f953545"> 1095</a></span><a class="code hl_function" href="classFtp_1_1Server.html#a608f182a639606058f8db59f4f953545">Ftp::Server::writeErrorReply</a>(<span class="keyword">const</span> <a class="code hl_class" href="classHttpReply.html">HttpReply</a> *reply, <span class="keyword">const</span> <span class="keywordtype">int</span> scode)</div>
<div class="line"><a id="l01096" name="l01096"></a><span class="lineno"> 1096</span>{</div>
<div class="line"><a id="l01097" name="l01097"></a><span class="lineno"> 1097</span>    <span class="keyword">const</span> <a class="code hl_class" href="classHttpRequest.html">HttpRequest</a> *request = pipeline.front()-&gt;http-&gt;request;</div>
<div class="line"><a id="l01098" name="l01098"></a><span class="lineno"> 1098</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(request);</div>
<div class="line"><a id="l01099" name="l01099"></a><span class="lineno"> 1099</span> </div>
<div class="line"><a id="l01100" name="l01100"></a><span class="lineno"> 1100</span>    <a class="code hl_class" href="classMemBuf.html">MemBuf</a> mb;</div>
<div class="line"><a id="l01101" name="l01101"></a><span class="lineno"> 1101</span>    mb.<a class="code hl_function" href="classMemBuf.html#a4a615d8e887439c66e04aab70f8be60a">init</a>();</div>
<div class="line"><a id="l01102" name="l01102"></a><span class="lineno"> 1102</span> </div>
<div class="line"><a id="l01103" name="l01103"></a><span class="lineno"> 1103</span>    <span class="keywordflow">if</span> (request-&gt;<a class="code hl_variable" href="classHttpRequest.html#aeeb3de67d14be944d152c249379832cb">error</a>)</div>
<div class="line"><a id="l01104" name="l01104"></a><span class="lineno"> 1104</span>        mb.<a class="code hl_function" href="classPackable.html#ab3147943b218d2943726aeaf135dd776">appendf</a>(<span class="stringliteral">&quot;%i-%s\r\n&quot;</span>, scode, <a class="code hl_function" href="group__ErrorPageInternal.html#ga02b38d00f8473e0b4ab6df245f882639">errorPageName</a>(request-&gt;<a class="code hl_variable" href="classHttpRequest.html#aeeb3de67d14be944d152c249379832cb">error</a>.<a class="code hl_variable" href="classError.html#a1220700c3c5aa1181e2f1fd762b67e8b">category</a>));</div>
<div class="line"><a id="l01105" name="l01105"></a><span class="lineno"> 1105</span> </div>
<div class="line"><a id="l01106" name="l01106"></a><span class="lineno"> 1106</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;detail: request-&gt;<a class="code hl_variable" href="classHttpRequest.html#aeeb3de67d14be944d152c249379832cb">error</a>.<a class="code hl_variable" href="classError.html#a08c0757b07f5a2c855985cc0e9eaf2a3">details</a>) {</div>
<div class="line"><a id="l01107" name="l01107"></a><span class="lineno"> 1107</span>        mb.<a class="code hl_function" href="classPackable.html#ab3147943b218d2943726aeaf135dd776">appendf</a>(<span class="stringliteral">&quot;%i-Error-Detail-Brief: &quot;</span> <a class="code hl_define" href="SBuf_8h.html#a225d674d14bd9377da94fdb0edc08ecc">SQUIDSBUFPH</a> <span class="stringliteral">&quot;\r\n&quot;</span>, scode, <a class="code hl_define" href="SBuf_8h.html#aba15ad960fbece70b7940c8d3a5c344b">SQUIDSBUFPRINT</a>(detail-&gt;brief()));</div>
<div class="line"><a id="l01108" name="l01108"></a><span class="lineno"> 1108</span>        mb.<a class="code hl_function" href="classPackable.html#ab3147943b218d2943726aeaf135dd776">appendf</a>(<span class="stringliteral">&quot;%i-Error-Detail-Verbose: &quot;</span> <a class="code hl_define" href="SBuf_8h.html#a225d674d14bd9377da94fdb0edc08ecc">SQUIDSBUFPH</a> <span class="stringliteral">&quot;\r\n&quot;</span>, scode, <a class="code hl_define" href="SBuf_8h.html#aba15ad960fbece70b7940c8d3a5c344b">SQUIDSBUFPRINT</a>(detail-&gt;verbose(request)));</div>
<div class="line"><a id="l01109" name="l01109"></a><span class="lineno"> 1109</span>    }</div>
<div class="line"><a id="l01110" name="l01110"></a><span class="lineno"> 1110</span> </div>
<div class="line"><a id="l01111" name="l01111"></a><span class="lineno"> 1111</span><span class="preprocessor">#if USE_ADAPTATION</span></div>
<div class="line"><a id="l01112" name="l01112"></a><span class="lineno"> 1112</span>    <span class="comment">// XXX: Remove hard coded names. Use an error page template instead.</span></div>
<div class="line"><a id="l01113" name="l01113"></a><span class="lineno"> 1113</span>    <span class="keyword">const</span> <a class="code hl_class" href="classRefCount.html">Adaptation::History::Pointer</a> ah = request-&gt;<a class="code hl_function" href="classHttpRequest.html#a1755dc87660c26cedea904817d91fbda">adaptHistory</a>();</div>
<div class="line"><a id="l01114" name="l01114"></a><span class="lineno"> 1114</span>    <span class="keywordflow">if</span> (ah != <span class="keyword">nullptr</span>) { <span class="comment">// XXX: add adapt::&lt;all_h but use lastMeta here</span></div>
<div class="line"><a id="l01115" name="l01115"></a><span class="lineno"> 1115</span>        <span class="keyword">const</span> <a class="code hl_class" href="classString.html">String</a> info = ah-&gt;<a class="code hl_variable" href="classAdaptation_1_1History.html#aa56c08168d67d16ac3d2a6cb2f1b8e59">allMeta</a>.<a class="code hl_function" href="classHttpHeader.html#ab438778c7fb47d4ff3b9ed41285be02f">getByName</a>(<span class="stringliteral">&quot;X-Response-Info&quot;</span>);</div>
<div class="line"><a id="l01116" name="l01116"></a><span class="lineno"> 1116</span>        <span class="keyword">const</span> <a class="code hl_class" href="classString.html">String</a> desc = ah-&gt;<a class="code hl_variable" href="classAdaptation_1_1History.html#aa56c08168d67d16ac3d2a6cb2f1b8e59">allMeta</a>.<a class="code hl_function" href="classHttpHeader.html#ab438778c7fb47d4ff3b9ed41285be02f">getByName</a>(<span class="stringliteral">&quot;X-Response-Desc&quot;</span>);</div>
<div class="line"><a id="l01117" name="l01117"></a><span class="lineno"> 1117</span>        <span class="keywordflow">if</span> (info.<a class="code hl_function" href="classString.html#aff70196bf32e527af1116bb4eb93f353">size</a>())</div>
<div class="line"><a id="l01118" name="l01118"></a><span class="lineno"> 1118</span>            mb.<a class="code hl_function" href="classPackable.html#ab3147943b218d2943726aeaf135dd776">appendf</a>(<span class="stringliteral">&quot;%i-Information: %s\r\n&quot;</span>, scode, info.<a class="code hl_function" href="classString.html#aba5551ee62c6e82730c0cb1856238c14">termedBuf</a>());</div>
<div class="line"><a id="l01119" name="l01119"></a><span class="lineno"> 1119</span>        <span class="keywordflow">if</span> (desc.<a class="code hl_function" href="classString.html#aff70196bf32e527af1116bb4eb93f353">size</a>())</div>
<div class="line"><a id="l01120" name="l01120"></a><span class="lineno"> 1120</span>            mb.<a class="code hl_function" href="classPackable.html#ab3147943b218d2943726aeaf135dd776">appendf</a>(<span class="stringliteral">&quot;%i-Description: %s\r\n&quot;</span>, scode, desc.<a class="code hl_function" href="classString.html#aba5551ee62c6e82730c0cb1856238c14">termedBuf</a>());</div>
<div class="line"><a id="l01121" name="l01121"></a><span class="lineno"> 1121</span>    }</div>
<div class="line"><a id="l01122" name="l01122"></a><span class="lineno"> 1122</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01123" name="l01123"></a><span class="lineno"> 1123</span> </div>
<div class="line"><a id="l01124" name="l01124"></a><span class="lineno"> 1124</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *reason = <span class="stringliteral">&quot;Lost Error&quot;</span>;</div>
<div class="line"><a id="l01125" name="l01125"></a><span class="lineno"> 1125</span>    <span class="keywordflow">if</span> (reply) {</div>
<div class="line"><a id="l01126" name="l01126"></a><span class="lineno"> 1126</span>        reason = reply-&gt;<a class="code hl_variable" href="classHttp_1_1Message.html#a79ae935ff618211b139dcfdd8a5277ec">header</a>.<a class="code hl_function" href="classHttpHeader.html#abe3327167942e75a78385e92bc1b26b7">has</a>(<a class="code hl_enumvalue" href="namespaceHttp.html#a92faa3c60e0b457c167759389ae061a4a99cab0d9e614ea5daec167ffc05839b1">Http::HdrType::FTP_REASON</a>) ?</div>
<div class="line"><a id="l01127" name="l01127"></a><span class="lineno"> 1127</span>                 reply-&gt;<a class="code hl_variable" href="classHttp_1_1Message.html#a79ae935ff618211b139dcfdd8a5277ec">header</a>.<a class="code hl_function" href="classHttpHeader.html#a89a87680aa68d7143be79793bcbce500">getStr</a>(<a class="code hl_enumvalue" href="namespaceHttp.html#a92faa3c60e0b457c167759389ae061a4a99cab0d9e614ea5daec167ffc05839b1">Http::HdrType::FTP_REASON</a>):</div>
<div class="line"><a id="l01128" name="l01128"></a><span class="lineno"> 1128</span>                 reply-&gt;<a class="code hl_variable" href="classHttpReply.html#a01790af23c553b590ac6009ebb693b6d">sline</a>.<a class="code hl_function" href="classHttp_1_1StatusLine.html#ad25ca8e2da20e0f713a30460c44dddda">reason</a>();</div>
<div class="line"><a id="l01129" name="l01129"></a><span class="lineno"> 1129</span>    }</div>
<div class="line"><a id="l01130" name="l01130"></a><span class="lineno"> 1130</span> </div>
<div class="line"><a id="l01131" name="l01131"></a><span class="lineno"> 1131</span>    mb.<a class="code hl_function" href="classPackable.html#ab3147943b218d2943726aeaf135dd776">appendf</a>(<span class="stringliteral">&quot;%i %s\r\n&quot;</span>, scode, reason); <span class="comment">// error terminating line</span></div>
<div class="line"><a id="l01132" name="l01132"></a><span class="lineno"> 1132</span> </div>
<div class="line"><a id="l01133" name="l01133"></a><span class="lineno"> 1133</span>    <span class="comment">// TODO: errorpage.cc should detect FTP client and use</span></div>
<div class="line"><a id="l01134" name="l01134"></a><span class="lineno"> 1134</span>    <span class="comment">// configurable FTP-friendly error templates which we should</span></div>
<div class="line"><a id="l01135" name="l01135"></a><span class="lineno"> 1135</span>    <span class="comment">// write to the client &quot;as is&quot; instead of hiding most of the info</span></div>
<div class="line"><a id="l01136" name="l01136"></a><span class="lineno"> 1136</span> </div>
<div class="line"><a id="l01137" name="l01137"></a><span class="lineno"> 1137</span>    writeReply(mb);</div>
<div class="line"><a id="l01138" name="l01138"></a><span class="lineno"> 1138</span>}</div>
</div>
<div class="line"><a id="l01139" name="l01139"></a><span class="lineno"> 1139</span> </div>
<div class="line"><a id="l01142" name="l01142"></a><span class="lineno"> 1142</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen01143" data-start="{" data-end="}">
<div class="line"><a id="l01143" name="l01143"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#a3eb9588ad1d0cf8894ab06d609688f47"> 1143</a></span><a class="code hl_function" href="classFtp_1_1Server.html#a3eb9588ad1d0cf8894ab06d609688f47">Ftp::Server::writeForwardedForeign</a>(<span class="keyword">const</span> <a class="code hl_class" href="classHttpReply.html">HttpReply</a> *reply)</div>
<div class="line"><a id="l01144" name="l01144"></a><span class="lineno"> 1144</span>{</div>
<div class="line"><a id="l01145" name="l01145"></a><span class="lineno"> 1145</span>    changeState(<a class="code hl_enumvalue" href="namespaceFtp.html#a56abcf0499ca5d50f20f9ce02525124ea7e2cc430f38c6f6b294c50f94caced31">fssConnected</a>, <span class="stringliteral">&quot;foreign reply&quot;</span>);</div>
<div class="line"><a id="l01146" name="l01146"></a><span class="lineno"> 1146</span>    closeDataConnection();</div>
<div class="line"><a id="l01147" name="l01147"></a><span class="lineno"> 1147</span>    <span class="comment">// 451: We intend to keep the control connection open.</span></div>
<div class="line"><a id="l01148" name="l01148"></a><span class="lineno"> 1148</span>    writeErrorReply(reply, 451);</div>
<div class="line"><a id="l01149" name="l01149"></a><span class="lineno"> 1149</span>}</div>
</div>
<div class="line"><a id="l01150" name="l01150"></a><span class="lineno"> 1150</span> </div>
<div class="line"><a id="l01151" name="l01151"></a><span class="lineno"> 1151</span><span class="keywordtype">bool</span></div>
<div class="foldopen" id="foldopen01152" data-start="{" data-end="}">
<div class="line"><a id="l01152" name="l01152"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#a7868f6c83620a3355e3f53e6fbe87daa"> 1152</a></span><a class="code hl_function" href="classFtp_1_1Server.html#a7868f6c83620a3355e3f53e6fbe87daa">Ftp::Server::writeControlMsgAndCall</a>(<a class="code hl_class" href="classHttpReply.html">HttpReply</a> *reply, <a class="code hl_class" href="classRefCount.html">AsyncCall::Pointer</a> &amp;call)</div>
<div class="line"><a id="l01153" name="l01153"></a><span class="lineno"> 1153</span>{</div>
<div class="line"><a id="l01154" name="l01154"></a><span class="lineno"> 1154</span>    <span class="comment">// the caller guarantees that we are dealing with the current context only</span></div>
<div class="line"><a id="l01155" name="l01155"></a><span class="lineno"> 1155</span>    <span class="comment">// the caller should also make sure reply-&gt;header.has(Http::HdrType::FTP_STATUS)</span></div>
<div class="line"><a id="l01156" name="l01156"></a><span class="lineno"> 1156</span>    writeForwardedReplyAndCall(reply, call);</div>
<div class="line"><a id="l01157" name="l01157"></a><span class="lineno"> 1157</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01158" name="l01158"></a><span class="lineno"> 1158</span>}</div>
</div>
<div class="line"><a id="l01159" name="l01159"></a><span class="lineno"> 1159</span> </div>
<div class="line"><a id="l01160" name="l01160"></a><span class="lineno"> 1160</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen01161" data-start="{" data-end="}">
<div class="line"><a id="l01161" name="l01161"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#ad934744914c9ed6f4444a5032be5e3b4"> 1161</a></span><a class="code hl_function" href="classFtp_1_1Server.html#ad934744914c9ed6f4444a5032be5e3b4">Ftp::Server::writeForwardedReplyAndCall</a>(<span class="keyword">const</span> <a class="code hl_class" href="classHttpReply.html">HttpReply</a> *reply, <a class="code hl_class" href="classRefCount.html">AsyncCall::Pointer</a> &amp;call)</div>
<div class="line"><a id="l01162" name="l01162"></a><span class="lineno"> 1162</span>{</div>
<div class="line"><a id="l01163" name="l01163"></a><span class="lineno"> 1163</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(reply != <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l01164" name="l01164"></a><span class="lineno"> 1164</span>    <span class="keyword">const</span> <a class="code hl_class" href="classHttpHeader.html">HttpHeader</a> &amp;header = reply-&gt;<a class="code hl_variable" href="classHttp_1_1Message.html#a79ae935ff618211b139dcfdd8a5277ec">header</a>;</div>
<div class="line"><a id="l01165" name="l01165"></a><span class="lineno"> 1165</span> </div>
<div class="line"><a id="l01166" name="l01166"></a><span class="lineno"> 1166</span>    <span class="comment">// without status, the caller must use the writeForwardedForeign() path</span></div>
<div class="line"><a id="l01167" name="l01167"></a><span class="lineno"> 1167</span>    <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(header.<a class="code hl_function" href="classHttpHeader.html#abe3327167942e75a78385e92bc1b26b7">has</a>(<a class="code hl_enumvalue" href="namespaceHttp.html#a92faa3c60e0b457c167759389ae061a4a441d11bb798c52af629374cdac708ffa">Http::HdrType::FTP_STATUS</a>));</div>
<div class="line"><a id="l01168" name="l01168"></a><span class="lineno"> 1168</span>    <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(header.<a class="code hl_function" href="classHttpHeader.html#abe3327167942e75a78385e92bc1b26b7">has</a>(<a class="code hl_enumvalue" href="namespaceHttp.html#a92faa3c60e0b457c167759389ae061a4a99cab0d9e614ea5daec167ffc05839b1">Http::HdrType::FTP_REASON</a>));</div>
<div class="line"><a id="l01169" name="l01169"></a><span class="lineno"> 1169</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> scode = header.<a class="code hl_function" href="classHttpHeader.html#ac372a06ceba805a52c4bce9cce8b28d8">getInt</a>(<a class="code hl_enumvalue" href="namespaceHttp.html#a92faa3c60e0b457c167759389ae061a4a441d11bb798c52af629374cdac708ffa">Http::HdrType::FTP_STATUS</a>);</div>
<div class="line"><a id="l01170" name="l01170"></a><span class="lineno"> 1170</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 7, <span class="stringliteral">&quot;scode: &quot;</span> &lt;&lt; scode);</div>
<div class="line"><a id="l01171" name="l01171"></a><span class="lineno"> 1171</span> </div>
<div class="line"><a id="l01172" name="l01172"></a><span class="lineno"> 1172</span>    <span class="comment">// Status 125 or 150 implies upload or data request, but we still check</span></div>
<div class="line"><a id="l01173" name="l01173"></a><span class="lineno"> 1173</span>    <span class="comment">// the state in case the server is buggy.</span></div>
<div class="line"><a id="l01174" name="l01174"></a><span class="lineno"> 1174</span>    <span class="keywordflow">if</span> ((scode == 125 || scode == 150) &amp;&amp;</div>
<div class="line"><a id="l01175" name="l01175"></a><span class="lineno"> 1175</span>            (master-&gt;serverState == <a class="code hl_enumvalue" href="namespaceFtp.html#a56abcf0499ca5d50f20f9ce02525124eaaf7ccbf3756c082cf11222ec601913a8">fssHandleUploadRequest</a> ||</div>
<div class="line"><a id="l01176" name="l01176"></a><span class="lineno"> 1176</span>             master-&gt;serverState == <a class="code hl_enumvalue" href="namespaceFtp.html#a56abcf0499ca5d50f20f9ce02525124eaf385076cc145cc42c7248f5b24d05c13">fssHandleDataRequest</a>)) {</div>
<div class="line"><a id="l01177" name="l01177"></a><span class="lineno"> 1177</span>        <span class="keywordflow">if</span> (checkDataConnPost()) {</div>
<div class="line"><a id="l01178" name="l01178"></a><span class="lineno"> 1178</span>            <span class="comment">// If the data connection is ready, start reading data (here)</span></div>
<div class="line"><a id="l01179" name="l01179"></a><span class="lineno"> 1179</span>            <span class="comment">// and forward the response to client (further below).</span></div>
<div class="line"><a id="l01180" name="l01180"></a><span class="lineno"> 1180</span>            <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 7, <span class="stringliteral">&quot;data connection established, start data transfer&quot;</span>);</div>
<div class="line"><a id="l01181" name="l01181"></a><span class="lineno"> 1181</span>            <span class="keywordflow">if</span> (master-&gt;serverState == <a class="code hl_enumvalue" href="namespaceFtp.html#a56abcf0499ca5d50f20f9ce02525124eaaf7ccbf3756c082cf11222ec601913a8">fssHandleUploadRequest</a>)</div>
<div class="line"><a id="l01182" name="l01182"></a><span class="lineno"> 1182</span>                maybeReadUploadData();</div>
<div class="line"><a id="l01183" name="l01183"></a><span class="lineno"> 1183</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01184" name="l01184"></a><span class="lineno"> 1184</span>            <span class="comment">// If we are waiting to accept the data connection, keep waiting.</span></div>
<div class="line"><a id="l01185" name="l01185"></a><span class="lineno"> 1185</span>            <span class="keywordflow">if</span> (<a class="code hl_function" href="namespaceComm.html#a91f0a0e22e74a7ad6f7c44c137c6f005">Comm::IsConnOpen</a>(dataListenConn)) {</div>
<div class="line"><a id="l01186" name="l01186"></a><span class="lineno"> 1186</span>                <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 7, <span class="stringliteral">&quot;wait for the client to establish a data connection&quot;</span>);</div>
<div class="line"><a id="l01187" name="l01187"></a><span class="lineno"> 1187</span>                onDataAcceptCall = call;</div>
<div class="line"><a id="l01188" name="l01188"></a><span class="lineno"> 1188</span>                <span class="comment">// TODO: Add connect timeout for passive connections listener?</span></div>
<div class="line"><a id="l01189" name="l01189"></a><span class="lineno"> 1189</span>                <span class="comment">// TODO: Remember server response so that we can forward it?</span></div>
<div class="line"><a id="l01190" name="l01190"></a><span class="lineno"> 1190</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01191" name="l01191"></a><span class="lineno"> 1191</span>                <span class="comment">// Either the connection was established and closed after the</span></div>
<div class="line"><a id="l01192" name="l01192"></a><span class="lineno"> 1192</span>                <span class="comment">// data was transferred OR we failed to establish an active</span></div>
<div class="line"><a id="l01193" name="l01193"></a><span class="lineno"> 1193</span>                <span class="comment">// data connection and already sent the error to the client.</span></div>
<div class="line"><a id="l01194" name="l01194"></a><span class="lineno"> 1194</span>                <span class="comment">// In either case, there is nothing more to do.</span></div>
<div class="line"><a id="l01195" name="l01195"></a><span class="lineno"> 1195</span>                <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 7, <span class="stringliteral">&quot;done with data OR active connection failed&quot;</span>);</div>
<div class="line"><a id="l01196" name="l01196"></a><span class="lineno"> 1196</span>            }</div>
<div class="line"><a id="l01197" name="l01197"></a><span class="lineno"> 1197</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01198" name="l01198"></a><span class="lineno"> 1198</span>        }</div>
<div class="line"><a id="l01199" name="l01199"></a><span class="lineno"> 1199</span>    }</div>
<div class="line"><a id="l01200" name="l01200"></a><span class="lineno"> 1200</span> </div>
<div class="line"><a id="l01201" name="l01201"></a><span class="lineno"> 1201</span>    <a class="code hl_class" href="classMemBuf.html">MemBuf</a> mb;</div>
<div class="line"><a id="l01202" name="l01202"></a><span class="lineno"> 1202</span>    mb.<a class="code hl_function" href="classMemBuf.html#a4a615d8e887439c66e04aab70f8be60a">init</a>();</div>
<div class="line"><a id="l01203" name="l01203"></a><span class="lineno"> 1203</span>    <a class="code hl_function" href="namespaceFtp.html#afbe492e82e3511179f2af6c59c2eb5b8">Ftp::PrintReply</a>(mb, reply);</div>
<div class="line"><a id="l01204" name="l01204"></a><span class="lineno"> 1204</span> </div>
<div class="line"><a id="l01205" name="l01205"></a><span class="lineno"> 1205</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(9, 2, <span class="stringliteral">&quot;FTP Client &quot;</span> &lt;&lt; clientConnection);</div>
<div class="line"><a id="l01206" name="l01206"></a><span class="lineno"> 1206</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(9, 2, <span class="stringliteral">&quot;FTP Client REPLY:\n---------\n&quot;</span> &lt;&lt; mb.<a class="code hl_variable" href="classMemBuf.html#a78daaa064a5aa4557e283a01c4aa27f1">buf</a> &lt;&lt;</div>
<div class="line"><a id="l01207" name="l01207"></a><span class="lineno"> 1207</span>           <span class="stringliteral">&quot;\n----------&quot;</span>);</div>
<div class="line"><a id="l01208" name="l01208"></a><span class="lineno"> 1208</span> </div>
<div class="line"><a id="l01209" name="l01209"></a><span class="lineno"> 1209</span>    <a class="code hl_function" href="namespaceComm.html#a96a9518a6c2c77d282a79f406e0252a9">Comm::Write</a>(clientConnection, &amp;mb, call);</div>
<div class="line"><a id="l01210" name="l01210"></a><span class="lineno"> 1210</span>}</div>
</div>
<div class="line"><a id="l01211" name="l01211"></a><span class="lineno"> 1211</span> </div>
<div class="line"><a id="l01212" name="l01212"></a><span class="lineno"> 1212</span><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen01213" data-start="{" data-end="}">
<div class="line"><a id="l01213" name="l01213"></a><span class="lineno"><a class="line" href="namespaceFtp.html#afbe492e82e3511179f2af6c59c2eb5b8"> 1213</a></span><a class="code hl_function" href="namespaceFtp.html#afbe492e82e3511179f2af6c59c2eb5b8">Ftp::PrintReply</a>(<a class="code hl_class" href="classMemBuf.html">MemBuf</a> &amp;mb, <span class="keyword">const</span> <a class="code hl_class" href="classHttpReply.html">HttpReply</a> *reply, <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span>)</div>
<div class="line"><a id="l01214" name="l01214"></a><span class="lineno"> 1214</span>{</div>
<div class="line"><a id="l01215" name="l01215"></a><span class="lineno"> 1215</span>    <span class="keyword">const</span> <a class="code hl_class" href="classHttpHeader.html">HttpHeader</a> &amp;header = reply-&gt;<a class="code hl_variable" href="classHttp_1_1Message.html#a79ae935ff618211b139dcfdd8a5277ec">header</a>;</div>
<div class="line"><a id="l01216" name="l01216"></a><span class="lineno"> 1216</span> </div>
<div class="line"><a id="l01217" name="l01217"></a><span class="lineno"> 1217</span>    <a class="code hl_typedef" href="HttpHeader_8h.html#aac9fc01c2b9cda8c02b1f7f8a2a9c78b">HttpHeaderPos</a> pos = <a class="code hl_define" href="HttpHeader_8h.html#abf5d862281ddf9a5315fcfa5be166c07">HttpHeaderInitPos</a>;</div>
<div class="line"><a id="l01218" name="l01218"></a><span class="lineno"> 1218</span>    <span class="keywordflow">while</span> (<span class="keyword">const</span> <a class="code hl_class" href="classHttpHeaderEntry.html">HttpHeaderEntry</a> *e = header.<a class="code hl_function" href="classHttpHeader.html#a81cb2fc85a9629783ba1e607de0f41ed">getEntry</a>(&amp;pos)) {</div>
<div class="line"><a id="l01219" name="l01219"></a><span class="lineno"> 1219</span>        <span class="keywordflow">if</span> (e-&gt;id == <a class="code hl_enumvalue" href="namespaceHttp.html#a92faa3c60e0b457c167759389ae061a4a09b6d21d0dfd00e8253d5c524fd848d4">Http::HdrType::FTP_PRE</a>) {</div>
<div class="line"><a id="l01220" name="l01220"></a><span class="lineno"> 1220</span>            <a class="code hl_class" href="classString.html">String</a> raw;</div>
<div class="line"><a id="l01221" name="l01221"></a><span class="lineno"> 1221</span>            <span class="keywordflow">if</span> (<a class="code hl_function" href="HttpHeader_8cc.html#ab9e192033c37d6882f676537fe47a878">httpHeaderParseQuotedString</a>(e-&gt;value.rawBuf(), e-&gt;value.size(), &amp;raw))</div>
<div class="line"><a id="l01222" name="l01222"></a><span class="lineno"> 1222</span>                mb.<a class="code hl_function" href="classPackable.html#ab3147943b218d2943726aeaf135dd776">appendf</a>(<span class="stringliteral">&quot;%s\r\n&quot;</span>, raw.<a class="code hl_function" href="classString.html#aba5551ee62c6e82730c0cb1856238c14">termedBuf</a>());</div>
<div class="line"><a id="l01223" name="l01223"></a><span class="lineno"> 1223</span>        }</div>
<div class="line"><a id="l01224" name="l01224"></a><span class="lineno"> 1224</span>    }</div>
<div class="line"><a id="l01225" name="l01225"></a><span class="lineno"> 1225</span> </div>
<div class="line"><a id="l01226" name="l01226"></a><span class="lineno"> 1226</span>    <span class="keywordflow">if</span> (header.<a class="code hl_function" href="classHttpHeader.html#abe3327167942e75a78385e92bc1b26b7">has</a>(<a class="code hl_enumvalue" href="namespaceHttp.html#a92faa3c60e0b457c167759389ae061a4a441d11bb798c52af629374cdac708ffa">Http::HdrType::FTP_STATUS</a>)) {</div>
<div class="line"><a id="l01227" name="l01227"></a><span class="lineno"> 1227</span>        <span class="keyword">const</span> <span class="keywordtype">char</span> *reason = header.<a class="code hl_function" href="classHttpHeader.html#a89a87680aa68d7143be79793bcbce500">getStr</a>(<a class="code hl_enumvalue" href="namespaceHttp.html#a92faa3c60e0b457c167759389ae061a4a99cab0d9e614ea5daec167ffc05839b1">Http::HdrType::FTP_REASON</a>);</div>
<div class="line"><a id="l01228" name="l01228"></a><span class="lineno"> 1228</span>        mb.<a class="code hl_function" href="classPackable.html#ab3147943b218d2943726aeaf135dd776">appendf</a>(<span class="stringliteral">&quot;%i %s\r\n&quot;</span>, header.<a class="code hl_function" href="classHttpHeader.html#ac372a06ceba805a52c4bce9cce8b28d8">getInt</a>(<a class="code hl_enumvalue" href="namespaceHttp.html#a92faa3c60e0b457c167759389ae061a4a441d11bb798c52af629374cdac708ffa">Http::HdrType::FTP_STATUS</a>),</div>
<div class="line"><a id="l01229" name="l01229"></a><span class="lineno"> 1229</span>                   (reason ? reason : <span class="stringliteral">&quot;&quot;</span>));</div>
<div class="line"><a id="l01230" name="l01230"></a><span class="lineno"> 1230</span>    }</div>
<div class="line"><a id="l01231" name="l01231"></a><span class="lineno"> 1231</span>}</div>
</div>
<div class="line"><a id="l01232" name="l01232"></a><span class="lineno"> 1232</span> </div>
<div class="line"><a id="l01233" name="l01233"></a><span class="lineno"> 1233</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen01234" data-start="{" data-end="}">
<div class="line"><a id="l01234" name="l01234"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#abb080a58365191b240f85bbc70d01cdb"> 1234</a></span><a class="code hl_function" href="classFtp_1_1Server.html#abb080a58365191b240f85bbc70d01cdb">Ftp::Server::wroteEarlyReply</a>(<span class="keyword">const</span> <a class="code hl_class" href="classCommIoCbParams.html">CommIoCbParams</a> &amp;io)</div>
<div class="line"><a id="l01235" name="l01235"></a><span class="lineno"> 1235</span>{</div>
<div class="line"><a id="l01236" name="l01236"></a><span class="lineno"> 1236</span>    <span class="keywordflow">if</span> (io.<a class="code hl_variable" href="classCommCommonCbParams.html#aaa1b70c6ff254ac72ac1503fc158df7e">flag</a> == <a class="code hl_enumvalue" href="namespaceComm.html#a9d8d4f4a5745b975c5785998e4246050a884f9d58f0f131131497fa9ceefb3b3c">Comm::ERR_CLOSING</a>)</div>
<div class="line"><a id="l01237" name="l01237"></a><span class="lineno"> 1237</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01238" name="l01238"></a><span class="lineno"> 1238</span> </div>
<div class="line"><a id="l01239" name="l01239"></a><span class="lineno"> 1239</span>    <span class="keywordflow">if</span> (io.<a class="code hl_variable" href="classCommCommonCbParams.html#aaa1b70c6ff254ac72ac1503fc158df7e">flag</a> != <a class="code hl_enumvalue" href="namespaceComm.html#a9d8d4f4a5745b975c5785998e4246050a2d02cf4ed31f765e18f4d8474ede4e24">Comm::OK</a>) {</div>
<div class="line"><a id="l01240" name="l01240"></a><span class="lineno"> 1240</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 3, <span class="stringliteral">&quot;FTP reply writing failed: &quot;</span> &lt;&lt; <a class="code hl_function" href="xstrerror_8cc.html#a3d643f764de4776e5489d4eb55a99849">xstrerr</a>(io.<a class="code hl_variable" href="classCommCommonCbParams.html#a5376946442719c10cc9307045e09460d">xerrno</a>));</div>
<div class="line"><a id="l01241" name="l01241"></a><span class="lineno"> 1241</span>        io.<a class="code hl_variable" href="classCommCommonCbParams.html#acbcbe42d3ccd12c6de3b1f3d1d7c4bc3">conn</a>-&gt;<a class="code hl_function" href="classComm_1_1Connection.html#a32253e90999f679dc032e19ad50d03ab">close</a>();</div>
<div class="line"><a id="l01242" name="l01242"></a><span class="lineno"> 1242</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01243" name="l01243"></a><span class="lineno"> 1243</span>    }</div>
<div class="line"><a id="l01244" name="l01244"></a><span class="lineno"> 1244</span> </div>
<div class="line"><a id="l01245" name="l01245"></a><span class="lineno"> 1245</span>    <a class="code hl_class" href="classRefCount.html">Http::StreamPointer</a> context = pipeline.front();</div>
<div class="line"><a id="l01246" name="l01246"></a><span class="lineno"> 1246</span>    <span class="keywordflow">if</span> (context != <span class="keyword">nullptr</span> &amp;&amp; context-&gt;http) {</div>
<div class="line"><a id="l01247" name="l01247"></a><span class="lineno"> 1247</span>        context-&gt;http-&gt;out.size += io.<a class="code hl_variable" href="classCommIoCbParams.html#a34e29cc8266e4126764a5a6077859542">size</a>;</div>
<div class="line"><a id="l01248" name="l01248"></a><span class="lineno"> 1248</span>        context-&gt;http-&gt;out.headers_sz += io.<a class="code hl_variable" href="classCommIoCbParams.html#a34e29cc8266e4126764a5a6077859542">size</a>;</div>
<div class="line"><a id="l01249" name="l01249"></a><span class="lineno"> 1249</span>    }</div>
<div class="line"><a id="l01250" name="l01250"></a><span class="lineno"> 1250</span> </div>
<div class="line"><a id="l01251" name="l01251"></a><span class="lineno"> 1251</span>    flags.readMore = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01252" name="l01252"></a><span class="lineno"> 1252</span>    readSomeData();</div>
<div class="line"><a id="l01253" name="l01253"></a><span class="lineno"> 1253</span>}</div>
</div>
<div class="line"><a id="l01254" name="l01254"></a><span class="lineno"> 1254</span> </div>
<div class="line"><a id="l01255" name="l01255"></a><span class="lineno"> 1255</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen01256" data-start="{" data-end="}">
<div class="line"><a id="l01256" name="l01256"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#a4d1af5c70cc5a133ee3f992c3e0ea391"> 1256</a></span><a class="code hl_function" href="classFtp_1_1Server.html#a4d1af5c70cc5a133ee3f992c3e0ea391">Ftp::Server::wroteReply</a>(<span class="keyword">const</span> <a class="code hl_class" href="classCommIoCbParams.html">CommIoCbParams</a> &amp;io)</div>
<div class="line"><a id="l01257" name="l01257"></a><span class="lineno"> 1257</span>{</div>
<div class="line"><a id="l01258" name="l01258"></a><span class="lineno"> 1258</span>    <span class="keywordflow">if</span> (io.<a class="code hl_variable" href="classCommCommonCbParams.html#aaa1b70c6ff254ac72ac1503fc158df7e">flag</a> == <a class="code hl_enumvalue" href="namespaceComm.html#a9d8d4f4a5745b975c5785998e4246050a884f9d58f0f131131497fa9ceefb3b3c">Comm::ERR_CLOSING</a>)</div>
<div class="line"><a id="l01259" name="l01259"></a><span class="lineno"> 1259</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01260" name="l01260"></a><span class="lineno"> 1260</span> </div>
<div class="line"><a id="l01261" name="l01261"></a><span class="lineno"> 1261</span>    <span class="keywordflow">if</span> (io.<a class="code hl_variable" href="classCommCommonCbParams.html#aaa1b70c6ff254ac72ac1503fc158df7e">flag</a> != <a class="code hl_enumvalue" href="namespaceComm.html#a9d8d4f4a5745b975c5785998e4246050a2d02cf4ed31f765e18f4d8474ede4e24">Comm::OK</a>) {</div>
<div class="line"><a id="l01262" name="l01262"></a><span class="lineno"> 1262</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 3, <span class="stringliteral">&quot;FTP reply writing failed: &quot;</span> &lt;&lt; <a class="code hl_function" href="xstrerror_8cc.html#a3d643f764de4776e5489d4eb55a99849">xstrerr</a>(io.<a class="code hl_variable" href="classCommCommonCbParams.html#a5376946442719c10cc9307045e09460d">xerrno</a>));</div>
<div class="line"><a id="l01263" name="l01263"></a><span class="lineno"> 1263</span>        io.<a class="code hl_variable" href="classCommCommonCbParams.html#acbcbe42d3ccd12c6de3b1f3d1d7c4bc3">conn</a>-&gt;<a class="code hl_function" href="classComm_1_1Connection.html#a32253e90999f679dc032e19ad50d03ab">close</a>();</div>
<div class="line"><a id="l01264" name="l01264"></a><span class="lineno"> 1264</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01265" name="l01265"></a><span class="lineno"> 1265</span>    }</div>
<div class="line"><a id="l01266" name="l01266"></a><span class="lineno"> 1266</span> </div>
<div class="line"><a id="l01267" name="l01267"></a><span class="lineno"> 1267</span>    <a class="code hl_class" href="classRefCount.html">Http::StreamPointer</a> context = pipeline.front();</div>
<div class="line"><a id="l01268" name="l01268"></a><span class="lineno"> 1268</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(context-&gt;http);</div>
<div class="line"><a id="l01269" name="l01269"></a><span class="lineno"> 1269</span>    context-&gt;http-&gt;out.size += io.<a class="code hl_variable" href="classCommIoCbParams.html#a34e29cc8266e4126764a5a6077859542">size</a>;</div>
<div class="line"><a id="l01270" name="l01270"></a><span class="lineno"> 1270</span>    context-&gt;http-&gt;out.headers_sz += io.<a class="code hl_variable" href="classCommIoCbParams.html#a34e29cc8266e4126764a5a6077859542">size</a>;</div>
<div class="line"><a id="l01271" name="l01271"></a><span class="lineno"> 1271</span> </div>
<div class="line"><a id="l01272" name="l01272"></a><span class="lineno"> 1272</span>    <span class="keywordflow">if</span> (master-&gt;serverState == <a class="code hl_enumvalue" href="namespaceFtp.html#a56abcf0499ca5d50f20f9ce02525124ea21ec8308de0a2e68cac20118053ea9f5">fssError</a>) {</div>
<div class="line"><a id="l01273" name="l01273"></a><span class="lineno"> 1273</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;closing on FTP server error&quot;</span>);</div>
<div class="line"><a id="l01274" name="l01274"></a><span class="lineno"> 1274</span>        io.<a class="code hl_variable" href="classCommCommonCbParams.html#acbcbe42d3ccd12c6de3b1f3d1d7c4bc3">conn</a>-&gt;<a class="code hl_function" href="classComm_1_1Connection.html#a32253e90999f679dc032e19ad50d03ab">close</a>();</div>
<div class="line"><a id="l01275" name="l01275"></a><span class="lineno"> 1275</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01276" name="l01276"></a><span class="lineno"> 1276</span>    }</div>
<div class="line"><a id="l01277" name="l01277"></a><span class="lineno"> 1277</span> </div>
<div class="line"><a id="l01278" name="l01278"></a><span class="lineno"> 1278</span>    <span class="keyword">const</span> <a class="code hl_enumeration" href="enums_8h.html#ad7d12a8ac0392194bda3900e7f4f876b">clientStream_status_t</a> socketState = context-&gt;socketState();</div>
<div class="line"><a id="l01279" name="l01279"></a><span class="lineno"> 1279</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;FTP client stream state &quot;</span> &lt;&lt; socketState);</div>
<div class="line"><a id="l01280" name="l01280"></a><span class="lineno"> 1280</span>    <span class="keywordflow">switch</span> (socketState) {</div>
<div class="line"><a id="l01281" name="l01281"></a><span class="lineno"> 1281</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="enums_8h.html#ad7d12a8ac0392194bda3900e7f4f876ba94d16363b82ec2278002d78080a8cb44">STREAM_UNPLANNED_COMPLETE</a>:</div>
<div class="line"><a id="l01282" name="l01282"></a><span class="lineno"> 1282</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="enums_8h.html#ad7d12a8ac0392194bda3900e7f4f876bae425b0891f7f866775009972cae49d71">STREAM_FAILED</a>:</div>
<div class="line"><a id="l01283" name="l01283"></a><span class="lineno"> 1283</span>        io.<a class="code hl_variable" href="classCommCommonCbParams.html#acbcbe42d3ccd12c6de3b1f3d1d7c4bc3">conn</a>-&gt;<a class="code hl_function" href="classComm_1_1Connection.html#a32253e90999f679dc032e19ad50d03ab">close</a>();</div>
<div class="line"><a id="l01284" name="l01284"></a><span class="lineno"> 1284</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01285" name="l01285"></a><span class="lineno"> 1285</span> </div>
<div class="line"><a id="l01286" name="l01286"></a><span class="lineno"> 1286</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="enums_8h.html#ad7d12a8ac0392194bda3900e7f4f876baafdb40c0b7683e2fd31711c386833017">STREAM_NONE</a>:</div>
<div class="line"><a id="l01287" name="l01287"></a><span class="lineno"> 1287</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="enums_8h.html#ad7d12a8ac0392194bda3900e7f4f876ba47cb242ab59c602b4398248aea577b19">STREAM_COMPLETE</a>:</div>
<div class="line"><a id="l01288" name="l01288"></a><span class="lineno"> 1288</span>        flags.readMore = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01289" name="l01289"></a><span class="lineno"> 1289</span>        changeState(<a class="code hl_enumvalue" href="namespaceFtp.html#a56abcf0499ca5d50f20f9ce02525124ea7e2cc430f38c6f6b294c50f94caced31">fssConnected</a>, <span class="stringliteral">&quot;Ftp::Server::wroteReply&quot;</span>);</div>
<div class="line"><a id="l01290" name="l01290"></a><span class="lineno"> 1290</span>        <span class="keywordflow">if</span> (bodyParser)</div>
<div class="line"><a id="l01291" name="l01291"></a><span class="lineno"> 1291</span>            finishDechunkingRequest(<span class="keyword">false</span>);</div>
<div class="line"><a id="l01292" name="l01292"></a><span class="lineno"> 1292</span>        context-&gt;finished();</div>
<div class="line"><a id="l01293" name="l01293"></a><span class="lineno"> 1293</span>        kick();</div>
<div class="line"><a id="l01294" name="l01294"></a><span class="lineno"> 1294</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01295" name="l01295"></a><span class="lineno"> 1295</span>    }</div>
<div class="line"><a id="l01296" name="l01296"></a><span class="lineno"> 1296</span>}</div>
</div>
<div class="line"><a id="l01297" name="l01297"></a><span class="lineno"> 1297</span> </div>
<div class="line"><a id="l01298" name="l01298"></a><span class="lineno"> 1298</span><span class="keywordtype">bool</span></div>
<div class="foldopen" id="foldopen01299" data-start="{" data-end="}">
<div class="line"><a id="l01299" name="l01299"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#acb972af7243a5d9615c56cb3e00a4ab9"> 1299</a></span><a class="code hl_function" href="classFtp_1_1Server.html#acb972af7243a5d9615c56cb3e00a4ab9">Ftp::Server::handleRequest</a>(<a class="code hl_class" href="classHttpRequest.html">HttpRequest</a> *request)</div>
<div class="line"><a id="l01300" name="l01300"></a><span class="lineno"> 1300</span>{</div>
<div class="line"><a id="l01301" name="l01301"></a><span class="lineno"> 1301</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 9, request);</div>
<div class="line"><a id="l01302" name="l01302"></a><span class="lineno"> 1302</span>    <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(request);</div>
<div class="line"><a id="l01303" name="l01303"></a><span class="lineno"> 1303</span> </div>
<div class="line"><a id="l01304" name="l01304"></a><span class="lineno"> 1304</span>    <a class="code hl_class" href="classHttpHeader.html">HttpHeader</a> &amp;header = request-&gt;<a class="code hl_variable" href="classHttp_1_1Message.html#a79ae935ff618211b139dcfdd8a5277ec">header</a>;</div>
<div class="line"><a id="l01305" name="l01305"></a><span class="lineno"> 1305</span>    <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(header.<a class="code hl_function" href="classHttpHeader.html#abe3327167942e75a78385e92bc1b26b7">has</a>(<a class="code hl_enumvalue" href="namespaceHttp.html#a92faa3c60e0b457c167759389ae061a4a9bdd18abe19a7e3517a6786ae7f15b44">Http::HdrType::FTP_COMMAND</a>));</div>
<div class="line"><a id="l01306" name="l01306"></a><span class="lineno"> 1306</span>    <a class="code hl_class" href="classString.html">String</a> &amp;cmd = header.<a class="code hl_function" href="classHttpHeader.html#acfab592ae0ede9d3934c233aacffbeeb">findEntry</a>(<a class="code hl_enumvalue" href="namespaceHttp.html#a92faa3c60e0b457c167759389ae061a4a9bdd18abe19a7e3517a6786ae7f15b44">Http::HdrType::FTP_COMMAND</a>)-&gt;<a class="code hl_variable" href="classHttpHeaderEntry.html#af1721f40aef39eef4476a19f806aedaa">value</a>;</div>
<div class="line"><a id="l01307" name="l01307"></a><span class="lineno"> 1307</span>    <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(header.<a class="code hl_function" href="classHttpHeader.html#abe3327167942e75a78385e92bc1b26b7">has</a>(<a class="code hl_enumvalue" href="namespaceHttp.html#a92faa3c60e0b457c167759389ae061a4af9f4f70983e0f5ffa741f2a523f0eda3">Http::HdrType::FTP_ARGUMENTS</a>));</div>
<div class="line"><a id="l01308" name="l01308"></a><span class="lineno"> 1308</span>    <a class="code hl_class" href="classString.html">String</a> &amp;params = header.<a class="code hl_function" href="classHttpHeader.html#acfab592ae0ede9d3934c233aacffbeeb">findEntry</a>(<a class="code hl_enumvalue" href="namespaceHttp.html#a92faa3c60e0b457c167759389ae061a4af9f4f70983e0f5ffa741f2a523f0eda3">Http::HdrType::FTP_ARGUMENTS</a>)-&gt;<a class="code hl_variable" href="classHttpHeaderEntry.html#af1721f40aef39eef4476a19f806aedaa">value</a>;</div>
<div class="line"><a id="l01309" name="l01309"></a><span class="lineno"> 1309</span> </div>
<div class="line"><a id="l01310" name="l01310"></a><span class="lineno"> 1310</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="classDebug.html#a44b82c996aedfa84dd8b61427f393e42">Debug::Enabled</a>(9, 2)) {</div>
<div class="line"><a id="l01311" name="l01311"></a><span class="lineno"> 1311</span>        <a class="code hl_class" href="classMemBuf.html">MemBuf</a> mb;</div>
<div class="line"><a id="l01312" name="l01312"></a><span class="lineno"> 1312</span>        mb.<a class="code hl_function" href="classMemBuf.html#a4a615d8e887439c66e04aab70f8be60a">init</a>();</div>
<div class="line"><a id="l01313" name="l01313"></a><span class="lineno"> 1313</span>        request-&gt;<a class="code hl_function" href="classHttpRequest.html#a54b1b1d850d85e6ad33ff19febb6adc8">pack</a>(&amp;mb);</div>
<div class="line"><a id="l01314" name="l01314"></a><span class="lineno"> 1314</span> </div>
<div class="line"><a id="l01315" name="l01315"></a><span class="lineno"> 1315</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(9, 2, <span class="stringliteral">&quot;FTP Client &quot;</span> &lt;&lt; clientConnection);</div>
<div class="line"><a id="l01316" name="l01316"></a><span class="lineno"> 1316</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(9, 2, <span class="stringliteral">&quot;FTP Client REQUEST:\n---------\n&quot;</span> &lt;&lt; mb.<a class="code hl_variable" href="classMemBuf.html#a78daaa064a5aa4557e283a01c4aa27f1">buf</a> &lt;&lt;</div>
<div class="line"><a id="l01317" name="l01317"></a><span class="lineno"> 1317</span>               <span class="stringliteral">&quot;\n----------&quot;</span>);</div>
<div class="line"><a id="l01318" name="l01318"></a><span class="lineno"> 1318</span>    }</div>
<div class="line"><a id="l01319" name="l01319"></a><span class="lineno"> 1319</span> </div>
<div class="line"><a id="l01320" name="l01320"></a><span class="lineno"> 1320</span>    <span class="comment">// TODO: When HttpHeader uses SBuf, change keys to SBuf</span></div>
<div class="line"><a id="l01321" name="l01321"></a><span class="lineno"> 1321</span>    <span class="keyword">typedef</span> std::map&lt;const std::string, RequestHandler&gt; RequestHandlers;</div>
<div class="line"><a id="l01322" name="l01322"></a><span class="lineno"> 1322</span>    <span class="keyword">static</span> RequestHandlers handlers;</div>
<div class="line"><a id="l01323" name="l01323"></a><span class="lineno"> 1323</span>    <span class="keywordflow">if</span> (!handlers.size()) {</div>
<div class="line"><a id="l01324" name="l01324"></a><span class="lineno"> 1324</span>        handlers[<span class="stringliteral">&quot;LIST&quot;</span>] = &amp;<a class="code hl_function" href="classFtp_1_1Server.html#a11eb95635878f282d7afc727a4bc23a8">Ftp::Server::handleDataRequest</a>;</div>
<div class="line"><a id="l01325" name="l01325"></a><span class="lineno"> 1325</span>        handlers[<span class="stringliteral">&quot;NLST&quot;</span>] = &amp;<a class="code hl_function" href="classFtp_1_1Server.html#a11eb95635878f282d7afc727a4bc23a8">Ftp::Server::handleDataRequest</a>;</div>
<div class="line"><a id="l01326" name="l01326"></a><span class="lineno"> 1326</span>        handlers[<span class="stringliteral">&quot;MLSD&quot;</span>] = &amp;<a class="code hl_function" href="classFtp_1_1Server.html#a11eb95635878f282d7afc727a4bc23a8">Ftp::Server::handleDataRequest</a>;</div>
<div class="line"><a id="l01327" name="l01327"></a><span class="lineno"> 1327</span>        handlers[<span class="stringliteral">&quot;FEAT&quot;</span>] = &amp;<a class="code hl_function" href="classFtp_1_1Server.html#a5be3658588359f1d53491a6ad92fe63a">Ftp::Server::handleFeatRequest</a>;</div>
<div class="line"><a id="l01328" name="l01328"></a><span class="lineno"> 1328</span>        handlers[<span class="stringliteral">&quot;PASV&quot;</span>] = &amp;<a class="code hl_function" href="classFtp_1_1Server.html#a0d7b71a2a2ee3993bbb065b565b9c85a">Ftp::Server::handlePasvRequest</a>;</div>
<div class="line"><a id="l01329" name="l01329"></a><span class="lineno"> 1329</span>        handlers[<span class="stringliteral">&quot;PORT&quot;</span>] = &amp;<a class="code hl_function" href="classFtp_1_1Server.html#a5777b8239009dbe5de8a56ec6765362d">Ftp::Server::handlePortRequest</a>;</div>
<div class="line"><a id="l01330" name="l01330"></a><span class="lineno"> 1330</span>        handlers[<span class="stringliteral">&quot;RETR&quot;</span>] = &amp;<a class="code hl_function" href="classFtp_1_1Server.html#a11eb95635878f282d7afc727a4bc23a8">Ftp::Server::handleDataRequest</a>;</div>
<div class="line"><a id="l01331" name="l01331"></a><span class="lineno"> 1331</span>        handlers[<span class="stringliteral">&quot;EPRT&quot;</span>] = &amp;<a class="code hl_function" href="classFtp_1_1Server.html#af40731e50bee1b03862d6f288817eff3">Ftp::Server::handleEprtRequest</a>;</div>
<div class="line"><a id="l01332" name="l01332"></a><span class="lineno"> 1332</span>        handlers[<span class="stringliteral">&quot;EPSV&quot;</span>] = &amp;<a class="code hl_function" href="classFtp_1_1Server.html#a9745cd38915b36995a608726fa185a2c">Ftp::Server::handleEpsvRequest</a>;</div>
<div class="line"><a id="l01333" name="l01333"></a><span class="lineno"> 1333</span>        handlers[<span class="stringliteral">&quot;CWD&quot;</span>] = &amp;<a class="code hl_function" href="classFtp_1_1Server.html#af20c431bd7cae760f440231ee5e140ec">Ftp::Server::handleCwdRequest</a>;</div>
<div class="line"><a id="l01334" name="l01334"></a><span class="lineno"> 1334</span>        handlers[<span class="stringliteral">&quot;PASS&quot;</span>] = &amp;<a class="code hl_function" href="classFtp_1_1Server.html#aafcb05a9300f5cf350682aef4b4fd915">Ftp::Server::handlePassRequest</a>;</div>
<div class="line"><a id="l01335" name="l01335"></a><span class="lineno"> 1335</span>        handlers[<span class="stringliteral">&quot;CDUP&quot;</span>] = &amp;<a class="code hl_function" href="classFtp_1_1Server.html#a38a276da4afa2eb9ab15354d85bcb798">Ftp::Server::handleCdupRequest</a>;</div>
<div class="line"><a id="l01336" name="l01336"></a><span class="lineno"> 1336</span>    }</div>
<div class="line"><a id="l01337" name="l01337"></a><span class="lineno"> 1337</span> </div>
<div class="line"><a id="l01338" name="l01338"></a><span class="lineno"> 1338</span>    RequestHandler handler = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l01339" name="l01339"></a><span class="lineno"> 1339</span>    <span class="keywordflow">if</span> (request-&gt;<a class="code hl_variable" href="classHttpRequest.html#a1f0af82ff15e9a29d15319fc3cf05a54">method</a> == <a class="code hl_enumvalue" href="namespaceHttp.html#a84eb275fbe86f9dcc2a0ce9164a60787a3eff063fbded3d15e4cea500e09c2de3">Http::METHOD_PUT</a>)</div>
<div class="line"><a id="l01340" name="l01340"></a><span class="lineno"> 1340</span>        handler = &amp;<a class="code hl_function" href="classFtp_1_1Server.html#a2460b627b8ee4623b29b44df5c4e55d5">Ftp::Server::handleUploadRequest</a>;</div>
<div class="line"><a id="l01341" name="l01341"></a><span class="lineno"> 1341</span>    <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01342" name="l01342"></a><span class="lineno"> 1342</span>        <span class="keyword">const</span> RequestHandlers::const_iterator hi = handlers.find(cmd.<a class="code hl_function" href="classString.html#aba5551ee62c6e82730c0cb1856238c14">termedBuf</a>());</div>
<div class="line"><a id="l01343" name="l01343"></a><span class="lineno"> 1343</span>        <span class="keywordflow">if</span> (hi != handlers.end())</div>
<div class="line"><a id="l01344" name="l01344"></a><span class="lineno"> 1344</span>            handler = hi-&gt;second;</div>
<div class="line"><a id="l01345" name="l01345"></a><span class="lineno"> 1345</span>    }</div>
<div class="line"><a id="l01346" name="l01346"></a><span class="lineno"> 1346</span> </div>
<div class="line"><a id="l01347" name="l01347"></a><span class="lineno"> 1347</span>    <span class="keywordflow">if</span> (!handler) {</div>
<div class="line"><a id="l01348" name="l01348"></a><span class="lineno"> 1348</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(9, 7, <span class="stringliteral">&quot;forwarding &quot;</span> &lt;&lt; cmd &lt;&lt; <span class="stringliteral">&quot; as is, no post-processing&quot;</span>);</div>
<div class="line"><a id="l01349" name="l01349"></a><span class="lineno"> 1349</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01350" name="l01350"></a><span class="lineno"> 1350</span>    }</div>
<div class="line"><a id="l01351" name="l01351"></a><span class="lineno"> 1351</span> </div>
<div class="line"><a id="l01352" name="l01352"></a><span class="lineno"> 1352</span>    <span class="keywordflow">return</span> (this-&gt;*handler)(cmd, params);</div>
<div class="line"><a id="l01353" name="l01353"></a><span class="lineno"> 1353</span>}</div>
</div>
<div class="line"><a id="l01354" name="l01354"></a><span class="lineno"> 1354</span> </div>
<div class="line"><a id="l01357" name="l01357"></a><span class="lineno"> 1357</span><a class="code hl_class" href="classHttp_1_1Stream.html">Http::Stream</a> *</div>
<div class="foldopen" id="foldopen01358" data-start="{" data-end="}">
<div class="line"><a id="l01358" name="l01358"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#abd8957626af753956b7263c321995c88"> 1358</a></span><a class="code hl_function" href="classFtp_1_1Server.html#abd8957626af753956b7263c321995c88">Ftp::Server::handleUserRequest</a>(<span class="keyword">const</span> <a class="code hl_class" href="classSBuf.html">SBuf</a> &amp;, <a class="code hl_class" href="classSBuf.html">SBuf</a> &amp;params)</div>
<div class="line"><a id="l01359" name="l01359"></a><span class="lineno"> 1359</span>{</div>
<div class="line"><a id="l01360" name="l01360"></a><span class="lineno"> 1360</span>    <span class="keywordflow">if</span> (params.<a class="code hl_function" href="classSBuf.html#a8bda8fe69e451e61946b35c2a2d2340b">isEmpty</a>())</div>
<div class="line"><a id="l01361" name="l01361"></a><span class="lineno"> 1361</span>        <span class="keywordflow">return</span> earlyError(EarlyErrorKind::MissingUsername);</div>
<div class="line"><a id="l01362" name="l01362"></a><span class="lineno"> 1362</span> </div>
<div class="line"><a id="l01363" name="l01363"></a><span class="lineno"> 1363</span>    <span class="comment">// find the [end of] user name</span></div>
<div class="line"><a id="l01364" name="l01364"></a><span class="lineno"> 1364</span>    <span class="keyword">const</span> <a class="code hl_typedef" href="classSBuf.html#ae27bdc0d7ad9a7aba6377e1a4a5af568">SBuf::size_type</a> eou = params.<a class="code hl_function" href="classSBuf.html#a531a0dd882ff1af666b03a8437701013">rfind</a>(<span class="charliteral">&#39;@&#39;</span>);</div>
<div class="line"><a id="l01365" name="l01365"></a><span class="lineno"> 1365</span>    <span class="keywordflow">if</span> (eou == <a class="code hl_variable" href="classSBuf.html#a1db91b2f039b38745f7d73b56ac9311f">SBuf::npos</a> || eou + 1 &gt;= params.<a class="code hl_function" href="classSBuf.html#a4fdfe954309aa6da19240f11a8f6b583">length</a>())</div>
<div class="line"><a id="l01366" name="l01366"></a><span class="lineno"> 1366</span>        <span class="keywordflow">return</span> earlyError(EarlyErrorKind::MissingHost);</div>
<div class="line"><a id="l01367" name="l01367"></a><span class="lineno"> 1367</span> </div>
<div class="line"><a id="l01368" name="l01368"></a><span class="lineno"> 1368</span>    <span class="comment">// Determine the intended destination.</span></div>
<div class="line"><a id="l01369" name="l01369"></a><span class="lineno"> 1369</span>    host = params.<a class="code hl_function" href="classSBuf.html#ae0a0e7a121bab1f1526a6fe01cd00f8c">substr</a>(eou + 1, params.<a class="code hl_function" href="classSBuf.html#a4fdfe954309aa6da19240f11a8f6b583">length</a>());</div>
<div class="line"><a id="l01370" name="l01370"></a><span class="lineno"> 1370</span>    <span class="comment">// If we can parse it as raw IPv6 address, then surround with &quot;[]&quot;.</span></div>
<div class="line"><a id="l01371" name="l01371"></a><span class="lineno"> 1371</span>    <span class="comment">// Otherwise (domain, IPv4, [bracketed] IPv6, garbage, etc), use as is.</span></div>
<div class="line"><a id="l01372" name="l01372"></a><span class="lineno"> 1372</span>    <span class="keywordflow">if</span> (host.find(<span class="charliteral">&#39;:&#39;</span>) != <a class="code hl_variable" href="classSBuf.html#a1db91b2f039b38745f7d73b56ac9311f">SBuf::npos</a>) {</div>
<div class="line"><a id="l01373" name="l01373"></a><span class="lineno"> 1373</span>        <span class="keyword">const</span> <a class="code hl_class" href="classIp_1_1Address.html">Ip::Address</a> ipa(host.c_str());</div>
<div class="line"><a id="l01374" name="l01374"></a><span class="lineno"> 1374</span>        <span class="keywordflow">if</span> (!ipa.<a class="code hl_function" href="classIp_1_1Address.html#ab00ddff71da22c55159fdc8176e14ea4">isAnyAddr</a>()) {</div>
<div class="line"><a id="l01375" name="l01375"></a><span class="lineno"> 1375</span>            <span class="keywordtype">char</span> ipBuf[<a class="code hl_define" href="ip_2forward_8h.html#a28806a9f06b4d32dab73b27053f10494">MAX_IPSTRLEN</a>];</div>
<div class="line"><a id="l01376" name="l01376"></a><span class="lineno"> 1376</span>            ipa.<a class="code hl_function" href="classIp_1_1Address.html#a2696806ea5ee1a73dbe87849a7d43539">toHostStr</a>(ipBuf, <a class="code hl_define" href="ip_2forward_8h.html#a28806a9f06b4d32dab73b27053f10494">MAX_IPSTRLEN</a>);</div>
<div class="line"><a id="l01377" name="l01377"></a><span class="lineno"> 1377</span>            host = ipBuf;</div>
<div class="line"><a id="l01378" name="l01378"></a><span class="lineno"> 1378</span>        }</div>
<div class="line"><a id="l01379" name="l01379"></a><span class="lineno"> 1379</span>    }</div>
<div class="line"><a id="l01380" name="l01380"></a><span class="lineno"> 1380</span> </div>
<div class="line"><a id="l01381" name="l01381"></a><span class="lineno"> 1381</span>    <span class="comment">// const SBuf login = params.substr(0, eou);</span></div>
<div class="line"><a id="l01382" name="l01382"></a><span class="lineno"> 1382</span>    params.<a class="code hl_function" href="classSBuf.html#a2f7b8f1302ad82646cc285927b453b87">chop</a>(0, eou); <span class="comment">// leave just the login part for the peer</span></div>
<div class="line"><a id="l01383" name="l01383"></a><span class="lineno"> 1383</span> </div>
<div class="line"><a id="l01384" name="l01384"></a><span class="lineno"> 1384</span>    <a class="code hl_class" href="classSBuf.html">SBuf</a> oldUri;</div>
<div class="line"><a id="l01385" name="l01385"></a><span class="lineno"> 1385</span>    <span class="keywordflow">if</span> (master-&gt;clientReadGreeting)</div>
<div class="line"><a id="l01386" name="l01386"></a><span class="lineno"> 1386</span>        oldUri = uri;</div>
<div class="line"><a id="l01387" name="l01387"></a><span class="lineno"> 1387</span> </div>
<div class="line"><a id="l01388" name="l01388"></a><span class="lineno"> 1388</span>    master-&gt;workingDir.<a class="code hl_function" href="classSBuf.html#adb0c2508d8e83b2fd5f931d65cc775d8">clear</a>();</div>
<div class="line"><a id="l01389" name="l01389"></a><span class="lineno"> 1389</span>    calcUri(<span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l01390" name="l01390"></a><span class="lineno"> 1390</span> </div>
<div class="line"><a id="l01391" name="l01391"></a><span class="lineno"> 1391</span>    <span class="keywordflow">if</span> (!master-&gt;clientReadGreeting) {</div>
<div class="line"><a id="l01392" name="l01392"></a><span class="lineno"> 1392</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(9, 3, <span class="stringliteral">&quot;set URI to &quot;</span> &lt;&lt; uri);</div>
<div class="line"><a id="l01393" name="l01393"></a><span class="lineno"> 1393</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (oldUri.<a class="code hl_function" href="classSBuf.html#a07c6f34501511503dda62b51774d9b59">caseCmp</a>(uri) == 0) {</div>
<div class="line"><a id="l01394" name="l01394"></a><span class="lineno"> 1394</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(9, 5, <span class="stringliteral">&quot;kept URI as &quot;</span> &lt;&lt; oldUri);</div>
<div class="line"><a id="l01395" name="l01395"></a><span class="lineno"> 1395</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01396" name="l01396"></a><span class="lineno"> 1396</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(9, 3, <span class="stringliteral">&quot;reset URI from &quot;</span> &lt;&lt; oldUri &lt;&lt; <span class="stringliteral">&quot; to &quot;</span> &lt;&lt; uri);</div>
<div class="line"><a id="l01397" name="l01397"></a><span class="lineno"> 1397</span>        closeDataConnection();</div>
<div class="line"><a id="l01398" name="l01398"></a><span class="lineno"> 1398</span>        unpinConnection(<span class="keyword">true</span>); <span class="comment">// close control connection to peer</span></div>
<div class="line"><a id="l01399" name="l01399"></a><span class="lineno"> 1399</span>        resetLogin(<span class="stringliteral">&quot;URI reset&quot;</span>);</div>
<div class="line"><a id="l01400" name="l01400"></a><span class="lineno"> 1400</span>    }</div>
<div class="line"><a id="l01401" name="l01401"></a><span class="lineno"> 1401</span> </div>
<div class="line"><a id="l01402" name="l01402"></a><span class="lineno"> 1402</span>    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>; <span class="comment">// no early errors</span></div>
<div class="line"><a id="l01403" name="l01403"></a><span class="lineno"> 1403</span>}</div>
</div>
<div class="line"><a id="l01404" name="l01404"></a><span class="lineno"> 1404</span> </div>
<div class="line"><a id="l01405" name="l01405"></a><span class="lineno"> 1405</span><span class="keywordtype">bool</span></div>
<div class="foldopen" id="foldopen01406" data-start="{" data-end="}">
<div class="line"><a id="l01406" name="l01406"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#a5be3658588359f1d53491a6ad92fe63a"> 1406</a></span><a class="code hl_function" href="classFtp_1_1Server.html#a5be3658588359f1d53491a6ad92fe63a">Ftp::Server::handleFeatRequest</a>(<a class="code hl_class" href="classString.html">String</a> &amp;, <a class="code hl_class" href="classString.html">String</a> &amp;)</div>
<div class="line"><a id="l01407" name="l01407"></a><span class="lineno"> 1407</span>{</div>
<div class="line"><a id="l01408" name="l01408"></a><span class="lineno"> 1408</span>    changeState(<a class="code hl_enumvalue" href="namespaceFtp.html#a56abcf0499ca5d50f20f9ce02525124ea59743532d13f5dfe934cc252ff8ecc66">fssHandleFeat</a>, <span class="stringliteral">&quot;handleFeatRequest&quot;</span>);</div>
<div class="line"><a id="l01409" name="l01409"></a><span class="lineno"> 1409</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01410" name="l01410"></a><span class="lineno"> 1410</span>}</div>
</div>
<div class="line"><a id="l01411" name="l01411"></a><span class="lineno"> 1411</span> </div>
<div class="line"><a id="l01412" name="l01412"></a><span class="lineno"> 1412</span><span class="keywordtype">bool</span></div>
<div class="foldopen" id="foldopen01413" data-start="{" data-end="}">
<div class="line"><a id="l01413" name="l01413"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#a0d7b71a2a2ee3993bbb065b565b9c85a"> 1413</a></span><a class="code hl_function" href="classFtp_1_1Server.html#a0d7b71a2a2ee3993bbb065b565b9c85a">Ftp::Server::handlePasvRequest</a>(<a class="code hl_class" href="classString.html">String</a> &amp;, <a class="code hl_class" href="classString.html">String</a> &amp;params)</div>
<div class="line"><a id="l01414" name="l01414"></a><span class="lineno"> 1414</span>{</div>
<div class="line"><a id="l01415" name="l01415"></a><span class="lineno"> 1415</span>    <span class="keywordflow">if</span> (gotEpsvAll) {</div>
<div class="line"><a id="l01416" name="l01416"></a><span class="lineno"> 1416</span>        setReply(500, <span class="stringliteral">&quot;Bad PASV command&quot;</span>);</div>
<div class="line"><a id="l01417" name="l01417"></a><span class="lineno"> 1417</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01418" name="l01418"></a><span class="lineno"> 1418</span>    }</div>
<div class="line"><a id="l01419" name="l01419"></a><span class="lineno"> 1419</span> </div>
<div class="line"><a id="l01420" name="l01420"></a><span class="lineno"> 1420</span>    <span class="keywordflow">if</span> (params.<a class="code hl_function" href="classString.html#aff70196bf32e527af1116bb4eb93f353">size</a>() &gt; 0) {</div>
<div class="line"><a id="l01421" name="l01421"></a><span class="lineno"> 1421</span>        setReply(501, <span class="stringliteral">&quot;Unexpected parameter&quot;</span>);</div>
<div class="line"><a id="l01422" name="l01422"></a><span class="lineno"> 1422</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01423" name="l01423"></a><span class="lineno"> 1423</span>    }</div>
<div class="line"><a id="l01424" name="l01424"></a><span class="lineno"> 1424</span> </div>
<div class="line"><a id="l01425" name="l01425"></a><span class="lineno"> 1425</span>    changeState(<a class="code hl_enumvalue" href="namespaceFtp.html#a56abcf0499ca5d50f20f9ce02525124ea7378f2a8f0588290c152b47b9739074a">fssHandlePasv</a>, <span class="stringliteral">&quot;handlePasvRequest&quot;</span>);</div>
<div class="line"><a id="l01426" name="l01426"></a><span class="lineno"> 1426</span>    <span class="comment">// no need to fake PASV request via setDataCommand() in true PASV case</span></div>
<div class="line"><a id="l01427" name="l01427"></a><span class="lineno"> 1427</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01428" name="l01428"></a><span class="lineno"> 1428</span>}</div>
</div>
<div class="line"><a id="l01429" name="l01429"></a><span class="lineno"> 1429</span> </div>
<div class="line"><a id="l01431" name="l01431"></a><span class="lineno"> 1431</span><span class="keywordtype">bool</span></div>
<div class="foldopen" id="foldopen01432" data-start="{" data-end="}">
<div class="line"><a id="l01432" name="l01432"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#a96e5eb2529c9084d9294d9689bbf7001"> 1432</a></span><a class="code hl_function" href="classFtp_1_1Server.html#a96e5eb2529c9084d9294d9689bbf7001">Ftp::Server::createDataConnection</a>(<a class="code hl_class" href="classIp_1_1Address.html">Ip::Address</a> cltAddr)</div>
<div class="line"><a id="l01433" name="l01433"></a><span class="lineno"> 1433</span>{</div>
<div class="line"><a id="l01434" name="l01434"></a><span class="lineno"> 1434</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(clientConnection != <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l01435" name="l01435"></a><span class="lineno"> 1435</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(!clientConnection-&gt;remote.isAnyAddr());</div>
<div class="line"><a id="l01436" name="l01436"></a><span class="lineno"> 1436</span> </div>
<div class="line"><a id="l01437" name="l01437"></a><span class="lineno"> 1437</span>    <span class="keywordflow">if</span> (cltAddr != clientConnection-&gt;remote) {</div>
<div class="line"><a id="l01438" name="l01438"></a><span class="lineno"> 1438</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 2, <span class="stringliteral">&quot;rogue PORT &quot;</span> &lt;&lt; cltAddr &lt;&lt; <span class="stringliteral">&quot; request? ctrl: &quot;</span> &lt;&lt; clientConnection-&gt;remote);</div>
<div class="line"><a id="l01439" name="l01439"></a><span class="lineno"> 1439</span>        <span class="comment">// Closing the control connection would not help with attacks because</span></div>
<div class="line"><a id="l01440" name="l01440"></a><span class="lineno"> 1440</span>        <span class="comment">// the client is evidently able to connect to us. Besides, closing</span></div>
<div class="line"><a id="l01441" name="l01441"></a><span class="lineno"> 1441</span>        <span class="comment">// makes retrials easier for the client and more damaging to us.</span></div>
<div class="line"><a id="l01442" name="l01442"></a><span class="lineno"> 1442</span>        setReply(501, <span class="stringliteral">&quot;Prohibited parameter value&quot;</span>);</div>
<div class="line"><a id="l01443" name="l01443"></a><span class="lineno"> 1443</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01444" name="l01444"></a><span class="lineno"> 1444</span>    }</div>
<div class="line"><a id="l01445" name="l01445"></a><span class="lineno"> 1445</span> </div>
<div class="line"><a id="l01446" name="l01446"></a><span class="lineno"> 1446</span>    closeDataConnection();</div>
<div class="line"><a id="l01447" name="l01447"></a><span class="lineno"> 1447</span> </div>
<div class="line"><a id="l01448" name="l01448"></a><span class="lineno"> 1448</span>    <a class="code hl_class" href="classRefCount.html">Comm::ConnectionPointer</a> conn = <span class="keyword">new</span> <a class="code hl_class" href="classComm_1_1Connection.html">Comm::Connection</a>();</div>
<div class="line"><a id="l01449" name="l01449"></a><span class="lineno"> 1449</span>    conn-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a31fb1758ce5a186c27710515b69aa94e">flags</a> |= <a class="code hl_define" href="Connection_8h.html#a931ba92f0e102b166d9f2de4dbda81a9">COMM_DOBIND</a>;</div>
<div class="line"><a id="l01450" name="l01450"></a><span class="lineno"> 1450</span> </div>
<div class="line"><a id="l01451" name="l01451"></a><span class="lineno"> 1451</span>    <span class="keywordflow">if</span> (clientConnection-&gt;flags &amp; <a class="code hl_define" href="Connection_8h.html#a8e482a7d3919ec1fefad794c35a4c81e">COMM_INTERCEPTION</a>) {</div>
<div class="line"><a id="l01452" name="l01452"></a><span class="lineno"> 1452</span>        <span class="comment">// In the case of NAT interception conn-&gt;local value is not set</span></div>
<div class="line"><a id="l01453" name="l01453"></a><span class="lineno"> 1453</span>        <span class="comment">// because the TCP stack will automatically pick correct source</span></div>
<div class="line"><a id="l01454" name="l01454"></a><span class="lineno"> 1454</span>        <span class="comment">// address for the data connection. We must only ensure that IP</span></div>
<div class="line"><a id="l01455" name="l01455"></a><span class="lineno"> 1455</span>        <span class="comment">// version matches client&#39;s address.</span></div>
<div class="line"><a id="l01456" name="l01456"></a><span class="lineno"> 1456</span>        conn-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a84e6544b719c79cbecbc7d2a891fbcb2">local</a>.<a class="code hl_function" href="classIp_1_1Address.html#ac629209aecf4fa35b00242073d30ccb8">setAnyAddr</a>();</div>
<div class="line"><a id="l01457" name="l01457"></a><span class="lineno"> 1457</span> </div>
<div class="line"><a id="l01458" name="l01458"></a><span class="lineno"> 1458</span>        <span class="keywordflow">if</span> (cltAddr.<a class="code hl_function" href="classIp_1_1Address.html#a6533c101544f6cf997406b3676849b3d">isIPv4</a>())</div>
<div class="line"><a id="l01459" name="l01459"></a><span class="lineno"> 1459</span>            conn-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a84e6544b719c79cbecbc7d2a891fbcb2">local</a>.<a class="code hl_function" href="classIp_1_1Address.html#a11fd4fdbf828795b3d188d01284181fe">setIPv4</a>();</div>
<div class="line"><a id="l01460" name="l01460"></a><span class="lineno"> 1460</span> </div>
<div class="line"><a id="l01461" name="l01461"></a><span class="lineno"> 1461</span>        conn-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a60e1b863400f49a2ed17054982561f17">remote</a> = cltAddr;</div>
<div class="line"><a id="l01462" name="l01462"></a><span class="lineno"> 1462</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01463" name="l01463"></a><span class="lineno"> 1463</span>        <span class="comment">// In the case of explicit-proxy the local IP of the control connection</span></div>
<div class="line"><a id="l01464" name="l01464"></a><span class="lineno"> 1464</span>        <span class="comment">// is the Squid IP the client is knowingly talking to.</span></div>
<div class="line"><a id="l01465" name="l01465"></a><span class="lineno"> 1465</span>        <span class="comment">//</span></div>
<div class="line"><a id="l01466" name="l01466"></a><span class="lineno"> 1466</span>        <span class="comment">// In the case of TPROXY the IP address of the control connection is</span></div>
<div class="line"><a id="l01467" name="l01467"></a><span class="lineno"> 1467</span>        <span class="comment">// server IP the client is connecting to, it can be spoofed by Squid.</span></div>
<div class="line"><a id="l01468" name="l01468"></a><span class="lineno"> 1468</span>        <span class="comment">//</span></div>
<div class="line"><a id="l01469" name="l01469"></a><span class="lineno"> 1469</span>        <span class="comment">// In both cases some clients may refuse to accept data connections if</span></div>
<div class="line"><a id="l01470" name="l01470"></a><span class="lineno"> 1470</span>        <span class="comment">// these control connection local-IP&#39;s are not used.</span></div>
<div class="line"><a id="l01471" name="l01471"></a><span class="lineno"> 1471</span>        conn-&gt;<a class="code hl_function" href="classComm_1_1Connection.html#a67c9c1d879e41286853b6140bd5b0076">setAddrs</a>(clientConnection-&gt;local, cltAddr);</div>
<div class="line"><a id="l01472" name="l01472"></a><span class="lineno"> 1472</span> </div>
<div class="line"><a id="l01473" name="l01473"></a><span class="lineno"> 1473</span>        <span class="comment">// Using non-local addresses in TPROXY mode requires appropriate socket option.</span></div>
<div class="line"><a id="l01474" name="l01474"></a><span class="lineno"> 1474</span>        <span class="keywordflow">if</span> (clientConnection-&gt;flags &amp; <a class="code hl_define" href="Connection_8h.html#a303a4af3db144519ffdefde6bc1b9659">COMM_TRANSPARENT</a>)</div>
<div class="line"><a id="l01475" name="l01475"></a><span class="lineno"> 1475</span>            conn-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a31fb1758ce5a186c27710515b69aa94e">flags</a> |= <a class="code hl_define" href="Connection_8h.html#a303a4af3db144519ffdefde6bc1b9659">COMM_TRANSPARENT</a>;</div>
<div class="line"><a id="l01476" name="l01476"></a><span class="lineno"> 1476</span>    }</div>
<div class="line"><a id="l01477" name="l01477"></a><span class="lineno"> 1477</span> </div>
<div class="line"><a id="l01478" name="l01478"></a><span class="lineno"> 1478</span>    <span class="comment">// RFC 959 requires active FTP connections to originate from port 20</span></div>
<div class="line"><a id="l01479" name="l01479"></a><span class="lineno"> 1479</span>    <span class="comment">// but that would preclude us from supporting concurrent transfers! (XXX?)</span></div>
<div class="line"><a id="l01480" name="l01480"></a><span class="lineno"> 1480</span>    conn-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a84e6544b719c79cbecbc7d2a891fbcb2">local</a>.<a class="code hl_function" href="classIp_1_1Address.html#aeea3c669850f18acd2efcd336fcf2438">port</a>(0);</div>
<div class="line"><a id="l01481" name="l01481"></a><span class="lineno"> 1481</span> </div>
<div class="line"><a id="l01482" name="l01482"></a><span class="lineno"> 1482</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(9, 3, <span class="stringliteral">&quot;will actively connect from &quot;</span> &lt;&lt; conn-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a84e6544b719c79cbecbc7d2a891fbcb2">local</a> &lt;&lt; <span class="stringliteral">&quot; to &quot;</span> &lt;&lt;</div>
<div class="line"><a id="l01483" name="l01483"></a><span class="lineno"> 1483</span>           conn-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a60e1b863400f49a2ed17054982561f17">remote</a>);</div>
<div class="line"><a id="l01484" name="l01484"></a><span class="lineno"> 1484</span> </div>
<div class="line"><a id="l01485" name="l01485"></a><span class="lineno"> 1485</span>    dataConn = conn;</div>
<div class="line"><a id="l01486" name="l01486"></a><span class="lineno"> 1486</span>    uploadAvailSize = 0;</div>
<div class="line"><a id="l01487" name="l01487"></a><span class="lineno"> 1487</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01488" name="l01488"></a><span class="lineno"> 1488</span>}</div>
</div>
<div class="line"><a id="l01489" name="l01489"></a><span class="lineno"> 1489</span> </div>
<div class="line"><a id="l01490" name="l01490"></a><span class="lineno"> 1490</span><span class="keywordtype">bool</span></div>
<div class="foldopen" id="foldopen01491" data-start="{" data-end="}">
<div class="line"><a id="l01491" name="l01491"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#a5777b8239009dbe5de8a56ec6765362d"> 1491</a></span><a class="code hl_function" href="classFtp_1_1Server.html#a5777b8239009dbe5de8a56ec6765362d">Ftp::Server::handlePortRequest</a>(<a class="code hl_class" href="classString.html">String</a> &amp;, <a class="code hl_class" href="classString.html">String</a> &amp;params)</div>
<div class="line"><a id="l01492" name="l01492"></a><span class="lineno"> 1492</span>{</div>
<div class="line"><a id="l01493" name="l01493"></a><span class="lineno"> 1493</span>    <span class="comment">// TODO: Should PORT errors trigger closeDataConnection() cleanup?</span></div>
<div class="line"><a id="l01494" name="l01494"></a><span class="lineno"> 1494</span> </div>
<div class="line"><a id="l01495" name="l01495"></a><span class="lineno"> 1495</span>    <span class="keywordflow">if</span> (gotEpsvAll) {</div>
<div class="line"><a id="l01496" name="l01496"></a><span class="lineno"> 1496</span>        setReply(500, <span class="stringliteral">&quot;Rejecting PORT after EPSV ALL&quot;</span>);</div>
<div class="line"><a id="l01497" name="l01497"></a><span class="lineno"> 1497</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01498" name="l01498"></a><span class="lineno"> 1498</span>    }</div>
<div class="line"><a id="l01499" name="l01499"></a><span class="lineno"> 1499</span> </div>
<div class="line"><a id="l01500" name="l01500"></a><span class="lineno"> 1500</span>    <span class="keywordflow">if</span> (!params.<a class="code hl_function" href="classString.html#aff70196bf32e527af1116bb4eb93f353">size</a>()) {</div>
<div class="line"><a id="l01501" name="l01501"></a><span class="lineno"> 1501</span>        setReply(501, <span class="stringliteral">&quot;Missing parameter&quot;</span>);</div>
<div class="line"><a id="l01502" name="l01502"></a><span class="lineno"> 1502</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01503" name="l01503"></a><span class="lineno"> 1503</span>    }</div>
<div class="line"><a id="l01504" name="l01504"></a><span class="lineno"> 1504</span> </div>
<div class="line"><a id="l01505" name="l01505"></a><span class="lineno"> 1505</span>    <a class="code hl_class" href="classIp_1_1Address.html">Ip::Address</a> cltAddr;</div>
<div class="line"><a id="l01506" name="l01506"></a><span class="lineno"> 1506</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="namespaceFtp.html#aa3555ce6316b7b57660f3e89f35ea8a9">Ftp::ParseIpPort</a>(params.<a class="code hl_function" href="classString.html#aba5551ee62c6e82730c0cb1856238c14">termedBuf</a>(), <span class="keyword">nullptr</span>, cltAddr)) {</div>
<div class="line"><a id="l01507" name="l01507"></a><span class="lineno"> 1507</span>        setReply(501, <span class="stringliteral">&quot;Invalid parameter&quot;</span>);</div>
<div class="line"><a id="l01508" name="l01508"></a><span class="lineno"> 1508</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01509" name="l01509"></a><span class="lineno"> 1509</span>    }</div>
<div class="line"><a id="l01510" name="l01510"></a><span class="lineno"> 1510</span> </div>
<div class="line"><a id="l01511" name="l01511"></a><span class="lineno"> 1511</span>    <span class="keywordflow">if</span> (!createDataConnection(cltAddr))</div>
<div class="line"><a id="l01512" name="l01512"></a><span class="lineno"> 1512</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01513" name="l01513"></a><span class="lineno"> 1513</span> </div>
<div class="line"><a id="l01514" name="l01514"></a><span class="lineno"> 1514</span>    changeState(<a class="code hl_enumvalue" href="namespaceFtp.html#a56abcf0499ca5d50f20f9ce02525124ea23e2e86967790b10336094bc42125c6a">fssHandlePort</a>, <span class="stringliteral">&quot;handlePortRequest&quot;</span>);</div>
<div class="line"><a id="l01515" name="l01515"></a><span class="lineno"> 1515</span>    setDataCommand();</div>
<div class="line"><a id="l01516" name="l01516"></a><span class="lineno"> 1516</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>; <span class="comment">// forward our fake PASV request</span></div>
<div class="line"><a id="l01517" name="l01517"></a><span class="lineno"> 1517</span>}</div>
</div>
<div class="line"><a id="l01518" name="l01518"></a><span class="lineno"> 1518</span> </div>
<div class="line"><a id="l01519" name="l01519"></a><span class="lineno"> 1519</span><span class="keywordtype">bool</span></div>
<div class="foldopen" id="foldopen01520" data-start="{" data-end="}">
<div class="line"><a id="l01520" name="l01520"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#a11eb95635878f282d7afc727a4bc23a8"> 1520</a></span><a class="code hl_function" href="classFtp_1_1Server.html#a11eb95635878f282d7afc727a4bc23a8">Ftp::Server::handleDataRequest</a>(<a class="code hl_class" href="classString.html">String</a> &amp;, <a class="code hl_class" href="classString.html">String</a> &amp;)</div>
<div class="line"><a id="l01521" name="l01521"></a><span class="lineno"> 1521</span>{</div>
<div class="line"><a id="l01522" name="l01522"></a><span class="lineno"> 1522</span>    <span class="keywordflow">if</span> (!checkDataConnPre())</div>
<div class="line"><a id="l01523" name="l01523"></a><span class="lineno"> 1523</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01524" name="l01524"></a><span class="lineno"> 1524</span> </div>
<div class="line"><a id="l01525" name="l01525"></a><span class="lineno"> 1525</span>    master-&gt;userDataDone = 0;</div>
<div class="line"><a id="l01526" name="l01526"></a><span class="lineno"> 1526</span>    originDataDownloadAbortedOnError = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01527" name="l01527"></a><span class="lineno"> 1527</span> </div>
<div class="line"><a id="l01528" name="l01528"></a><span class="lineno"> 1528</span>    changeState(<a class="code hl_enumvalue" href="namespaceFtp.html#a56abcf0499ca5d50f20f9ce02525124eaf385076cc145cc42c7248f5b24d05c13">fssHandleDataRequest</a>, <span class="stringliteral">&quot;handleDataRequest&quot;</span>);</div>
<div class="line"><a id="l01529" name="l01529"></a><span class="lineno"> 1529</span> </div>
<div class="line"><a id="l01530" name="l01530"></a><span class="lineno"> 1530</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01531" name="l01531"></a><span class="lineno"> 1531</span>}</div>
</div>
<div class="line"><a id="l01532" name="l01532"></a><span class="lineno"> 1532</span> </div>
<div class="line"><a id="l01533" name="l01533"></a><span class="lineno"> 1533</span><span class="keywordtype">bool</span></div>
<div class="foldopen" id="foldopen01534" data-start="{" data-end="}">
<div class="line"><a id="l01534" name="l01534"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#a2460b627b8ee4623b29b44df5c4e55d5"> 1534</a></span><a class="code hl_function" href="classFtp_1_1Server.html#a2460b627b8ee4623b29b44df5c4e55d5">Ftp::Server::handleUploadRequest</a>(<a class="code hl_class" href="classString.html">String</a> &amp;, <a class="code hl_class" href="classString.html">String</a> &amp;)</div>
<div class="line"><a id="l01535" name="l01535"></a><span class="lineno"> 1535</span>{</div>
<div class="line"><a id="l01536" name="l01536"></a><span class="lineno"> 1536</span>    <span class="keywordflow">if</span> (!checkDataConnPre())</div>
<div class="line"><a id="l01537" name="l01537"></a><span class="lineno"> 1537</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01538" name="l01538"></a><span class="lineno"> 1538</span> </div>
<div class="line"><a id="l01539" name="l01539"></a><span class="lineno"> 1539</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="SquidConfig_8cc.html#a75b136e6a1eef61424d84596a404aafe">Config</a>.<a class="code hl_variable" href="classSquidConfig.html#ac7f1138fffbdda4a9a888100e3187691">accessList</a>.<a class="code hl_variable" href="classSquidConfig.html#afcb714948371a7254490b0d5538a4df3">forceRequestBodyContinuation</a>) {</div>
<div class="line"><a id="l01540" name="l01540"></a><span class="lineno"> 1540</span>        <a class="code hl_class" href="classClientHttpRequest.html">ClientHttpRequest</a> *http = pipeline.front()-&gt;http;</div>
<div class="line"><a id="l01541" name="l01541"></a><span class="lineno"> 1541</span>        <a class="code hl_class" href="classHttpRequest.html">HttpRequest</a> *request = http-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#a2becc63f591bbc0b40542099c1bb05a9">request</a>;</div>
<div class="line"><a id="l01542" name="l01542"></a><span class="lineno"> 1542</span>        <a class="code hl_class" href="classACLFilledChecklist.html">ACLFilledChecklist</a> bodyContinuationCheck(<a class="code hl_variable" href="SquidConfig_8cc.html#a75b136e6a1eef61424d84596a404aafe">Config</a>.<a class="code hl_variable" href="classSquidConfig.html#ac7f1138fffbdda4a9a888100e3187691">accessList</a>.<a class="code hl_variable" href="classSquidConfig.html#afcb714948371a7254490b0d5538a4df3">forceRequestBodyContinuation</a>, request);</div>
<div class="line"><a id="l01543" name="l01543"></a><span class="lineno"> 1543</span>        bodyContinuationCheck.<a class="code hl_variable" href="classACLFilledChecklist.html#ac9fc7ac3b0ef5a2a0d2811aa762dbeab">al</a> = http-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#af1ec5778cbc7fcd488df2918c821f499">al</a>;</div>
<div class="line"><a id="l01544" name="l01544"></a><span class="lineno"> 1544</span>        bodyContinuationCheck.<a class="code hl_function" href="classACLFilledChecklist.html#ae77611904901fa5f796cdd54ff5be235">syncAle</a>(request, http-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#a3f6d0f7008f5302283e91937cdc67f75">log_uri</a>);</div>
<div class="line"><a id="l01545" name="l01545"></a><span class="lineno"> 1545</span>        <span class="keywordflow">if</span> (bodyContinuationCheck.<a class="code hl_function" href="classACLChecklist.html#a51ae541a90994e7ed5d11f2b242ac689">fastCheck</a>().<a class="code hl_function" href="classAcl_1_1Answer.html#af1a1444d19654eb50f7a4323b225f845">allowed</a>()) {</div>
<div class="line"><a id="l01546" name="l01546"></a><span class="lineno"> 1546</span>            request-&gt;<a class="code hl_variable" href="classHttpRequest.html#a79627850aba026a7aa5c1de69958da70">forcedBodyContinuation</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01547" name="l01547"></a><span class="lineno"> 1547</span>            <span class="keywordflow">if</span> (checkDataConnPost()) {</div>
<div class="line"><a id="l01548" name="l01548"></a><span class="lineno"> 1548</span>                <span class="comment">// Write control Msg</span></div>
<div class="line"><a id="l01549" name="l01549"></a><span class="lineno"> 1549</span>                writeEarlyReply(150, <span class="stringliteral">&quot;Data connection opened&quot;</span>);</div>
<div class="line"><a id="l01550" name="l01550"></a><span class="lineno"> 1550</span>                maybeReadUploadData();</div>
<div class="line"><a id="l01551" name="l01551"></a><span class="lineno"> 1551</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01552" name="l01552"></a><span class="lineno"> 1552</span>                <span class="comment">// wait for acceptDataConnection but tell it to call wroteEarlyReply</span></div>
<div class="line"><a id="l01553" name="l01553"></a><span class="lineno"> 1553</span>                <span class="comment">// after writing &quot;150 Data connection opened&quot;</span></div>
<div class="line"><a id="l01554" name="l01554"></a><span class="lineno"> 1554</span>                <span class="keyword">typedef</span> <a class="code hl_class" href="classCommCbMemFunT.html">CommCbMemFunT&lt;Server, CommIoCbParams&gt;</a> Dialer;</div>
<div class="line"><a id="l01555" name="l01555"></a><span class="lineno"> 1555</span>                <a class="code hl_class" href="classRefCount.html">AsyncCall::Pointer</a> call = <a class="code hl_define" href="AsyncJobCalls_8h.html#a3412f4fa1246aee4d4ac46a143075e03">JobCallback</a>(33, 5, Dialer, <span class="keyword">this</span>, <a class="code hl_function" href="classFtp_1_1Server.html#abb080a58365191b240f85bbc70d01cdb">Ftp::Server::wroteEarlyReply</a>);</div>
<div class="line"><a id="l01556" name="l01556"></a><span class="lineno"> 1556</span>                onDataAcceptCall = call;</div>
<div class="line"><a id="l01557" name="l01557"></a><span class="lineno"> 1557</span>            }</div>
<div class="line"><a id="l01558" name="l01558"></a><span class="lineno"> 1558</span>        }</div>
<div class="line"><a id="l01559" name="l01559"></a><span class="lineno"> 1559</span>    }</div>
<div class="line"><a id="l01560" name="l01560"></a><span class="lineno"> 1560</span> </div>
<div class="line"><a id="l01561" name="l01561"></a><span class="lineno"> 1561</span>    changeState(<a class="code hl_enumvalue" href="namespaceFtp.html#a56abcf0499ca5d50f20f9ce02525124eaaf7ccbf3756c082cf11222ec601913a8">fssHandleUploadRequest</a>, <span class="stringliteral">&quot;handleDataRequest&quot;</span>);</div>
<div class="line"><a id="l01562" name="l01562"></a><span class="lineno"> 1562</span> </div>
<div class="line"><a id="l01563" name="l01563"></a><span class="lineno"> 1563</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01564" name="l01564"></a><span class="lineno"> 1564</span>}</div>
</div>
<div class="line"><a id="l01565" name="l01565"></a><span class="lineno"> 1565</span> </div>
<div class="line"><a id="l01566" name="l01566"></a><span class="lineno"> 1566</span><span class="keywordtype">bool</span></div>
<div class="foldopen" id="foldopen01567" data-start="{" data-end="}">
<div class="line"><a id="l01567" name="l01567"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#af40731e50bee1b03862d6f288817eff3"> 1567</a></span><a class="code hl_function" href="classFtp_1_1Server.html#af40731e50bee1b03862d6f288817eff3">Ftp::Server::handleEprtRequest</a>(<a class="code hl_class" href="classString.html">String</a> &amp;, <a class="code hl_class" href="classString.html">String</a> &amp;params)</div>
<div class="line"><a id="l01568" name="l01568"></a><span class="lineno"> 1568</span>{</div>
<div class="line"><a id="l01569" name="l01569"></a><span class="lineno"> 1569</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(9, 3, <span class="stringliteral">&quot;Process an EPRT &quot;</span> &lt;&lt; params);</div>
<div class="line"><a id="l01570" name="l01570"></a><span class="lineno"> 1570</span> </div>
<div class="line"><a id="l01571" name="l01571"></a><span class="lineno"> 1571</span>    <span class="keywordflow">if</span> (gotEpsvAll) {</div>
<div class="line"><a id="l01572" name="l01572"></a><span class="lineno"> 1572</span>        setReply(500, <span class="stringliteral">&quot;Rejecting EPRT after EPSV ALL&quot;</span>);</div>
<div class="line"><a id="l01573" name="l01573"></a><span class="lineno"> 1573</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01574" name="l01574"></a><span class="lineno"> 1574</span>    }</div>
<div class="line"><a id="l01575" name="l01575"></a><span class="lineno"> 1575</span> </div>
<div class="line"><a id="l01576" name="l01576"></a><span class="lineno"> 1576</span>    <span class="keywordflow">if</span> (!params.<a class="code hl_function" href="classString.html#aff70196bf32e527af1116bb4eb93f353">size</a>()) {</div>
<div class="line"><a id="l01577" name="l01577"></a><span class="lineno"> 1577</span>        setReply(501, <span class="stringliteral">&quot;Missing parameter&quot;</span>);</div>
<div class="line"><a id="l01578" name="l01578"></a><span class="lineno"> 1578</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01579" name="l01579"></a><span class="lineno"> 1579</span>    }</div>
<div class="line"><a id="l01580" name="l01580"></a><span class="lineno"> 1580</span> </div>
<div class="line"><a id="l01581" name="l01581"></a><span class="lineno"> 1581</span>    <a class="code hl_class" href="classIp_1_1Address.html">Ip::Address</a> cltAddr;</div>
<div class="line"><a id="l01582" name="l01582"></a><span class="lineno"> 1582</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="namespaceFtp.html#a36fae0a62f51adc56e257b784481bc42">Ftp::ParseProtoIpPort</a>(params.<a class="code hl_function" href="classString.html#aba5551ee62c6e82730c0cb1856238c14">termedBuf</a>(), cltAddr)) {</div>
<div class="line"><a id="l01583" name="l01583"></a><span class="lineno"> 1583</span>        setReply(501, <span class="stringliteral">&quot;Invalid parameter&quot;</span>);</div>
<div class="line"><a id="l01584" name="l01584"></a><span class="lineno"> 1584</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01585" name="l01585"></a><span class="lineno"> 1585</span>    }</div>
<div class="line"><a id="l01586" name="l01586"></a><span class="lineno"> 1586</span> </div>
<div class="line"><a id="l01587" name="l01587"></a><span class="lineno"> 1587</span>    <span class="keywordflow">if</span> (!createDataConnection(cltAddr))</div>
<div class="line"><a id="l01588" name="l01588"></a><span class="lineno"> 1588</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01589" name="l01589"></a><span class="lineno"> 1589</span> </div>
<div class="line"><a id="l01590" name="l01590"></a><span class="lineno"> 1590</span>    changeState(<a class="code hl_enumvalue" href="namespaceFtp.html#a56abcf0499ca5d50f20f9ce02525124ea841ba4d12454bd93a03ecc1c931a87bf">fssHandleEprt</a>, <span class="stringliteral">&quot;handleEprtRequest&quot;</span>);</div>
<div class="line"><a id="l01591" name="l01591"></a><span class="lineno"> 1591</span>    setDataCommand();</div>
<div class="line"><a id="l01592" name="l01592"></a><span class="lineno"> 1592</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>; <span class="comment">// forward our fake PASV request</span></div>
<div class="line"><a id="l01593" name="l01593"></a><span class="lineno"> 1593</span>}</div>
</div>
<div class="line"><a id="l01594" name="l01594"></a><span class="lineno"> 1594</span> </div>
<div class="line"><a id="l01595" name="l01595"></a><span class="lineno"> 1595</span><span class="keywordtype">bool</span></div>
<div class="foldopen" id="foldopen01596" data-start="{" data-end="}">
<div class="line"><a id="l01596" name="l01596"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#a9745cd38915b36995a608726fa185a2c"> 1596</a></span><a class="code hl_function" href="classFtp_1_1Server.html#a9745cd38915b36995a608726fa185a2c">Ftp::Server::handleEpsvRequest</a>(<a class="code hl_class" href="classString.html">String</a> &amp;, <a class="code hl_class" href="classString.html">String</a> &amp;params)</div>
<div class="line"><a id="l01597" name="l01597"></a><span class="lineno"> 1597</span>{</div>
<div class="line"><a id="l01598" name="l01598"></a><span class="lineno"> 1598</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(9, 3, <span class="stringliteral">&quot;Process an EPSV command with params: &quot;</span> &lt;&lt; params);</div>
<div class="line"><a id="l01599" name="l01599"></a><span class="lineno"> 1599</span>    <span class="keywordflow">if</span> (params.<a class="code hl_function" href="classString.html#aff70196bf32e527af1116bb4eb93f353">size</a>() &lt;= 0) {</div>
<div class="line"><a id="l01600" name="l01600"></a><span class="lineno"> 1600</span>        <span class="comment">// treat parameterless EPSV as &quot;use the protocol of the ctrl conn&quot;</span></div>
<div class="line"><a id="l01601" name="l01601"></a><span class="lineno"> 1601</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (params.<a class="code hl_function" href="classString.html#ad371f67478ccdf8fc55d2beb03708ff3">caseCmp</a>(<span class="stringliteral">&quot;ALL&quot;</span>) == 0) {</div>
<div class="line"><a id="l01602" name="l01602"></a><span class="lineno"> 1602</span>        setReply(200, <span class="stringliteral">&quot;EPSV ALL ok&quot;</span>);</div>
<div class="line"><a id="l01603" name="l01603"></a><span class="lineno"> 1603</span>        gotEpsvAll = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01604" name="l01604"></a><span class="lineno"> 1604</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01605" name="l01605"></a><span class="lineno"> 1605</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (params.<a class="code hl_function" href="classString.html#a08745577171227c59ced9a0ca85cd5ac">cmp</a>(<span class="stringliteral">&quot;2&quot;</span>) == 0) {</div>
<div class="line"><a id="l01606" name="l01606"></a><span class="lineno"> 1606</span>        <span class="keywordflow">if</span> (!Ip::EnableIpv6) {</div>
<div class="line"><a id="l01607" name="l01607"></a><span class="lineno"> 1607</span>            setReply(522, <span class="stringliteral">&quot;Network protocol not supported, use (1)&quot;</span>);</div>
<div class="line"><a id="l01608" name="l01608"></a><span class="lineno"> 1608</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01609" name="l01609"></a><span class="lineno"> 1609</span>        }</div>
<div class="line"><a id="l01610" name="l01610"></a><span class="lineno"> 1610</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (params.<a class="code hl_function" href="classString.html#a08745577171227c59ced9a0ca85cd5ac">cmp</a>(<span class="stringliteral">&quot;1&quot;</span>) != 0) {</div>
<div class="line"><a id="l01611" name="l01611"></a><span class="lineno"> 1611</span>        setReply(501, <span class="stringliteral">&quot;Unsupported EPSV parameter&quot;</span>);</div>
<div class="line"><a id="l01612" name="l01612"></a><span class="lineno"> 1612</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01613" name="l01613"></a><span class="lineno"> 1613</span>    }</div>
<div class="line"><a id="l01614" name="l01614"></a><span class="lineno"> 1614</span> </div>
<div class="line"><a id="l01615" name="l01615"></a><span class="lineno"> 1615</span>    changeState(<a class="code hl_enumvalue" href="namespaceFtp.html#a56abcf0499ca5d50f20f9ce02525124eace00ce9091de95a55b3226621e66fb68">fssHandleEpsv</a>, <span class="stringliteral">&quot;handleEpsvRequest&quot;</span>);</div>
<div class="line"><a id="l01616" name="l01616"></a><span class="lineno"> 1616</span>    setDataCommand();</div>
<div class="line"><a id="l01617" name="l01617"></a><span class="lineno"> 1617</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>; <span class="comment">// forward our fake PASV request</span></div>
<div class="line"><a id="l01618" name="l01618"></a><span class="lineno"> 1618</span>}</div>
</div>
<div class="line"><a id="l01619" name="l01619"></a><span class="lineno"> 1619</span> </div>
<div class="line"><a id="l01620" name="l01620"></a><span class="lineno"> 1620</span><span class="keywordtype">bool</span></div>
<div class="foldopen" id="foldopen01621" data-start="{" data-end="}">
<div class="line"><a id="l01621" name="l01621"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#af20c431bd7cae760f440231ee5e140ec"> 1621</a></span><a class="code hl_function" href="classFtp_1_1Server.html#af20c431bd7cae760f440231ee5e140ec">Ftp::Server::handleCwdRequest</a>(<a class="code hl_class" href="classString.html">String</a> &amp;, <a class="code hl_class" href="classString.html">String</a> &amp;)</div>
<div class="line"><a id="l01622" name="l01622"></a><span class="lineno"> 1622</span>{</div>
<div class="line"><a id="l01623" name="l01623"></a><span class="lineno"> 1623</span>    changeState(<a class="code hl_enumvalue" href="namespaceFtp.html#a56abcf0499ca5d50f20f9ce02525124ea8be1a0f8f031b0b6edc50539aec2b57c">fssHandleCwd</a>, <span class="stringliteral">&quot;handleCwdRequest&quot;</span>);</div>
<div class="line"><a id="l01624" name="l01624"></a><span class="lineno"> 1624</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01625" name="l01625"></a><span class="lineno"> 1625</span>}</div>
</div>
<div class="line"><a id="l01626" name="l01626"></a><span class="lineno"> 1626</span> </div>
<div class="line"><a id="l01627" name="l01627"></a><span class="lineno"> 1627</span><span class="keywordtype">bool</span></div>
<div class="foldopen" id="foldopen01628" data-start="{" data-end="}">
<div class="line"><a id="l01628" name="l01628"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#aafcb05a9300f5cf350682aef4b4fd915"> 1628</a></span><a class="code hl_function" href="classFtp_1_1Server.html#aafcb05a9300f5cf350682aef4b4fd915">Ftp::Server::handlePassRequest</a>(<a class="code hl_class" href="classString.html">String</a> &amp;, <a class="code hl_class" href="classString.html">String</a> &amp;)</div>
<div class="line"><a id="l01629" name="l01629"></a><span class="lineno"> 1629</span>{</div>
<div class="line"><a id="l01630" name="l01630"></a><span class="lineno"> 1630</span>    changeState(<a class="code hl_enumvalue" href="namespaceFtp.html#a56abcf0499ca5d50f20f9ce02525124ea8edceb8ceb3bb91af0797b9ac75945c3">fssHandlePass</a>, <span class="stringliteral">&quot;handlePassRequest&quot;</span>);</div>
<div class="line"><a id="l01631" name="l01631"></a><span class="lineno"> 1631</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01632" name="l01632"></a><span class="lineno"> 1632</span>}</div>
</div>
<div class="line"><a id="l01633" name="l01633"></a><span class="lineno"> 1633</span> </div>
<div class="line"><a id="l01634" name="l01634"></a><span class="lineno"> 1634</span><span class="keywordtype">bool</span></div>
<div class="foldopen" id="foldopen01635" data-start="{" data-end="}">
<div class="line"><a id="l01635" name="l01635"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#a38a276da4afa2eb9ab15354d85bcb798"> 1635</a></span><a class="code hl_function" href="classFtp_1_1Server.html#a38a276da4afa2eb9ab15354d85bcb798">Ftp::Server::handleCdupRequest</a>(<a class="code hl_class" href="classString.html">String</a> &amp;, <a class="code hl_class" href="classString.html">String</a> &amp;)</div>
<div class="line"><a id="l01636" name="l01636"></a><span class="lineno"> 1636</span>{</div>
<div class="line"><a id="l01637" name="l01637"></a><span class="lineno"> 1637</span>    changeState(<a class="code hl_enumvalue" href="namespaceFtp.html#a56abcf0499ca5d50f20f9ce02525124ea3e2ae24438de9cc3285c777b31770207">fssHandleCdup</a>, <span class="stringliteral">&quot;handleCdupRequest&quot;</span>);</div>
<div class="line"><a id="l01638" name="l01638"></a><span class="lineno"> 1638</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01639" name="l01639"></a><span class="lineno"> 1639</span>}</div>
</div>
<div class="line"><a id="l01640" name="l01640"></a><span class="lineno"> 1640</span> </div>
<div class="line"><a id="l01641" name="l01641"></a><span class="lineno"> 1641</span><span class="comment">// Convert user PORT, EPRT, PASV, or EPSV data command to Squid PASV command.</span></div>
<div class="line"><a id="l01642" name="l01642"></a><span class="lineno"> 1642</span><span class="comment">// Squid FTP client decides what data command to use with peers.</span></div>
<div class="line"><a id="l01643" name="l01643"></a><span class="lineno"> 1643</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen01644" data-start="{" data-end="}">
<div class="line"><a id="l01644" name="l01644"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#a1c82aaec15b04070e766c84521e47b9d"> 1644</a></span><a class="code hl_function" href="classFtp_1_1Server.html#a1c82aaec15b04070e766c84521e47b9d">Ftp::Server::setDataCommand</a>()</div>
<div class="line"><a id="l01645" name="l01645"></a><span class="lineno"> 1645</span>{</div>
<div class="line"><a id="l01646" name="l01646"></a><span class="lineno"> 1646</span>    <a class="code hl_class" href="classClientHttpRequest.html">ClientHttpRequest</a> *<span class="keyword">const</span> http = pipeline.front()-&gt;http;</div>
<div class="line"><a id="l01647" name="l01647"></a><span class="lineno"> 1647</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(http != <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l01648" name="l01648"></a><span class="lineno"> 1648</span>    <a class="code hl_class" href="classHttpRequest.html">HttpRequest</a> *<span class="keyword">const</span> request = http-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#a2becc63f591bbc0b40542099c1bb05a9">request</a>;</div>
<div class="line"><a id="l01649" name="l01649"></a><span class="lineno"> 1649</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(request != <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l01650" name="l01650"></a><span class="lineno"> 1650</span>    <a class="code hl_class" href="classHttpHeader.html">HttpHeader</a> &amp;header = request-&gt;<a class="code hl_variable" href="classHttp_1_1Message.html#a79ae935ff618211b139dcfdd8a5277ec">header</a>;</div>
<div class="line"><a id="l01651" name="l01651"></a><span class="lineno"> 1651</span>    <span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classSBuf.html">SBuf</a> pasvValue(<span class="stringliteral">&quot;PASV&quot;</span>);</div>
<div class="line"><a id="l01652" name="l01652"></a><span class="lineno"> 1652</span>    header.<a class="code hl_function" href="classHttpHeader.html#ae56dc631f4c28f3f6a64467cffa42ac9">updateOrAddStr</a>(<a class="code hl_enumvalue" href="namespaceHttp.html#a92faa3c60e0b457c167759389ae061a4a9bdd18abe19a7e3517a6786ae7f15b44">Http::HdrType::FTP_COMMAND</a>, pasvValue);</div>
<div class="line"><a id="l01653" name="l01653"></a><span class="lineno"> 1653</span>    <span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_class" href="classSBuf.html">SBuf</a> emptyValue(<span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><a id="l01654" name="l01654"></a><span class="lineno"> 1654</span>    header.<a class="code hl_function" href="classHttpHeader.html#ae56dc631f4c28f3f6a64467cffa42ac9">updateOrAddStr</a>(<a class="code hl_enumvalue" href="namespaceHttp.html#a92faa3c60e0b457c167759389ae061a4af9f4f70983e0f5ffa741f2a523f0eda3">Http::HdrType::FTP_ARGUMENTS</a>, emptyValue);</div>
<div class="line"><a id="l01655" name="l01655"></a><span class="lineno"> 1655</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(9, 5, <span class="stringliteral">&quot;client data command converted to fake PASV&quot;</span>);</div>
<div class="line"><a id="l01656" name="l01656"></a><span class="lineno"> 1656</span>}</div>
</div>
<div class="line"><a id="l01657" name="l01657"></a><span class="lineno"> 1657</span> </div>
<div class="line"><a id="l01660" name="l01660"></a><span class="lineno"> 1660</span><span class="keywordtype">bool</span></div>
<div class="foldopen" id="foldopen01661" data-start="{" data-end="}">
<div class="line"><a id="l01661" name="l01661"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#a6b841156ae0316934069ebaa7c7c488f"> 1661</a></span><a class="code hl_function" href="classFtp_1_1Server.html#a6b841156ae0316934069ebaa7c7c488f">Ftp::Server::checkDataConnPre</a>()</div>
<div class="line"><a id="l01662" name="l01662"></a><span class="lineno"> 1662</span>{</div>
<div class="line"><a id="l01663" name="l01663"></a><span class="lineno"> 1663</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="namespaceComm.html#a91f0a0e22e74a7ad6f7c44c137c6f005">Comm::IsConnOpen</a>(dataConn))</div>
<div class="line"><a id="l01664" name="l01664"></a><span class="lineno"> 1664</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01665" name="l01665"></a><span class="lineno"> 1665</span> </div>
<div class="line"><a id="l01666" name="l01666"></a><span class="lineno"> 1666</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="namespaceComm.html#a91f0a0e22e74a7ad6f7c44c137c6f005">Comm::IsConnOpen</a>(dataListenConn)) {</div>
<div class="line"><a id="l01667" name="l01667"></a><span class="lineno"> 1667</span>        <span class="comment">// We are still waiting for a client to connect to us after PASV.</span></div>
<div class="line"><a id="l01668" name="l01668"></a><span class="lineno"> 1668</span>        <span class="comment">// Perhaps client&#39;s data conn handshake has not reached us yet.</span></div>
<div class="line"><a id="l01669" name="l01669"></a><span class="lineno"> 1669</span>        <span class="comment">// After we talk to the server, checkDataConnPost() will recheck.</span></div>
<div class="line"><a id="l01670" name="l01670"></a><span class="lineno"> 1670</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 3, <span class="stringliteral">&quot;expecting clt data conn &quot;</span> &lt;&lt; dataListenConn);</div>
<div class="line"><a id="l01671" name="l01671"></a><span class="lineno"> 1671</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01672" name="l01672"></a><span class="lineno"> 1672</span>    }</div>
<div class="line"><a id="l01673" name="l01673"></a><span class="lineno"> 1673</span> </div>
<div class="line"><a id="l01674" name="l01674"></a><span class="lineno"> 1674</span>    <span class="keywordflow">if</span> (!dataConn || dataConn-&gt;remote.isAnyAddr()) {</div>
<div class="line"><a id="l01675" name="l01675"></a><span class="lineno"> 1675</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;missing &quot;</span> &lt;&lt; dataConn);</div>
<div class="line"><a id="l01676" name="l01676"></a><span class="lineno"> 1676</span>        <span class="comment">// TODO: use client address and default port instead.</span></div>
<div class="line"><a id="l01677" name="l01677"></a><span class="lineno"> 1677</span>        setReply(425, <span class="stringliteral">&quot;Use PORT or PASV first&quot;</span>);</div>
<div class="line"><a id="l01678" name="l01678"></a><span class="lineno"> 1678</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01679" name="l01679"></a><span class="lineno"> 1679</span>    }</div>
<div class="line"><a id="l01680" name="l01680"></a><span class="lineno"> 1680</span> </div>
<div class="line"><a id="l01681" name="l01681"></a><span class="lineno"> 1681</span>    <span class="comment">// active transfer: open a data connection from Squid to client</span></div>
<div class="line"><a id="l01682" name="l01682"></a><span class="lineno"> 1682</span>    <span class="keyword">typedef</span> <a class="code hl_class" href="classCommCbMemFunT.html">CommCbMemFunT&lt;Server, CommConnectCbParams&gt;</a> Dialer;</div>
<div class="line"><a id="l01683" name="l01683"></a><span class="lineno"> 1683</span>    <a class="code hl_class" href="classRefCount.html">AsyncCall::Pointer</a> callback = <a class="code hl_define" href="AsyncJobCalls_8h.html#a3412f4fa1246aee4d4ac46a143075e03">JobCallback</a>(17, 3, Dialer, <span class="keyword">this</span>, <a class="code hl_function" href="classFtp_1_1Server.html#a2e1bf5f8613d64f9483f3cdaf30ee38e">Ftp::Server::connectedForData</a>);</div>
<div class="line"><a id="l01684" name="l01684"></a><span class="lineno"> 1684</span>    <span class="keyword">const</span> <span class="keyword">auto</span> cs = <span class="keyword">new</span> <a class="code hl_class" href="classComm_1_1ConnOpener.html">Comm::ConnOpener</a>(dataConn-&gt;cloneProfile(), callback,</div>
<div class="line"><a id="l01685" name="l01685"></a><span class="lineno"> 1685</span>                                         <a class="code hl_variable" href="SquidConfig_8cc.html#a75b136e6a1eef61424d84596a404aafe">Config</a>.<a class="code hl_variable" href="classSquidConfig.html#a616f6fb80c58175d607c035c74744b17">Timeout</a>.<a class="code hl_variable" href="classSquidConfig.html#aba653ea563fdbd655dac52d5a477974b">connect</a>);</div>
<div class="line"><a id="l01686" name="l01686"></a><span class="lineno"> 1686</span>    dataConnWait.start(cs, callback);</div>
<div class="line"><a id="l01687" name="l01687"></a><span class="lineno"> 1687</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01688" name="l01688"></a><span class="lineno"> 1688</span>}</div>
</div>
<div class="line"><a id="l01689" name="l01689"></a><span class="lineno"> 1689</span> </div>
<div class="line"><a id="l01691" name="l01691"></a><span class="lineno"> 1691</span><span class="keywordtype">bool</span></div>
<div class="foldopen" id="foldopen01692" data-start="{" data-end="}">
<div class="line"><a id="l01692" name="l01692"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#adfc11254c46706715973503ae2f49063"> 1692</a></span><a class="code hl_function" href="classFtp_1_1Server.html#adfc11254c46706715973503ae2f49063">Ftp::Server::checkDataConnPost</a>()<span class="keyword"> const</span></div>
<div class="line"><a id="l01693" name="l01693"></a><span class="lineno"> 1693</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01694" name="l01694"></a><span class="lineno"> 1694</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="namespaceComm.html#a91f0a0e22e74a7ad6f7c44c137c6f005">Comm::IsConnOpen</a>(dataConn)) {</div>
<div class="line"><a id="l01695" name="l01695"></a><span class="lineno"> 1695</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 3, <span class="stringliteral">&quot;missing client data conn: &quot;</span> &lt;&lt; dataConn);</div>
<div class="line"><a id="l01696" name="l01696"></a><span class="lineno"> 1696</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01697" name="l01697"></a><span class="lineno"> 1697</span>    }</div>
<div class="line"><a id="l01698" name="l01698"></a><span class="lineno"> 1698</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01699" name="l01699"></a><span class="lineno"> 1699</span>}</div>
</div>
<div class="line"><a id="l01700" name="l01700"></a><span class="lineno"> 1700</span> </div>
<div class="line"><a id="l01702" name="l01702"></a><span class="lineno"> 1702</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen01703" data-start="{" data-end="}">
<div class="line"><a id="l01703" name="l01703"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#a2e1bf5f8613d64f9483f3cdaf30ee38e"> 1703</a></span><a class="code hl_function" href="classFtp_1_1Server.html#a2e1bf5f8613d64f9483f3cdaf30ee38e">Ftp::Server::connectedForData</a>(<span class="keyword">const</span> <a class="code hl_class" href="classCommConnectCbParams.html">CommConnectCbParams</a> &amp;params)</div>
<div class="line"><a id="l01704" name="l01704"></a><span class="lineno"> 1704</span>{</div>
<div class="line"><a id="l01705" name="l01705"></a><span class="lineno"> 1705</span>    dataConnWait.finish();</div>
<div class="line"><a id="l01706" name="l01706"></a><span class="lineno"> 1706</span> </div>
<div class="line"><a id="l01707" name="l01707"></a><span class="lineno"> 1707</span>    <span class="keywordflow">if</span> (params.<a class="code hl_variable" href="classCommCommonCbParams.html#aaa1b70c6ff254ac72ac1503fc158df7e">flag</a> != <a class="code hl_enumvalue" href="namespaceComm.html#a9d8d4f4a5745b975c5785998e4246050a2d02cf4ed31f765e18f4d8474ede4e24">Comm::OK</a>) {</div>
<div class="line"><a id="l01708" name="l01708"></a><span class="lineno"> 1708</span>        setReply(425, <span class="stringliteral">&quot;Cannot open data connection.&quot;</span>);</div>
<div class="line"><a id="l01709" name="l01709"></a><span class="lineno"> 1709</span>        <a class="code hl_class" href="classRefCount.html">Http::StreamPointer</a> context = pipeline.front();</div>
<div class="line"><a id="l01710" name="l01710"></a><span class="lineno"> 1710</span>        <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(context-&gt;http);</div>
<div class="line"><a id="l01711" name="l01711"></a><span class="lineno"> 1711</span>        <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(context-&gt;http-&gt;storeEntry() != <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l01712" name="l01712"></a><span class="lineno"> 1712</span>        <span class="comment">// TODO: call closeDataConnection() to reset data conn processing?</span></div>
<div class="line"><a id="l01713" name="l01713"></a><span class="lineno"> 1713</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01714" name="l01714"></a><span class="lineno"> 1714</span>        <span class="comment">// Finalize the details and start owning the supplied connection.</span></div>
<div class="line"><a id="l01715" name="l01715"></a><span class="lineno"> 1715</span>        <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(params.<a class="code hl_variable" href="classCommCommonCbParams.html#acbcbe42d3ccd12c6de3b1f3d1d7c4bc3">conn</a>);</div>
<div class="line"><a id="l01716" name="l01716"></a><span class="lineno"> 1716</span>        <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(dataConn);</div>
<div class="line"><a id="l01717" name="l01717"></a><span class="lineno"> 1717</span>        <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(!dataConn-&gt;isOpen());</div>
<div class="line"><a id="l01718" name="l01718"></a><span class="lineno"> 1718</span>        dataConn = params.<a class="code hl_variable" href="classCommCommonCbParams.html#acbcbe42d3ccd12c6de3b1f3d1d7c4bc3">conn</a>;</div>
<div class="line"><a id="l01719" name="l01719"></a><span class="lineno"> 1719</span>        <span class="comment">// XXX: Missing comm_add_close_handler() to track external closures.</span></div>
<div class="line"><a id="l01720" name="l01720"></a><span class="lineno"> 1720</span> </div>
<div class="line"><a id="l01721" name="l01721"></a><span class="lineno"> 1721</span>        <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(<a class="code hl_function" href="namespaceComm.html#a91f0a0e22e74a7ad6f7c44c137c6f005">Comm::IsConnOpen</a>(params.<a class="code hl_variable" href="classCommCommonCbParams.html#acbcbe42d3ccd12c6de3b1f3d1d7c4bc3">conn</a>));</div>
<div class="line"><a id="l01722" name="l01722"></a><span class="lineno"> 1722</span>        <a class="code hl_function" href="fd_8cc.html#a397dc4e5e5cf728d8f1a48b32cb4e60d">fd_note</a>(params.<a class="code hl_variable" href="classCommCommonCbParams.html#acbcbe42d3ccd12c6de3b1f3d1d7c4bc3">conn</a>-&gt;<a class="code hl_variable" href="classComm_1_1Connection.html#a8e53f4d6fd38545947a5aac6efb98fca">fd</a>, <span class="stringliteral">&quot;active client ftp data&quot;</span>);</div>
<div class="line"><a id="l01723" name="l01723"></a><span class="lineno"> 1723</span>    }</div>
<div class="line"><a id="l01724" name="l01724"></a><span class="lineno"> 1724</span> </div>
<div class="line"><a id="l01725" name="l01725"></a><span class="lineno"> 1725</span>    doProcessRequest();</div>
<div class="line"><a id="l01726" name="l01726"></a><span class="lineno"> 1726</span>}</div>
</div>
<div class="line"><a id="l01727" name="l01727"></a><span class="lineno"> 1727</span> </div>
<div class="line"><a id="l01728" name="l01728"></a><span class="lineno"> 1728</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen01729" data-start="{" data-end="}">
<div class="line"><a id="l01729" name="l01729"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#a9bbdcbe2fc3cf89f62cca8991473fb65"> 1729</a></span><a class="code hl_function" href="classFtp_1_1Server.html#a9bbdcbe2fc3cf89f62cca8991473fb65">Ftp::Server::setReply</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> code, <span class="keyword">const</span> <span class="keywordtype">char</span> *msg)</div>
<div class="line"><a id="l01730" name="l01730"></a><span class="lineno"> 1730</span>{</div>
<div class="line"><a id="l01731" name="l01731"></a><span class="lineno"> 1731</span>    <a class="code hl_class" href="classRefCount.html">Http::StreamPointer</a> context = pipeline.front();</div>
<div class="line"><a id="l01732" name="l01732"></a><span class="lineno"> 1732</span>    <a class="code hl_class" href="classClientHttpRequest.html">ClientHttpRequest</a> *<span class="keyword">const</span> http = context-&gt;http;</div>
<div class="line"><a id="l01733" name="l01733"></a><span class="lineno"> 1733</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(http != <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l01734" name="l01734"></a><span class="lineno"> 1734</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(http-&gt;<a class="code hl_function" href="classClientHttpRequest.html#ac8c0f73794781ce53acf6083e0077f34">storeEntry</a>() == <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l01735" name="l01735"></a><span class="lineno"> 1735</span> </div>
<div class="line"><a id="l01736" name="l01736"></a><span class="lineno"> 1736</span>    <a class="code hl_class" href="classHttpReply.html">HttpReply</a> *<span class="keyword">const</span> reply = <a class="code hl_function" href="namespaceFtp.html#ac99540d79350b5eec3729725a8a52a55">Ftp::HttpReplyWrapper</a>(code, msg, <a class="code hl_enumvalue" href="namespaceHttp.html#a432f881deb187c726161d6435daec722ab95a10cc149f601422b96a56b2acf1f7">Http::scNoContent</a>, 0);</div>
<div class="line"><a id="l01737" name="l01737"></a><span class="lineno"> 1737</span> </div>
<div class="line"><a id="l01738" name="l01738"></a><span class="lineno"> 1738</span>    <a class="code hl_class" href="classclientStreamNode.html">clientStreamNode</a> *<span class="keyword">const</span> <a class="code hl_struct" href="structnode.html">node</a> = context-&gt;getClientReplyContext();</div>
<div class="line"><a id="l01739" name="l01739"></a><span class="lineno"> 1739</span>    <a class="code hl_class" href="classclientReplyContext.html">clientReplyContext</a> *<span class="keyword">const</span> repContext =</div>
<div class="line"><a id="l01740" name="l01740"></a><span class="lineno"> 1740</span>        <span class="keyword">dynamic_cast&lt;</span><a class="code hl_class" href="classclientReplyContext.html">clientReplyContext</a> *<span class="keyword">&gt;</span>(<a class="code hl_struct" href="structnode.html">node</a>-&gt;data.getRaw());</div>
<div class="line"><a id="l01741" name="l01741"></a><span class="lineno"> 1741</span>    <a class="code hl_define" href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a>(repContext != <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l01742" name="l01742"></a><span class="lineno"> 1742</span> </div>
<div class="line"><a id="l01743" name="l01743"></a><span class="lineno"> 1743</span>    <a class="code hl_class" href="classRequestFlags.html">RequestFlags</a> reqFlags;</div>
<div class="line"><a id="l01744" name="l01744"></a><span class="lineno"> 1744</span>    reqFlags.<a class="code hl_function" href="classRequestFlags.html#a7a87d1bd6000a6ce88eae02e6edf9f4c">disableCacheUse</a>(<span class="stringliteral">&quot;FTP response wrapper&quot;</span>);</div>
<div class="line"><a id="l01745" name="l01745"></a><span class="lineno"> 1745</span>    repContext-&gt;<a class="code hl_function" href="classclientReplyContext.html#a52e1f683492128736519f7389c712b6c">createStoreEntry</a>(http-&gt;<a class="code hl_variable" href="classClientHttpRequest.html#a2becc63f591bbc0b40542099c1bb05a9">request</a>-&gt;<a class="code hl_variable" href="classHttpRequest.html#a1f0af82ff15e9a29d15319fc3cf05a54">method</a>, reqFlags);</div>
<div class="line"><a id="l01746" name="l01746"></a><span class="lineno"> 1746</span>    http-&gt;<a class="code hl_function" href="classClientHttpRequest.html#ac8c0f73794781ce53acf6083e0077f34">storeEntry</a>()-&gt;<a class="code hl_function" href="classStoreEntry.html#aae28c5e9a323d60ac8fe8ce98f6eb7c5">replaceHttpReply</a>(reply);</div>
<div class="line"><a id="l01747" name="l01747"></a><span class="lineno"> 1747</span>}</div>
</div>
<div class="line"><a id="l01748" name="l01748"></a><span class="lineno"> 1748</span> </div>
<div class="line"><a id="l01749" name="l01749"></a><span class="lineno"> 1749</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen01750" data-start="{" data-end="}">
<div class="line"><a id="l01750" name="l01750"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#a527df8bef2b079388d32dcfca742b474"> 1750</a></span><a class="code hl_function" href="classFtp_1_1Server.html#a527df8bef2b079388d32dcfca742b474">Ftp::Server::callException</a>(<span class="keyword">const</span> std::exception &amp;e)</div>
<div class="line"><a id="l01751" name="l01751"></a><span class="lineno"> 1751</span>{</div>
<div class="line"><a id="l01752" name="l01752"></a><span class="lineno"> 1752</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 2, <span class="stringliteral">&quot;FTP::Server job caught: &quot;</span> &lt;&lt; e.what());</div>
<div class="line"><a id="l01753" name="l01753"></a><span class="lineno"> 1753</span>    closeDataConnection();</div>
<div class="line"><a id="l01754" name="l01754"></a><span class="lineno"> 1754</span>    unpinConnection(<span class="keyword">true</span>);</div>
<div class="line"><a id="l01755" name="l01755"></a><span class="lineno"> 1755</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="namespaceComm.html#a91f0a0e22e74a7ad6f7c44c137c6f005">Comm::IsConnOpen</a>(clientConnection))</div>
<div class="line"><a id="l01756" name="l01756"></a><span class="lineno"> 1756</span>        clientConnection-&gt;close();</div>
<div class="line"><a id="l01757" name="l01757"></a><span class="lineno"> 1757</span>    <a class="code hl_function" href="classAsyncJob.html#aefd101ddca496c1372f282e0f15229b8">AsyncJob::callException</a>(e);</div>
<div class="line"><a id="l01758" name="l01758"></a><span class="lineno"> 1758</span>}</div>
</div>
<div class="line"><a id="l01759" name="l01759"></a><span class="lineno"> 1759</span> </div>
<div class="line"><a id="l01760" name="l01760"></a><span class="lineno"> 1760</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen01761" data-start="{" data-end="}">
<div class="line"><a id="l01761" name="l01761"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#a68296ed05e04f05f4d86abf14e66d480"> 1761</a></span><a class="code hl_function" href="classFtp_1_1Server.html#a68296ed05e04f05f4d86abf14e66d480">Ftp::Server::startWaitingForOrigin</a>()</div>
<div class="line"><a id="l01762" name="l01762"></a><span class="lineno"> 1762</span>{</div>
<div class="line"><a id="l01763" name="l01763"></a><span class="lineno"> 1763</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="comm_8cc.html#a8464d2ca5f1d7e8046880d95fe30873a">isOpen</a>()) <span class="comment">// if we are closing, nothing to do</span></div>
<div class="line"><a id="l01764" name="l01764"></a><span class="lineno"> 1764</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01765" name="l01765"></a><span class="lineno"> 1765</span> </div>
<div class="line"><a id="l01766" name="l01766"></a><span class="lineno"> 1766</span>    <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;waiting for Ftp::Client data transfer to end&quot;</span>);</div>
<div class="line"><a id="l01767" name="l01767"></a><span class="lineno"> 1767</span>    waitingForOrigin = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01768" name="l01768"></a><span class="lineno"> 1768</span>}</div>
</div>
<div class="line"><a id="l01769" name="l01769"></a><span class="lineno"> 1769</span> </div>
<div class="line"><a id="l01770" name="l01770"></a><span class="lineno"> 1770</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen01771" data-start="{" data-end="}">
<div class="line"><a id="l01771" name="l01771"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#ad327101ea8c2cff503fd9140fa2cd8b3"> 1771</a></span><a class="code hl_function" href="classFtp_1_1Server.html#ad327101ea8c2cff503fd9140fa2cd8b3">Ftp::Server::stopWaitingForOrigin</a>(<span class="keywordtype">int</span> originStatus)</div>
<div class="line"><a id="l01772" name="l01772"></a><span class="lineno"> 1772</span>{</div>
<div class="line"><a id="l01773" name="l01773"></a><span class="lineno"> 1773</span>    <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(waitingForOrigin);</div>
<div class="line"><a id="l01774" name="l01774"></a><span class="lineno"> 1774</span>    waitingForOrigin = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01775" name="l01775"></a><span class="lineno"> 1775</span> </div>
<div class="line"><a id="l01776" name="l01776"></a><span class="lineno"> 1776</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="comm_8cc.html#a8464d2ca5f1d7e8046880d95fe30873a">isOpen</a>()) <span class="comment">// if we are closing, nothing to do</span></div>
<div class="line"><a id="l01777" name="l01777"></a><span class="lineno"> 1777</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01778" name="l01778"></a><span class="lineno"> 1778</span> </div>
<div class="line"><a id="l01779" name="l01779"></a><span class="lineno"> 1779</span>    <span class="comment">// if we have already decided how to respond, respond now</span></div>
<div class="line"><a id="l01780" name="l01780"></a><span class="lineno"> 1780</span>    <span class="keywordflow">if</span> (delayedReply) {</div>
<div class="line"><a id="l01781" name="l01781"></a><span class="lineno"> 1781</span>        <a class="code hl_class" href="classRefCount.html">HttpReply::Pointer</a> reply = delayedReply;</div>
<div class="line"><a id="l01782" name="l01782"></a><span class="lineno"> 1782</span>        delayedReply = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l01783" name="l01783"></a><span class="lineno"> 1783</span>        writeForwardedReply(reply.<a class="code hl_function" href="classRefCount.html#a9f2168c1df4a4ab6b7931425d85c37f0">getRaw</a>());</div>
<div class="line"><a id="l01784" name="l01784"></a><span class="lineno"> 1784</span>        <span class="keywordflow">return</span>; <span class="comment">// do not completeDataDownload() after an earlier response</span></div>
<div class="line"><a id="l01785" name="l01785"></a><span class="lineno"> 1785</span>    }</div>
<div class="line"><a id="l01786" name="l01786"></a><span class="lineno"> 1786</span> </div>
<div class="line"><a id="l01787" name="l01787"></a><span class="lineno"> 1787</span>    <span class="keywordflow">if</span> (master-&gt;serverState != <a class="code hl_enumvalue" href="namespaceFtp.html#a56abcf0499ca5d50f20f9ce02525124eaf385076cc145cc42c7248f5b24d05c13">fssHandleDataRequest</a>)</div>
<div class="line"><a id="l01788" name="l01788"></a><span class="lineno"> 1788</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01789" name="l01789"></a><span class="lineno"> 1789</span> </div>
<div class="line"><a id="l01790" name="l01790"></a><span class="lineno"> 1790</span>    <span class="comment">// completeDataDownload() could be waitingForOrigin in fssHandleDataRequest</span></div>
<div class="line"><a id="l01791" name="l01791"></a><span class="lineno"> 1791</span>    <span class="comment">// Depending on which side has finished downloading first, either trust</span></div>
<div class="line"><a id="l01792" name="l01792"></a><span class="lineno"> 1792</span>    <span class="comment">// master-&gt;userDataDone status or set originDataDownloadAbortedOnError:</span></div>
<div class="line"><a id="l01793" name="l01793"></a><span class="lineno"> 1793</span>    <span class="keywordflow">if</span> (master-&gt;userDataDone) {</div>
<div class="line"><a id="l01794" name="l01794"></a><span class="lineno"> 1794</span>        <span class="comment">// We finished downloading before Ftp::Client. Most likely, the</span></div>
<div class="line"><a id="l01795" name="l01795"></a><span class="lineno"> 1795</span>        <span class="comment">// adaptation shortened the origin response or we hit an error.</span></div>
<div class="line"><a id="l01796" name="l01796"></a><span class="lineno"> 1796</span>        <span class="comment">// Our status (stored in master-&gt;userDataDone) is more informative.</span></div>
<div class="line"><a id="l01797" name="l01797"></a><span class="lineno"> 1797</span>        <span class="comment">// Use master-&gt;userDataDone; avoid originDataDownloadAbortedOnError.</span></div>
<div class="line"><a id="l01798" name="l01798"></a><span class="lineno"> 1798</span>        completeDataDownload();</div>
<div class="line"><a id="l01799" name="l01799"></a><span class="lineno"> 1799</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01800" name="l01800"></a><span class="lineno"> 1800</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;too early to write the response&quot;</span>);</div>
<div class="line"><a id="l01801" name="l01801"></a><span class="lineno"> 1801</span>        <span class="comment">// Ftp::Client naturally finished downloading before us. Set</span></div>
<div class="line"><a id="l01802" name="l01802"></a><span class="lineno"> 1802</span>        <span class="comment">// originDataDownloadAbortedOnError to overwrite future</span></div>
<div class="line"><a id="l01803" name="l01803"></a><span class="lineno"> 1803</span>        <span class="comment">// master-&gt;userDataDone and relay Ftp::Client error, if there was</span></div>
<div class="line"><a id="l01804" name="l01804"></a><span class="lineno"> 1804</span>        <span class="comment">// any, to the user.</span></div>
<div class="line"><a id="l01805" name="l01805"></a><span class="lineno"> 1805</span>        originDataDownloadAbortedOnError = (originStatus &gt;= 400);</div>
<div class="line"><a id="l01806" name="l01806"></a><span class="lineno"> 1806</span>    }</div>
<div class="line"><a id="l01807" name="l01807"></a><span class="lineno"> 1807</span>}</div>
</div>
<div class="line"><a id="l01808" name="l01808"></a><span class="lineno"> 1808</span> </div>
<div class="foldopen" id="foldopen01809" data-start="{" data-end="}">
<div class="line"><a id="l01809" name="l01809"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#a2cd34e1f2833ff4009844349c16e11f9"> 1809</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classFtp_1_1Server.html#a2cd34e1f2833ff4009844349c16e11f9">Ftp::Server::userDataCompletionCheckpoint</a>(<span class="keywordtype">int</span> finalStatusCode)</div>
<div class="line"><a id="l01810" name="l01810"></a><span class="lineno"> 1810</span>{</div>
<div class="line"><a id="l01811" name="l01811"></a><span class="lineno"> 1811</span>    <a class="code hl_define" href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a>(!master-&gt;userDataDone);</div>
<div class="line"><a id="l01812" name="l01812"></a><span class="lineno"> 1812</span>    master-&gt;userDataDone = finalStatusCode;</div>
<div class="line"><a id="l01813" name="l01813"></a><span class="lineno"> 1813</span> </div>
<div class="line"><a id="l01814" name="l01814"></a><span class="lineno"> 1814</span>    <span class="keywordflow">if</span> (bodyParser)</div>
<div class="line"><a id="l01815" name="l01815"></a><span class="lineno"> 1815</span>        finishDechunkingRequest(<span class="keyword">false</span>);</div>
<div class="line"><a id="l01816" name="l01816"></a><span class="lineno"> 1816</span> </div>
<div class="line"><a id="l01817" name="l01817"></a><span class="lineno"> 1817</span>    <span class="keywordflow">if</span> (waitingForOrigin) {</div>
<div class="line"><a id="l01818" name="l01818"></a><span class="lineno"> 1818</span>        <span class="comment">// The completeDataDownload() is not called here unconditionally</span></div>
<div class="line"><a id="l01819" name="l01819"></a><span class="lineno"> 1819</span>        <span class="comment">// because we want to signal the FTP user that we are not fully</span></div>
<div class="line"><a id="l01820" name="l01820"></a><span class="lineno"> 1820</span>        <span class="comment">// done processing its data stream, even though all data bytes</span></div>
<div class="line"><a id="l01821" name="l01821"></a><span class="lineno"> 1821</span>        <span class="comment">// have been sent or received already.</span></div>
<div class="line"><a id="l01822" name="l01822"></a><span class="lineno"> 1822</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;Transferring from FTP server is not complete&quot;</span>);</div>
<div class="line"><a id="l01823" name="l01823"></a><span class="lineno"> 1823</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01824" name="l01824"></a><span class="lineno"> 1824</span>    }</div>
<div class="line"><a id="l01825" name="l01825"></a><span class="lineno"> 1825</span> </div>
<div class="line"><a id="l01826" name="l01826"></a><span class="lineno"> 1826</span>    <span class="comment">// Adjust our reply if the server aborted with an error before we are done.</span></div>
<div class="line"><a id="l01827" name="l01827"></a><span class="lineno"> 1827</span>    <span class="keywordflow">if</span> (master-&gt;userDataDone == 226 &amp;&amp; originDataDownloadAbortedOnError) {</div>
<div class="line"><a id="l01828" name="l01828"></a><span class="lineno"> 1828</span>        <a class="code hl_define" href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a>(33, 5, <span class="stringliteral">&quot;Transferring from FTP server terminated with an error, adjust status code&quot;</span>);</div>
<div class="line"><a id="l01829" name="l01829"></a><span class="lineno"> 1829</span>        master-&gt;userDataDone = 451;</div>
<div class="line"><a id="l01830" name="l01830"></a><span class="lineno"> 1830</span>    }</div>
<div class="line"><a id="l01831" name="l01831"></a><span class="lineno"> 1831</span>    completeDataDownload();</div>
<div class="line"><a id="l01832" name="l01832"></a><span class="lineno"> 1832</span>}</div>
</div>
<div class="line"><a id="l01833" name="l01833"></a><span class="lineno"> 1833</span> </div>
<div class="foldopen" id="foldopen01834" data-start="{" data-end="}">
<div class="line"><a id="l01834" name="l01834"></a><span class="lineno"><a class="line" href="classFtp_1_1Server.html#a55ed9bf0c94ad3b3226b01e5fd8332b9"> 1834</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classFtp_1_1Server.html#a55ed9bf0c94ad3b3226b01e5fd8332b9">Ftp::Server::completeDataDownload</a>()</div>
<div class="line"><a id="l01835" name="l01835"></a><span class="lineno"> 1835</span>{</div>
<div class="line"><a id="l01836" name="l01836"></a><span class="lineno"> 1836</span>    writeCustomReply(master-&gt;userDataDone, master-&gt;userDataDone == 226 ? <span class="stringliteral">&quot;Transfer complete&quot;</span> : <span class="stringliteral">&quot;Server error; transfer aborted&quot;</span>);</div>
<div class="line"><a id="l01837" name="l01837"></a><span class="lineno"> 1837</span>    closeDataConnection();</div>
<div class="line"><a id="l01838" name="l01838"></a><span class="lineno"> 1838</span>}</div>
</div>
<div class="line"><a id="l01839" name="l01839"></a><span class="lineno"> 1839</span> </div>
<div class="line"><a id="l01841" name="l01841"></a><span class="lineno"> 1841</span><span class="keyword">static</span> <span class="keywordtype">bool</span></div>
<div class="foldopen" id="foldopen01842" data-start="{" data-end="}">
<div class="line"><a id="l01842" name="l01842"></a><span class="lineno"><a class="line" href="namespaceFtp.html#a14f2935b10878a54a2cc5e6621b3e946"> 1842</a></span><a class="code hl_function" href="namespaceFtp.html#a14f2935b10878a54a2cc5e6621b3e946">Ftp::SupportedCommand</a>(<span class="keyword">const</span> <a class="code hl_class" href="classSBuf.html">SBuf</a> &amp;name)</div>
<div class="line"><a id="l01843" name="l01843"></a><span class="lineno"> 1843</span>{</div>
<div class="line"><a id="l01844" name="l01844"></a><span class="lineno"> 1844</span>    <span class="keyword">static</span> std::set&lt;SBuf&gt; BlockList;</div>
<div class="line"><a id="l01845" name="l01845"></a><span class="lineno"> 1845</span>    <span class="keywordflow">if</span> (BlockList.empty()) {</div>
<div class="line"><a id="l01846" name="l01846"></a><span class="lineno"> 1846</span>        <span class="comment">/* Add FTP commands that Squid cannot relay correctly. */</span></div>
<div class="line"><a id="l01847" name="l01847"></a><span class="lineno"> 1847</span> </div>
<div class="line"><a id="l01848" name="l01848"></a><span class="lineno"> 1848</span>        <span class="comment">// We probably do not support AUTH TLS.* and AUTH SSL,</span></div>
<div class="line"><a id="l01849" name="l01849"></a><span class="lineno"> 1849</span>        <span class="comment">// but let&#39;s disclaim all AUTH support to KISS, for now.</span></div>
<div class="line"><a id="l01850" name="l01850"></a><span class="lineno"> 1850</span>        BlockList.insert(<a class="code hl_function" href="namespaceFtp.html#a910f99db5e91bb78320ec141a625f114">cmdAuth</a>());</div>
<div class="line"><a id="l01851" name="l01851"></a><span class="lineno"> 1851</span>    }</div>
<div class="line"><a id="l01852" name="l01852"></a><span class="lineno"> 1852</span> </div>
<div class="line"><a id="l01853" name="l01853"></a><span class="lineno"> 1853</span>    <span class="comment">// we claim support for all commands that we do not know about</span></div>
<div class="line"><a id="l01854" name="l01854"></a><span class="lineno"> 1854</span>    <span class="keywordflow">return</span> BlockList.find(name) == BlockList.end();</div>
<div class="line"><a id="l01855" name="l01855"></a><span class="lineno"> 1855</span>}</div>
</div>
<div class="line"><a id="l01856" name="l01856"></a><span class="lineno"> 1856</span> </div>
<div class="ttc" id="aAssure_8h_html_a1fcca4cd6cfc3b9f835aa3652eb0c2f5"><div class="ttname"><a href="Assure_8h.html#a1fcca4cd6cfc3b9f835aa3652eb0c2f5">Assure</a></div><div class="ttdeci">#define Assure(condition)</div><div class="ttdef"><b>Definition</b> <a href="Assure_8h_source.html#l00035">Assure.h:35</a></div></div>
<div class="ttc" id="aAsyncJobCalls_8h_html_a3412f4fa1246aee4d4ac46a143075e03"><div class="ttname"><a href="AsyncJobCalls_8h.html#a3412f4fa1246aee4d4ac46a143075e03">JobCallback</a></div><div class="ttdeci">#define JobCallback(dbgSection, dbgLevel, Dialer, job, method)</div><div class="ttdoc">Convenience macro to create a Dialer-based job callback.</div><div class="ttdef"><b>Definition</b> <a href="AsyncJobCalls_8h_source.html#l00070">AsyncJobCalls.h:70</a></div></div>
<div class="ttc" id="aAsyncJobCalls_8h_html_a3841bf50f853d9ba9de4309dcc96e72f"><div class="ttname"><a href="AsyncJobCalls_8h.html#a3841bf50f853d9ba9de4309dcc96e72f">CallJobHere</a></div><div class="ttdeci">#define CallJobHere(debugSection, debugLevel, job, Class, method)</div><div class="ttdef"><b>Definition</b> <a href="AsyncJobCalls_8h_source.html#l00059">AsyncJobCalls.h:59</a></div></div>
<div class="ttc" id="aCharacterSet_8h_html"><div class="ttname"><a href="CharacterSet_8h.html">CharacterSet.h</a></div></div>
<div class="ttc" id="aCommCalls_8h_html_a7e143fa246c3e54c90fa8d20b390b88d"><div class="ttname"><a href="CommCalls_8h.html#a7e143fa246c3e54c90fa8d20b390b88d">commCbCall</a></div><div class="ttdeci">CommCbFunPtrCallT&lt; Dialer &gt; * commCbCall(int debugSection, int debugLevel, const char *callName, const Dialer &amp;dialer)</div><div class="ttdef"><b>Definition</b> <a href="CommCalls_8h_source.html#l00312">CommCalls.h:312</a></div></div>
<div class="ttc" id="aConnOpener_8h_html"><div class="ttname"><a href="ConnOpener_8h.html">ConnOpener.h</a></div></div>
<div class="ttc" id="aConnection_8h_html_a303a4af3db144519ffdefde6bc1b9659"><div class="ttname"><a href="Connection_8h.html#a303a4af3db144519ffdefde6bc1b9659">COMM_TRANSPARENT</a></div><div class="ttdeci">#define COMM_TRANSPARENT</div><div class="ttdef"><b>Definition</b> <a href="Connection_8h_source.html#l00050">Connection.h:50</a></div></div>
<div class="ttc" id="aConnection_8h_html_a8e482a7d3919ec1fefad794c35a4c81e"><div class="ttname"><a href="Connection_8h.html#a8e482a7d3919ec1fefad794c35a4c81e">COMM_INTERCEPTION</a></div><div class="ttdeci">#define COMM_INTERCEPTION</div><div class="ttdef"><b>Definition</b> <a href="Connection_8h_source.html#l00051">Connection.h:51</a></div></div>
<div class="ttc" id="aConnection_8h_html_a931ba92f0e102b166d9f2de4dbda81a9"><div class="ttname"><a href="Connection_8h.html#a931ba92f0e102b166d9f2de4dbda81a9">COMM_DOBIND</a></div><div class="ttdeci">#define COMM_DOBIND</div><div class="ttdef"><b>Definition</b> <a href="Connection_8h_source.html#l00049">Connection.h:49</a></div></div>
<div class="ttc" id="aConnection_8h_html_aadad9238e4d0e913034b3dfc22f8ba44"><div class="ttname"><a href="Connection_8h.html#aadad9238e4d0e913034b3dfc22f8ba44">COMM_NONBLOCKING</a></div><div class="ttdeci">#define COMM_NONBLOCKING</div><div class="ttdef"><b>Definition</b> <a href="Connection_8h_source.html#l00046">Connection.h:46</a></div></div>
<div class="ttc" id="aFdNotes_8h_html"><div class="ttname"><a href="FdNotes_8h.html">FdNotes.h</a></div></div>
<div class="ttc" id="aFilledChecklist_8h_html"><div class="ttname"><a href="FilledChecklist_8h.html">FilledChecklist.h</a></div></div>
<div class="ttc" id="aFtpServer_8h_html"><div class="ttname"><a href="FtpServer_8h.html">FtpServer.h</a></div></div>
<div class="ttc" id="aHttpHdrCc_8h_html"><div class="ttname"><a href="HttpHdrCc_8h.html">HttpHdrCc.h</a></div></div>
<div class="ttc" id="aHttpHeader_8cc_html_ab9e192033c37d6882f676537fe47a878"><div class="ttname"><a href="HttpHeader_8cc.html#ab9e192033c37d6882f676537fe47a878">httpHeaderParseQuotedString</a></div><div class="ttdeci">int httpHeaderParseQuotedString(const char *start, const int len, String *val)</div><div class="ttdef"><b>Definition</b> <a href="HttpHeader_8cc_source.html#l00167">HttpHeader.cc:167</a></div></div>
<div class="ttc" id="aHttpHeader_8h_html_aac9fc01c2b9cda8c02b1f7f8a2a9c78b"><div class="ttname"><a href="HttpHeader_8h.html#aac9fc01c2b9cda8c02b1f7f8a2a9c78b">HttpHeaderPos</a></div><div class="ttdeci">ssize_t HttpHeaderPos</div><div class="ttdef"><b>Definition</b> <a href="HttpHeader_8h_source.html#l00045">HttpHeader.h:45</a></div></div>
<div class="ttc" id="aHttpHeader_8h_html_abf5d862281ddf9a5315fcfa5be166c07"><div class="ttname"><a href="HttpHeader_8h.html#abf5d862281ddf9a5315fcfa5be166c07">HttpHeaderInitPos</a></div><div class="ttdeci">#define HttpHeaderInitPos</div><div class="ttdef"><b>Definition</b> <a href="HttpHeader_8h_source.html#l00048">HttpHeader.h:48</a></div></div>
<div class="ttc" id="aPortCfg_8cc_html_a20da400521f3fa3eb2de9df0eb5f96fc"><div class="ttname"><a href="PortCfg_8cc.html#a20da400521f3fa3eb2de9df0eb5f96fc">NHttpSockets</a></div><div class="ttdeci">int NHttpSockets</div><div class="ttdef"><b>Definition</b> <a href="PortCfg_8cc_source.html#l00025">PortCfg.cc:25</a></div></div>
<div class="ttc" id="aPortCfg_8cc_html_a31b693c418c2d271a30c0d70c2fbb170"><div class="ttname"><a href="PortCfg_8cc.html#a31b693c418c2d271a30c0d70c2fbb170">FtpPortList</a></div><div class="ttdeci">AnyP::PortCfgPointer FtpPortList</div><div class="ttdoc">list of Squid ftp_port configured</div><div class="ttdef"><b>Definition</b> <a href="PortCfg_8cc_source.html#l00023">PortCfg.cc:23</a></div></div>
<div class="ttc" id="aPortCfg_8h_html_ad26669cbef20c833f401d0c236dfa54b"><div class="ttname"><a href="PortCfg_8h.html#ad26669cbef20c833f401d0c236dfa54b">MAXTCPLISTENPORTS</a></div><div class="ttdeci">#define MAXTCPLISTENPORTS</div><div class="ttdef"><b>Definition</b> <a href="PortCfg_8h_source.html#l00086">PortCfg.h:86</a></div></div>
<div class="ttc" id="aRaw_8h_html"><div class="ttname"><a href="Raw_8h.html">Raw.h</a></div></div>
<div class="ttc" id="aRead_8h_html"><div class="ttname"><a href="Read_8h.html">Read.h</a></div></div>
<div class="ttc" id="aRead_8h_html_a172f652cee9cf7837348c4a3bb6599f7"><div class="ttname"><a href="Read_8h.html#a172f652cee9cf7837348c4a3bb6599f7">comm_read</a></div><div class="ttdeci">void comm_read(const Comm::ConnectionPointer &amp;conn, char *buf, int len, AsyncCall::Pointer &amp;callback)</div><div class="ttdef"><b>Definition</b> <a href="Read_8h_source.html#l00059">Read.h:59</a></div></div>
<div class="ttc" id="aRefCount_8h_html"><div class="ttname"><a href="RefCount_8h.html">RefCount.h</a></div></div>
<div class="ttc" id="aRequestParser_8h_html"><div class="ttname"><a href="RequestParser_8h.html">RequestParser.h</a></div></div>
<div class="ttc" id="aSBuf_8h_html_a225d674d14bd9377da94fdb0edc08ecc"><div class="ttname"><a href="SBuf_8h.html#a225d674d14bd9377da94fdb0edc08ecc">SQUIDSBUFPH</a></div><div class="ttdeci">#define SQUIDSBUFPH</div><div class="ttdef"><b>Definition</b> <a href="SBuf_8h_source.html#l00031">SBuf.h:31</a></div></div>
<div class="ttc" id="aSBuf_8h_html_aba15ad960fbece70b7940c8d3a5c344b"><div class="ttname"><a href="SBuf_8h.html#aba15ad960fbece70b7940c8d3a5c344b">SQUIDSBUFPRINT</a></div><div class="ttdeci">#define SQUIDSBUFPRINT(s)</div><div class="ttdef"><b>Definition</b> <a href="SBuf_8h_source.html#l00032">SBuf.h:32</a></div></div>
<div class="ttc" id="aSquidConfig_8cc_html_a75b136e6a1eef61424d84596a404aafe"><div class="ttname"><a href="SquidConfig_8cc.html#a75b136e6a1eef61424d84596a404aafe">Config</a></div><div class="ttdeci">class SquidConfig Config</div><div class="ttdef"><b>Definition</b> <a href="SquidConfig_8cc_source.html#l00012">SquidConfig.cc:12</a></div></div>
<div class="ttc" id="aSquidConfig_8h_html"><div class="ttname"><a href="SquidConfig_8h.html">SquidConfig.h</a></div></div>
<div class="ttc" id="aStatCounters_8cc_html_a97511f6512b50279a2cd9cf1446060d7"><div class="ttname"><a href="StatCounters_8cc.html#a97511f6512b50279a2cd9cf1446060d7">statCounter</a></div><div class="ttdeci">StatCounters statCounter</div><div class="ttdef"><b>Definition</b> <a href="StatCounters_8cc_source.html#l00012">StatCounters.cc:12</a></div></div>
<div class="ttc" id="aStatCounters_8h_html"><div class="ttname"><a href="StatCounters_8h.html">StatCounters.h</a></div></div>
<div class="ttc" id="aSubscription_8h_html"><div class="ttname"><a href="Subscription_8h.html">Subscription.h</a></div></div>
<div class="ttc" id="aTcpAcceptor_8h_html"><div class="ttname"><a href="TcpAcceptor_8h.html">TcpAcceptor.h</a></div></div>
<div class="ttc" id="aTextException_8h_html_a2cf020aa9d72c2ec7abef506457b2f9a"><div class="ttname"><a href="TextException_8h.html#a2cf020aa9d72c2ec7abef506457b2f9a">TexcHere</a></div><div class="ttdeci">#define TexcHere(msg)</div><div class="ttdoc">legacy convenience macro; it is not difficult to type Here() now</div><div class="ttdef"><b>Definition</b> <a href="TextException_8h_source.html#l00063">TextException.h:63</a></div></div>
<div class="ttc" id="aTextException_8h_html_ad79a19f4098f2506d0aa28628f18fd36"><div class="ttname"><a href="TextException_8h.html#ad79a19f4098f2506d0aa28628f18fd36">Must</a></div><div class="ttdeci">#define Must(condition)</div><div class="ttdef"><b>Definition</b> <a href="TextException_8h_source.html#l00075">TextException.h:75</a></div></div>
<div class="ttc" id="aWrite_8h_html"><div class="ttname"><a href="Write_8h.html">Write.h</a></div></div>
<div class="ttc" id="aassert_8h_html_a33fa45e42155e69ce8d0da0fd978b351"><div class="ttname"><a href="assert_8h.html#a33fa45e42155e69ce8d0da0fd978b351">assert</a></div><div class="ttdeci">#define assert(EX)</div><div class="ttdef"><b>Definition</b> <a href="assert_8h_source.html#l00017">assert.h:17</a></div></div>
<div class="ttc" id="abasic__radius__auth_8cc_html_aa8195632e4f244f5dbb6f0728cce9682"><div class="ttname"><a href="basic__radius__auth_8cc.html#aa8195632e4f244f5dbb6f0728cce9682">server</a></div><div class="ttdeci">static char server[MAXLINE]</div><div class="ttdef"><b>Definition</b> <a href="basic__radius__auth_8cc_source.html#l00102">basic_radius_auth.cc:102</a></div></div>
<div class="ttc" id="acbdata_8h_html_ad60a7b19cb747d7868f3b241c67f77b9"><div class="ttname"><a href="cbdata_8h.html#ad60a7b19cb747d7868f3b241c67f77b9">CBDATA_NAMESPACED_CLASS_INIT</a></div><div class="ttdeci">#define CBDATA_NAMESPACED_CLASS_INIT(namespace, type)</div><div class="ttdef"><b>Definition</b> <a href="cbdata_8h_source.html#l00333">cbdata.h:333</a></div></div>
<div class="ttc" id="aclassACLChecklist_html_a51ae541a90994e7ed5d11f2b242ac689"><div class="ttname"><a href="classACLChecklist.html#a51ae541a90994e7ed5d11f2b242ac689">ACLChecklist::fastCheck</a></div><div class="ttdeci">Acl::Answer const &amp; fastCheck()</div><div class="ttdef"><b>Definition</b> <a href="Checklist_8cc_source.html#l00298">Checklist.cc:298</a></div></div>
<div class="ttc" id="aclassACLFilledChecklist_html"><div class="ttname"><a href="classACLFilledChecklist.html">ACLFilledChecklist</a></div><div class="ttdef"><b>Definition</b> <a href="FilledChecklist_8h_source.html#l00033">FilledChecklist.h:34</a></div></div>
<div class="ttc" id="aclassACLFilledChecklist_html_ac9fc7ac3b0ef5a2a0d2811aa762dbeab"><div class="ttname"><a href="classACLFilledChecklist.html#ac9fc7ac3b0ef5a2a0d2811aa762dbeab">ACLFilledChecklist::al</a></div><div class="ttdeci">AccessLogEntry::Pointer al</div><div class="ttdoc">info for the future access.log, and external ACL</div><div class="ttdef"><b>Definition</b> <a href="FilledChecklist_8h_source.html#l00124">FilledChecklist.h:124</a></div></div>
<div class="ttc" id="aclassACLFilledChecklist_html_ae77611904901fa5f796cdd54ff5be235"><div class="ttname"><a href="classACLFilledChecklist.html#ae77611904901fa5f796cdd54ff5be235">ACLFilledChecklist::syncAle</a></div><div class="ttdeci">void syncAle(HttpRequest *adaptedRequest, const char *logUri) const override</div><div class="ttdoc">assigns uninitialized adapted_request and url ALE components</div><div class="ttdef"><b>Definition</b> <a href="FilledChecklist_8cc_source.html#l00093">FilledChecklist.cc:93</a></div></div>
<div class="ttc" id="aclassAcl_1_1Answer_html_af1a1444d19654eb50f7a4323b225f845"><div class="ttname"><a href="classAcl_1_1Answer.html#af1a1444d19654eb50f7a4323b225f845">Acl::Answer::allowed</a></div><div class="ttdeci">bool allowed() const</div><div class="ttdef"><b>Definition</b> <a href="acl_2Acl_8h_source.html#l00082">Acl.h:82</a></div></div>
<div class="ttc" id="aclassAdaptation_1_1History_html_aa56c08168d67d16ac3d2a6cb2f1b8e59"><div class="ttname"><a href="classAdaptation_1_1History.html#aa56c08168d67d16ac3d2a6cb2f1b8e59">Adaptation::History::allMeta</a></div><div class="ttdeci">HttpHeader allMeta</div><div class="ttdoc">All REQMOD and RESPMOD meta headers merged. Last field wins conflicts.</div><div class="ttdef"><b>Definition</b> <a href="History_8h_source.html#l00063">History.h:63</a></div></div>
<div class="ttc" id="aclassAsyncCallT_html"><div class="ttname"><a href="classAsyncCallT.html">AsyncCallT</a></div><div class="ttdef"><b>Definition</b> <a href="AsyncCall_8h_source.html#l00124">AsyncCall.h:125</a></div></div>
<div class="ttc" id="aclassAsyncJob_html"><div class="ttname"><a href="classAsyncJob.html">AsyncJob</a></div><div class="ttdef"><b>Definition</b> <a href="AsyncJob_8h_source.html#l00031">AsyncJob.h:32</a></div></div>
<div class="ttc" id="aclassAsyncJob_html_a1dd42e9842d751193268966d4e0de2fa"><div class="ttname"><a href="classAsyncJob.html#a1dd42e9842d751193268966d4e0de2fa">AsyncJob::Start</a></div><div class="ttdeci">static void Start(const Pointer &amp;job)</div><div class="ttdef"><b>Definition</b> <a href="AsyncJob_8cc_source.html#l00037">AsyncJob.cc:37</a></div></div>
<div class="ttc" id="aclassAsyncJob_html_aefd101ddca496c1372f282e0f15229b8"><div class="ttname"><a href="classAsyncJob.html#aefd101ddca496c1372f282e0f15229b8">AsyncJob::callException</a></div><div class="ttdeci">virtual void callException(const std::exception &amp;e)</div><div class="ttdoc">called when the job throws during an async call</div><div class="ttdef"><b>Definition</b> <a href="AsyncJob_8cc_source.html#l00143">AsyncJob.cc:143</a></div></div>
<div class="ttc" id="aclassCallSubscription_html"><div class="ttname"><a href="classCallSubscription.html">CallSubscription</a></div><div class="ttdef"><b>Definition</b> <a href="Subscription_8h_source.html#l00048">Subscription.h:49</a></div></div>
<div class="ttc" id="aclassCbcPointer_html"><div class="ttname"><a href="classCbcPointer.html">CbcPointer</a></div><div class="ttdef"><b>Definition</b> <a href="CbcPointer_8h_source.html#l00025">CbcPointer.h:26</a></div></div>
<div class="ttc" id="aclassCharacterSet_html"><div class="ttname"><a href="classCharacterSet.html">CharacterSet</a></div><div class="ttdoc">optimized set of C chars, with quick membership test and merge support</div><div class="ttdef"><b>Definition</b> <a href="CharacterSet_8h_source.html#l00017">CharacterSet.h:18</a></div></div>
<div class="ttc" id="aclassCharacterSet_html_a1b83850bb6e25b80633a956162d720f4"><div class="ttname"><a href="classCharacterSet.html#a1b83850bb6e25b80633a956162d720f4">CharacterSet::complement</a></div><div class="ttdeci">CharacterSet complement(const char *complementLabel=nullptr) const</div><div class="ttdef"><b>Definition</b> <a href="CharacterSet_8cc_source.html#l00074">CharacterSet.cc:74</a></div></div>
<div class="ttc" id="aclassCharacterSet_html_a3cbeebe695817ffd06be28481004f787"><div class="ttname"><a href="classCharacterSet.html#a3cbeebe695817ffd06be28481004f787">CharacterSet::SP</a></div><div class="ttdeci">static const CharacterSet SP</div><div class="ttdef"><b>Definition</b> <a href="CharacterSet_8h_source.html#l00094">CharacterSet.h:94</a></div></div>
<div class="ttc" id="aclassCharacterSet_html_a93ba52a29423824a1e9414a3c00b50f9"><div class="ttname"><a href="classCharacterSet.html#a93ba52a29423824a1e9414a3c00b50f9">CharacterSet::LF</a></div><div class="ttdeci">static const CharacterSet LF</div><div class="ttdef"><b>Definition</b> <a href="CharacterSet_8h_source.html#l00092">CharacterSet.h:92</a></div></div>
<div class="ttc" id="aclassClientHttpRequest_html"><div class="ttname"><a href="classClientHttpRequest.html">ClientHttpRequest</a></div><div class="ttdef"><b>Definition</b> <a href="client__side__request_8h_source.html#l00030">client_side_request.h:35</a></div></div>
<div class="ttc" id="aclassClientHttpRequest_html_a2becc63f591bbc0b40542099c1bb05a9"><div class="ttname"><a href="classClientHttpRequest.html#a2becc63f591bbc0b40542099c1bb05a9">ClientHttpRequest::request</a></div><div class="ttdeci">HttpRequest *const request</div><div class="ttdef"><b>Definition</b> <a href="client__side__request_8h_source.html#l00130">client_side_request.h:130</a></div></div>
<div class="ttc" id="aclassClientHttpRequest_html_a3f6d0f7008f5302283e91937cdc67f75"><div class="ttname"><a href="classClientHttpRequest.html#a3f6d0f7008f5302283e91937cdc67f75">ClientHttpRequest::log_uri</a></div><div class="ttdeci">char *const log_uri</div><div class="ttdef"><b>Definition</b> <a href="client__side__request_8h_source.html#l00141">client_side_request.h:141</a></div></div>
<div class="ttc" id="aclassClientHttpRequest_html_a5912c3e9af285d3f77ec815c719b8105"><div class="ttname"><a href="classClientHttpRequest.html#a5912c3e9af285d3f77ec815c719b8105">ClientHttpRequest::initRequest</a></div><div class="ttdeci">void initRequest(HttpRequest *)</div><div class="ttdef"><b>Definition</b> <a href="client__side__request_8cc_source.html#l01463">client_side_request.cc:1463</a></div></div>
<div class="ttc" id="aclassClientHttpRequest_html_a88642d6f6a181e20927a9e54cabf3c91"><div class="ttname"><a href="classClientHttpRequest.html#a88642d6f6a181e20927a9e54cabf3c91">ClientHttpRequest::req_sz</a></div><div class="ttdeci">size_t req_sz</div><div class="ttdoc">raw request size on input, not current request size</div><div class="ttdef"><b>Definition</b> <a href="client__side__request_8h_source.html#l00159">client_side_request.h:159</a></div></div>
<div class="ttc" id="aclassClientHttpRequest_html_ac1d305af64fb92ccfce613c1eb96d178"><div class="ttname"><a href="classClientHttpRequest.html#ac1d305af64fb92ccfce613c1eb96d178">ClientHttpRequest::uri</a></div><div class="ttdeci">char * uri</div><div class="ttdef"><b>Definition</b> <a href="client__side__request_8h_source.html#l00135">client_side_request.h:135</a></div></div>
<div class="ttc" id="aclassClientHttpRequest_html_ac8c0f73794781ce53acf6083e0077f34"><div class="ttname"><a href="classClientHttpRequest.html#ac8c0f73794781ce53acf6083e0077f34">ClientHttpRequest::storeEntry</a></div><div class="ttdeci">StoreEntry * storeEntry() const</div><div class="ttdef"><b>Definition</b> <a href="client__side__request_8h_source.html#l00063">client_side_request.h:63</a></div></div>
<div class="ttc" id="aclassClientHttpRequest_html_ae2f400bf3f3d140535bfa6c43908a348"><div class="ttname"><a href="classClientHttpRequest.html#ae2f400bf3f3d140535bfa6c43908a348">ClientHttpRequest::client_stream</a></div><div class="ttdeci">dlink_list client_stream</div><div class="ttdef"><b>Definition</b> <a href="client__side__request_8h_source.html#l00174">client_side_request.h:174</a></div></div>
<div class="ttc" id="aclassClientHttpRequest_html_af1ec5778cbc7fcd488df2918c821f499"><div class="ttname"><a href="classClientHttpRequest.html#af1ec5778cbc7fcd488df2918c821f499">ClientHttpRequest::al</a></div><div class="ttdeci">const AccessLogEntry::Pointer al</div><div class="ttdoc">access.log entry</div><div class="ttdef"><b>Definition</b> <a href="client__side__request_8h_source.html#l00161">client_side_request.h:161</a></div></div>
<div class="ttc" id="aclassCodeContext_html_a13251c00d03b5a9cb9f3b164f0154969"><div class="ttname"><a href="classCodeContext.html#a13251c00d03b5a9cb9f3b164f0154969">CodeContext::Current</a></div><div class="ttdeci">static const Pointer &amp; Current()</div><div class="ttdef"><b>Definition</b> <a href="CodeContext_8cc_source.html#l00033">CodeContext.cc:33</a></div></div>
<div class="ttc" id="aclassCodeContext_html_aeed1567dd2fb1c97eb3fa3f10df4622e"><div class="ttname"><a href="classCodeContext.html#aeed1567dd2fb1c97eb3fa3f10df4622e">CodeContext::Reset</a></div><div class="ttdeci">static void Reset()</div><div class="ttdoc">forgets the current context, setting it to nil/unknown</div><div class="ttdef"><b>Definition</b> <a href="CodeContext_8cc_source.html#l00077">CodeContext.cc:77</a></div></div>
<div class="ttc" id="aclassCommAcceptCbParams_html"><div class="ttname"><a href="classCommAcceptCbParams.html">CommAcceptCbParams</a></div><div class="ttdef"><b>Definition</b> <a href="CommCalls_8h_source.html#l00092">CommCalls.h:93</a></div></div>
<div class="ttc" id="aclassCommAcceptCbParams_html_a42535776245356fa787da0705fc46f40"><div class="ttname"><a href="classCommAcceptCbParams.html#a42535776245356fa787da0705fc46f40">CommAcceptCbParams::port</a></div><div class="ttdeci">AnyP::PortCfgPointer port</div><div class="ttdoc">the configuration listening port this call relates to (may be nil)</div><div class="ttdef"><b>Definition</b> <a href="CommCalls_8h_source.html#l00100">CommCalls.h:100</a></div></div>
<div class="ttc" id="aclassCommAcceptCbPtrFun_html"><div class="ttname"><a href="classCommAcceptCbPtrFun.html">CommAcceptCbPtrFun</a></div><div class="ttdef"><b>Definition</b> <a href="CommCalls_8h_source.html#l00194">CommCalls.h:196</a></div></div>
<div class="ttc" id="aclassCommCbFunPtrCallT_html"><div class="ttname"><a href="classCommCbFunPtrCallT.html">CommCbFunPtrCallT</a></div><div class="ttdef"><b>Definition</b> <a href="CommCalls_8h_source.html#l00280">CommCalls.h:281</a></div></div>
<div class="ttc" id="aclassCommCbMemFunT_html"><div class="ttname"><a href="classCommCbMemFunT.html">CommCbMemFunT</a></div><div class="ttdef"><b>Definition</b> <a href="CommCalls_8h_source.html#l00165">CommCalls.h:166</a></div></div>
<div class="ttc" id="aclassCommCloseCbParams_html"><div class="ttname"><a href="classCommCloseCbParams.html">CommCloseCbParams</a></div><div class="ttdef"><b>Definition</b> <a href="CommCalls_8h_source.html#l00127">CommCalls.h:128</a></div></div>
<div class="ttc" id="aclassCommCommonCbParams_html_a5376946442719c10cc9307045e09460d"><div class="ttname"><a href="classCommCommonCbParams.html#a5376946442719c10cc9307045e09460d">CommCommonCbParams::xerrno</a></div><div class="ttdeci">int xerrno</div><div class="ttdoc">The last errno to occur. non-zero if flag is Comm::COMM_ERROR.</div><div class="ttdef"><b>Definition</b> <a href="CommCalls_8h_source.html#l00083">CommCalls.h:83</a></div></div>
<div class="ttc" id="aclassCommCommonCbParams_html_aaa1b70c6ff254ac72ac1503fc158df7e"><div class="ttname"><a href="classCommCommonCbParams.html#aaa1b70c6ff254ac72ac1503fc158df7e">CommCommonCbParams::flag</a></div><div class="ttdeci">Comm::Flag flag</div><div class="ttdoc">comm layer result status.</div><div class="ttdef"><b>Definition</b> <a href="CommCalls_8h_source.html#l00082">CommCalls.h:82</a></div></div>
<div class="ttc" id="aclassCommCommonCbParams_html_acbcbe42d3ccd12c6de3b1f3d1d7c4bc3"><div class="ttname"><a href="classCommCommonCbParams.html#acbcbe42d3ccd12c6de3b1f3d1d7c4bc3">CommCommonCbParams::conn</a></div><div class="ttdeci">Comm::ConnectionPointer conn</div><div class="ttdef"><b>Definition</b> <a href="CommCalls_8h_source.html#l00080">CommCalls.h:80</a></div></div>
<div class="ttc" id="aclassCommConnectCbParams_html"><div class="ttname"><a href="classCommConnectCbParams.html">CommConnectCbParams</a></div><div class="ttdef"><b>Definition</b> <a href="CommCalls_8h_source.html#l00104">CommCalls.h:105</a></div></div>
<div class="ttc" id="aclassCommIoCbParams_html"><div class="ttname"><a href="classCommIoCbParams.html">CommIoCbParams</a></div><div class="ttdef"><b>Definition</b> <a href="CommCalls_8h_source.html#l00113">CommCalls.h:114</a></div></div>
<div class="ttc" id="aclassCommIoCbParams_html_a1ca0b2967f5e2a60cef9ac296ba9b9c7"><div class="ttname"><a href="classCommIoCbParams.html#a1ca0b2967f5e2a60cef9ac296ba9b9c7">CommIoCbParams::buf</a></div><div class="ttdeci">char * buf</div><div class="ttdef"><b>Definition</b> <a href="CommCalls_8h_source.html#l00122">CommCalls.h:122</a></div></div>
<div class="ttc" id="aclassCommIoCbParams_html_a34e29cc8266e4126764a5a6077859542"><div class="ttname"><a href="classCommIoCbParams.html#a34e29cc8266e4126764a5a6077859542">CommIoCbParams::size</a></div><div class="ttdeci">size_t size</div><div class="ttdef"><b>Definition</b> <a href="CommCalls_8h_source.html#l00123">CommCalls.h:123</a></div></div>
<div class="ttc" id="aclassComm_1_1ConnOpener_html"><div class="ttname"><a href="classComm_1_1ConnOpener.html">Comm::ConnOpener</a></div><div class="ttdef"><b>Definition</b> <a href="ConnOpener_8h_source.html#l00024">ConnOpener.h:25</a></div></div>
<div class="ttc" id="aclassComm_1_1Connection_html"><div class="ttname"><a href="classComm_1_1Connection.html">Comm::Connection</a></div><div class="ttdef"><b>Definition</b> <a href="Connection_8h_source.html#l00072">Connection.h:73</a></div></div>
<div class="ttc" id="aclassComm_1_1Connection_html_a31fb1758ce5a186c27710515b69aa94e"><div class="ttname"><a href="classComm_1_1Connection.html#a31fb1758ce5a186c27710515b69aa94e">Comm::Connection::flags</a></div><div class="ttdeci">int flags</div><div class="ttdef"><b>Definition</b> <a href="Connection_8h_source.html#l00177">Connection.h:177</a></div></div>
<div class="ttc" id="aclassComm_1_1Connection_html_a32253e90999f679dc032e19ad50d03ab"><div class="ttname"><a href="classComm_1_1Connection.html#a32253e90999f679dc032e19ad50d03ab">Comm::Connection::close</a></div><div class="ttdeci">void close()</div><div class="ttdef"><b>Definition</b> <a href="Connection_8cc_source.html#l00091">Connection.cc:91</a></div></div>
<div class="ttc" id="aclassComm_1_1Connection_html_a60e1b863400f49a2ed17054982561f17"><div class="ttname"><a href="classComm_1_1Connection.html#a60e1b863400f49a2ed17054982561f17">Comm::Connection::remote</a></div><div class="ttdeci">Ip::Address remote</div><div class="ttdef"><b>Definition</b> <a href="Connection_8h_source.html#l00152">Connection.h:152</a></div></div>
<div class="ttc" id="aclassComm_1_1Connection_html_a67c9c1d879e41286853b6140bd5b0076"><div class="ttname"><a href="classComm_1_1Connection.html#a67c9c1d879e41286853b6140bd5b0076">Comm::Connection::setAddrs</a></div><div class="ttdeci">void setAddrs(const Ip::Address &amp;aLocal, const Ip::Address &amp;aRemote)</div><div class="ttdef"><b>Definition</b> <a href="Connection_8h_source.html#l00106">Connection.h:106</a></div></div>
<div class="ttc" id="aclassComm_1_1Connection_html_a7a09f662fc4891a7240dde7169fc0485"><div class="ttname"><a href="classComm_1_1Connection.html#a7a09f662fc4891a7240dde7169fc0485">Comm::Connection::leaveOrphanage</a></div><div class="ttdeci">void leaveOrphanage()</div><div class="ttdoc">resume relying on owner(s) to initiate an explicit connection closure</div><div class="ttdef"><b>Definition</b> <a href="Connection_8h_source.html#l00092">Connection.h:92</a></div></div>
<div class="ttc" id="aclassComm_1_1Connection_html_a84e6544b719c79cbecbc7d2a891fbcb2"><div class="ttname"><a href="classComm_1_1Connection.html#a84e6544b719c79cbecbc7d2a891fbcb2">Comm::Connection::local</a></div><div class="ttdeci">Ip::Address local</div><div class="ttdef"><b>Definition</b> <a href="Connection_8h_source.html#l00149">Connection.h:149</a></div></div>
<div class="ttc" id="aclassComm_1_1Connection_html_a8e53f4d6fd38545947a5aac6efb98fca"><div class="ttname"><a href="classComm_1_1Connection.html#a8e53f4d6fd38545947a5aac6efb98fca">Comm::Connection::fd</a></div><div class="ttdeci">int fd</div><div class="ttdef"><b>Definition</b> <a href="Connection_8h_source.html#l00158">Connection.h:158</a></div></div>
<div class="ttc" id="aclassComm_1_1TcpAcceptor_html"><div class="ttname"><a href="classComm_1_1TcpAcceptor.html">Comm::TcpAcceptor</a></div><div class="ttdef"><b>Definition</b> <a href="TcpAcceptor_8h_source.html#l00038">TcpAcceptor.h:39</a></div></div>
<div class="ttc" id="aclassConnStateData_html"><div class="ttname"><a href="classConnStateData.html">ConnStateData</a></div><div class="ttdef"><b>Definition</b> <a href="client__side_8h_source.html#l00079">client_side.h:84</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a17f5c3c2de993a7edcf465054e08d8de"><div class="ttname"><a href="classConnStateData.html#a17f5c3c2de993a7edcf465054e08d8de">ConnStateData::clientPinnedConnectionClosed</a></div><div class="ttdeci">virtual void clientPinnedConnectionClosed(const CommCloseCbParams &amp;io)</div><div class="ttdoc">Our close handler called by Comm when the pinned connection is closed.</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l03660">client_side.cc:3660</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a4cbbc46289185d9b973594b11f7649fa"><div class="ttname"><a href="classConnStateData.html#a4cbbc46289185d9b973594b11f7649fa">ConnStateData::start</a></div><div class="ttdeci">void start() override</div><div class="ttdoc">called by AsyncStart; do not call directly</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l02128">client_side.cc:2128</a></div></div>
<div class="ttc" id="aclassConnStateData_html_a7f95d063c54bfa6618b5d45869b5c21b"><div class="ttname"><a href="classConnStateData.html#a7f95d063c54bfa6618b5d45869b5c21b">ConnStateData::flags</a></div><div class="ttdeci">struct ConnStateData::@28 flags</div></div>
<div class="ttc" id="aclassConnStateData_html_ac049eac9adf044f1310c48e058778f6d"><div class="ttname"><a href="classConnStateData.html#ac049eac9adf044f1310c48e058778f6d">ConnStateData::readMore</a></div><div class="ttdeci">bool readMore</div><div class="ttdoc">needs comm_read (for this request or new requests)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8h_source.html#l00139">client_side.h:139</a></div></div>
<div class="ttc" id="aclassConnStateData_html_ae41a2f60162e48d848dcb535fa1ab2ff"><div class="ttname"><a href="classConnStateData.html#ae41a2f60162e48d848dcb535fa1ab2ff">ConnStateData::noteBodyConsumerAborted</a></div><div class="ttdeci">void noteBodyConsumerAborted(BodyPipe::Pointer) override=0</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l02067">client_side.cc:2067</a></div></div>
<div class="ttc" id="aclassDebug_html_a44b82c996aedfa84dd8b61427f393e42"><div class="ttname"><a href="classDebug.html#a44b82c996aedfa84dd8b61427f393e42">Debug::Enabled</a></div><div class="ttdeci">static bool Enabled(const int section, const int level)</div><div class="ttdoc">whether debugging the given section and the given level produces output</div><div class="ttdef"><b>Definition</b> <a href="debug_2Stream_8h_source.html#l00075">Stream.h:75</a></div></div>
<div class="ttc" id="aclassError_html_a08c0757b07f5a2c855985cc0e9eaf2a3"><div class="ttname"><a href="classError.html#a08c0757b07f5a2c855985cc0e9eaf2a3">Error::details</a></div><div class="ttdeci">ErrorDetails details</div><div class="ttdef"><b>Definition</b> <a href="Error_8h_source.html#l00060">Error.h:60</a></div></div>
<div class="ttc" id="aclassError_html_a1220700c3c5aa1181e2f1fd762b67e8b"><div class="ttname"><a href="classError.html#a1220700c3c5aa1181e2f1fd762b67e8b">Error::category</a></div><div class="ttdeci">err_type category</div><div class="ttdoc">primary error classification (or ERR_NONE)</div><div class="ttdef"><b>Definition</b> <a href="Error_8h_source.html#l00055">Error.h:55</a></div></div>
<div class="ttc" id="aclassFtp_1_1MasterState_html"><div class="ttname"><a href="classFtp_1_1MasterState.html">Ftp::MasterState</a></div><div class="ttdoc">Transaction information shared among our FTP client and server jobs.</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8h_source.html#l00042">FtpServer.h:43</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html"><div class="ttname"><a href="classFtp_1_1Server.html">Ftp::Server</a></div><div class="ttdoc">Manages a control connection from an FTP client.</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8h_source.html#l00058">FtpServer.h:59</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_a023c93ee1944bea0aa2ba85c1d46f81e"><div class="ttname"><a href="classFtp_1_1Server.html#a023c93ee1944bea0aa2ba85c1d46f81e">Ftp::Server::writeCustomReply</a></div><div class="ttdeci">void writeCustomReply(const int code, const char *msg, const HttpReply *reply=nullptr)</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l00507">FtpServer.cc:507</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_a0242af8d0555c33f19ca03d00d3319fc"><div class="ttname"><a href="classFtp_1_1Server.html#a0242af8d0555c33f19ca03d00d3319fc">Ftp::Server::handleDataReply</a></div><div class="ttdeci">void handleDataReply(const HttpReply *header, StoreIOBuffer receivedData)</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l00943">FtpServer.cc:943</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_a0545b68871f07591508658821e2fe756"><div class="ttname"><a href="classFtp_1_1Server.html#a0545b68871f07591508658821e2fe756">Ftp::Server::calcUri</a></div><div class="ttdeci">void calcUri(const SBuf *file)</div><div class="ttdoc">computes uri member from host and, if tracked, working dir with file name</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l00345">FtpServer.cc:345</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_a0d7b71a2a2ee3993bbb065b565b9c85a"><div class="ttname"><a href="classFtp_1_1Server.html#a0d7b71a2a2ee3993bbb065b565b9c85a">Ftp::Server::handlePasvRequest</a></div><div class="ttdeci">bool handlePasvRequest(String &amp;cmd, String &amp;params)</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l01413">FtpServer.cc:1413</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_a11eb95635878f282d7afc727a4bc23a8"><div class="ttname"><a href="classFtp_1_1Server.html#a11eb95635878f282d7afc727a4bc23a8">Ftp::Server::handleDataRequest</a></div><div class="ttdeci">bool handleDataRequest(String &amp;cmd, String &amp;params)</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l01520">FtpServer.cc:1520</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_a1c82aaec15b04070e766c84521e47b9d"><div class="ttname"><a href="classFtp_1_1Server.html#a1c82aaec15b04070e766c84521e47b9d">Ftp::Server::setDataCommand</a></div><div class="ttdeci">void setDataCommand()</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l01644">FtpServer.cc:1644</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_a2460b627b8ee4623b29b44df5c4e55d5"><div class="ttname"><a href="classFtp_1_1Server.html#a2460b627b8ee4623b29b44df5c4e55d5">Ftp::Server::handleUploadRequest</a></div><div class="ttdeci">bool handleUploadRequest(String &amp;cmd, String &amp;params)</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l01534">FtpServer.cc:1534</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_a263e5acd24e621a9919e220d7ed3bb48"><div class="ttname"><a href="classFtp_1_1Server.html#a263e5acd24e621a9919e220d7ed3bb48">Ftp::Server::writeForwardedReply</a></div><div class="ttdeci">void writeForwardedReply(const HttpReply *reply)</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l01036">FtpServer.cc:1036</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_a2cd34e1f2833ff4009844349c16e11f9"><div class="ttname"><a href="classFtp_1_1Server.html#a2cd34e1f2833ff4009844349c16e11f9">Ftp::Server::userDataCompletionCheckpoint</a></div><div class="ttdeci">void userDataCompletionCheckpoint(int finalStatusCode)</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l01809">FtpServer.cc:1809</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_a2e1bf5f8613d64f9483f3cdaf30ee38e"><div class="ttname"><a href="classFtp_1_1Server.html#a2e1bf5f8613d64f9483f3cdaf30ee38e">Ftp::Server::connectedForData</a></div><div class="ttdeci">void connectedForData(const CommConnectCbParams &amp;params)</div><div class="ttdoc">Done establishing a data connection to the user.</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l01703">FtpServer.cc:1703</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_a318b2a9e533d1cecc0f25fbe4e4dccf4"><div class="ttname"><a href="classFtp_1_1Server.html#a318b2a9e533d1cecc0f25fbe4e4dccf4">Ftp::Server::EarlyErrorKind</a></div><div class="ttdeci">EarlyErrorKind</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8h_source.html#l00086">FtpServer.h:86</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_a38a276da4afa2eb9ab15354d85bcb798"><div class="ttname"><a href="classFtp_1_1Server.html#a38a276da4afa2eb9ab15354d85bcb798">Ftp::Server::handleCdupRequest</a></div><div class="ttdeci">bool handleCdupRequest(String &amp;cmd, String &amp;params)</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l01635">FtpServer.cc:1635</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_a3eb9588ad1d0cf8894ab06d609688f47"><div class="ttname"><a href="classFtp_1_1Server.html#a3eb9588ad1d0cf8894ab06d609688f47">Ftp::Server::writeForwardedForeign</a></div><div class="ttdeci">void writeForwardedForeign(const HttpReply *reply)</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l01143">FtpServer.cc:1143</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_a415ec5a03d629f95a7dc0b3dd9c830d6"><div class="ttname"><a href="classFtp_1_1Server.html#a415ec5a03d629f95a7dc0b3dd9c830d6">Ftp::Server::AcceptCtrlConnection</a></div><div class="ttdeci">static void AcceptCtrlConnection(const CommAcceptCbParams &amp;params)</div><div class="ttdoc">accept a new FTP control connection and hand it to a dedicated Server</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l00242">FtpServer.cc:242</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_a448ac7f18ac63bd5ebf64bafd9fe20da"><div class="ttname"><a href="classFtp_1_1Server.html#a448ac7f18ac63bd5ebf64bafd9fe20da">Ftp::Server::maybeReadUploadData</a></div><div class="ttdeci">void maybeReadUploadData()</div><div class="ttdoc">schedules another data connection read if needed</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l00109">FtpServer.cc:109</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_a45ebf20dc16be23b519c2e6f65cad88f"><div class="ttname"><a href="classFtp_1_1Server.html#a45ebf20dc16be23b519c2e6f65cad88f">Ftp::Server::handleEprtReply</a></div><div class="ttdeci">void handleEprtReply(const HttpReply *header, StoreIOBuffer receivedData)</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l01059">FtpServer.cc:1059</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_a4b356bbe62e9d8ebc34d2681dcce6d3f"><div class="ttname"><a href="classFtp_1_1Server.html#a4b356bbe62e9d8ebc34d2681dcce6d3f">Ftp::Server::changeState</a></div><div class="ttdeci">void changeState(const Ftp::ServerState newState, const char *reason)</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l00529">FtpServer.cc:529</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_a4d1af5c70cc5a133ee3f992c3e0ea391"><div class="ttname"><a href="classFtp_1_1Server.html#a4d1af5c70cc5a133ee3f992c3e0ea391">Ftp::Server::wroteReply</a></div><div class="ttdeci">void wroteReply(const CommIoCbParams &amp;io)</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l01256">FtpServer.cc:1256</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_a50165f8199d17e1552aab0fcf077b4d8"><div class="ttname"><a href="classFtp_1_1Server.html#a50165f8199d17e1552aab0fcf077b4d8">Ftp::Server::handlePasvReply</a></div><div class="ttdeci">void handlePasvReply(const HttpReply *header, StoreIOBuffer receivedData)</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l00881">FtpServer.cc:881</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_a51ca9368784f809c9f74c953b3930309"><div class="ttname"><a href="classFtp_1_1Server.html#a51ca9368784f809c9f74c953b3930309">Ftp::Server::earlyError</a></div><div class="ttdeci">Http::Stream * earlyError(const EarlyErrorKind eek)</div><div class="ttdoc">creates a context filled with an error message for a given early error</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l00570">FtpServer.cc:570</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_a527df8bef2b079388d32dcfca742b474"><div class="ttname"><a href="classFtp_1_1Server.html#a527df8bef2b079388d32dcfca742b474">Ftp::Server::callException</a></div><div class="ttdeci">void callException(const std::exception &amp;e) override</div><div class="ttdoc">called when the job throws during an async call</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l01750">FtpServer.cc:1750</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_a55ed9bf0c94ad3b3226b01e5fd8332b9"><div class="ttname"><a href="classFtp_1_1Server.html#a55ed9bf0c94ad3b3226b01e5fd8332b9">Ftp::Server::completeDataDownload</a></div><div class="ttdeci">void completeDataDownload()</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l01834">FtpServer.cc:1834</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_a569ffc9a347f8ae7b1aa38c6067b95ac"><div class="ttname"><a href="classFtp_1_1Server.html#a569ffc9a347f8ae7b1aa38c6067b95ac">Ftp::Server::handleFeatReply</a></div><div class="ttdeci">void handleFeatReply(const HttpReply *header, StoreIOBuffer receivedData)</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l00812">FtpServer.cc:812</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_a5777b8239009dbe5de8a56ec6765362d"><div class="ttname"><a href="classFtp_1_1Server.html#a5777b8239009dbe5de8a56ec6765362d">Ftp::Server::handlePortRequest</a></div><div class="ttdeci">bool handlePortRequest(String &amp;cmd, String &amp;params)</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l01491">FtpServer.cc:1491</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_a587c2c7812b6594e676b91e90d5deaa8"><div class="ttname"><a href="classFtp_1_1Server.html#a587c2c7812b6594e676b91e90d5deaa8">Ftp::Server::acceptDataConnection</a></div><div class="ttdeci">void acceptDataConnection(const CommAcceptCbParams &amp;params)</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l00401">FtpServer.cc:401</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_a5be3658588359f1d53491a6ad92fe63a"><div class="ttname"><a href="classFtp_1_1Server.html#a5be3658588359f1d53491a6ad92fe63a">Ftp::Server::handleFeatRequest</a></div><div class="ttdeci">bool handleFeatRequest(String &amp;cmd, String &amp;params)</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l01406">FtpServer.cc:1406</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_a608f182a639606058f8db59f4f953545"><div class="ttname"><a href="classFtp_1_1Server.html#a608f182a639606058f8db59f4f953545">Ftp::Server::writeErrorReply</a></div><div class="ttdeci">void writeErrorReply(const HttpReply *reply, const int status)</div><div class="ttdoc">writes FTP error response with given status and reply-derived error details</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l01095">FtpServer.cc:1095</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_a68296ed05e04f05f4d86abf14e66d480"><div class="ttname"><a href="classFtp_1_1Server.html#a68296ed05e04f05f4d86abf14e66d480">Ftp::Server::startWaitingForOrigin</a></div><div class="ttdeci">void startWaitingForOrigin()</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l01761">FtpServer.cc:1761</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_a6b841156ae0316934069ebaa7c7c488f"><div class="ttname"><a href="classFtp_1_1Server.html#a6b841156ae0316934069ebaa7c7c488f">Ftp::Server::checkDataConnPre</a></div><div class="ttdeci">bool checkDataConnPre()</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l01661">FtpServer.cc:1661</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_a6bbbb722cc383590224e0e03b8c71a23"><div class="ttname"><a href="classFtp_1_1Server.html#a6bbbb722cc383590224e0e03b8c71a23">Ftp::Server::writeReply</a></div><div class="ttdeci">void writeReply(MemBuf &amp;mb)</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l00495">FtpServer.cc:495</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_a6c743f785f963e6b8d77a47a65a39ff4"><div class="ttname"><a href="classFtp_1_1Server.html#a6c743f785f963e6b8d77a47a65a39ff4">Ftp::Server::resetLogin</a></div><div class="ttdeci">void resetLogin(const char *reason)</div><div class="ttdoc">clear client and server login-related state after the old login is gone</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l00336">FtpServer.cc:336</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_a6c92190199455f65a55e459ad42821be"><div class="ttname"><a href="classFtp_1_1Server.html#a6c92190199455f65a55e459ad42821be">Ftp::Server::processParsedRequest</a></div><div class="ttdeci">void processParsedRequest(Http::StreamPointer &amp;context) override</div><div class="ttdoc">start processing a freshly parsed request</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l00156">FtpServer.cc:156</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_a6cff7ff003b533336e5ed9e030d23dc2"><div class="ttname"><a href="classFtp_1_1Server.html#a6cff7ff003b533336e5ed9e030d23dc2">Ftp::Server::noteBodyConsumerAborted</a></div><div class="ttdeci">void noteBodyConsumerAborted(BodyPipe::Pointer ptr) override</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l00231">FtpServer.cc:231</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_a6e8fa216b3301a1f7d416eff260c0f90"><div class="ttname"><a href="classFtp_1_1Server.html#a6e8fa216b3301a1f7d416eff260c0f90">Ftp::Server::wroteReplyData</a></div><div class="ttdeci">void wroteReplyData(const CommIoCbParams &amp;io)</div><div class="ttdoc">called when we are done writing a chunk of the response data</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l00986">FtpServer.cc:986</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_a73eaed1cdcd71f4611166021f2c13c10"><div class="ttname"><a href="classFtp_1_1Server.html#a73eaed1cdcd71f4611166021f2c13c10">Ftp::Server::idleTimeout</a></div><div class="ttdeci">time_t idleTimeout() const override</div><div class="ttdoc">timeout to use when waiting for the next request</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l00086">FtpServer.cc:86</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_a7443373c03f2b2f3a9846f12105d305b"><div class="ttname"><a href="classFtp_1_1Server.html#a7443373c03f2b2f3a9846f12105d305b">Ftp::Server::clientPinnedConnectionClosed</a></div><div class="ttdeci">void clientPinnedConnectionClosed(const CommCloseCbParams &amp;io) override</div><div class="ttdoc">Our close handler called by Comm when the pinned connection is closed.</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l00316">FtpServer.cc:316</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_a74fc75d405fb33c1ee941b3849cfb6e2"><div class="ttname"><a href="classFtp_1_1Server.html#a74fc75d405fb33c1ee941b3849cfb6e2">Ftp::Server::Server</a></div><div class="ttdeci">Server(const MasterXaction::Pointer &amp;xact)</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l00053">FtpServer.cc:53</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_a7868f6c83620a3355e3f53e6fbe87daa"><div class="ttname"><a href="classFtp_1_1Server.html#a7868f6c83620a3355e3f53e6fbe87daa">Ftp::Server::writeControlMsgAndCall</a></div><div class="ttdeci">bool writeControlMsgAndCall(HttpReply *rep, AsyncCall::Pointer &amp;call) override</div><div class="ttdoc">handle a control message received by context from a peer and call back</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l01152">FtpServer.cc:1152</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_a836442f1bc5870bde3d986e77d19b3aa"><div class="ttname"><a href="classFtp_1_1Server.html#a836442f1bc5870bde3d986e77d19b3aa">Ftp::Server::start</a></div><div class="ttdeci">void start() override</div><div class="ttdoc">called by AsyncStart; do not call directly</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l00092">FtpServer.cc:92</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_a84749bf0f7e8946f7e818435bd00a02c"><div class="ttname"><a href="classFtp_1_1Server.html#a84749bf0f7e8946f7e818435bd00a02c">Ftp::Server::handlePortReply</a></div><div class="ttdeci">void handlePortReply(const HttpReply *header, StoreIOBuffer receivedData)</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l00921">FtpServer.cc:921</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_a8dfc2912a7b006956187cdab988ad628"><div class="ttname"><a href="classFtp_1_1Server.html#a8dfc2912a7b006956187cdab988ad628">Ftp::Server::handleErrorReply</a></div><div class="ttdeci">void handleErrorReply(const HttpReply *header, StoreIOBuffer receivedData)</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l00934">FtpServer.cc:934</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_a8e274e401beeaa3b2f18c9f78b5cac42"><div class="ttname"><a href="classFtp_1_1Server.html#a8e274e401beeaa3b2f18c9f78b5cac42">Ftp::Server::notePeerConnection</a></div><div class="ttdeci">void notePeerConnection(Comm::ConnectionPointer conn) override</div><div class="ttdoc">called just before a FwdState-dispatched job starts using connection</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l00302">FtpServer.cc:302</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_a91c96fb1d958ac2c8232bec4138a40d8"><div class="ttname"><a href="classFtp_1_1Server.html#a91c96fb1d958ac2c8232bec4138a40d8">Ftp::Server::parseOneRequest</a></div><div class="ttdeci">Http::Stream * parseOneRequest() override</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l00640">FtpServer.cc:640</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_a93a3abbbf6ec0099007957bf5d3fccdf"><div class="ttname"><a href="classFtp_1_1Server.html#a93a3abbbf6ec0099007957bf5d3fccdf">Ftp::Server::uploadBuf</a></div><div class="ttdeci">char uploadBuf[CLIENT_REQ_BUF_SZ]</div><div class="ttdoc">data connection input buffer</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8h_source.html#l00190">FtpServer.h:190</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_a94f14ee4da75b18e38893f9a0aa69147"><div class="ttname"><a href="classFtp_1_1Server.html#a94f14ee4da75b18e38893f9a0aa69147">Ftp::Server::handleReply</a></div><div class="ttdeci">void handleReply(HttpReply *header, StoreIOBuffer receivedData) override</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l00778">FtpServer.cc:778</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_a96e5eb2529c9084d9294d9689bbf7001"><div class="ttname"><a href="classFtp_1_1Server.html#a96e5eb2529c9084d9294d9689bbf7001">Ftp::Server::createDataConnection</a></div><div class="ttdeci">bool createDataConnection(Ip::Address cltAddr)</div><div class="ttdoc">[Re]initializes dataConn for active data transfers. Does not connect.</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l01432">FtpServer.cc:1432</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_a9745cd38915b36995a608726fa185a2c"><div class="ttname"><a href="classFtp_1_1Server.html#a9745cd38915b36995a608726fa185a2c">Ftp::Server::handleEpsvRequest</a></div><div class="ttdeci">bool handleEpsvRequest(String &amp;cmd, String &amp;params)</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l01596">FtpServer.cc:1596</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_a9bbdcbe2fc3cf89f62cca8991473fb65"><div class="ttname"><a href="classFtp_1_1Server.html#a9bbdcbe2fc3cf89f62cca8991473fb65">Ftp::Server::setReply</a></div><div class="ttdeci">void setReply(const int code, const char *msg)</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l01729">FtpServer.cc:1729</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_aa7d62ff57f50fc4cbe2b4df15a9b1607"><div class="ttname"><a href="classFtp_1_1Server.html#aa7d62ff57f50fc4cbe2b4df15a9b1607">Ftp::Server::replyDataWritingCheckpoint</a></div><div class="ttdeci">void replyDataWritingCheckpoint()</div><div class="ttdoc">ClientStream checks after (actual or skipped) reply data writing.</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l01004">FtpServer.cc:1004</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_aafcb05a9300f5cf350682aef4b4fd915"><div class="ttname"><a href="classFtp_1_1Server.html#aafcb05a9300f5cf350682aef4b4fd915">Ftp::Server::handlePassRequest</a></div><div class="ttdeci">bool handlePassRequest(String &amp;cmd, String &amp;params)</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l01628">FtpServer.cc:1628</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_ab78c320c4406518c7e1b2c08b45a4749"><div class="ttname"><a href="classFtp_1_1Server.html#ab78c320c4406518c7e1b2c08b45a4749">Ftp::Server::handleEpsvReply</a></div><div class="ttdeci">void handleEpsvReply(const HttpReply *header, StoreIOBuffer receivedData)</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l01072">FtpServer.cc:1072</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_abb080a58365191b240f85bbc70d01cdb"><div class="ttname"><a href="classFtp_1_1Server.html#abb080a58365191b240f85bbc70d01cdb">Ftp::Server::wroteEarlyReply</a></div><div class="ttdeci">void wroteEarlyReply(const CommIoCbParams &amp;io)</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l01234">FtpServer.cc:1234</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_abd8957626af753956b7263c321995c88"><div class="ttname"><a href="classFtp_1_1Server.html#abd8957626af753956b7263c321995c88">Ftp::Server::handleUserRequest</a></div><div class="ttdeci">Http::Stream * handleUserRequest(const SBuf &amp;cmd, SBuf &amp;params)</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l01358">FtpServer.cc:1358</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_ac65b32892d544696d1f6b650f028b8c7"><div class="ttname"><a href="classFtp_1_1Server.html#ac65b32892d544696d1f6b650f028b8c7">Ftp::Server::handleUploadReply</a></div><div class="ttdeci">void handleUploadReply(const HttpReply *header, StoreIOBuffer receivedData)</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l01029">FtpServer.cc:1029</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_acb972af7243a5d9615c56cb3e00a4ab9"><div class="ttname"><a href="classFtp_1_1Server.html#acb972af7243a5d9615c56cb3e00a4ab9">Ftp::Server::handleRequest</a></div><div class="ttdeci">bool handleRequest(HttpRequest *)</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l01299">FtpServer.cc:1299</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_acd6efb656e34a35cafb6368eb748d3a9"><div class="ttname"><a href="classFtp_1_1Server.html#acd6efb656e34a35cafb6368eb748d3a9">Ftp::Server::noteMoreBodySpaceAvailable</a></div><div class="ttdeci">void noteMoreBodySpaceAvailable(BodyPipe::Pointer) override</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l00222">FtpServer.cc:222</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_ad327101ea8c2cff503fd9140fa2cd8b3"><div class="ttname"><a href="classFtp_1_1Server.html#ad327101ea8c2cff503fd9140fa2cd8b3">Ftp::Server::stopWaitingForOrigin</a></div><div class="ttdeci">void stopWaitingForOrigin(int status)</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l01771">FtpServer.cc:1771</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_ad45a60163911e766785a77148c25566a"><div class="ttname"><a href="classFtp_1_1Server.html#ad45a60163911e766785a77148c25566a">Ftp::Server::shovelUploadData</a></div><div class="ttdeci">void shovelUploadData()</div><div class="ttdoc">shovel upload data from the internal buffer to the body pipe if possible</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l00202">FtpServer.cc:202</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_ad801a22938549c5a29b2d9958374d23a"><div class="ttname"><a href="classFtp_1_1Server.html#ad801a22938549c5a29b2d9958374d23a">Ftp::Server::listenForDataConnection</a></div><div class="ttdeci">unsigned int listenForDataConnection()</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l00370">FtpServer.cc:370</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_ad934744914c9ed6f4444a5032be5e3b4"><div class="ttname"><a href="classFtp_1_1Server.html#ad934744914c9ed6f4444a5032be5e3b4">Ftp::Server::writeForwardedReplyAndCall</a></div><div class="ttdeci">void writeForwardedReplyAndCall(const HttpReply *reply, AsyncCall::Pointer &amp;call)</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l01161">FtpServer.cc:1161</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_ade79635001afef68c7936aae16267f05"><div class="ttname"><a href="classFtp_1_1Server.html#ade79635001afef68c7936aae16267f05">Ftp::Server::pipelinePrefetchMax</a></div><div class="ttdeci">int pipelinePrefetchMax() const override</div><div class="ttdoc">returning N allows a pipeline of 1+N requests (see pipeline_prefetch)</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l00080">FtpServer.cc:80</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_adfc11254c46706715973503ae2f49063"><div class="ttname"><a href="classFtp_1_1Server.html#adfc11254c46706715973503ae2f49063">Ftp::Server::checkDataConnPost</a></div><div class="ttdeci">bool checkDataConnPost() const</div><div class="ttdoc">Check that client data connection is ready for immediate I/O.</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l01692">FtpServer.cc:1692</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_ae058b6cf529fdbfb29fdea2217e43011"><div class="ttname"><a href="classFtp_1_1Server.html#ae058b6cf529fdbfb29fdea2217e43011">Ftp::Server::doProcessRequest</a></div><div class="ttdeci">void doProcessRequest()</div><div class="ttdoc">react to the freshly parsed request</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l00128">FtpServer.cc:128</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_aeb55d738404a6a927fdd9f2704c808f5"><div class="ttname"><a href="classFtp_1_1Server.html#aeb55d738404a6a927fdd9f2704c808f5">Ftp::Server::readUploadData</a></div><div class="ttdeci">void readUploadData(const CommIoCbParams &amp;io)</div><div class="ttdoc">imports more upload data from the data connection</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l00168">FtpServer.cc:168</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_af20c431bd7cae760f440231ee5e140ec"><div class="ttname"><a href="classFtp_1_1Server.html#af20c431bd7cae760f440231ee5e140ec">Ftp::Server::handleCwdRequest</a></div><div class="ttdeci">bool handleCwdRequest(String &amp;cmd, String &amp;params)</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l01621">FtpServer.cc:1621</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_af40731e50bee1b03862d6f288817eff3"><div class="ttname"><a href="classFtp_1_1Server.html#af40731e50bee1b03862d6f288817eff3">Ftp::Server::handleEprtRequest</a></div><div class="ttdeci">bool handleEprtRequest(String &amp;cmd, String &amp;params)</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l01567">FtpServer.cc:1567</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_af46569dae5e4a0d6e67b0b4eca1e66b5"><div class="ttname"><a href="classFtp_1_1Server.html#af46569dae5e4a0d6e67b0b4eca1e66b5">Ftp::Server::writeEarlyReply</a></div><div class="ttdeci">void writeEarlyReply(const int code, const char *msg)</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l00476">FtpServer.cc:476</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_af575d2e7efe3b7130dcbffc2c163f5e6"><div class="ttname"><a href="classFtp_1_1Server.html#af575d2e7efe3b7130dcbffc2c163f5e6">Ftp::Server::~Server</a></div><div class="ttdeci">~Server() override</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l00074">FtpServer.cc:74</a></div></div>
<div class="ttc" id="aclassFtp_1_1Server_html_af79d866333b560434b1548aa3c7c4509"><div class="ttname"><a href="classFtp_1_1Server.html#af79d866333b560434b1548aa3c7c4509">Ftp::Server::closeDataConnection</a></div><div class="ttdeci">void closeDataConnection()</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l00445">FtpServer.cc:445</a></div></div>
<div class="ttc" id="aclassHttpHeaderEntry_html"><div class="ttname"><a href="classHttpHeaderEntry.html">HttpHeaderEntry</a></div><div class="ttdef"><b>Definition</b> <a href="HttpHeader_8h_source.html#l00050">HttpHeader.h:51</a></div></div>
<div class="ttc" id="aclassHttpHeaderEntry_html_af1721f40aef39eef4476a19f806aedaa"><div class="ttname"><a href="classHttpHeaderEntry.html#af1721f40aef39eef4476a19f806aedaa">HttpHeaderEntry::value</a></div><div class="ttdeci">String value</div><div class="ttdef"><b>Definition</b> <a href="HttpHeader_8h_source.html#l00068">HttpHeader.h:68</a></div></div>
<div class="ttc" id="aclassHttpHeader_html"><div class="ttname"><a href="classHttpHeader.html">HttpHeader</a></div><div class="ttdef"><b>Definition</b> <a href="HttpHeader_8h_source.html#l00074">HttpHeader.h:75</a></div></div>
<div class="ttc" id="aclassHttpHeader_html_a187949b24278b65f28338947c605b130"><div class="ttname"><a href="classHttpHeader.html#a187949b24278b65f28338947c605b130">HttpHeader::putStr</a></div><div class="ttdeci">void putStr(Http::HdrType id, const char *str)</div><div class="ttdef"><b>Definition</b> <a href="HttpHeader_8cc_source.html#l01128">HttpHeader.cc:1128</a></div></div>
<div class="ttc" id="aclassHttpHeader_html_a6a5a2911b3e812c91b5eab549fcf2f09"><div class="ttname"><a href="classHttpHeader.html#a6a5a2911b3e812c91b5eab549fcf2f09">HttpHeader::refreshMask</a></div><div class="ttdeci">void refreshMask()</div><div class="ttdef"><b>Definition</b> <a href="HttpHeader_8cc_source.html#l00855">HttpHeader.cc:855</a></div></div>
<div class="ttc" id="aclassHttpHeader_html_a81cb2fc85a9629783ba1e607de0f41ed"><div class="ttname"><a href="classHttpHeader.html#a81cb2fc85a9629783ba1e607de0f41ed">HttpHeader::getEntry</a></div><div class="ttdeci">HttpHeaderEntry * getEntry(HttpHeaderPos *pos) const</div><div class="ttdef"><b>Definition</b> <a href="HttpHeader_8cc_source.html#l00716">HttpHeader.cc:716</a></div></div>
<div class="ttc" id="aclassHttpHeader_html_a89a87680aa68d7143be79793bcbce500"><div class="ttname"><a href="classHttpHeader.html#a89a87680aa68d7143be79793bcbce500">HttpHeader::getStr</a></div><div class="ttdeci">const char * getStr(Http::HdrType id) const</div><div class="ttdef"><b>Definition</b> <a href="HttpHeader_8cc_source.html#l01296">HttpHeader.cc:1296</a></div></div>
<div class="ttc" id="aclassHttpHeader_html_aa5d893d7e238241fc80e96d6705e5699"><div class="ttname"><a href="classHttpHeader.html#aa5d893d7e238241fc80e96d6705e5699">HttpHeader::addEntry</a></div><div class="ttdeci">void addEntry(HttpHeaderEntry *e)</div><div class="ttdef"><b>Definition</b> <a href="HttpHeader_8cc_source.html#l00869">HttpHeader.cc:869</a></div></div>
<div class="ttc" id="aclassHttpHeader_html_ab438778c7fb47d4ff3b9ed41285be02f"><div class="ttname"><a href="classHttpHeader.html#ab438778c7fb47d4ff3b9ed41285be02f">HttpHeader::getByName</a></div><div class="ttdeci">String getByName(const SBuf &amp;name) const</div><div class="ttdef"><b>Definition</b> <a href="HttpHeader_8cc_source.html#l00981">HttpHeader.cc:981</a></div></div>
<div class="ttc" id="aclassHttpHeader_html_abe3327167942e75a78385e92bc1b26b7"><div class="ttname"><a href="classHttpHeader.html#abe3327167942e75a78385e92bc1b26b7">HttpHeader::has</a></div><div class="ttdeci">int has(Http::HdrType id) const</div><div class="ttdef"><b>Definition</b> <a href="HttpHeader_8cc_source.html#l01070">HttpHeader.cc:1070</a></div></div>
<div class="ttc" id="aclassHttpHeader_html_ac372a06ceba805a52c4bce9cce8b28d8"><div class="ttname"><a href="classHttpHeader.html#ac372a06ceba805a52c4bce9cce8b28d8">HttpHeader::getInt</a></div><div class="ttdeci">int getInt(Http::HdrType id) const</div><div class="ttdef"><b>Definition</b> <a href="HttpHeader_8cc_source.html#l01253">HttpHeader.cc:1253</a></div></div>
<div class="ttc" id="aclassHttpHeader_html_acfab592ae0ede9d3934c233aacffbeeb"><div class="ttname"><a href="classHttpHeader.html#acfab592ae0ede9d3934c233aacffbeeb">HttpHeader::findEntry</a></div><div class="ttdeci">HttpHeaderEntry * findEntry(Http::HdrType id) const</div><div class="ttdef"><b>Definition</b> <a href="HttpHeader_8cc_source.html#l00735">HttpHeader.cc:735</a></div></div>
<div class="ttc" id="aclassHttpHeader_html_ae56dc631f4c28f3f6a64467cffa42ac9"><div class="ttname"><a href="classHttpHeader.html#ae56dc631f4c28f3f6a64467cffa42ac9">HttpHeader::updateOrAddStr</a></div><div class="ttdeci">void updateOrAddStr(Http::HdrType, const SBuf &amp;)</div><div class="ttdef"><b>Definition</b> <a href="HttpHeader_8cc_source.html#l01216">HttpHeader.cc:1216</a></div></div>
<div class="ttc" id="aclassHttpReply_html"><div class="ttname"><a href="classHttpReply.html">HttpReply</a></div><div class="ttdef"><b>Definition</b> <a href="HttpReply_8h_source.html#l00024">HttpReply.h:25</a></div></div>
<div class="ttc" id="aclassHttpReply_html_a01790af23c553b590ac6009ebb693b6d"><div class="ttname"><a href="classHttpReply.html#a01790af23c553b590ac6009ebb693b6d">HttpReply::sline</a></div><div class="ttdeci">Http::StatusLine sline</div><div class="ttdef"><b>Definition</b> <a href="HttpReply_8h_source.html#l00056">HttpReply.h:56</a></div></div>
<div class="ttc" id="aclassHttpRequestMethod_html"><div class="ttname"><a href="classHttpRequestMethod.html">HttpRequestMethod</a></div><div class="ttdef"><b>Definition</b> <a href="RequestMethod_8h_source.html#l00026">RequestMethod.h:27</a></div></div>
<div class="ttc" id="aclassHttpRequest_html"><div class="ttname"><a href="classHttpRequest.html">HttpRequest</a></div><div class="ttdef"><b>Definition</b> <a href="HttpRequest_8h_source.html#l00048">HttpRequest.h:49</a></div></div>
<div class="ttc" id="aclassHttpRequest_html_a1755dc87660c26cedea904817d91fbda"><div class="ttname"><a href="classHttpRequest.html#a1755dc87660c26cedea904817d91fbda">HttpRequest::adaptHistory</a></div><div class="ttdeci">Adaptation::History::Pointer adaptHistory(bool createIfNone=false) const</div><div class="ttdoc">Returns possibly nil history, creating it if requested.</div><div class="ttdef"><b>Definition</b> <a href="HttpRequest_8cc_source.html#l00401">HttpRequest.cc:401</a></div></div>
<div class="ttc" id="aclassHttpRequest_html_a1f0af82ff15e9a29d15319fc3cf05a54"><div class="ttname"><a href="classHttpRequest.html#a1f0af82ff15e9a29d15319fc3cf05a54">HttpRequest::method</a></div><div class="ttdeci">HttpRequestMethod method</div><div class="ttdef"><b>Definition</b> <a href="HttpRequest_8h_source.html#l00114">HttpRequest.h:114</a></div></div>
<div class="ttc" id="aclassHttpRequest_html_a54b1b1d850d85e6ad33ff19febb6adc8"><div class="ttname"><a href="classHttpRequest.html#a54b1b1d850d85e6ad33ff19febb6adc8">HttpRequest::pack</a></div><div class="ttdeci">void pack(Packable *p, bool maskSensitiveInfo=false) const</div><div class="ttdef"><b>Definition</b> <a href="HttpRequest_8cc_source.html#l00343">HttpRequest.cc:343</a></div></div>
<div class="ttc" id="aclassHttpRequest_html_a79627850aba026a7aa5c1de69958da70"><div class="ttname"><a href="classHttpRequest.html#a79627850aba026a7aa5c1de69958da70">HttpRequest::forcedBodyContinuation</a></div><div class="ttdeci">bool forcedBodyContinuation</div><div class="ttdoc">whether we have responded with HTTP 100 or FTP 150 already</div><div class="ttdef"><b>Definition</b> <a href="HttpRequest_8h_source.html#l00192">HttpRequest.h:192</a></div></div>
<div class="ttc" id="aclassHttpRequest_html_ad433674df1fe206d190f89b520d59621"><div class="ttname"><a href="classHttpRequest.html#ad433674df1fe206d190f89b520d59621">HttpRequest::FromUrl</a></div><div class="ttdeci">static HttpRequest * FromUrl(const SBuf &amp;url, const MasterXaction::Pointer &amp;, const HttpRequestMethod &amp;method=Http::METHOD_GET)</div><div class="ttdef"><b>Definition</b> <a href="HttpRequest_8cc_source.html#l00514">HttpRequest.cc:514</a></div></div>
<div class="ttc" id="aclassHttpRequest_html_aeeb3de67d14be944d152c249379832cb"><div class="ttname"><a href="classHttpRequest.html#aeeb3de67d14be944d152c249379832cb">HttpRequest::error</a></div><div class="ttdeci">Error error</div><div class="ttdoc">the first transaction problem encountered (or falsy)</div><div class="ttdef"><b>Definition</b> <a href="HttpRequest_8h_source.html#l00161">HttpRequest.h:161</a></div></div>
<div class="ttc" id="aclassHttp_1_1Message_html_a79ae935ff618211b139dcfdd8a5277ec"><div class="ttname"><a href="classHttp_1_1Message.html#a79ae935ff618211b139dcfdd8a5277ec">Http::Message::header</a></div><div class="ttdeci">HttpHeader header</div><div class="ttdef"><b>Definition</b> <a href="http_2Message_8h_source.html#l00074">Message.h:74</a></div></div>
<div class="ttc" id="aclassHttp_1_1StatusLine_html_ad25ca8e2da20e0f713a30460c44dddda"><div class="ttname"><a href="classHttp_1_1StatusLine.html#ad25ca8e2da20e0f713a30460c44dddda">Http::StatusLine::reason</a></div><div class="ttdeci">const char * reason() const</div><div class="ttdoc">retrieve the reason string for this status line</div><div class="ttdef"><b>Definition</b> <a href="StatusLine_8cc_source.html#l00044">StatusLine.cc:44</a></div></div>
<div class="ttc" id="aclassHttp_1_1StatusLine_html_af852e58bb3e96bc41cd16787b0a7d7db"><div class="ttname"><a href="classHttp_1_1StatusLine.html#af852e58bb3e96bc41cd16787b0a7d7db">Http::StatusLine::status</a></div><div class="ttdeci">Http::StatusCode status() const</div><div class="ttdoc">retrieve the status code for this status line</div><div class="ttdef"><b>Definition</b> <a href="StatusLine_8h_source.html#l00045">StatusLine.h:45</a></div></div>
<div class="ttc" id="aclassHttp_1_1Stream_html"><div class="ttname"><a href="classHttp_1_1Stream.html">Http::Stream</a></div><div class="ttdef"><b>Definition</b> <a href="http_2Stream_8h_source.html#l00072">Stream.h:73</a></div></div>
<div class="ttc" id="aclassHttp_1_1Stream_html_a19ce29fe9e19e5a7ea0f5dedc37895c2"><div class="ttname"><a href="classHttp_1_1Stream.html#a19ce29fe9e19e5a7ea0f5dedc37895c2">Http::Stream::parsed_ok</a></div><div class="ttdeci">unsigned parsed_ok</div><div class="ttdoc">Was this parsed correctly?</div><div class="ttdef"><b>Definition</b> <a href="http_2Stream_8h_source.html#l00140">Stream.h:140</a></div></div>
<div class="ttc" id="aclassHttp_1_1Stream_html_a720b33b5850e89ebda3011c853c20f9f"><div class="ttname"><a href="classHttp_1_1Stream.html#a720b33b5850e89ebda3011c853c20f9f">Http::Stream::flags</a></div><div class="ttdeci">struct Http::Stream::@58 flags</div></div>
<div class="ttc" id="aclassHttp_1_1Stream_html_aa13355bfcaa6f65caf4b0a64765d5968"><div class="ttname"><a href="classHttp_1_1Stream.html#aa13355bfcaa6f65caf4b0a64765d5968">Http::Stream::reqbuf</a></div><div class="ttdeci">char reqbuf[HTTP_REQBUF_SZ]</div><div class="ttdef"><b>Definition</b> <a href="http_2Stream_8h_source.html#l00137">Stream.h:137</a></div></div>
<div class="ttc" id="aclassHttp_1_1Stream_html_aa440325d7261074611d9150b3133bc26"><div class="ttname"><a href="classHttp_1_1Stream.html#aa440325d7261074611d9150b3133bc26">Http::Stream::getClientReplyContext</a></div><div class="ttdeci">clientStreamNode * getClientReplyContext() const</div><div class="ttdef"><b>Definition</b> <a href="Stream_8cc_source.html#l00511">Stream.cc:511</a></div></div>
<div class="ttc" id="aclassIp_1_1Address_html"><div class="ttname"><a href="classIp_1_1Address.html">Ip::Address</a></div><div class="ttdef"><b>Definition</b> <a href="ip_2Address_8h_source.html#l00042">Address.h:43</a></div></div>
<div class="ttc" id="aclassIp_1_1Address_html_a00a47f51e0c2b78115495af295924aee"><div class="ttname"><a href="classIp_1_1Address.html#a00a47f51e0c2b78115495af295924aee">Ip::Address::toStr</a></div><div class="ttdeci">char * toStr(char *buf, const unsigned int blen, int force=AF_UNSPEC) const</div><div class="ttdef"><b>Definition</b> <a href="ip_2Address_8cc_source.html#l00804">Address.cc:804</a></div></div>
<div class="ttc" id="aclassIp_1_1Address_html_a11fd4fdbf828795b3d188d01284181fe"><div class="ttname"><a href="classIp_1_1Address.html#a11fd4fdbf828795b3d188d01284181fe">Ip::Address::setIPv4</a></div><div class="ttdeci">bool setIPv4()</div><div class="ttdef"><b>Definition</b> <a href="ip_2Address_8cc_source.html#l00244">Address.cc:244</a></div></div>
<div class="ttc" id="aclassIp_1_1Address_html_a2696806ea5ee1a73dbe87849a7d43539"><div class="ttname"><a href="classIp_1_1Address.html#a2696806ea5ee1a73dbe87849a7d43539">Ip::Address::toHostStr</a></div><div class="ttdeci">unsigned int toHostStr(char *buf, const unsigned int len) const</div><div class="ttdef"><b>Definition</b> <a href="ip_2Address_8cc_source.html#l00854">Address.cc:854</a></div></div>
<div class="ttc" id="aclassIp_1_1Address_html_a6533c101544f6cf997406b3676849b3d"><div class="ttname"><a href="classIp_1_1Address.html#a6533c101544f6cf997406b3676849b3d">Ip::Address::isIPv4</a></div><div class="ttdeci">bool isIPv4() const</div><div class="ttdef"><b>Definition</b> <a href="ip_2Address_8cc_source.html#l00178">Address.cc:178</a></div></div>
<div class="ttc" id="aclassIp_1_1Address_html_ab00ddff71da22c55159fdc8176e14ea4"><div class="ttname"><a href="classIp_1_1Address.html#ab00ddff71da22c55159fdc8176e14ea4">Ip::Address::isAnyAddr</a></div><div class="ttdeci">bool isAnyAddr() const</div><div class="ttdef"><b>Definition</b> <a href="ip_2Address_8cc_source.html#l00190">Address.cc:190</a></div></div>
<div class="ttc" id="aclassIp_1_1Address_html_ac629209aecf4fa35b00242073d30ccb8"><div class="ttname"><a href="classIp_1_1Address.html#ac629209aecf4fa35b00242073d30ccb8">Ip::Address::setAnyAddr</a></div><div class="ttdeci">void setAnyAddr()</div><div class="ttdoc">NOTE: Does NOT clear the Port stored. Only the Address and Type.</div><div class="ttdef"><b>Definition</b> <a href="ip_2Address_8cc_source.html#l00197">Address.cc:197</a></div></div>
<div class="ttc" id="aclassIp_1_1Address_html_aeea3c669850f18acd2efcd336fcf2438"><div class="ttname"><a href="classIp_1_1Address.html#aeea3c669850f18acd2efcd336fcf2438">Ip::Address::port</a></div><div class="ttdeci">unsigned short port() const</div><div class="ttdef"><b>Definition</b> <a href="ip_2Address_8cc_source.html#l00790">Address.cc:790</a></div></div>
<div class="ttc" id="aclassMasterXaction_html_af3cb33c92de57dbb4f9b5a0bf5488ad4"><div class="ttname"><a href="classMasterXaction.html#af3cb33c92de57dbb4f9b5a0bf5488ad4">MasterXaction::MakePortful</a></div><div class="ttdeci">static Pointer MakePortful(const AnyP::PortCfgPointer &amp;aPort)</div><div class="ttdef"><b>Definition</b> <a href="MasterXaction_8h_source.html#l00054">MasterXaction.h:54</a></div></div>
<div class="ttc" id="aclassMemBuf_html"><div class="ttname"><a href="classMemBuf.html">MemBuf</a></div><div class="ttdef"><b>Definition</b> <a href="MemBuf_8h_source.html#l00023">MemBuf.h:24</a></div></div>
<div class="ttc" id="aclassMemBuf_html_a2e7319f5feaf76c1fd43f163a87ddaad"><div class="ttname"><a href="classMemBuf.html#a2e7319f5feaf76c1fd43f163a87ddaad">MemBuf::append</a></div><div class="ttdeci">void append(const char *c, int sz) override</div><div class="ttdef"><b>Definition</b> <a href="MemBuf_8cc_source.html#l00209">MemBuf.cc:209</a></div></div>
<div class="ttc" id="aclassMemBuf_html_a4a615d8e887439c66e04aab70f8be60a"><div class="ttname"><a href="classMemBuf.html#a4a615d8e887439c66e04aab70f8be60a">MemBuf::init</a></div><div class="ttdeci">void init(mb_size_t szInit, mb_size_t szMax)</div><div class="ttdef"><b>Definition</b> <a href="MemBuf_8cc_source.html#l00093">MemBuf.cc:93</a></div></div>
<div class="ttc" id="aclassMemBuf_html_a512e0e6f4a6b327f31c9db28fe9aaeb3"><div class="ttname"><a href="classMemBuf.html#a512e0e6f4a6b327f31c9db28fe9aaeb3">MemBuf::size</a></div><div class="ttdeci">mb_size_t size</div><div class="ttdef"><b>Definition</b> <a href="MemBuf_8h_source.html#l00135">MemBuf.h:135</a></div></div>
<div class="ttc" id="aclassMemBuf_html_a78daaa064a5aa4557e283a01c4aa27f1"><div class="ttname"><a href="classMemBuf.html#a78daaa064a5aa4557e283a01c4aa27f1">MemBuf::buf</a></div><div class="ttdeci">char * buf</div><div class="ttdef"><b>Definition</b> <a href="MemBuf_8h_source.html#l00134">MemBuf.h:134</a></div></div>
<div class="ttc" id="aclassPackable_html_ab3147943b218d2943726aeaf135dd776"><div class="ttname"><a href="classPackable.html#ab3147943b218d2943726aeaf135dd776">Packable::appendf</a></div><div class="ttdeci">void appendf(const char *fmt,...) PRINTF_FORMAT_ARG2</div><div class="ttdoc">Append operation with printf-style arguments.</div><div class="ttdef"><b>Definition</b> <a href="Packable_8h_source.html#l00061">Packable.h:61</a></div></div>
<div class="ttc" id="aclassParser_1_1Tokenizer_html"><div class="ttname"><a href="classParser_1_1Tokenizer.html">Parser::Tokenizer</a></div><div class="ttdef"><b>Definition</b> <a href="parser_2Tokenizer_8h_source.html#l00029">Tokenizer.h:30</a></div></div>
<div class="ttc" id="aclassRaw_html"><div class="ttname"><a href="classRaw.html">Raw</a></div><div class="ttdef"><b>Definition</b> <a href="Raw_8h_source.html#l00020">Raw.h:21</a></div></div>
<div class="ttc" id="aclassRefCount_html"><div class="ttname"><a href="classRefCount.html">RefCount&lt; MasterXaction &gt;</a></div></div>
<div class="ttc" id="aclassRefCount_html_a9f2168c1df4a4ab6b7931425d85c37f0"><div class="ttname"><a href="classRefCount.html#a9f2168c1df4a4ab6b7931425d85c37f0">RefCount::getRaw</a></div><div class="ttdeci">C * getRaw() const</div><div class="ttdef"><b>Definition</b> <a href="RefCount_8h_source.html#l00089">RefCount.h:89</a></div></div>
<div class="ttc" id="aclassRequestFlags_html"><div class="ttname"><a href="classRequestFlags.html">RequestFlags</a></div><div class="ttdef"><b>Definition</b> <a href="RequestFlags_8h_source.html#l00022">RequestFlags.h:23</a></div></div>
<div class="ttc" id="aclassRequestFlags_html_a7a87d1bd6000a6ce88eae02e6edf9f4c"><div class="ttname"><a href="classRequestFlags.html#a7a87d1bd6000a6ce88eae02e6edf9f4c">RequestFlags::disableCacheUse</a></div><div class="ttdeci">void disableCacheUse(const char *reason)</div><div class="ttdef"><b>Definition</b> <a href="RequestFlags_8cc_source.html#l00030">RequestFlags.cc:30</a></div></div>
<div class="ttc" id="aclassSBuf_html"><div class="ttname"><a href="classSBuf.html">SBuf</a></div><div class="ttdef"><b>Definition</b> <a href="SBuf_8h_source.html#l00093">SBuf.h:94</a></div></div>
<div class="ttc" id="aclassSBuf_html_a02393e7599a95c4a7bc89fa645120575"><div class="ttname"><a href="classSBuf.html#a02393e7599a95c4a7bc89fa645120575">SBuf::toUpper</a></div><div class="ttdeci">void toUpper()</div><div class="ttdoc">converts all characters to upper case;</div><div class="ttdef"><b>Definition</b> <a href="SBuf_8cc_source.html#l00824">SBuf.cc:824</a></div></div>
<div class="ttc" id="aclassSBuf_html_a07c6f34501511503dda62b51774d9b59"><div class="ttname"><a href="classSBuf.html#a07c6f34501511503dda62b51774d9b59">SBuf::caseCmp</a></div><div class="ttdeci">int caseCmp(const SBuf &amp;S, const size_type n) const</div><div class="ttdoc">shorthand version for case-insensitive compare()</div><div class="ttdef"><b>Definition</b> <a href="SBuf_8h_source.html#l00287">SBuf.h:287</a></div></div>
<div class="ttc" id="aclassSBuf_html_a1db91b2f039b38745f7d73b56ac9311f"><div class="ttname"><a href="classSBuf.html#a1db91b2f039b38745f7d73b56ac9311f">SBuf::npos</a></div><div class="ttdeci">static const size_type npos</div><div class="ttdef"><b>Definition</b> <a href="SBuf_8h_source.html#l00100">SBuf.h:100</a></div></div>
<div class="ttc" id="aclassSBuf_html_a2a7fda503e54cb36b023dcaaab633f65"><div class="ttname"><a href="classSBuf.html#a2a7fda503e54cb36b023dcaaab633f65">SBuf::c_str</a></div><div class="ttdeci">const char * c_str()</div><div class="ttdef"><b>Definition</b> <a href="SBuf_8cc_source.html#l00516">SBuf.cc:516</a></div></div>
<div class="ttc" id="aclassSBuf_html_a2f7b8f1302ad82646cc285927b453b87"><div class="ttname"><a href="classSBuf.html#a2f7b8f1302ad82646cc285927b453b87">SBuf::chop</a></div><div class="ttdeci">SBuf &amp; chop(size_type pos, size_type n=npos)</div><div class="ttdef"><b>Definition</b> <a href="SBuf_8cc_source.html#l00530">SBuf.cc:530</a></div></div>
<div class="ttc" id="aclassSBuf_html_a4fdfe954309aa6da19240f11a8f6b583"><div class="ttname"><a href="classSBuf.html#a4fdfe954309aa6da19240f11a8f6b583">SBuf::length</a></div><div class="ttdeci">size_type length() const</div><div class="ttdoc">Returns the number of bytes stored in SBuf.</div><div class="ttdef"><b>Definition</b> <a href="SBuf_8h_source.html#l00419">SBuf.h:419</a></div></div>
<div class="ttc" id="aclassSBuf_html_a531a0dd882ff1af666b03a8437701013"><div class="ttname"><a href="classSBuf.html#a531a0dd882ff1af666b03a8437701013">SBuf::rfind</a></div><div class="ttdeci">size_type rfind(char c, size_type endPos=npos) const</div><div class="ttdef"><b>Definition</b> <a href="SBuf_8cc_source.html#l00692">SBuf.cc:692</a></div></div>
<div class="ttc" id="aclassSBuf_html_a6f56e99bef653fef295096b7fc04be99"><div class="ttname"><a href="classSBuf.html#a6f56e99bef653fef295096b7fc04be99">SBuf::trim</a></div><div class="ttdeci">SBuf &amp; trim(const SBuf &amp;toRemove, bool atBeginning=true, bool atEnd=true)</div><div class="ttdef"><b>Definition</b> <a href="SBuf_8cc_source.html#l00551">SBuf.cc:551</a></div></div>
<div class="ttc" id="aclassSBuf_html_a8bda8fe69e451e61946b35c2a2d2340b"><div class="ttname"><a href="classSBuf.html#a8bda8fe69e451e61946b35c2a2d2340b">SBuf::isEmpty</a></div><div class="ttdeci">bool isEmpty() const</div><div class="ttdef"><b>Definition</b> <a href="SBuf_8h_source.html#l00435">SBuf.h:435</a></div></div>
<div class="ttc" id="aclassSBuf_html_adb0c2508d8e83b2fd5f931d65cc775d8"><div class="ttname"><a href="classSBuf.html#adb0c2508d8e83b2fd5f931d65cc775d8">SBuf::clear</a></div><div class="ttdeci">void clear()</div><div class="ttdef"><b>Definition</b> <a href="SBuf_8cc_source.html#l00175">SBuf.cc:175</a></div></div>
<div class="ttc" id="aclassSBuf_html_ae0a0e7a121bab1f1526a6fe01cd00f8c"><div class="ttname"><a href="classSBuf.html#ae0a0e7a121bab1f1526a6fe01cd00f8c">SBuf::substr</a></div><div class="ttdeci">SBuf substr(size_type pos, size_type n=npos) const</div><div class="ttdef"><b>Definition</b> <a href="SBuf_8cc_source.html#l00576">SBuf.cc:576</a></div></div>
<div class="ttc" id="aclassSBuf_html_ae27bdc0d7ad9a7aba6377e1a4a5af568"><div class="ttname"><a href="classSBuf.html#ae27bdc0d7ad9a7aba6377e1a4a5af568">SBuf::size_type</a></div><div class="ttdeci">MemBlob::size_type size_type</div><div class="ttdef"><b>Definition</b> <a href="SBuf_8h_source.html#l00096">SBuf.h:96</a></div></div>
<div class="ttc" id="aclassServer_html"><div class="ttname"><a href="classServer.html">Server</a></div><div class="ttdef"><b>Definition</b> <a href="Server_8h_source.html#l00031">Server.h:32</a></div></div>
<div class="ttc" id="aclassSquidConfig_html_a43c9fbdbbc5e8378236fea4989ff1981"><div class="ttname"><a href="classSquidConfig.html#a43c9fbdbbc5e8378236fea4989ff1981">SquidConfig::ftpClientIdle</a></div><div class="ttdeci">time_t ftpClientIdle</div><div class="ttdef"><b>Definition</b> <a href="SquidConfig_8h_source.html#l00121">SquidConfig.h:121</a></div></div>
<div class="ttc" id="aclassSquidConfig_html_a616f6fb80c58175d607c035c74744b17"><div class="ttname"><a href="classSquidConfig.html#a616f6fb80c58175d607c035c74744b17">SquidConfig::Timeout</a></div><div class="ttdeci">struct SquidConfig::@77 Timeout</div></div>
<div class="ttc" id="aclassSquidConfig_html_a9a5a4aaa278ec44c9807fb2c5433b49b"><div class="ttname"><a href="classSquidConfig.html#a9a5a4aaa278ec44c9807fb2c5433b49b">SquidConfig::maxRequestHeaderSize</a></div><div class="ttdeci">size_t maxRequestHeaderSize</div><div class="ttdef"><b>Definition</b> <a href="SquidConfig_8h_source.html#l00134">SquidConfig.h:134</a></div></div>
<div class="ttc" id="aclassSquidConfig_html_aba653ea563fdbd655dac52d5a477974b"><div class="ttname"><a href="classSquidConfig.html#aba653ea563fdbd655dac52d5a477974b">SquidConfig::connect</a></div><div class="ttdeci">time_t connect</div><div class="ttdef"><b>Definition</b> <a href="SquidConfig_8h_source.html#l00115">SquidConfig.h:115</a></div></div>
<div class="ttc" id="aclassSquidConfig_html_ac7f1138fffbdda4a9a888100e3187691"><div class="ttname"><a href="classSquidConfig.html#ac7f1138fffbdda4a9a888100e3187691">SquidConfig::accessList</a></div><div class="ttdeci">struct SquidConfig::@91 accessList</div></div>
<div class="ttc" id="aclassSquidConfig_html_afcb714948371a7254490b0d5538a4df3"><div class="ttname"><a href="classSquidConfig.html#afcb714948371a7254490b0d5538a4df3">SquidConfig::forceRequestBodyContinuation</a></div><div class="ttdeci">acl_access * forceRequestBodyContinuation</div><div class="ttdef"><b>Definition</b> <a href="SquidConfig_8h_source.html#l00404">SquidConfig.h:404</a></div></div>
<div class="ttc" id="aclassStatCounters_html_aa88b8ad0eef8be950212966821e49b49"><div class="ttname"><a href="classStatCounters.html#aa88b8ad0eef8be950212966821e49b49">StatCounters::kbytes_in</a></div><div class="ttdeci">ByteCounter kbytes_in</div><div class="ttdef"><b>Definition</b> <a href="StatCounters_8h_source.html#l00045">StatCounters.h:45</a></div></div>
<div class="ttc" id="aclassStatCounters_html_ae0515f9863b6255630e2563b01f8ca43"><div class="ttname"><a href="classStatCounters.html#ae0515f9863b6255630e2563b01f8ca43">StatCounters::client_http</a></div><div class="ttdeci">struct StatCounters::@104 client_http</div></div>
<div class="ttc" id="aclassStoreEntry_html_aae28c5e9a323d60ac8fe8ce98f6eb7c5"><div class="ttname"><a href="classStoreEntry.html#aae28c5e9a323d60ac8fe8ce98f6eb7c5">StoreEntry::replaceHttpReply</a></div><div class="ttdeci">void replaceHttpReply(const HttpReplyPointer &amp;, const bool andStartWriting=true)</div><div class="ttdef"><b>Definition</b> <a href="store_8cc_source.html#l01705">store.cc:1705</a></div></div>
<div class="ttc" id="aclassStoreIOBuffer_html"><div class="ttname"><a href="classStoreIOBuffer.html">StoreIOBuffer</a></div><div class="ttdef"><b>Definition</b> <a href="StoreIOBuffer_8h_source.html#l00015">StoreIOBuffer.h:16</a></div></div>
<div class="ttc" id="aclassStoreIOBuffer_html_a08224ebb5a73aa6b18c0e7a60ebf00b5"><div class="ttname"><a href="classStoreIOBuffer.html#a08224ebb5a73aa6b18c0e7a60ebf00b5">StoreIOBuffer::data</a></div><div class="ttdeci">char * data</div><div class="ttdef"><b>Definition</b> <a href="StoreIOBuffer_8h_source.html#l00059">StoreIOBuffer.h:59</a></div></div>
<div class="ttc" id="aclassStoreIOBuffer_html_a97772bf328fe745e1d1fc23ee91cec39"><div class="ttname"><a href="classStoreIOBuffer.html#a97772bf328fe745e1d1fc23ee91cec39">StoreIOBuffer::length</a></div><div class="ttdeci">size_t length</div><div class="ttdef"><b>Definition</b> <a href="StoreIOBuffer_8h_source.html#l00057">StoreIOBuffer.h:57</a></div></div>
<div class="ttc" id="aclassString_html"><div class="ttname"><a href="classString.html">String</a></div><div class="ttdef"><b>Definition</b> <a href="SquidString_8h_source.html#l00026">SquidString.h:27</a></div></div>
<div class="ttc" id="aclassString_html_a08745577171227c59ced9a0ca85cd5ac"><div class="ttname"><a href="classString.html#a08745577171227c59ced9a0ca85cd5ac">String::cmp</a></div><div class="ttdeci">int cmp(char const *) const</div><div class="ttdef"><b>Definition</b> <a href="String_8cc_source.html#l00243">String.cc:243</a></div></div>
<div class="ttc" id="aclassString_html_aba5551ee62c6e82730c0cb1856238c14"><div class="ttname"><a href="classString.html#aba5551ee62c6e82730c0cb1856238c14">String::termedBuf</a></div><div class="ttdeci">char const * termedBuf() const</div><div class="ttdef"><b>Definition</b> <a href="SquidString_8h_source.html#l00093">SquidString.h:93</a></div></div>
<div class="ttc" id="aclassString_html_ad371f67478ccdf8fc55d2beb03708ff3"><div class="ttname"><a href="classString.html#ad371f67478ccdf8fc55d2beb03708ff3">String::caseCmp</a></div><div class="ttdeci">int caseCmp(char const *) const</div><div class="ttdef"><b>Definition</b> <a href="String_8cc_source.html#l00273">String.cc:273</a></div></div>
<div class="ttc" id="aclassString_html_aff70196bf32e527af1116bb4eb93f353"><div class="ttname"><a href="classString.html#aff70196bf32e527af1116bb4eb93f353">String::size</a></div><div class="ttdeci">size_type size() const</div><div class="ttdef"><b>Definition</b> <a href="SquidString_8h_source.html#l00074">SquidString.h:74</a></div></div>
<div class="ttc" id="aclassclientReplyContext_html"><div class="ttname"><a href="classclientReplyContext.html">clientReplyContext</a></div><div class="ttdef"><b>Definition</b> <a href="client__side__reply_8h_source.html#l00022">client_side_reply.h:23</a></div></div>
<div class="ttc" id="aclassclientReplyContext_html_a0f8952c0b6f0b7a451aa61a94cdd7ed9"><div class="ttname"><a href="classclientReplyContext.html#a0f8952c0b6f0b7a451aa61a94cdd7ed9">clientReplyContext::setReplyToReply</a></div><div class="ttdeci">void setReplyToReply(HttpReply *reply)</div><div class="ttdoc">creates a store entry for the reply and appends error reply to it</div><div class="ttdef"><b>Definition</b> <a href="client__side__reply_8cc_source.html#l00130">client_side_reply.cc:130</a></div></div>
<div class="ttc" id="aclassclientReplyContext_html_a52e1f683492128736519f7389c712b6c"><div class="ttname"><a href="classclientReplyContext.html#a52e1f683492128736519f7389c712b6c">clientReplyContext::createStoreEntry</a></div><div class="ttdeci">void createStoreEntry(const HttpRequestMethod &amp;m, RequestFlags flags)</div><div class="ttdef"><b>Definition</b> <a href="client__side__reply_8cc_source.html#l02065">client_side_reply.cc:2065</a></div></div>
<div class="ttc" id="aclassclientStreamNode_html"><div class="ttname"><a href="classclientStreamNode.html">clientStreamNode</a></div><div class="ttdef"><b>Definition</b> <a href="clientStream_8h_source.html#l00075">clientStream.h:76</a></div></div>
<div class="ttc" id="aclientStream_8h_html"><div class="ttname"><a href="clientStream_8h.html">clientStream.h</a></div></div>
<div class="ttc" id="aclient__side_8cc_html_a543c6b42543c68733190d18e2a933a58"><div class="ttname"><a href="client__side_8cc.html#a543c6b42543c68733190d18e2a933a58">clientProcessRequest</a></div><div class="ttdeci">void clientProcessRequest(ConnStateData *conn, const Http1::RequestParserPointer &amp;hp, Http::Stream *context)</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l01568">client_side.cc:1568</a></div></div>
<div class="ttc" id="aclient__side_8cc_html_aa598a3822a54b412815630007ed6982b"><div class="ttname"><a href="client__side_8cc.html#aa598a3822a54b412815630007ed6982b">clientSetKeepaliveFlag</a></div><div class="ttdeci">void clientSetKeepaliveFlag(ClientHttpRequest *http)</div><div class="ttdoc">decide whether to expect multiple requests on the corresponding connection</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l00674">client_side.cc:674</a></div></div>
<div class="ttc" id="aclient__side_8cc_html_ad4b535b12e4c55b5763c6644d0e40a6e"><div class="ttname"><a href="client__side_8cc.html#ad4b535b12e4c55b5763c6644d0e40a6e">clientStartListeningOn</a></div><div class="ttdeci">void clientStartListeningOn(AnyP::PortCfgPointer &amp;port, const RefCount&lt; CommCbFunPtrCallT&lt; CommAcceptCbPtrFun &gt; &gt; &amp;subCall, const Ipc::FdNoteId fdNote)</div><div class="ttdoc">accept requests to a given port and inform subCall about them</div><div class="ttdef"><b>Definition</b> <a href="client__side_8cc_source.html#l03293">client_side.cc:3293</a></div></div>
<div class="ttc" id="aclient__side_8h_html_a2800047b5d0d3e31d1739cd35378f4ab"><div class="ttname"><a href="client__side_8h.html#a2800047b5d0d3e31d1739cd35378f4ab">clientSocketDetach</a></div><div class="ttdeci">CSD clientSocketDetach</div><div class="ttdef"><b>Definition</b> <a href="client__side_8h_source.html#l00533">client_side.h:533</a></div></div>
<div class="ttc" id="aclient__side_8h_html_a3d42a7ece901f14e6ec973a0feb096e1"><div class="ttname"><a href="client__side_8h.html#a3d42a7ece901f14e6ec973a0feb096e1">clientReplyStatus</a></div><div class="ttdeci">CSS clientReplyStatus</div><div class="ttdef"><b>Definition</b> <a href="client__side_8h_source.html#l00530">client_side.h:530</a></div></div>
<div class="ttc" id="aclient__side_8h_html_aa4068f99f4e406110e3f13bfe5904a93"><div class="ttname"><a href="client__side_8h.html#aa4068f99f4e406110e3f13bfe5904a93">clientSocketRecipient</a></div><div class="ttdeci">CSCB clientSocketRecipient</div><div class="ttdef"><b>Definition</b> <a href="client__side_8h_source.html#l00532">client_side.h:532</a></div></div>
<div class="ttc" id="aclient__side_8h_html_ab806362f706a7b39732957bb45e3c2df"><div class="ttname"><a href="client__side_8h.html#ab806362f706a7b39732957bb45e3c2df">clientReplyDetach</a></div><div class="ttdeci">CSD clientReplyDetach</div><div class="ttdef"><b>Definition</b> <a href="client__side_8h_source.html#l00531">client_side.h:531</a></div></div>
<div class="ttc" id="aclient__side_8h_html_ae73f7b10b6c2bd55c5f96c9d62839e8d"><div class="ttname"><a href="client__side_8h.html#ae73f7b10b6c2bd55c5f96c9d62839e8d">clientGetMoreData</a></div><div class="ttdeci">CSR clientGetMoreData</div><div class="ttdef"><b>Definition</b> <a href="client__side_8h_source.html#l00529">client_side.h:529</a></div></div>
<div class="ttc" id="aclient__side__reply_8h_html"><div class="ttname"><a href="client__side__reply_8h.html">client_side_reply.h</a></div></div>
<div class="ttc" id="aclient__side__request_8h_html"><div class="ttname"><a href="client__side__request_8h.html">client_side_request.h</a></div></div>
<div class="ttc" id="acomm_8cc_html_a1c9ec1883ab8ef62d500741ddce94afa"><div class="ttname"><a href="comm_8cc.html#a1c9ec1883ab8ef62d500741ddce94afa">comm_local_port</a></div><div class="ttdeci">unsigned short comm_local_port(int fd)</div><div class="ttdef"><b>Definition</b> <a href="comm_8cc_source.html#l00167">comm.cc:167</a></div></div>
<div class="ttc" id="acomm_8cc_html_a779138fc791bf0190157d0fb368fb790"><div class="ttname"><a href="comm_8cc.html#a779138fc791bf0190157d0fb368fb790">comm_open_listener</a></div><div class="ttdeci">void comm_open_listener(int sock_type, int proto, Comm::ConnectionPointer &amp;conn, const char *note)</div><div class="ttdef"><b>Definition</b> <a href="comm_8cc_source.html#l00259">comm.cc:259</a></div></div>
<div class="ttc" id="acomm_8cc_html_a8464d2ca5f1d7e8046880d95fe30873a"><div class="ttname"><a href="comm_8cc.html#a8464d2ca5f1d7e8046880d95fe30873a">isOpen</a></div><div class="ttdeci">bool isOpen(const int fd)</div><div class="ttdef"><b>Definition</b> <a href="comm_8cc_source.html#l00091">comm.cc:91</a></div></div>
<div class="ttc" id="acompat__shared_8h_html_ae39b16594fa61c8ddac14be4cce249cd"><div class="ttname"><a href="compat__shared_8h.html#ae39b16594fa61c8ddac14be4cce249cd">min</a></div><div class="ttdeci">A const &amp; min(A const &amp;lhs, A const &amp;rhs)</div><div class="ttdef"><b>Definition</b> <a href="compat__shared_8h_source.html#l00103">compat_shared.h:103</a></div></div>
<div class="ttc" id="adebug_2Stream_8h_html_ad1f6f001d275799243ee96d0b1519d3a"><div class="ttname"><a href="debug_2Stream_8h.html#ad1f6f001d275799243ee96d0b1519d3a">DBG_IMPORTANT</a></div><div class="ttdeci">#define DBG_IMPORTANT</div><div class="ttdef"><b>Definition</b> <a href="debug_2Stream_8h_source.html#l00038">Stream.h:38</a></div></div>
<div class="ttc" id="adebug_2Stream_8h_html_ad8cd33a7d75c0efd4d3fd369dc6a8f13"><div class="ttname"><a href="debug_2Stream_8h.html#ad8cd33a7d75c0efd4d3fd369dc6a8f13">debugs</a></div><div class="ttdeci">#define debugs(SECTION, LEVEL, CONTENT)</div><div class="ttdef"><b>Definition</b> <a href="debug_2Stream_8h_source.html#l00192">Stream.h:192</a></div></div>
<div class="ttc" id="adebug_2Stream_8h_html_af0ecf487aee4d8ff164c0f40e71c5150"><div class="ttname"><a href="debug_2Stream_8h.html#af0ecf487aee4d8ff164c0f40e71c5150">DBG_CRITICAL</a></div><div class="ttdeci">#define DBG_CRITICAL</div><div class="ttdef"><b>Definition</b> <a href="debug_2Stream_8h_source.html#l00037">Stream.h:37</a></div></div>
<div class="ttc" id="aeDirectory_2ldap__backend_8cc_html_a63c89c04d1feae07ca35558055155ffb"><div class="ttname"><a href="eDirectory_2ldap__backend_8cc.html#a63c89c04d1feae07ca35558055155ffb">port</a></div><div class="ttdeci">static int port</div><div class="ttdef"><b>Definition</b> <a href="eDirectory_2ldap__backend_8cc_source.html#l00070">ldap_backend.cc:70</a></div></div>
<div class="ttc" id="aenums_8h_html_ad7d12a8ac0392194bda3900e7f4f876b"><div class="ttname"><a href="enums_8h.html#ad7d12a8ac0392194bda3900e7f4f876b">clientStream_status_t</a></div><div class="ttdeci">clientStream_status_t</div><div class="ttdef"><b>Definition</b> <a href="enums_8h_source.html#l00120">enums.h:120</a></div></div>
<div class="ttc" id="aenums_8h_html_ad7d12a8ac0392194bda3900e7f4f876ba47cb242ab59c602b4398248aea577b19"><div class="ttname"><a href="enums_8h.html#ad7d12a8ac0392194bda3900e7f4f876ba47cb242ab59c602b4398248aea577b19">STREAM_COMPLETE</a></div><div class="ttdeci">@ STREAM_COMPLETE</div><div class="ttdef"><b>Definition</b> <a href="enums_8h_source.html#l00122">enums.h:122</a></div></div>
<div class="ttc" id="aenums_8h_html_ad7d12a8ac0392194bda3900e7f4f876ba94d16363b82ec2278002d78080a8cb44"><div class="ttname"><a href="enums_8h.html#ad7d12a8ac0392194bda3900e7f4f876ba94d16363b82ec2278002d78080a8cb44">STREAM_UNPLANNED_COMPLETE</a></div><div class="ttdeci">@ STREAM_UNPLANNED_COMPLETE</div><div class="ttdef"><b>Definition</b> <a href="enums_8h_source.html#l00127">enums.h:127</a></div></div>
<div class="ttc" id="aenums_8h_html_ad7d12a8ac0392194bda3900e7f4f876baafdb40c0b7683e2fd31711c386833017"><div class="ttname"><a href="enums_8h.html#ad7d12a8ac0392194bda3900e7f4f876baafdb40c0b7683e2fd31711c386833017">STREAM_NONE</a></div><div class="ttdeci">@ STREAM_NONE</div><div class="ttdef"><b>Definition</b> <a href="enums_8h_source.html#l00121">enums.h:121</a></div></div>
<div class="ttc" id="aenums_8h_html_ad7d12a8ac0392194bda3900e7f4f876bae425b0891f7f866775009972cae49d71"><div class="ttname"><a href="enums_8h.html#ad7d12a8ac0392194bda3900e7f4f876bae425b0891f7f866775009972cae49d71">STREAM_FAILED</a></div><div class="ttdeci">@ STREAM_FAILED</div><div class="ttdef"><b>Definition</b> <a href="enums_8h_source.html#l00133">enums.h:132</a></div></div>
<div class="ttc" id="aerrorpage_8h_html"><div class="ttname"><a href="errorpage_8h.html">errorpage.h</a></div></div>
<div class="ttc" id="afatal_8cc_html_ab64d40563aeeae7c01b72bea4c3ed032"><div class="ttname"><a href="fatal_8cc.html#ab64d40563aeeae7c01b72bea4c3ed032">fatal</a></div><div class="ttdeci">void fatal(const char *message)</div><div class="ttdef"><b>Definition</b> <a href="fatal_8cc_source.html#l00028">fatal.cc:28</a></div></div>
<div class="ttc" id="afd_8cc_html_a397dc4e5e5cf728d8f1a48b32cb4e60d"><div class="ttname"><a href="fd_8cc.html#a397dc4e5e5cf728d8f1a48b32cb4e60d">fd_note</a></div><div class="ttdeci">void fd_note(int fd, const char *s)</div><div class="ttdef"><b>Definition</b> <a href="fd_8cc_source.html#l00211">fd.cc:211</a></div></div>
<div class="ttc" id="afd_8h_html"><div class="ttname"><a href="fd_8h.html">fd.h</a></div></div>
<div class="ttc" id="aftp_2Elements_8h_html"><div class="ttname"><a href="ftp_2Elements_8h.html">Elements.h</a></div></div>
<div class="ttc" id="aftp_2Parsing_8h_html"><div class="ttname"><a href="ftp_2Parsing_8h.html">Parsing.h</a></div></div>
<div class="ttc" id="aglobals_8h_html"><div class="ttname"><a href="globals_8h.html">globals.h</a></div></div>
<div class="ttc" id="agroup__ClientStreamInternal_html_ga73019262f28c27affc3937cac3441a43"><div class="ttname"><a href="group__ClientStreamInternal.html#ga73019262f28c27affc3937cac3441a43">clientStreamInit</a></div><div class="ttdeci">void clientStreamInit(dlink_list *list, CSR *func, CSD *rdetach, CSS *readstatus, const ClientStreamData &amp;readdata, CSCB *callback, CSD *cdetach, const ClientStreamData &amp;callbackdata, StoreIOBuffer tailBuffer)</div><div class="ttdef"><b>Definition</b> <a href="clientStream_8cc_source.html#l00112">clientStream.cc:112</a></div></div>
<div class="ttc" id="agroup__ErrorPageInternal_html_ga02b38d00f8473e0b4ab6df245f882639"><div class="ttname"><a href="group__ErrorPageInternal.html#ga02b38d00f8473e0b4ab6df245f882639">errorPageName</a></div><div class="ttdeci">const char * errorPageName(int pageId)</div><div class="ttdoc">error ID to string</div><div class="ttdef"><b>Definition</b> <a href="errorpage_8cc_source.html#l00669">errorpage.cc:669</a></div></div>
<div class="ttc" id="ahttp_2Stream_8h_html"><div class="ttname"><a href="http_2Stream_8h.html">Stream.h</a></div></div>
<div class="ttc" id="ahttp_2forward_8h_html_a196f6d12d102aebcc7a2778bea3e6b19"><div class="ttname"><a href="http_2forward_8h.html#a196f6d12d102aebcc7a2778bea3e6b19">HTTP_REQBUF_SZ</a></div><div class="ttdeci">#define HTTP_REQBUF_SZ</div><div class="ttdef"><b>Definition</b> <a href="http_2forward_8h_source.html#l00014">forward.h:14</a></div></div>
<div class="ttc" id="aip_2forward_8h_html_a28806a9f06b4d32dab73b27053f10494"><div class="ttname"><a href="ip_2forward_8h.html#a28806a9f06b4d32dab73b27053f10494">MAX_IPSTRLEN</a></div><div class="ttdeci">#define MAX_IPSTRLEN</div><div class="ttdoc">Length of buffer that needs to be allocated to old a null-terminated IP-string.</div><div class="ttdef"><b>Definition</b> <a href="ip_2forward_8h_source.html#l00025">forward.h:25</a></div></div>
<div class="ttc" id="aip_2tools_8h_html"><div class="ttname"><a href="ip_2tools_8h.html">tools.h</a></div></div>
<div class="ttc" id="anamespaceComm_html_a24de01312960dba5c38466509cadb831"><div class="ttname"><a href="namespaceComm.html#a24de01312960dba5c38466509cadb831">Comm::ReadCancel</a></div><div class="ttdeci">void ReadCancel(int fd, AsyncCall::Pointer &amp;callback)</div><div class="ttdoc">Cancel the read pending on FD. No action if none pending.</div><div class="ttdef"><b>Definition</b> <a href="Read_8cc_source.html#l00219">Read.cc:219</a></div></div>
<div class="ttc" id="anamespaceComm_html_a91f0a0e22e74a7ad6f7c44c137c6f005"><div class="ttname"><a href="namespaceComm.html#a91f0a0e22e74a7ad6f7c44c137c6f005">Comm::IsConnOpen</a></div><div class="ttdeci">bool IsConnOpen(const Comm::ConnectionPointer &amp;conn)</div><div class="ttdef"><b>Definition</b> <a href="Connection_8cc_source.html#l00027">Connection.cc:27</a></div></div>
<div class="ttc" id="anamespaceComm_html_a96a9518a6c2c77d282a79f406e0252a9"><div class="ttname"><a href="namespaceComm.html#a96a9518a6c2c77d282a79f406e0252a9">Comm::Write</a></div><div class="ttdeci">void Write(const Comm::ConnectionPointer &amp;conn, const char *buf, int size, AsyncCall::Pointer &amp;callback, FREE *free_func)</div><div class="ttdef"><b>Definition</b> <a href="Write_8cc_source.html#l00033">Write.cc:33</a></div></div>
<div class="ttc" id="anamespaceComm_html_a9d8d4f4a5745b975c5785998e4246050a2d02cf4ed31f765e18f4d8474ede4e24"><div class="ttname"><a href="namespaceComm.html#a9d8d4f4a5745b975c5785998e4246050a2d02cf4ed31f765e18f4d8474ede4e24">Comm::OK</a></div><div class="ttdeci">@ OK</div><div class="ttdef"><b>Definition</b> <a href="Flag_8h_source.html#l00016">Flag.h:16</a></div></div>
<div class="ttc" id="anamespaceComm_html_a9d8d4f4a5745b975c5785998e4246050a884f9d58f0f131131497fa9ceefb3b3c"><div class="ttname"><a href="namespaceComm.html#a9d8d4f4a5745b975c5785998e4246050a884f9d58f0f131131497fa9ceefb3b3c">Comm::ERR_CLOSING</a></div><div class="ttdeci">@ ERR_CLOSING</div><div class="ttdef"><b>Definition</b> <a href="Flag_8h_source.html#l00024">Flag.h:24</a></div></div>
<div class="ttc" id="anamespaceFtp_html"><div class="ttname"><a href="namespaceFtp.html">Ftp</a></div><div class="ttdef"><b>Definition</b> <a href="clients_2forward_8h_source.html#l00023">forward.h:24</a></div></div>
<div class="ttc" id="anamespaceFtp_html_a14f2935b10878a54a2cc5e6621b3e946"><div class="ttname"><a href="namespaceFtp.html#a14f2935b10878a54a2cc5e6621b3e946">Ftp::SupportedCommand</a></div><div class="ttdeci">static bool SupportedCommand(const SBuf &amp;name)</div><div class="ttdoc">Whether Squid FTP Relay supports a named feature (e.g., a command).</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l01842">FtpServer.cc:1842</a></div></div>
<div class="ttc" id="anamespaceFtp_html_a1a99fa3e836e0d5c97e88d241976f1bd"><div class="ttname"><a href="namespaceFtp.html#a1a99fa3e836e0d5c97e88d241976f1bd">Ftp::cmdAppe</a></div><div class="ttdeci">const SBuf &amp; cmdAppe()</div><div class="ttdef"><b>Definition</b> <a href="ftp_2Elements_8cc_source.html#l00056">Elements.cc:56</a></div></div>
<div class="ttc" id="anamespaceFtp_html_a249e9fd7ca0e728fa3cfeee3342d2108"><div class="ttname"><a href="namespaceFtp.html#a249e9fd7ca0e728fa3cfeee3342d2108">Ftp::ProtocolVersion</a></div><div class="ttdeci">AnyP::ProtocolVersion ProtocolVersion()</div><div class="ttdoc">Protocol version to use in Http::Message structures wrapping FTP messages.</div><div class="ttdef"><b>Definition</b> <a href="ftp_2Elements_8cc_source.html#l00024">Elements.cc:24</a></div></div>
<div class="ttc" id="anamespaceFtp_html_a36fae0a62f51adc56e257b784481bc42"><div class="ttname"><a href="namespaceFtp.html#a36fae0a62f51adc56e257b784481bc42">Ftp::ParseProtoIpPort</a></div><div class="ttdeci">bool ParseProtoIpPort(const char *buf, Ip::Address &amp;addr)</div><div class="ttdef"><b>Definition</b> <a href="ftp_2Parsing_8cc_source.html#l00052">Parsing.cc:52</a></div></div>
<div class="ttc" id="anamespaceFtp_html_a3872491626f8faa65590d1f3e8ec8ef3"><div class="ttname"><a href="namespaceFtp.html#a3872491626f8faa65590d1f3e8ec8ef3">Ftp::cmdDele</a></div><div class="ttdeci">const SBuf &amp; cmdDele()</div><div class="ttdef"><b>Definition</b> <a href="ftp_2Elements_8cc_source.html#l00077">Elements.cc:77</a></div></div>
<div class="ttc" id="anamespaceFtp_html_a42edcb3767e7fdd8e3e7742ca5d7f7a2"><div class="ttname"><a href="namespaceFtp.html#a42edcb3767e7fdd8e3e7742ca5d7f7a2">Ftp::cmdEpsv</a></div><div class="ttdeci">const SBuf &amp; cmdEpsv()</div><div class="ttdef"><b>Definition</b> <a href="ftp_2Elements_8cc_source.html#l00091">Elements.cc:91</a></div></div>
<div class="ttc" id="anamespaceFtp_html_a49fa2e886422a3246c0ffe8cae3138dd"><div class="ttname"><a href="namespaceFtp.html#a49fa2e886422a3246c0ffe8cae3138dd">Ftp::cmdSmnt</a></div><div class="ttdeci">const SBuf &amp; cmdSmnt()</div><div class="ttdef"><b>Definition</b> <a href="ftp_2Elements_8cc_source.html#l00161">Elements.cc:161</a></div></div>
<div class="ttc" id="anamespaceFtp_html_a53508f6345902671b349430ab26916d5"><div class="ttname"><a href="namespaceFtp.html#a53508f6345902671b349430ab26916d5">Ftp::cmdStou</a></div><div class="ttdeci">const SBuf &amp; cmdStou()</div><div class="ttdef"><b>Definition</b> <a href="ftp_2Elements_8cc_source.html#l00182">Elements.cc:182</a></div></div>
<div class="ttc" id="anamespaceFtp_html_a56abcf0499ca5d50f20f9ce02525124e"><div class="ttname"><a href="namespaceFtp.html#a56abcf0499ca5d50f20f9ce02525124e">Ftp::ServerState</a></div><div class="ttdeci">ServerState</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8h_source.html#l00023">FtpServer.h:23</a></div></div>
<div class="ttc" id="anamespaceFtp_html_a56abcf0499ca5d50f20f9ce02525124ea21ec8308de0a2e68cac20118053ea9f5"><div class="ttname"><a href="namespaceFtp.html#a56abcf0499ca5d50f20f9ce02525124ea21ec8308de0a2e68cac20118053ea9f5">Ftp::fssError</a></div><div class="ttdeci">@ fssError</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8h_source.html#l00037">FtpServer.h:36</a></div></div>
<div class="ttc" id="anamespaceFtp_html_a56abcf0499ca5d50f20f9ce02525124ea23e2e86967790b10336094bc42125c6a"><div class="ttname"><a href="namespaceFtp.html#a56abcf0499ca5d50f20f9ce02525124ea23e2e86967790b10336094bc42125c6a">Ftp::fssHandlePort</a></div><div class="ttdeci">@ fssHandlePort</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8h_source.html#l00028">FtpServer.h:28</a></div></div>
<div class="ttc" id="anamespaceFtp_html_a56abcf0499ca5d50f20f9ce02525124ea3e2ae24438de9cc3285c777b31770207"><div class="ttname"><a href="namespaceFtp.html#a56abcf0499ca5d50f20f9ce02525124ea3e2ae24438de9cc3285c777b31770207">Ftp::fssHandleCdup</a></div><div class="ttdeci">@ fssHandleCdup</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8h_source.html#l00035">FtpServer.h:35</a></div></div>
<div class="ttc" id="anamespaceFtp_html_a56abcf0499ca5d50f20f9ce02525124ea59743532d13f5dfe934cc252ff8ecc66"><div class="ttname"><a href="namespaceFtp.html#a56abcf0499ca5d50f20f9ce02525124ea59743532d13f5dfe934cc252ff8ecc66">Ftp::fssHandleFeat</a></div><div class="ttdeci">@ fssHandleFeat</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8h_source.html#l00026">FtpServer.h:26</a></div></div>
<div class="ttc" id="anamespaceFtp_html_a56abcf0499ca5d50f20f9ce02525124ea7378f2a8f0588290c152b47b9739074a"><div class="ttname"><a href="namespaceFtp.html#a56abcf0499ca5d50f20f9ce02525124ea7378f2a8f0588290c152b47b9739074a">Ftp::fssHandlePasv</a></div><div class="ttdeci">@ fssHandlePasv</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8h_source.html#l00027">FtpServer.h:27</a></div></div>
<div class="ttc" id="anamespaceFtp_html_a56abcf0499ca5d50f20f9ce02525124ea7e2cc430f38c6f6b294c50f94caced31"><div class="ttname"><a href="namespaceFtp.html#a56abcf0499ca5d50f20f9ce02525124ea7e2cc430f38c6f6b294c50f94caced31">Ftp::fssConnected</a></div><div class="ttdeci">@ fssConnected</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8h_source.html#l00025">FtpServer.h:25</a></div></div>
<div class="ttc" id="anamespaceFtp_html_a56abcf0499ca5d50f20f9ce02525124ea841ba4d12454bd93a03ecc1c931a87bf"><div class="ttname"><a href="namespaceFtp.html#a56abcf0499ca5d50f20f9ce02525124ea841ba4d12454bd93a03ecc1c931a87bf">Ftp::fssHandleEprt</a></div><div class="ttdeci">@ fssHandleEprt</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8h_source.html#l00031">FtpServer.h:31</a></div></div>
<div class="ttc" id="anamespaceFtp_html_a56abcf0499ca5d50f20f9ce02525124ea8be1a0f8f031b0b6edc50539aec2b57c"><div class="ttname"><a href="namespaceFtp.html#a56abcf0499ca5d50f20f9ce02525124ea8be1a0f8f031b0b6edc50539aec2b57c">Ftp::fssHandleCwd</a></div><div class="ttdeci">@ fssHandleCwd</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8h_source.html#l00033">FtpServer.h:33</a></div></div>
<div class="ttc" id="anamespaceFtp_html_a56abcf0499ca5d50f20f9ce02525124ea8edceb8ceb3bb91af0797b9ac75945c3"><div class="ttname"><a href="namespaceFtp.html#a56abcf0499ca5d50f20f9ce02525124ea8edceb8ceb3bb91af0797b9ac75945c3">Ftp::fssHandlePass</a></div><div class="ttdeci">@ fssHandlePass</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8h_source.html#l00034">FtpServer.h:34</a></div></div>
<div class="ttc" id="anamespaceFtp_html_a56abcf0499ca5d50f20f9ce02525124eaaf7ccbf3756c082cf11222ec601913a8"><div class="ttname"><a href="namespaceFtp.html#a56abcf0499ca5d50f20f9ce02525124eaaf7ccbf3756c082cf11222ec601913a8">Ftp::fssHandleUploadRequest</a></div><div class="ttdeci">@ fssHandleUploadRequest</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8h_source.html#l00030">FtpServer.h:30</a></div></div>
<div class="ttc" id="anamespaceFtp_html_a56abcf0499ca5d50f20f9ce02525124eab7bb00cd04b240b0fc4554117f7d226b"><div class="ttname"><a href="namespaceFtp.html#a56abcf0499ca5d50f20f9ce02525124eab7bb00cd04b240b0fc4554117f7d226b">Ftp::fssBegin</a></div><div class="ttdeci">@ fssBegin</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8h_source.html#l00024">FtpServer.h:24</a></div></div>
<div class="ttc" id="anamespaceFtp_html_a56abcf0499ca5d50f20f9ce02525124eace00ce9091de95a55b3226621e66fb68"><div class="ttname"><a href="namespaceFtp.html#a56abcf0499ca5d50f20f9ce02525124eace00ce9091de95a55b3226621e66fb68">Ftp::fssHandleEpsv</a></div><div class="ttdeci">@ fssHandleEpsv</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8h_source.html#l00032">FtpServer.h:32</a></div></div>
<div class="ttc" id="anamespaceFtp_html_a56abcf0499ca5d50f20f9ce02525124eaf385076cc145cc42c7248f5b24d05c13"><div class="ttname"><a href="namespaceFtp.html#a56abcf0499ca5d50f20f9ce02525124eaf385076cc145cc42c7248f5b24d05c13">Ftp::fssHandleDataRequest</a></div><div class="ttdeci">@ fssHandleDataRequest</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8h_source.html#l00029">FtpServer.h:29</a></div></div>
<div class="ttc" id="anamespaceFtp_html_a603e2df6ab8dad0f4b40a86bbfd2e411"><div class="ttname"><a href="namespaceFtp.html#a603e2df6ab8dad0f4b40a86bbfd2e411">Ftp::cmdStor</a></div><div class="ttdeci">const SBuf &amp; cmdStor()</div><div class="ttdef"><b>Definition</b> <a href="ftp_2Elements_8cc_source.html#l00175">Elements.cc:175</a></div></div>
<div class="ttc" id="anamespaceFtp_html_a6a14ded9bed8494db4e66daee70f1db2"><div class="ttname"><a href="namespaceFtp.html#a6a14ded9bed8494db4e66daee70f1db2">Ftp::cmdMlsd</a></div><div class="ttdeci">const SBuf &amp; cmdMlsd()</div><div class="ttdef"><b>Definition</b> <a href="ftp_2Elements_8cc_source.html#l00112">Elements.cc:112</a></div></div>
<div class="ttc" id="anamespaceFtp_html_a766fc1c345a87ac051e948e05571f00c"><div class="ttname"><a href="namespaceFtp.html#a766fc1c345a87ac051e948e05571f00c">Ftp::cmdList</a></div><div class="ttdeci">const SBuf &amp; cmdList()</div><div class="ttdef"><b>Definition</b> <a href="ftp_2Elements_8cc_source.html#l00098">Elements.cc:98</a></div></div>
<div class="ttc" id="anamespaceFtp_html_a80fba0aae7827e3cfde9f23944d2fb11"><div class="ttname"><a href="namespaceFtp.html#a80fba0aae7827e3cfde9f23944d2fb11">Ftp::cmdRetr</a></div><div class="ttdeci">const SBuf &amp; cmdRetr()</div><div class="ttdef"><b>Definition</b> <a href="ftp_2Elements_8cc_source.html#l00133">Elements.cc:133</a></div></div>
<div class="ttc" id="anamespaceFtp_html_a864c4520d3d763f009c14f508f77e079"><div class="ttname"><a href="namespaceFtp.html#a864c4520d3d763f009c14f508f77e079">Ftp::cmdNlst</a></div><div class="ttdeci">const SBuf &amp; cmdNlst()</div><div class="ttdef"><b>Definition</b> <a href="ftp_2Elements_8cc_source.html#l00126">Elements.cc:126</a></div></div>
<div class="ttc" id="anamespaceFtp_html_a87996da5ee785620cd35472f3652696a"><div class="ttname"><a href="namespaceFtp.html#a87996da5ee785620cd35472f3652696a">Ftp::cmdMlst</a></div><div class="ttdeci">const SBuf &amp; cmdMlst()</div><div class="ttdef"><b>Definition</b> <a href="ftp_2Elements_8cc_source.html#l00119">Elements.cc:119</a></div></div>
<div class="ttc" id="anamespaceFtp_html_a8cd7e00904c95411d852ea9d1f73c455"><div class="ttname"><a href="namespaceFtp.html#a8cd7e00904c95411d852ea9d1f73c455">Ftp::cmdStat</a></div><div class="ttdeci">const SBuf &amp; cmdStat()</div><div class="ttdef"><b>Definition</b> <a href="ftp_2Elements_8cc_source.html#l00168">Elements.cc:168</a></div></div>
<div class="ttc" id="anamespaceFtp_html_a910f99db5e91bb78320ec141a625f114"><div class="ttname"><a href="namespaceFtp.html#a910f99db5e91bb78320ec141a625f114">Ftp::cmdAuth</a></div><div class="ttdeci">const SBuf &amp; cmdAuth()</div><div class="ttdef"><b>Definition</b> <a href="ftp_2Elements_8cc_source.html#l00063">Elements.cc:63</a></div></div>
<div class="ttc" id="anamespaceFtp_html_a970f9156aff8feb9e9642c20c5fab8b8"><div class="ttname"><a href="namespaceFtp.html#a970f9156aff8feb9e9642c20c5fab8b8">Ftp::CommandHasPathParameter</a></div><div class="ttdeci">static bool CommandHasPathParameter(const SBuf &amp;cmd)</div><div class="ttdoc">whether the given FTP command has a pathname parameter</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l00544">FtpServer.cc:544</a></div></div>
<div class="ttc" id="anamespaceFtp_html_aa0567d127f548a51c718347e21b1d477"><div class="ttname"><a href="namespaceFtp.html#aa0567d127f548a51c718347e21b1d477">Ftp::cmdCwd</a></div><div class="ttdeci">const SBuf &amp; cmdCwd()</div><div class="ttdef"><b>Definition</b> <a href="ftp_2Elements_8cc_source.html#l00070">Elements.cc:70</a></div></div>
<div class="ttc" id="anamespaceFtp_html_aa3555ce6316b7b57660f3e89f35ea8a9"><div class="ttname"><a href="namespaceFtp.html#aa3555ce6316b7b57660f3e89f35ea8a9">Ftp::ParseIpPort</a></div><div class="ttdeci">bool ParseIpPort(const char *buf, const char *forceIp, Ip::Address &amp;addr)</div><div class="ttdoc">parses and validates &quot;A1,A2,A3,A4,P1,P2&quot; IP,port sequence</div><div class="ttdef"><b>Definition</b> <a href="ftp_2Parsing_8cc_source.html#l00018">Parsing.cc:18</a></div></div>
<div class="ttc" id="anamespaceFtp_html_aaa24147f4a5f2761ce9117f19e706da4"><div class="ttname"><a href="namespaceFtp.html#aaa24147f4a5f2761ce9117f19e706da4">Ftp::cmdEprt</a></div><div class="ttdeci">const SBuf &amp; cmdEprt()</div><div class="ttdef"><b>Definition</b> <a href="ftp_2Elements_8cc_source.html#l00084">Elements.cc:84</a></div></div>
<div class="ttc" id="anamespaceFtp_html_ab6a0942e483ea32aa3731bcd223deade"><div class="ttname"><a href="namespaceFtp.html#ab6a0942e483ea32aa3731bcd223deade">Ftp::cmdRnto</a></div><div class="ttdeci">const SBuf &amp; cmdRnto()</div><div class="ttdef"><b>Definition</b> <a href="ftp_2Elements_8cc_source.html#l00154">Elements.cc:154</a></div></div>
<div class="ttc" id="anamespaceFtp_html_ab97a258f68a87139b5f64f777764a4ad"><div class="ttname"><a href="namespaceFtp.html#ab97a258f68a87139b5f64f777764a4ad">Ftp::cmdMkd</a></div><div class="ttdeci">const SBuf &amp; cmdMkd()</div><div class="ttdef"><b>Definition</b> <a href="ftp_2Elements_8cc_source.html#l00105">Elements.cc:105</a></div></div>
<div class="ttc" id="anamespaceFtp_html_ac55a50b808dcd5c95c9f5ebfe6628128"><div class="ttname"><a href="namespaceFtp.html#ac55a50b808dcd5c95c9f5ebfe6628128">Ftp::cmdUser</a></div><div class="ttdeci">const SBuf &amp; cmdUser()</div><div class="ttdef"><b>Definition</b> <a href="ftp_2Elements_8cc_source.html#l00189">Elements.cc:189</a></div></div>
<div class="ttc" id="anamespaceFtp_html_ac99540d79350b5eec3729725a8a52a55"><div class="ttname"><a href="namespaceFtp.html#ac99540d79350b5eec3729725a8a52a55">Ftp::HttpReplyWrapper</a></div><div class="ttdeci">HttpReply * HttpReplyWrapper(const int ftpStatus, const char *ftpReason, const Http::StatusCode httpStatus, const int64_t clen)</div><div class="ttdoc">Create an internal HttpReply structure to house FTP control response info.</div><div class="ttdef"><b>Definition</b> <a href="ftp_2Elements_8cc_source.html#l00030">Elements.cc:30</a></div></div>
<div class="ttc" id="anamespaceFtp_html_ad0ba09ef50b5d9dcf0ac56bb87e879a6"><div class="ttname"><a href="namespaceFtp.html#ad0ba09ef50b5d9dcf0ac56bb87e879a6">Ftp::cmdRnfr</a></div><div class="ttdeci">const SBuf &amp; cmdRnfr()</div><div class="ttdef"><b>Definition</b> <a href="ftp_2Elements_8cc_source.html#l00147">Elements.cc:147</a></div></div>
<div class="ttc" id="anamespaceFtp_html_adf377404cef36010cd7e17ec7b5a8a87"><div class="ttname"><a href="namespaceFtp.html#adf377404cef36010cd7e17ec7b5a8a87">Ftp::StopListening</a></div><div class="ttdeci">void StopListening()</div><div class="ttdoc">reject new connections to any configured ftp_port</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l00287">FtpServer.cc:287</a></div></div>
<div class="ttc" id="anamespaceFtp_html_ae2b3b88ec5c7af470746a1658d7434f3"><div class="ttname"><a href="namespaceFtp.html#ae2b3b88ec5c7af470746a1658d7434f3">Ftp::StartListening</a></div><div class="ttdeci">void StartListening()</div><div class="ttdoc">accept connections on all configured ftp_ports</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l00265">FtpServer.cc:265</a></div></div>
<div class="ttc" id="anamespaceFtp_html_aee082b8b0ceeb30bc8ae847d7d770d69"><div class="ttname"><a href="namespaceFtp.html#aee082b8b0ceeb30bc8ae847d7d770d69">Ftp::cmdRmd</a></div><div class="ttdeci">const SBuf &amp; cmdRmd()</div><div class="ttdef"><b>Definition</b> <a href="ftp_2Elements_8cc_source.html#l00140">Elements.cc:140</a></div></div>
<div class="ttc" id="anamespaceFtp_html_afbe492e82e3511179f2af6c59c2eb5b8"><div class="ttname"><a href="namespaceFtp.html#afbe492e82e3511179f2af6c59c2eb5b8">Ftp::PrintReply</a></div><div class="ttdeci">static void PrintReply(MemBuf &amp;mb, const HttpReply *reply, const char *const prefix=&quot;&quot;)</div><div class="ttdef"><b>Definition</b> <a href="FtpServer_8cc_source.html#l01213">FtpServer.cc:1213</a></div></div>
<div class="ttc" id="anamespaceHttp_html_a432f881deb187c726161d6435daec722a74568860e1daf616488c945a9b3d4416"><div class="ttname"><a href="namespaceHttp.html#a432f881deb187c726161d6435daec722a74568860e1daf616488c945a9b3d4416">Http::scBadRequest</a></div><div class="ttdeci">@ scBadRequest</div><div class="ttdef"><b>Definition</b> <a href="StatusCode_8h_source.html#l00045">StatusCode.h:45</a></div></div>
<div class="ttc" id="anamespaceHttp_html_a432f881deb187c726161d6435daec722aad8d279f381aa192a9f4389158d1b25e"><div class="ttname"><a href="namespaceHttp.html#a432f881deb187c726161d6435daec722aad8d279f381aa192a9f4389158d1b25e">Http::scOkay</a></div><div class="ttdeci">@ scOkay</div><div class="ttdef"><b>Definition</b> <a href="StatusCode_8h_source.html#l00027">StatusCode.h:27</a></div></div>
<div class="ttc" id="anamespaceHttp_html_a432f881deb187c726161d6435daec722ab95a10cc149f601422b96a56b2acf1f7"><div class="ttname"><a href="namespaceHttp.html#a432f881deb187c726161d6435daec722ab95a10cc149f601422b96a56b2acf1f7">Http::scNoContent</a></div><div class="ttdeci">@ scNoContent</div><div class="ttdef"><b>Definition</b> <a href="StatusCode_8h_source.html#l00031">StatusCode.h:31</a></div></div>
<div class="ttc" id="anamespaceHttp_html_a84eb275fbe86f9dcc2a0ce9164a60787a3eff063fbded3d15e4cea500e09c2de3"><div class="ttname"><a href="namespaceHttp.html#a84eb275fbe86f9dcc2a0ce9164a60787a3eff063fbded3d15e4cea500e09c2de3">Http::METHOD_PUT</a></div><div class="ttdeci">@ METHOD_PUT</div><div class="ttdef"><b>Definition</b> <a href="MethodType_8h_source.html#l00027">MethodType.h:27</a></div></div>
<div class="ttc" id="anamespaceHttp_html_a84eb275fbe86f9dcc2a0ce9164a60787abf0f2b96078c49aefdf7ab3ef183a5de"><div class="ttname"><a href="namespaceHttp.html#a84eb275fbe86f9dcc2a0ce9164a60787abf0f2b96078c49aefdf7ab3ef183a5de">Http::METHOD_GET</a></div><div class="ttdeci">@ METHOD_GET</div><div class="ttdef"><b>Definition</b> <a href="MethodType_8h_source.html#l00025">MethodType.h:25</a></div></div>
<div class="ttc" id="anamespaceHttp_html_a8f5de7a6ddd395e9aaf0dffd043c2276"><div class="ttname"><a href="namespaceHttp.html#a8f5de7a6ddd395e9aaf0dffd043c2276">Http::ProtocolVersion</a></div><div class="ttdeci">AnyP::ProtocolVersion ProtocolVersion()</div><div class="ttdef"><b>Definition</b> <a href="http_2ProtocolVersion_8h_source.html#l00032">ProtocolVersion.h:32</a></div></div>
<div class="ttc" id="anamespaceHttp_html_a92faa3c60e0b457c167759389ae061a4a09b6d21d0dfd00e8253d5c524fd848d4"><div class="ttname"><a href="namespaceHttp.html#a92faa3c60e0b457c167759389ae061a4a09b6d21d0dfd00e8253d5c524fd848d4">Http::FTP_PRE</a></div><div class="ttdeci">@ FTP_PRE</div><div class="ttdef"><b>Definition</b> <a href="RegisteredHeaders_8h_source.html#l00117">RegisteredHeaders.h:117</a></div></div>
<div class="ttc" id="anamespaceHttp_html_a92faa3c60e0b457c167759389ae061a4a441d11bb798c52af629374cdac708ffa"><div class="ttname"><a href="namespaceHttp.html#a92faa3c60e0b457c167759389ae061a4a441d11bb798c52af629374cdac708ffa">Http::FTP_STATUS</a></div><div class="ttdeci">@ FTP_STATUS</div><div class="ttdef"><b>Definition</b> <a href="RegisteredHeaders_8h_source.html#l00118">RegisteredHeaders.h:118</a></div></div>
<div class="ttc" id="anamespaceHttp_html_a92faa3c60e0b457c167759389ae061a4a51dab0b7ae28f45fb969fca664517f91"><div class="ttname"><a href="namespaceHttp.html#a92faa3c60e0b457c167759389ae061a4a51dab0b7ae28f45fb969fca664517f91">Http::EXPECT</a></div><div class="ttdeci">@ EXPECT</div><div class="ttdef"><b>Definition</b> <a href="RegisteredHeaders_8h_source.html#l00055">RegisteredHeaders.h:55</a></div></div>
<div class="ttc" id="anamespaceHttp_html_a92faa3c60e0b457c167759389ae061a4a99cab0d9e614ea5daec167ffc05839b1"><div class="ttname"><a href="namespaceHttp.html#a92faa3c60e0b457c167759389ae061a4a99cab0d9e614ea5daec167ffc05839b1">Http::FTP_REASON</a></div><div class="ttdeci">@ FTP_REASON</div><div class="ttdef"><b>Definition</b> <a href="RegisteredHeaders_8h_source.html#l00119">RegisteredHeaders.h:119</a></div></div>
<div class="ttc" id="anamespaceHttp_html_a92faa3c60e0b457c167759389ae061a4a9bdd18abe19a7e3517a6786ae7f15b44"><div class="ttname"><a href="namespaceHttp.html#a92faa3c60e0b457c167759389ae061a4a9bdd18abe19a7e3517a6786ae7f15b44">Http::FTP_COMMAND</a></div><div class="ttdeci">@ FTP_COMMAND</div><div class="ttdef"><b>Definition</b> <a href="RegisteredHeaders_8h_source.html#l00115">RegisteredHeaders.h:115</a></div></div>
<div class="ttc" id="anamespaceHttp_html_a92faa3c60e0b457c167759389ae061a4abf644a4ab3a498ed2854c3022837e8f9"><div class="ttname"><a href="namespaceHttp.html#a92faa3c60e0b457c167759389ae061a4abf644a4ab3a498ed2854c3022837e8f9">Http::TRANSFER_ENCODING</a></div><div class="ttdeci">@ TRANSFER_ENCODING</div><div class="ttdef"><b>Definition</b> <a href="RegisteredHeaders_8h_source.html#l00099">RegisteredHeaders.h:99</a></div></div>
<div class="ttc" id="anamespaceHttp_html_a92faa3c60e0b457c167759389ae061a4af9f4f70983e0f5ffa741f2a523f0eda3"><div class="ttname"><a href="namespaceHttp.html#a92faa3c60e0b457c167759389ae061a4af9f4f70983e0f5ffa741f2a523f0eda3">Http::FTP_ARGUMENTS</a></div><div class="ttdeci">@ FTP_ARGUMENTS</div><div class="ttdef"><b>Definition</b> <a href="RegisteredHeaders_8h_source.html#l00116">RegisteredHeaders.h:116</a></div></div>
<div class="ttc" id="anamespaceIpc_html_a08603c9424a847b7951bb043ed92c6d7a94a6de559e17ce534c152883d7b58663"><div class="ttname"><a href="namespaceIpc.html#a08603c9424a847b7951bb043ed92c6d7a94a6de559e17ce534c152883d7b58663">Ipc::fdnFtpSocket</a></div><div class="ttdeci">@ fdnFtpSocket</div><div class="ttdef"><b>Definition</b> <a href="FdNotes_8h_source.html#l00020">FdNotes.h:20</a></div></div>
<div class="ttc" id="anegotiate__wrapper_8cc_html_a5eb055ca3b42205cc134b4a438cd9a72"><div class="ttname"><a href="negotiate__wrapper_8cc.html#a5eb055ca3b42205cc134b4a438cd9a72">xstrdup</a></div><div class="ttdeci">#define xstrdup</div><div class="ttdef"><b>Definition</b> <a href="negotiate__wrapper_8cc_source.html#l00047">negotiate_wrapper.cc:47</a></div></div>
<div class="ttc" id="aparser_2Tokenizer_8h_html"><div class="ttname"><a href="parser_2Tokenizer_8h.html">Tokenizer.h</a></div></div>
<div class="ttc" id="aservers_2forward_8h_html"><div class="ttname"><a href="servers_2forward_8h.html">forward.h</a></div></div>
<div class="ttc" id="asquid_8h_html"><div class="ttname"><a href="squid_8h.html">squid.h</a></div></div>
<div class="ttc" id="astructnode_html"><div class="ttname"><a href="structnode.html">node</a></div><div class="ttdef"><b>Definition</b> <a href="parse_8c_source.html#l00104">parse.c:104</a></div></div>
<div class="ttc" id="astructtok_html"><div class="ttname"><a href="structtok.html">tok</a></div><div class="ttdef"><b>Definition</b> <a href="parse_8c_source.html#l00160">parse.c:160</a></div></div>
<div class="ttc" id="atools_8h_html"><div class="ttname"><a href="tools_8h.html">tools.h</a></div></div>
<div class="ttc" id="axstrerror_8cc_html_a3d643f764de4776e5489d4eb55a99849"><div class="ttname"><a href="xstrerror_8cc.html#a3d643f764de4776e5489d4eb55a99849">xstrerr</a></div><div class="ttdeci">const char * xstrerr(int error)</div><div class="ttdef"><b>Definition</b> <a href="xstrerror_8cc_source.html#l00083">xstrerror.cc:83</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_3c69fff7f634b97773a4d39d4565ffb4.html">squid</a></li><li class="navelem"><a class="el" href="dir_27a06220d184fcc3bd2c56b7794ae45b.html">src</a></li><li class="navelem"><a class="el" href="dir_f057117a2f0e37348bd4d58206e3ecb0.html">servers</a></li><li class="navelem"><a class="el" href="FtpServer_8cc.html">FtpServer.cc</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
